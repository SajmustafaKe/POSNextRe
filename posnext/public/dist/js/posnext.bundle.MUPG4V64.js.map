{
  "version": 3,
  "sources": ["../../../../../apps/posnext/node_modules/onscan.js/onscan.js", "../../../../../apps/posnext/posnext/public/js/pos_controller.js", "../../../../../apps/posnext/posnext/public/js/pos_item_selector.js", "../../../../../apps/posnext/posnext/public/js/pos_item_cart.js", "../../../../../apps/posnext/posnext/public/js/pos_item_details.js", "../../../../../apps/posnext/posnext/public/js/pos_number_pad.js", "../../../../../apps/posnext/posnext/public/js/pos_payment.js", "../../../../../apps/posnext/posnext/public/js/pos_past_order_list.js", "../../../../../apps/posnext/posnext/public/js/pos_past_order_summary.js", "../../../../../apps/posnext/posnext/public/js/pos_table_selector.js"],
  "sourcesContent": ["/*\n * onScan.js - scan-events for hardware barcodes scanners in javascript\n */\n;(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define(factory()) :\n    global.onScan = factory()\n}(this, (function () {\n\tvar onScan = {\t\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @param Object oOptions\n\t\t * @return self\n\t\t */\n\t\tattachTo: function(oDomElement, oOptions) {\n\t\n\t\t\tif(oDomElement.scannerDetectionData !== undefined){\n\t\t\t\tthrow new Error(\"onScan.js is already initialized for DOM element \" + oDomElement);\n\t\t\t}\n\t\n\t\t\tvar oDefaults = {\n\t\t\t\tonScan: function(sScanned, iQty){}, // Callback after detection of a successfull scanning:  function(){sScancode, iCount)}()\n\t\t\t\tonScanError: function(oDebug){}, // Callback after detection of a unsuccessfull scanning (scanned string in parameter)\n\t\t\t\tonKeyProcess: function(sChar, oEvent){}, // Callback after receiving and processing a char (scanned char in parameter)\n\t\t\t\tonKeyDetect: function(iKeyCode, oEvent){}, // Callback after detecting a keyDown (key char in parameter) - in contrast to onKeyProcess, this fires for non-character keys like tab, arrows, etc. too!\n\t\t\t\tonPaste: function(sPasted, oEvent){}, // Callback after receiving a value on paste, no matter if it is a valid code or not\n\t\t\t\tkeyCodeMapper: function(oEvent) {return onScan.decodeKeyEvent(oEvent)}, // Custom function to decode a keydown event into a character. Must return decoded character or NULL if the given event should not be processed.\n\t\t\t\tonScanButtonLongPress: function(){}, // Callback after detection of a successfull scan while the scan button was pressed and held down\n\t\t\t\tscanButtonKeyCode:false, // Key code of the scanner hardware button (if the scanner button a acts as a key itself) \n\t\t\t\tscanButtonLongPressTime:500, // How long (ms) the hardware button should be pressed, until a callback gets executed\n\t\t\t\ttimeBeforeScanTest:100, // Wait duration (ms) after keypress event to check if scanning is finished\n\t\t\t\tavgTimeByChar:30, // Average time (ms) between 2 chars. Used to do difference between keyboard typing and scanning\n\t\t\t\tminLength:6, // Minimum length for a scanning\n\t\t\t\tsuffixKeyCodes:[9,13], // Chars to remove and means end of scanning\n\t\t\t\tprefixKeyCodes:[], // Chars to remove and means start of scanning\n\t\t\t\tignoreIfFocusOn:false, // do not handle scans if the currently focused element matches this selector or object\n\t\t\t\tstopPropagation:false, // Stop immediate propagation on keypress event\n\t\t\t\tpreventDefault:false, // Prevent default action on keypress event\n\t\t\t\tcaptureEvents:false, // Get the events before any listeners deeper in the DOM\n\t\t\t\treactToKeydown:true, // look for scan input in keyboard events\n\t\t\t\treactToPaste:false, // look for scan input in paste events\n\t\t\t\tsingleScanQty: 1, // Quantity of Items put out to onScan in a single scan\n\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\toOptions = this._mergeOptions(oDefaults, oOptions);\n\t\n\t\t\t// initializing options and variables on DomElement\n\t\t\toDomElement.scannerDetectionData = {\n\t\t\t\t\toptions: oOptions,\n\t\t\t\t\tvars:{\n\t\t\t\t\t\tfirstCharTime: 0,\n\t\t\t\t\t\tlastCharTime: 0,\n\t\t\t\t\t\taccumulatedString: '',\n\t\t\t\t\t\ttestTimer: false,\n\t\t\t\t\t\tlongPressTimeStart: 0,\n\t\t\t\t\t\tlongPressed: false\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t};\n\t\t\t\n\t\t\t// initializing handlers (based on settings)\n\t\t\tif (oOptions.reactToPaste === true){\n\t\t\t\toDomElement.addEventListener(\"paste\", this._handlePaste, oOptions.captureEvents);\n\t\t\t}\n\t\t\tif (oOptions.scanButtonKeyCode !== false){\n\t\t\t\toDomElement.addEventListener(\"keyup\", this._handleKeyUp, oOptions.captureEvents);\n\t\t\t}\n\t\t\tif (oOptions.reactToKeydown === true || oOptions.scanButtonKeyCode !== false){\t\n\t\t\t\toDomElement.addEventListener(\"keydown\", this._handleKeyDown, oOptions.captureEvents);\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @return void\n\t\t */\n\t\tdetachFrom: function(oDomElement) {\n\t\t\t// detaching all used events\n\t\t\tif (oDomElement.scannerDetectionData.options.reactToPaste){\n\t\t\t\toDomElement.removeEventListener(\"paste\", this._handlePaste);\n\t\t\t}\n\t\t\tif (oDomElement.scannerDetectionData.options.scanButtonKeyCode !== false){\n\t\t\t\toDomElement.removeEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t}\n\t\t\toDomElement.removeEventListener(\"keydown\", this._handleKeyDown);\n\t\t\t\n\t\t\t// clearing data off DomElement\n\t\t\toDomElement.scannerDetectionData = undefined; \n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @return Object\n\t\t */\n\t\tgetOptions: function(oDomElement){\n\t\t\treturn oDomElement.scannerDetectionData.options;\t\t\t\n\t\t},\n\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @param Object oOptions\n\t\t * @return self\n\t\t */\n\t\tsetOptions: function(oDomElement, oOptions){\n\t\t\t// check if some handlers need to be changed based on possible option changes\n\t\t\tswitch (oDomElement.scannerDetectionData.options.reactToPaste){\n\t\t\t\tcase true: \n\t\t\t\t\tif (oOptions.reactToPaste === false){\n\t\t\t\t\t\toDomElement.removeEventListener(\"paste\", this._handlePaste);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase false:\n\t\t\t\t\tif (oOptions.reactToPaste === true){\n\t\t\t\t\t\toDomElement.addEventListener(\"paste\", this._handlePaste);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tswitch (oDomElement.scannerDetectionData.options.scanButtonKeyCode){\n\t\t\t\tcase false:\n\t\t\t\t\tif (oOptions.scanButtonKeyCode !== false){\n\t\t\t\t\t\toDomElement.addEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault: \n\t\t\t\t\tif (oOptions.scanButtonKeyCode === false){\n\t\t\t\t\t\toDomElement.removeEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\t// merge old and new options\n\t\t\toDomElement.scannerDetectionData.options = this._mergeOptions(oDomElement.scannerDetectionData.options, oOptions);\n\t\t\n\t\t\t// reinitiallize\n\t\t\tthis._reinitialize(oDomElement);\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Transforms key codes into characters.\n\t\t * \n\t\t * By default, only the follwing key codes are taken into account\n\t\t * - 48-90 (letters and regular numbers)\n\t\t * - 96-105 (numeric keypad numbers)\n\t\t * - 106-111 (numeric keypad operations)\n\t\t * \n\t\t * All other keys will yield empty strings!\n\t\t * \n\t\t * The above keycodes will be decoded using the KeyboardEvent.key property on modern\n\t\t * browsers. On older browsers the method will fall back to String.fromCharCode()\n\t\t * putting the result to upper/lower case depending on KeyboardEvent.shiftKey if\n\t\t * it is set.\n\t\t * \n\t\t * @param KeyboardEvent oEvent\n\t\t * @return string\n\t\t */\n\t\tdecodeKeyEvent : function (oEvent) {\n\t\t\tvar iCode = this._getNormalizedKeyNum(oEvent);\n\t\t\tswitch (true) {\n\t\t\t\tcase iCode >= 48 && iCode <= 90: // numbers and letters\n\t\t\t\tcase iCode >= 106 && iCode <= 111: // operations on numeric keypad (+, -, etc.)\n\t\t\t\t\tif (oEvent.key !== undefined && oEvent.key !== '') {\n\t\t\t\t\t\treturn oEvent.key;\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\tvar sDecoded = String.fromCharCode(iCode);\n\t\t\t\t\tswitch (oEvent.shiftKey) {\n\t\t\t\t\t\tcase false: sDecoded = sDecoded.toLowerCase(); break;\n\t\t\t\t\t\tcase true: sDecoded = sDecoded.toUpperCase(); break;\n\t\t\t\t\t}\n\t\t\t\t\treturn sDecoded;\n\t\t\t\tcase iCode >= 96 && iCode <= 105: // numbers on numeric keypad\n\t\t\t\t\treturn 0+(iCode-96);\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\t\t\n\t\t/**\n\t\t * Simulates a scan of the provided code.\n\t     *\n\t\t * The scan code can be defined as\n\t\t * - a string - in this case no keyCode decoding is done and the code is merely validated\n\t\t * against constraints like minLenght, etc.\n\t\t * - an array of keyCodes (e.g. `[70,71,80]`) - will produce `keydown` events with corresponding\n\t\t * `keyCode` properties. NOTE: these events will have empty `key` properties, so decoding may\n\t\t * yield different results than with native events.\n\t\t * - an array of objects (e.g. `[{keyCode: 70, key: \"F\", shiftKey: true}, {keyCode: 71, key: \"g\"}]`) -\n\t\t * this way almost any event can be simulated, but it's a lot of work to do.\n\t\t *\n\t\t * @param DomElement oDomElement\n\t\t * @param string|array mStringOrArray\n\t\t * @return self\n\t\t */\n\t\tsimulate: function(oDomElement, mStringOrArray){\n\t\t\tthis._reinitialize(oDomElement);\n\t\t\tif (Array.isArray(mStringOrArray)){\n\t\t\t\tmStringOrArray.forEach(function(mKey){\n\t\t\t\t\tvar oEventProps = {};\n\t\t\t\t\tif( (typeof mKey === \"object\" || typeof mKey === 'function') && (mKey !== null) ) {\n\t\t\t\t\t\toEventProps = mKey;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toEventProps.keyCode = parseInt(mKey);\n\t\t\t\t\t}\n\t\t\t\t\tvar oEvent = new KeyboardEvent('keydown', oEventProps);\n\t\t\t\t\tdocument.dispatchEvent(oEvent);\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthis._validateScanCode(oDomElement, mStringOrArray);\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param DomElement oDomElement\n\t\t * @return void\n\t\t */\n\t\t_reinitialize: function(oDomElement){\n\t\t\tvar oVars = oDomElement.scannerDetectionData.vars;\n\t\t\toVars.firstCharTime = 0;\n\t\t\toVars.lastCharTime = 0;\n\t\t\toVars.accumulatedString = '';\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param DomElement oDomElement\n\t     * @return boolean\n\t\t */\n\t\t_isFocusOnIgnoredElement: function(oDomElement){\n\t\t\t\n\t\t\tvar ignoreSelectors = oDomElement.scannerDetectionData.options.ignoreIfFocusOn;\n\t\n\t        if(!ignoreSelectors){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\n\t\t\tvar oFocused = document.activeElement;\n\t\t\t\n\t\t\t// checks if ignored element is an array, and if so it checks if one of the elements of it is an active one\n\t\t\tif (Array.isArray(ignoreSelectors)){\n\t\t\t\tfor(var i=0; i<ignoreSelectors.length; i++){\n\t\t\t\t\tif(oFocused.matches(ignoreSelectors[i]) === true){\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t// if the option consists of an single element, it only checks this one\n\t\t\t} else if (oFocused.matches(ignoreSelectors)){\n\t\t\t\treturn true;\t\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t// if the active element is not listed in the ignoreIfFocusOn option, return false\n\t\t    return false;\n\t    },\n\t\t\n\t    /**\n\t     * Validates the scan code accumulated by the given DOM element and fires the respective events.\n\t     * \n\t     * @private\n\t     * @param DomElement oDomElement\n\t     * @return boolean\n\t     */\n\t\t_validateScanCode: function(oDomElement, sScanCode){\n\t\t\tvar oScannerData = oDomElement.scannerDetectionData;\t\t\t\n\t\t\tvar oOptions = oScannerData.options;\n\t\t\tvar iSingleScanQty = oScannerData.options.singleScanQty;\n\t\t\tvar iFirstCharTime = oScannerData.vars.firstCharTime;\n\t\t\tvar iLastCharTime = oScannerData.vars.lastCharTime;\n\t\t\tvar oScanError = {};\n\t        var oEvent;\n\t        \n\t\t\tswitch(true){\n\t\t\t\t\n\t\t\t\t// detect codes that are too short\n\t\t\t\tcase (sScanCode.length < oOptions.minLength):\n\t\t\t\t\toScanError = {\n\t\t\t\t\t\tmessage: \"Receieved code is shorter then minimal length\"\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// detect codes that were entered too slow\t\n\t\t\t\tcase ((iLastCharTime - iFirstCharTime) > (sScanCode.length * oOptions.avgTimeByChar)):\n\t\t\t\t\toScanError = {\n\t\t\t\t\t\tmessage: \"Receieved code was not entered in time\"\n\t\t\t\t\t};\t\t\t\t\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// if a code was not filtered out earlier it is valid\t\n\t\t\t\tdefault:\n\t\t\t\t\toOptions.onScan.call(oDomElement, sScanCode, iSingleScanQty);\n\t\t\t\t\toEvent = new CustomEvent(\n\t\t\t\t\t\t'scan',\n\t\t\t\t\t\t{\t\n\t\t\t\t\t\t\tdetail: { \n\t\t\t\t\t\t\t\tscanCode: sScanCode,\n\t\t\t\t\t\t\t\tqty: iSingleScanQty\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\toDomElement.dispatchEvent(oEvent);\n\t\t\t\t\tonScan._reinitialize(oDomElement);\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t\t// If an error occurred (otherwise the method would return earlier) create an object for errordetection\n\t\t\toScanError.scanCode = sScanCode;\n\t\t\toScanError.scanDuration = iLastCharTime - iFirstCharTime;\n\t\t\toScanError.avgTimeByChar = oOptions.avgTimeByChar;\n\t\t\toScanError.minLength = oOptions.minLength;\n\t\t\t\n\t\t\toOptions.onScanError.call(oDomElement, oScanError);\n\t\t\t\n\t\t\toEvent = new CustomEvent(\n\t\t\t\t'scanError', \n\t\t\t\t{detail: oScanError}\n\t\t\t);\n\t\t\toDomElement.dispatchEvent(oEvent);\n\t\t\t\n\t\t\tonScan._reinitialize(oDomElement);\n\t\t\treturn false;\n\t    },\n\t\n\t    /**\n\t     * @private\n\t     * @param Object oDefaults\n\t     * @param Object oOptions\n\t     * @return Object\n\t     */\n\t\t_mergeOptions: function(oDefaults, oOptions){\n\t\t\tvar oExtended = {};\n\t\t\tvar prop;\n\t\t\tfor (prop in oDefaults){\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(oDefaults, prop)){\n\t\t\t\t\toExtended[prop] = oDefaults[prop];\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t\tfor (prop in oOptions){\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(oOptions, prop)){\n\t\t\t\t\toExtended[prop] = oOptions[prop];\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t\treturn oExtended;\n\t\t},\n\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return int\n\t\t * @see https://www.w3schools.com/jsref/event_key_keycode.asp\n\t\t */\n\t\t_getNormalizedKeyNum: function(e){\n\t\t\treturn e.which || e.keyCode;\n\t\t},\n\t\n\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return void\n\t\t */\n\t\t_handleKeyDown: function(e){\n\t\t\tvar iKeyCode = onScan._getNormalizedKeyNum(e);\n\t\t\tvar oOptions = this.scannerDetectionData.options;\n\t\t\tvar oVars = this.scannerDetectionData.vars;\n\t\t\tvar bScanFinished = false;\n\t\t\t\n\t\t\tif (oOptions.onKeyDetect.call(this, iKeyCode, e) === false) {\n\t\t\t\treturn;\n\t\t\t}\t\t\n\t\t\t\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\t\t\t\n\t        // If it's just the button of the scanner, ignore it and wait for the real input\n\t\t    if(oOptions.scanButtonKeyCode !== false && iKeyCode==oOptions.scanButtonKeyCode) {\n\t\t\t\t\n\t\t\t\t// if the button was first pressed, start a timeout for the callback, which gets interrupted if the scanbutton gets released\n\t\t\t\tif (!oVars.longPressed){\n\t\t\t\t\toVars.longPressTimer = setTimeout( oOptions.onScanButtonLongPress, oOptions.scanButtonLongPressTime, this);\n\t\t\t\t\toVars.longPressed = true;\n\t\t\t\t}\n\t\n\t\t\t\treturn;\n\t        }\n\t\t\t\n\t\t\tswitch(true){\n\t\t\t\t// If it's not the first character and we encounter a terminating character, trigger scan process\n\t\t\t\tcase (oVars.firstCharTime && oOptions.suffixKeyCodes.indexOf(iKeyCode)!==-1):\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\tbScanFinished=true;\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// If it's the first character and we encountered one of the starting characters, don't process the scan\t\n\t\t\t\tcase (!oVars.firstCharTime && oOptions.prefixKeyCodes.indexOf(iKeyCode)!==-1):\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\tbScanFinished=false;\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// Otherwise, just add the character to the scan string we're building\t\n\t\t\t\tdefault:\n\t\t\t\t\tvar character = oOptions.keyCodeMapper.call(this, e);\n\t\t\t\t\tif (character === null){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\toVars.accumulatedString += character;\n\t\t\t\t\t\n\t\t\t\t\tif (oOptions.preventDefault) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t\tif (oOptions.stopPropagation) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tbScanFinished=false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t        \n\t\t\tif(!oVars.firstCharTime){\n\t\t\t\toVars.firstCharTime=Date.now();\n\t\t\t}\n\t\t\t\n\t\t\toVars.lastCharTime=Date.now();\n\t\n\t\t\tif(oVars.testTimer){ \n\t\t\t\tclearTimeout(oVars.testTimer);\n\t\t\t}\n\t\t\t\n\t\t\tif(bScanFinished){\n\t\t\t\tonScan._validateScanCode(this, oVars.accumulatedString);\n\t\t\t\toVars.testTimer=false;\n\t\t\t} else {\n\t\t\t\toVars.testTimer=setTimeout(onScan._validateScanCode, oOptions.timeBeforeScanTest, this, oVars.accumulatedString);\n\t\t\t}\n\t\n\t\t\toOptions.onKeyProcess.call(this, character, e);\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param Event e\n\t\t * @return void\n\t\t */\n\t\t_handlePaste: function(e){\n\t\n\t\t\tvar oOptions = this.scannerDetectionData.options;\n\t\t\tvar oVars = this.scannerDetectionData.vars;\n\t\t\tvar sPasteString = (event.clipboardData || window.clipboardData).getData('text');\n\t\t\t\n\t\t\t// if the focus is on an ignored element, abort\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\te.preventDefault();\n\n\t\t\tif (oOptions.stopPropagation) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t}\n\t\t\t\t\t\t\n\t\t\toOptions.onPaste.call(this, sPasteString, event);\n\t\t\t\n\t\t\toVars.firstCharTime = 0;\n\t\t\toVars.lastCharTime = 0;\n\t\t\t\n\t\t\t// validate the string\n\t\t\tonScan._validateScanCode(this, sPasteString);\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return void\n\t\t */\n\t\t_handleKeyUp: function(e){\n\t\t\t// if the focus is on an ignored element, abort\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tvar iKeyCode = onScan._getNormalizedKeyNum(e);\n\t\t\t\n\t\t\t// if hardware key is not being pressed anymore stop the timeout and reset\n\t\t\tif (iKeyCode == this.scannerDetectionData.options.scanButtonKeyCode){\n\t\t\t\tclearTimeout(this.scannerDetectionData.vars.longPressTimer);\n\t\t\t\tthis.scannerDetectionData.vars.longPressed = false;\n\t\t\t}\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Returns TRUE the scanner is currently in the middle of a scan sequence.\n\t\t * \n\t\t * @param DomElement\n\t\t * @return boolean\n\t\t */\n\t\tisScanInProgressFor: function(oDomElement) {\n\t\t\treturn oDomElement.scannerDetectionData.vars.firstCharTime > 0;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Returns TRUE if onScan is attached to the given DOM element and FALSE otherwise.\n\t\t * \n\t\t * @param DomElement\n\t\t * @return boolean\n\t\t */\n\t\tisAttachedTo: function(oDomElement) {\n\t\t\treturn (oDomElement.scannerDetectionData !== undefined);\n\t\t}\n\t};\n\t\n\treturn onScan;\n})));", "frappe.provide('posnext.PointOfSale');\nvar selected_item = null\n\nposnext.PointOfSale.Controller = class {\n\tconstructor(wrapper) {\n\t\tconsole.log(\"CONTROLLLER HERE ssssssadasdasd\")\n\t\tthis.wrapper = $(wrapper).find('.layout-main-section');\n\t\tthis.page = wrapper.page;\n\t\tfrappe.run_serially([\n\t\t\t() => this.reload_status = false,\n\t\t\t() => this.check_opening_entry(\"\"),\n\t\t\t() => this.reload_status = true,\n\t\t]);\n\n\n\n\t}\n\n\tfetch_opening_entry(value) {\n\t\treturn frappe.call(\"posnext.posnext.page.posnext.point_of_sale.check_opening_entry\", { \"user\": frappe.session.user, \"value\": value });\n\t}\n\ncheck_opening_entry(value = \"\") {\n\tif (frappe.user_roles.includes(\"Waiter\")) {\n\t\tthis.find_available_opening_entry();\n\t} else {\n\t\tthis.fetch_opening_entry(value).then((r) => {\n\t\t\tif (r.message.length) {\n\t\t\t\t// assuming only one opening voucher is available for the current user\n\t\t\t\tthis.prepare_app_defaults(r.message[0]);\n\t\t\t} else {\n\t\t\t\tthis.create_opening_voucher();\n\t\t\t}\n\t\t});\n\t}\n}\n\n// New method to find any available opening entry for waiters\nfind_available_opening_entry() {\n\tconst me = this;\n\t\n\t// Call server method to get any available opening entry\n\tfrappe.call({\n\t\tmethod: \"posnext.posnext.page.posnext.point_of_sale.get_available_opening_entry\",\n\t\tcallback: (r) => {\n\t\t\tif (r.message && r.message.length > 0) {\n\t\t\t\t// Use the first available opening entry\n\t\t\t\tme.prepare_app_defaults(r.message[0]);\n\t\t\t\t\n\t\t\t\t// Show info message to waiter\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"Using existing POS Opening Entry: {0}\", [r.message[0].name]),\n\t\t\t\t\tindicator: 'blue'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// No opening entries available at all\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('No POS Opening Entry Available'),\n\t\t\t\t\tmessage: __('No POS Opening Entry is currently available. Please contact your manager to create one.'),\n\t\t\t\t\tindicator: 'red'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n}\n\n\tcreate_opening_voucher() {\n\t\tconst me = this;\n\t\tconst table_fields = [\n\t\t\t{\n\t\t\t\tfieldname: \"mode_of_payment\", fieldtype: \"Link\",\n\t\t\t\tin_list_view: 1, label: \"Mode of Payment\",\n\t\t\t\toptions: \"Mode of Payment\", reqd: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"opening_amount\", fieldtype: \"Currency\",\n\t\t\t\tin_list_view: 1, label: \"Opening Amount\",\n\t\t\t\toptions: \"company:company_currency\",\n\t\t\t\tchange: function () {\n\t\t\t\t\tdialog.fields_dict.balance_details.df.data.some(d => {\n\t\t\t\t\t\tif (d.idx == this.doc.idx) {\n\t\t\t\t\t\t\td.opening_amount = this.value;\n\t\t\t\t\t\t\tdialog.fields_dict.balance_details.grid.refresh();\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst fetch_pos_payment_methods = () => {\n\t\t\tconst pos_profile = dialog.fields_dict.pos_profile.get_value();\n\t\t\tif (!pos_profile) return;\n\t\t\tfrappe.db.get_doc(\"POS Profile\", pos_profile).then(({ payments }) => {\n\t\t\t\tdialog.fields_dict.balance_details.df.data = [];\n\t\t\t\tpayments.forEach(pay => {\n\t\t\t\t\tconst { mode_of_payment } = pay;\n\t\t\t\t\tdialog.fields_dict.balance_details.df.data.push({ mode_of_payment, opening_amount: '0' });\n\t\t\t\t});\n\t\t\t\tdialog.fields_dict.balance_details.grid.refresh();\n\t\t\t});\n\t\t}\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Create POS Opening Entry'),\n\t\t\tstatic: true,\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Link', label: __('Company'), default: frappe.defaults.get_default('company'),\n\t\t\t\t\toptions: 'Company', fieldname: 'company', reqd: 1\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Link', label: __('POS Profile'),\n\t\t\t\t\toptions: 'POS Profile', fieldname: 'pos_profile', reqd: 1,\n\t\t\t\t\tget_query: () => pos_profile_query(),\n\t\t\t\t\tonchange: () => fetch_pos_payment_methods()\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"balance_details\",\n\t\t\t\t\tfieldtype: \"Table\",\n\t\t\t\t\tlabel: \"Opening Balance Details\",\n\t\t\t\t\tcannot_add_rows: false,\n\t\t\t\t\tin_place_edit: true,\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tdata: [],\n\t\t\t\t\tfields: table_fields\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action: async function({ company, pos_profile, balance_details }) {\n\t\t\t\tif (!balance_details.length) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"Please add Mode of payments and opening balance details.\"),\n\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t})\n\t\t\t\t\treturn frappe.utils.play_sound(\"error\");\n\t\t\t\t}\n\n\t\t\t\t// filter balance details for empty rows\n\t\t\t\tbalance_details = balance_details.filter(d => d.mode_of_payment);\n\n\t\t\t\tconst method = \"posnext.posnext.page.posnext.point_of_sale.create_opening_voucher\";\n\t\t\t\tconst res = await frappe.call({ method, args: { pos_profile, company, balance_details }, freeze:true });\n\t\t\t\t!res.exc && me.prepare_app_defaults(res.message);\n\t\t\t\tdialog.hide();\n\t\t\t},\n\t\t\tprimary_action_label: __('Submit')\n\t\t});\n\t\tdialog.show();\n\t\tconst pos_profile_query = () => {\n\t\t\treturn {\n\t\t\t\tquery: 'erpnext.accounts.doctype.pos_profile.pos_profile.pos_profile_query',\n\t\t\t\tfilters: { company: dialog.fields_dict.company.get_value() }\n\t\t\t}\n\t\t};\n\t}\n\n\tasync prepare_app_defaults(data) {\n\t\tthis.pos_opening = data.name;\n\t\tthis.company = data.company;\n\t\tthis.pos_profile = data.pos_profile;\n\t\tthis.pos_opening_time = data.period_start_date;\n\t\tthis.item_stock_map = {};\n\t\tthis.settings = {};\n\t\twindow.current_pos_profile = this.pos_profile\n\t\tfrappe.db.get_value('Stock Settings', undefined, 'allow_negative_stock').then(({ message }) => {\n\t\t\tthis.allow_negative_stock = flt(message.allow_negative_stock) || false;\n\t\t});\n\n\t\tfrappe.call({\n\t\t\tmethod: \"posnext.posnext.page.posnext.point_of_sale.get_pos_profile_data\",\n\t\t\targs: { \"pos_profile\": this.pos_profile },\n\t\t\tcallback: (res) => {\n\t\t\t\tconst profile = res.message;\n\n\t\t\t\tObject.assign(this.settings, profile);\n\t\t\t\tthis.settings.customer_groups = profile.customer_groups.map(group => group.name);\n\n\t\t\t\tthis.make_app();\n\t\t\t}\n\t\t});\n\t}\n\n\tset_opening_entry_status() {\n\t\tthis.page.set_title_sub(\n\t\t\t`<span class=\"indicator orange\">\n\t\t\t\t<a class=\"text-muted\" href=\"#Form/POS%20Opening%20Entry/${this.pos_opening}\">\n\t\t\t\t\tOpened at ${moment(this.pos_opening_time).format(\"Do MMMM, h:mma\")}\n\t\t\t\t</a>\n\t\t\t</span>`);\n\t}\n\n\tmake_app() {\n\t\tthis.prepare_dom();\n\t\tthis.show_table_selector();\n\t}\n\n\tshow_table_selector() {\n\t\t// Initialize recent order list if not already done\n\t\tif (!this.recent_order_list) {\n\t\t\tthis.init_recent_order_list();\n\t\t}\n\t\tthis.table_selector = new posnext.PointOfSale.TableSelector({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\ttable_selected: (table) => {\n\t\t\t\t\tthis.selected_table = table;\n\t\t\t\t\tthis.start_ordering();\n\t\t\t\t},\n\t\t\t\ttoggle_recent_order: () => {\n\t\t\t\t\tthis.toggle_recent_order();\n\t\t\t\t}\n\t\t\t},\n\t\t\tpos_profile: this.pos_profile\n\t\t});\n\t}\n\n\tstart_ordering() {\n\t\t// Clear the table selector\n\t\tthis.$components_wrapper.empty();\n\t\t// Prepare the main POS interface\n\t\tthis.prepare_components();\n\t\tthis.prepare_menu();\n\t\tthis.make_new_invoice();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<div class=\"point-of-sale-app\"></div>`\n\t\t);\n\n\t\tthis.$components_wrapper = this.wrapper.find('.point-of-sale-app');\n\t}\n\n\tprepare_components() {\n\t\tthis.init_item_selector();\n\t\tthis.init_item_details();\n\t\tthis.init_item_cart();\n\t\tthis.init_payments();\n\t\tthis.init_recent_order_list();\n\t\tthis.init_order_summary();\n\t}\n\n\tprepare_menu() {\n\t\tthis.page.clear_menu();\n\t\tif(this.settings.custom_show_open_form_view){\n\t\t\tthis.page.add_menu_item(__(\"Open Form View\"), this.open_form_view.bind(this), false, 'Ctrl+F');\n\t\t}\n\t\tif(this.settings.custom_show_toggle_recent_orders) {\n\t\t\tthis.page.add_menu_item(__(\"Toggle Recent Orders\"), this.toggle_recent_order.bind(this), false, 'Ctrl+O');\n\t\t}\n\t\tif(this.settings.custom_show_save_as_draft) {\n\t\t\tthis.page.add_menu_item(__(\"Save as Draft\"), this.save_draft_invoice.bind(this), false, 'Ctrl+S');\n\t\t}\n\t\tif(this.settings.custom_show_close_the_pos && !frappe.user_roles.includes('Waiter')) {\n\t\t\tthis.page.add_menu_item(__('Close the POS'), this.close_pos.bind(this), false, 'Shift+Ctrl+C');\n\t\t}\n\t}\n\n\topen_form_view() {\n\t\tfrappe.model.sync(this.frm.doc);\n\t\tfrappe.set_route(\"Form\", this.frm.doc.doctype, this.frm.doc.name);\n\t}\n\nshow_recent_order_list() {\n    return this.toggle_recent_order_list(true); // Force show=true\n}\n\ntoggle_recent_order() {\n    const show = this.recent_order_list.$component.is(':hidden');\n    return this.toggle_recent_order_list(show);\n}\n\nsave_draft_invoice() {\n    if (!this.$components_wrapper.is(\":visible\")) {\n        frappe.show_alert({\n            message: __(\"POS interface is not visible.\"),\n            indicator: 'red'\n        });\n        frappe.dom.unfreeze();\n        return Promise.reject(new Error(\"POS interface is not visible\"));\n    }\n    const frm = this.frm;\n    if (!frm) {\n        frappe.show_alert({\n            message: __(\"Form not initialized. Please try again.\"),\n            indicator: 'red'\n        });\n        frappe.dom.unfreeze();\n        return Promise.reject(new Error(\"Form not initialized\"));\n    }\n    if (!frm.doc.items.length) {\n        frappe.show_alert({\n            message: __(\"You must add at least one item to save it as draft.\"),\n            indicator: 'red'\n        });\n        frappe.utils.play_sound(\"error\");\n        frappe.dom.unfreeze();\n        return Promise.reject(new Error(\"No items in invoice\"));\n    }\n    if (!frm.doc.pos_profile) {\n        frappe.show_alert({\n            message: __(\"POS Profile is required for draft invoice\"),\n            indicator: 'red'\n        });\n        frappe.dom.unfreeze();\n        return Promise.reject(new Error(\"POS Profile required\"));\n    }\n    if (!frm.doc.customer) {\n        frappe.show_alert({\n            message: __(\"Customer is required for draft invoice\"),\n            indicator: 'red'\n        });\n        frappe.dom.unfreeze();\n        return Promise.reject(new Error(\"Customer required\"));\n    }\n    console.log(\"Saving draft with doc:\", frm.doc);\n    return new Promise((resolve, reject) => {\n        frappe.call({\n            method: \"posnext.posnext.page.posnext.point_of_sale.save_draft_invoice\",\n            args: {\n                doc: {\n                    name: frm.doc.name,\n                    customer: frm.doc.customer,\n                    items: frm.doc.items.map(item => ({\n                        item_code: item.item_code,\n                        qty: item.qty,\n                        rate: item.rate,\n                        uom: item.uom,\n                        warehouse: item.warehouse,\n                        serial_no: item.serial_no,\n                        batch_no: item.batch_no\n                    })),\n                    created_by_name: frm.doc.created_by_name || frappe.session.user,\n                    pos_profile: frm.doc.pos_profile,\n                    company: frm.doc.company\n                }\n            },\n            callback: (r) => {\n                console.log(\"Save draft response:\", r);\n                frappe.dom.unfreeze();\n                if (r.exc) {\n                    let error_msg = r.exc;\n                    try {\n                        const exc = JSON.parse(r.exc);\n                        error_msg = exc._error_message || exc.message || r.exc;\n                    } catch (e) {\n                        // Fallback\n                    }\n                    frappe.show_alert({\n                        message: __(`Error saving draft: ${error_msg}`),\n                        indicator: 'red'\n                    });\n                    frappe.utils.play_sound(\"error\");\n                    reject(new Error(error_msg));\n                    return;\n                }\n                if (r.message) {\n                    frappe.show_alert({\n                        message: __(\"Draft invoice saved successfully\"),\n                        indicator: 'green'\n                    });\n                    // Update frm.doc with saved data\n                    frm.doc.name = r.message.name || frm.doc.name;\n                    frm.doc.created_by_name = r.message.created_by_name || frm.doc.created_by_name;\n                    resolve({\n                        invoice_name: frm.doc.name,\n                        created_by_name: frm.doc.created_by_name\n                    });\n                    // Only call make_new_invoice if not called by ItemCart.js\n                    if (!r.message.from_hold) {\n                        frappe.run_serially([\n                            () => frappe.dom.freeze(),\n                            () => this.make_new_invoice(true),\n                            () => frappe.dom.unfreeze()\n                        ]);\n                    }\n                }\n            },\n            error: (xhr, status, error) => {\n                console.error(\"Save draft AJAX error:\", status, error);\n                frappe.dom.unfreeze();\n                frappe.show_alert({\n                    message: __(\"Failed to save draft. Please check your connection or contact support.\"),\n                    indicator: 'red'\n                });\n                frappe.utils.play_sound(\"error\");\n                reject(new Error(\"Failed to save draft: \" + error));\n            }\n        });\n    });\n}\n\n\tclose_pos() {\n\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\n\t\tlet voucher = frappe.model.get_new_doc('POS Closing Entry');\n\t\tvoucher.pos_profile = this.frm.doc.pos_profile;\n\t\tvoucher.user = frappe.session.user;\n\t\tvoucher.company = this.frm.doc.company;\n\t\tvoucher.pos_opening_entry = this.pos_opening;\n\t\tvoucher.period_end_date = frappe.datetime.now_datetime();\n\t\tvoucher.posting_date = frappe.datetime.now_date();\n\t\tvoucher.posting_time = frappe.datetime.now_time();\n\t\tfrappe.set_route('Form', 'POS Closing Entry', voucher.name);\n\t}\n\n\tinit_item_selector() {\n\t\tif(this.frm){\n\t\tthis.frm.doc.set_warehouse = this.settings.warehouse\n\t\t}\n\t\tthis.item_selector = new posnext.PointOfSale.ItemSelector({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tpos_profile: this.pos_profile,\n\t\t\tsettings: this.settings,\n\t\t\treload_status: this.reload_status,\n\t\t\tcurrency: this.settings.currency,\n\t\t\tevents: {\n\t\t\t\tcheck_opening_entry: () => this.check_opening_entry(),\n\t\t\t\titem_selected: args => this.on_cart_update(args),\n\n\t\t\t\tinit_item_cart: () => this.init_item_cart(),\n\t\t\t\tinit_item_details: () => this.init_item_details(),\n\t\t\t\tchange_items: (args) => this.change_items(args),\n\t\t\t\tget_frm: () => this.frm || {}\n\t\t\t}\n\t\t})\n\t}\n\tchange_items(items){\n\t\tvar me = this\n\t\tthis.frm = items;\n\t\tthis.cart.load_invoice()\n\t\t// for(var x=0;x<items.length;x+=1){\n\t\t// \tvar item_code = items[x].item_code\n\t\t// \tvar batch_no = items[x].batch_no\n\t\t// \tvar serial_no = items[x].serial_no\n\t\t// \tvar uom =items[x].uom\n\t\t// \tvar rate = items[x].rate\n\t\t// \tme.on_cart_update({\n\t\t// \t\t\tfield: 'qty',\n\t\t// \t\t\tvalue: items[x].qty === 0 ? \"+1\" : items[x].qty,\n\t\t// \t\t\titem: { item_code, batch_no, serial_no, uom, rate}\n\t\t// \t})\n\t\t// \t// this.update_cart_html(this.frm.items[x])\n\t\t// }\n\t}\n\n// UPDATE: In Controller.js init_item_cart method, add the new event\n\ninit_item_cart() {\n    this.cart = new posnext.PointOfSale.ItemCart({\n        wrapper: this.$components_wrapper,\n        settings: this.settings,\n        events: {\n            get_frm: () => this.frm,\n            cart_item_clicked: (item) => {\n\t\t\t\tif (frappe.user_roles.includes(\"Waiter\")) {\n\t\t\t\t}else{\n                // Find the item in the form\n                const item_row = this.frm.doc.items.find(i => i.name === item.name);\n                if (item_row) {\n                    // Ensure item details component is visible\n                    if (!this.item_details.$component.is(':visible')) {\n                        this.item_details.toggle_component(true);\n                    }\n                    // Open item details for editing\n                    this.item_details.toggle_item_details_section(item_row);\n                    // Set global selected_item for persistence\n                    selected_item = item_row;\n                    \n                    // Optionally minimize item selector to give more space for item details\n                    this.item_selector.resize_selector(true);\n                    this.cart.toggle_numpad(true);\n                }}\n            },\n            numpad_event: (value, action) => this.update_item_field(value, action),\n            checkout: () => this.save_and_checkout(),\n            edit_cart: () => this.payment.edit_cart(),\n            save_draft_invoice: () => this.save_draft_invoice(),\n            toggle_recent_order: () => this.toggle_recent_order(),\n            show_recent_order_list: () => this.show_recent_order_list(),\n            customer_details_updated: (details) => { /* Handle customer details update */ },\n            load_new_invoice: (from_held) => this.make_new_invoice(from_held)\n        }\n    });\n}\n\tinit_item_details() {\n\t\tthis.item_details = new posnext.PointOfSale.ItemDetails({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\ttoggle_item_selector: (minimize) => {\n\t\t\t\t\tthis.item_selector.resize_selector(minimize);\n\t\t\t\t\tthis.cart.toggle_numpad(minimize);\n\t\t\t\t},\n\n\t\t\t\tform_updated: (item, field, value) => {\n\t\t\t\t\tconst item_row = frappe.model.get_doc(item.doctype, item.name);\n\t\t\t\t\tif (item_row && item_row[field] != value) {\n\t\t\t\t\t\tconst args = {\n\t\t\t\t\t\t\tfield,\n\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\titem: this.item_details.current_item\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn this.on_cart_update(args);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t},\n\n\t\t\t\thighlight_cart_item: (item) => {\n\t\t\t\t\tconst cart_item = this.cart.get_cart_item(item);\n\t\t\t\t\tthis.cart.toggle_item_highlight(cart_item);\n\t\t\t\t},\n\n\t\t\t\titem_field_focused: (fieldname) => {\n\t\t\t\t\tthis.cart.toggle_numpad_field_edit(fieldname);\n\t\t\t\t},\n\t\t\t\tset_value_in_current_cart_item: (selector, value) => {\n\t\t\t\t\tthis.cart.update_selector_value_in_cart_item(selector, value, this.item_details.current_item);\n\t\t\t\t},\n\t\t\t\tclone_new_batch_item_in_frm: (batch_serial_map, item) => {\n\t\t\t\t\t// called if serial nos are 'auto_selected' and if those serial nos belongs to multiple batches\n\t\t\t\t\t// for each unique batch new item row is added in the form & cart\n\t\t\t\t\tObject.keys(batch_serial_map).forEach(batch => {\n\t\t\t\t\t\tconst item_to_clone = this.frm.doc.items.find(i => i.name == item.name);\n\t\t\t\t\t\tconst new_row = this.frm.add_child(\"items\", { ...item_to_clone });\n\t\t\t\t\t\t// update new serialno and batch\n\t\t\t\t\t\tnew_row.batch_no = batch;\n\t\t\t\t\t\tnew_row.serial_no = batch_serial_map[batch].join(`\\n`);\n\t\t\t\t\t\tnew_row.qty = batch_serial_map[batch].length;\n\t\t\t\t\t\tthis.frm.doc.items.forEach(row => {\n\t\t\t\t\t\t\tif (item.item_code === row.item_code) {\n\t\t\t\t\t\t\t\tthis.update_cart_html(row);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tremove_item_from_cart: () => this.remove_item_from_cart(),\n\t\t\t\tget_item_stock_map: () => this.item_stock_map,\n\t\t\t\tclose_item_details: () => {\n\t\t\t\t\tselected_item = null\n\t\t\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t\t\t\tthis.cart.prev_action = null;\n\t\t\t\t\tthis.cart.toggle_item_highlight();\n\t\t\t\t},\n\t\t\t\tget_available_stock: (item_code, warehouse) => this.get_available_stock(item_code, warehouse)\n\t\t\t}\n\t\t});\n\t\tif(selected_item){\n\t\t\tthis.item_details.toggle_item_details_section(selected_item);\n\t\t}\n\t}\n\n\tinit_payments() {\n\t\tthis.payment = new posnext.PointOfSale.Payment({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm || {},\n\n\t\t\t\tget_customer_details: () => this.customer_details || {},\n\n\t\t\t\ttoggle_other_sections: (show) => {\n\t\t\t\t\tif (show) {\n\t\t\t\t\t\tthis.item_details.$component.is(':visible') ? this.item_details.$component.css('display', 'none') : '';\n\t\t\t\t\t\tthis.item_selector.toggle_component(false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.item_selector.toggle_component(true);\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tsubmit_invoice: () => {\n\t\t\t\t\tthis.frm.savesubmit()\n\t\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\t\tthis.toggle_components(false);\n\t\t\t\t\t\t\tthis.order_summary.toggle_component(true);\n\t\t\t\t\t\t\tthis.order_summary.load_summary_of(this.frm.doc, true);\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\t\t\tmessage: __('Sales Invoice {0} created succesfully', [r.doc.name])\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\topen_recent_orders: () => {\n\t\t\t\tthis.toggle_components(false);\n           \t\tthis.recent_order_list.toggle_component(true);\n   \t\t\t\tthis.order_summary.toggle_component(true);\n        }\n\t\t\t}\n\t\t});\n\t}\n\n\tinit_recent_order_list() {\n\t\tthis.recent_order_list = new posnext.PointOfSale.PastOrderList({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\topen_invoice_data: (name) => {\n\t\t\t\t\tfrappe.db.get_doc('Sales Invoice', name).then((doc) => {\n\t\t\t\t\t\tthis.order_summary.load_summary_of(doc);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\treset_summary: () => this.order_summary.toggle_summary_placeholder(true),\n\t\t\t\tprevious_screen: () => {\n\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t\t\t\t\tthis.cart.load_invoice()\n\t\t\t\t\tthis.item_selector.toggle_component(true)\n\t\t\t\t\tthis.wrapper.find('.past-order-summary').css(\"display\",\"none\");\n\t\t\t\t},\n\n\t\t\t}\n\t\t})\n\t}\n\n\tinit_order_summary() {\n\t\tthis.order_summary = new posnext.PointOfSale.PastOrderSummary({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tpos_profile: this.settings,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\tprocess_return: (name) => {\n\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t\t\t\t\tfrappe.db.get_doc('Sales Invoice', name).then((doc) => {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => this.make_return_invoice(doc),\n\t\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t\t() => this.item_selector.toggle_component(true)\n\t\t\t\t\t\t]);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tedit_order: (name) => {\n\t\t\t\t\tthis.table_selector.toggle_component(false);\n\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => this.frm.refresh(name),\n\t\t\t\t\t\t() => this.frm.call('reset_mode_of_payments'),\n\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t() => this.item_selector.toggle_component(true)\n\t\t\t\t\t]);\n\t\t\t\t},\n\t\t\t\tdelete_order: (name) => {\n\t\t\t\t\tfrappe.model.delete_doc(this.frm.doc.doctype, name, () => {\n\t\t\t\t\t\tthis.recent_order_list.refresh_list();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tnew_order: () => {\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => frappe.dom.freeze(),\n\t\t\t\t\t\t() => this.make_new_invoice(),\n\t\t\t\t\t\t() => this.table_selector.toggle_component(true),\n\t\t\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\ttoggle_recent_order_list(show) {\n    this.toggle_components(!show);\n    this.recent_order_list.toggle_component(show);\n    this.order_summary.toggle_component(show);\n    \n    // Return a resolved promise for consistency with async callers\n    return Promise.resolve();\n}\n\n\ttoggle_components(show) {\n\t\tthis.cart.toggle_component(show);\n\t\tthis.item_selector.toggle_component(show);\n\t\tif (this.table_selector) {\n\t\t\tthis.table_selector.toggle_component(!show);\n\t\t}\n\n\t\t// do not show item details or payment if recent order is toggled off\n\t\t!show ? (this.item_details.toggle_component(false) || this.payment.toggle_component(false)) : '';\n\t}\n\nmake_new_invoice(from_held = false) {\n    const steps = [\n        () => frappe.dom.freeze(),\n        () => this.make_sales_invoice_frm(),\n        () => this.set_pos_profile_data(),\n        () => this.set_pos_profile_status(),\n        () => this.cart.load_invoice(),\n        () => frappe.dom.unfreeze()\n    ];\n    if (from_held) {\n        // Ensure recent order list remains visible\n        steps.push(() => this.toggle_components(false)); // Hide cart explicitly\n        steps.push(() => this.recent_order_list.toggle_component(true)); // Ensure list is visible\n        steps.push(() => this.order_summary.toggle_component(true)); // Ensure summary is visible\n    }\n    return frappe.run_serially(steps);\n}\n\n\tmake_sales_invoice_frm() {\n\t\tconst doctype = 'Sales Invoice';\n\t\treturn new Promise(resolve => {\n\t\t\tif (this.frm) {\n\t\t\t\tthis.frm = this.get_new_frm(this.frm);\n\t\t\t\tthis.frm.doc.items = [];\n\t\t\t\tthis.frm.doc.is_pos = 1\n\t\t\t\tthis.frm.doc.set_warehouse = this.settings.warehouse\n\t\t\t\tif (this.selected_table && !this.frm.doc.pos_table) {\n\t\t\t\t\tthis.frm.doc.pos_table = this.selected_table;\n\t\t\t\t}\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\tfrappe.model.with_doctype(doctype, () => {\n\t\t\t\t\tthis.frm = this.get_new_frm();\n\t\t\t\t\tthis.frm.doc.items = [];\n\t\t\t\t\tthis.frm.doc.is_pos = 1\n\t\t\t\t\tthis.frm.doc.set_warehouse = this.settings.warehouse\n\t\t\t\t\tif (this.selected_table && !this.frm.doc.pos_table) {\n\t\t\t\t\t\tthis.frm.doc.pos_table = this.selected_table;\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log(\"THIS FRRRRM\")\n\t\t\t\t\tconsole.log(this.frm.doc)\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tget_new_frm(_frm) {\n\t\tconst doctype = 'Sales Invoice';\n\t\tconst page = $('<div>');\n\t\tconst frm = _frm || new frappe.ui.form.Form(doctype, page, false);\n\t\tconst name = frappe.model.make_new_doc_and_get_name(doctype, true);\n\t\tfrm.refresh(name);\n\n\t\treturn frm;\n\t}\n\n\tasync make_return_invoice(doc) {\n\t\tfrappe.dom.freeze();\n\t\tthis.frm = this.get_new_frm(this.frm);\n\t\tthis.frm.doc.items = [];\n\t\treturn frappe.call({\n\t\t\tmethod: \"posnext.posnext.page.posnext.point_of_sale.make_sales_return\",\n\t\t\targs: {\n\t\t\t\t'source_name': doc.name,\n\t\t\t\t'target_doc': this.frm.doc\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\t// console.log(r.message)\n\t\t\t\tfrappe.model.sync(r.message);\n\t\t\t\tfrappe.get_doc(r.message.doctype, r.message.name).__run_link_triggers = false;\n\t\t\t\tthis.set_pos_profile_data().then(() => {\n\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tset_pos_profile_data() {\n\t\tif (this.company && !this.frm.doc.company) this.frm.doc.company = this.company;\n\t\tif ((this.pos_profile && !this.frm.doc.pos_profile) | (this.frm.doc.is_return && this.pos_profile != this.frm.doc.pos_profile)) {\n\t\t\tthis.frm.doc.pos_profile = this.pos_profile;\n\t\t}\n\n\t\tif (!this.frm.doc.company) return;\n\n\t\treturn this.frm.trigger(\"set_pos_data\");\n\t}\n\n\tset_pos_profile_status() {\n\t\tthis.page.set_indicator(this.pos_profile, \"blue\");\n\t}\n\nasync on_cart_update(args) {\n    // REMOVE THIS LINE: frappe.dom.freeze();\n    let item_row = undefined;\n    try {\n        let { field, value, item } = args;\n        item_row = this.get_item_from_frm(item);\n        const item_row_exists = !$.isEmptyObject(item_row);\n\n        const from_selector = field === 'qty' && value === \"+1\";\n        if (from_selector)\n            value = flt(item_row.stock_qty) + flt(value);\n\n        if (item_row_exists) {\n            if (field === 'qty')\n                value = flt(value);\n\n            if (['qty', 'conversion_factor'].includes(field) && value > 0 && !this.allow_negative_stock) {\n                const qty_needed = field === 'qty' ? value * item_row.conversion_factor : item_row.qty * value;\n                await this.check_stock_availability(item_row, qty_needed, this.frm.doc.set_warehouse);\n            }\n\n            if (this.is_current_item_being_edited(item_row) || from_selector) {\n                await frappe.model.set_value(item_row.doctype, item_row.name, field, value);\n                this.update_cart_html(item_row);\n            }\n\n        } else {\n            if (!this.frm.doc.customer && !this.settings.custom_mobile_number_based_customer){\n                return this.raise_customer_selection_alert();\n            }\n            frappe.flags.ignore_company_party_validation = true\n            const { item_code, batch_no, serial_no, rate, uom } = item;\n\n            if (!item_code)\n                return;\n\n            const new_item = { item_code, batch_no, rate, uom, [field]: value };\n            if(value){\n                new_item['qty'] = value\n            }\n            if (serial_no) {\n                await this.check_serial_no_availablilty(item_code, this.frm.doc.set_warehouse, serial_no);\n                new_item['serial_no'] = serial_no;\n            }\n\n            if (field === 'serial_no')\n                new_item['qty'] = value.split(`\\n`).length || 0;\n\n            item_row = this.frm.add_child('items', new_item);\n\n            if (field === 'qty' && value !== 0 && !this.allow_negative_stock) {\n                const qty_needed = value * item_row.conversion_factor;\n                await this.check_stock_availability(item_row, qty_needed, this.frm.doc.set_warehouse);\n            }\n\n            await this.trigger_new_item_events(item_row);\n            this.update_cart_html(item_row);\n\n            if (this.item_details.$component.is(':visible'))\n                this.edit_item_details_of(item_row);\n\n            if (this.check_serial_batch_selection_needed(item_row) && !this.item_details.$component.is(':visible'))\n                this.edit_item_details_of(item_row);\n        }\n\n    } catch (error) {\n        console.log(error);\n    } finally {\n        // REMOVE THIS LINE: frappe.dom.unfreeze();\n        return item_row;\n    }\n}\n\n\traise_customer_selection_alert() {\n\t\tfrappe.dom.unfreeze();\n\t\tfrappe.show_alert({\n\t\t\tmessage: __('You must select a customer before adding an item.'),\n\t\t\tindicator: 'orange'\n\t\t});\n\t\tfrappe.utils.play_sound(\"error\");\n\t}\n\nget_item_from_frm({ name, item_code, batch_no, uom, rate }) {\n    let item_row = null;\n\n    if (name) {\n        item_row = this.frm.doc.items.find(i => i.name == name);\n    } else {\n        \n        item_row = this.frm.doc.items.find(i => {\n            const basic_match = i.item_code === item_code \n                             && i.uom === uom \n                             && i.rate === flt(rate);\n            \n            if (!basic_match) return false;\n            \n            const item_has_batch = i.has_batch_no;\n            const incoming_has_batch = (batch_no && batch_no !== 'null' && batch_no !== null);\n            \n            if (item_has_batch && incoming_has_batch) {\n                return i.batch_no === batch_no;\n            } else if (!item_has_batch && !incoming_has_batch) {\n                return true;\n            } else {\n                return false;\n            }\n        });\n    }\n    return item_row || {};\n}\n\n\tedit_item_details_of(item_row) {\n\t\tthis.item_details.toggle_item_details_section(item_row);\n\t}\n\n\tis_current_item_being_edited(item_row) {\n\t\treturn item_row.name == this.item_details.current_item.name;\n\t}\n\n\tupdate_cart_html(item_row, remove_item) {\n\t\tthis.cart.update_item_html(item_row, remove_item);\n\t\tthis.cart.update_totals_section(this.frm);\n\t}\n\n\tcheck_serial_batch_selection_needed(item_row) {\n\t\t// right now item details is shown for every type of item.\n\t\t// if item details is not shown for every item then this fn will be needed\n\t\tconst serialized = item_row.has_serial_no;\n\t\tconst batched = item_row.has_batch_no;\n\t\tconst no_serial_selected = !item_row.serial_no;\n\t\tconst no_batch_selected = !item_row.batch_no;\n\n\t\tif ((serialized && no_serial_selected) || (batched && no_batch_selected) ||\n\t\t\t(serialized && batched && (no_batch_selected || no_serial_selected))) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tasync trigger_new_item_events(item_row) {\n\t\tawait this.frm.script_manager.trigger('item_code', item_row.doctype, item_row.name);\n\t\tawait this.frm.script_manager.trigger('qty', item_row.doctype, item_row.name);\n\t}\n\n\tasync check_stock_availability(item_row, qty_needed, warehouse) {\n    const resp = (await this.get_available_stock(item_row.item_code, warehouse)).message;\n    const available_qty = resp[0][warehouse] || 0;\n    const is_stock_item = resp[1];\n\tconsole.log('Debug:', {\n        item_code: item_row.item_code, \n        available_qty, \n        is_stock_item, \n        qty_needed\n    });\n\n    // REMOVE THIS LINE: frappe.dom.unfreeze();\n    console.log(item_row)\n    const bold_uom = item_row.uom.bold();\n    const bold_item_code = item_row.item_code.bold();\n    const bold_warehouse = warehouse.bold();\n    const bold_available_qty = available_qty.toString().bold()\n    \n    if (!(available_qty > 0)) {\n        if (is_stock_item) {\n            frappe.model.clear_doc(item_row.doctype, item_row.name);\n            frappe.throw({\n                title: __(\"Not Available\"),\n                message: __('Item Code: {0} is not available under warehouse {1}.', [bold_item_code, bold_warehouse])\n            });\n        } else {\n            return;\n        }\n    } else if (is_stock_item && available_qty < qty_needed) {\n        frappe.throw({\n            message: __('Stock quantity not enough for Item Code: {0} under warehouse {1}. Available quantity {2} {3}.', [bold_item_code, bold_warehouse, bold_available_qty, bold_uom]),\n            indicator: 'orange'\n        });\n        frappe.utils.play_sound(\"error\");\n    }\n    // REMOVE THIS LINE: frappe.dom.freeze();\n}\n\n\tasync check_serial_no_availablilty(item_code, warehouse, serial_no) {\n\t\tconst method = \"erpnext.stock.doctype.serial_no.serial_no.get_pos_reserved_serial_nos\";\n\t\tconst args = {filters: { item_code, warehouse }}\n\t\tconst res = await frappe.call({ method, args });\n\n\t\tif (res.message.includes(serial_no)) {\n\t\t\tfrappe.throw({\n\t\t\t\ttitle: __(\"Not Available\"),\n\t\t\t\tmessage: __('Serial No: {0} has already been transacted into another Sales Invoice.', [serial_no.bold()])\n\t\t\t});\n\t\t}\n\t}\n\n\tget_available_stock(item_code, warehouse) {\n\t\tconst me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pos_invoice.pos_invoice.get_stock_availability\",\n\t\t\targs: {\n\t\t\t\t'item_code': item_code,\n\t\t\t\t'warehouse': warehouse,\n\t\t\t},\n\t\t\tcallback(res) {\n\t\t\t\tif (!me.item_stock_map[item_code])\n\t\t\t\t\tme.item_stock_map[item_code] = {};\n\t\t\t\tme.item_stock_map[item_code][warehouse] = res.message;\n\t\t\t}\n\t\t});\n\t}\n\n\tupdate_item_field(value, field_or_action) {\n\t\tif (field_or_action === 'checkout') {\n\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t} else if (field_or_action === 'remove') {\n\t\t\tthis.remove_item_from_cart();\n\t\t} else {\n\t\t\tconst field_control = this.item_details[`${field_or_action}_control`];\n\t\t\tif (!field_control) return;\n\t\t\tfield_control.set_focus();\n\t\t\tvalue != \"\" && field_control.set_value(value);\n\t\t}\n\t}\n\n\tremove_item_from_cart() {\n\t\tfrappe.dom.freeze();\n\t\tconst { doctype, name, current_item } = this.item_details;\n\n\t\treturn frappe.model.set_value(doctype, name, 'qty', 0)\n\t\t\t.then(() => {\n\t\t\t\tfrappe.model.clear_doc(doctype, name);\n\t\t\t\tthis.update_cart_html(current_item, true);\n\t\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t})\n\t\t\t.catch(e => console.log(e));\n\t}\n\n\tasync save_and_checkout() {\n\t\tif (this.frm.is_dirty()) {\n\t\t\tlet save_error = false;\n\t\t\tawait this.frm.save(null, null, null, () => save_error = true);\n\t\t\t// only move to payment section if save is successful\n\t\t\t!save_error && this.payment.checkout();\n\t\t\t// show checkout button on error\n\t\t\tsave_error && setTimeout(() => {\n\t\t\t\tthis.cart.toggle_checkout_btn(true);\n\t\t\t}, 300); // wait for save to finish\n\t\t} else {\n\t\t\tthis.payment.checkout();\n\t\t}\n\t}\n};\n", "frappe.provide('posnext.PointOfSale');\nvar view = \"List\"\nimport onScan from \"onscan.js\";\n\nposnext.PointOfSale.ItemSelector = class {\n\t// eslint-disable-next-line no-unused-vars\n\tconstructor({ frm, wrapper, events, pos_profile, settings,currency,init_item_cart,reload_status }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.currency = currency;\n\t\tthis.pos_profile = pos_profile;\n\t\tthis.hide_images = settings.hide_images;\n\t\tthis.reload_status = reload_status\n\t\tthis.auto_add_item = settings.auto_add_item_to_cart;\n\t\tif(settings.custom_default_view){\n\t\t\tview = settings.custom_default_view\n\t\t}\n\t\tif(settings.custom_show_only_list_view){\n\t\t\tview = \"List\"\n\t\t}\n\t\tif(settings.custom_show_only_card_view){\n\t\t\tview = \"Card\"\n\t\t}\n\t\tthis.custom_show_item_code = settings.custom_show_item_code\n\t\tthis.show_only_list_view = settings.custom_show_only_list_view\n\t\tthis.show_only_card_view = settings.custom_show_only_card_view\n\t\tthis.inti_component();\n\t}\n\n\tinti_component() {\n\n\t\tthis.prepare_dom();\n\t\tthis.make_search_bar();\n\t\tthis.load_items_data();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tif(view === \"Card\" && !this.show_only_list_view){\n\n\t\t\tthis.wrapper.append(\n\t\t\t\t`<section class=\"items-selector\" id=\"card-view-section\">\n\t\t\t\t\t<div class=\"filter-section\">\n\t\t\t\t\t\t<div class=\"label\" style=\"grid-column: span 2 / span 2\">${__('All Items')}</div>\n\t\t\t\t\t\t<div class=\"list-view\"><a class=\"list-span\">List</a></div>\n\t\t\t\t\t\t<div class=\"card-view\"><a class=\"card-span\">Card</a></div>\n\t\t\t\t\t\t<div class=\"pos-profile\" style=\"grid-column: span 2 / span 2\"></div>\n\t\t\t\t\t\t<div class=\"search-field\" style=\"grid-column: span 2 / span 2\"></div>\n\t\t\t\t\t\t<div class=\"item-group-field\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"items-container\"></div>\n\t\t\t\t</section>`\n\t\t\t);\n\n\t\t\tthis.$component = this.wrapper.find('.items-selector');\n\t\t\tthis.$items_container = this.$component.find('.items-container');\n\t\t} else if(view === \"List\" && !this.show_only_card_view) {\n\n\t\t\tthis.wrapper.append(\n\t\t\t\t`<section class=\"customer-cart-container items-selector\" id=\"list-view-section\" style=\"grid-column: span 6 / span 6;overflow-y:hidden\">\n\t\t\t\t\t<div class=\"filter-section\">\n\t\t\t\t\t\t<div class=\"label\" style=\"grid-column: span 2 / span 2\">${__('All Items')}</div>\n\t\t\t\t\t\t<div class=\"list-view\"><a class=\"list-span\">List</a></div>\n\t\t\t\t\t\t<div class=\"card-view\"><a class=\"card-span\">Card</a></div>\n\t\t\t\t\t\t<div class=\"pos-profile\" style=\"grid-column: span 2 / span 2\"></div>\n\t\t\t\t\t\t<div class=\"search-field\" style=\"grid-column: span 2 / span 2\"></div>\n\t\t\t\t\t\t<div class=\"item-group-field\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"cart-container\"></div>\n\t\t\t\t</section>`\n\t\t\t);\n\n\t\t\tthis.$component = this.wrapper.find('.customer-cart-container');\n\t\t\tthis.$items_container = this.$component.find('.cart-container');\n\t\t}\n\n\t\tthis.$list_view = this.$component.find('.list-view');\n\t\tthis.$card_view = this.$component.find('.card-view');\n\t\tif(view === \"List\" && !this.show_only_list_view){\n\t\t\tthis.$list_view.find('.list-span').css({\"display\": \"inline-block\",\"background-color\": \"#3498db\",\"color\": \"white\",\"padding\": \"5px 10px\", \"border-radius\": \"20px\", \"font-size\": \"14px\",\"font-weight\": \"bold\", \"text-transform\": \"uppercase\",\"letter-spacing\": \"1px\",\"cursor\": \"pointer\", \"transition\": \"background-color 0.3s ease\"});\n\t\t\tthis.$card_view.find('.card-span').css({\"display\":  \"\",\"background-color\": \"\",\"color\": \"\",\"padding\": \"\", \"border-radius\": \"\", \"font-size\": \"\",\"font-weight\": \"\", \"text-transform\": \"\",\"letter-spacing\": \"\",\"cursor\": \"\", \"transition\": \"\"});\n\t\t} else if(view === \"Card\" && !this.show_only_card_view){\n\t\t\tthis.$card_view.find('.card-span').css({\"display\": \"inline-block\",\"background-color\": \"#3498db\",\"color\": \"white\",\"padding\": \"5px 10px\", \"border-radius\": \"20px\", \"font-size\": \"14px\",\"font-weight\": \"bold\", \"text-transform\": \"uppercase\",\"letter-spacing\": \"1px\",\"cursor\": \"pointer\", \"transition\": \"background-color 0.3s ease\"});\n\t\t\tthis.$list_view.find('.list-span').css({\"display\":  \"\",\"background-color\": \"\",\"color\": \"\",\"padding\": \"\", \"border-radius\": \"\", \"font-size\": \"\",\"font-weight\": \"\", \"text-transform\": \"\",\"letter-spacing\": \"\",\"cursor\": \"\", \"transition\": \"\"});\n\t\t} else {\n\t\t\tthis.$list_view.find('.list-span').css({\"display\": \"none\"});\n\t\t\tthis.$card_view.find('.card-span').css({\"display\":  \"none\"});\n\n\t\t}\n\t\tif(!this.show_only_card_view && !this.show_only_list_view){\n\t\t\tthis.click_functions()\n\t\t}\n\t}\n\tclick_functions(){\n\t\tthis.$list_view.on('click', 'a', () => {\n\n\t\t\tthis.$list_view.find('.list-span').css({\"display\": \"inline-block\",\"background-color\": \"#3498db\",\"color\": \"white\",\"padding\": \"5px 10px\", \"border-radius\": \"20px\", \"font-size\": \"14px\",\"font-weight\": \"bold\", \"text-transform\": \"uppercase\",\"letter-spacing\": \"1px\",\"cursor\": \"pointer\", \"transition\": \"background-color 0.3s ease\"});\n\t\t\tthis.$card_view.find('.card-span').css({\"display\": \"\",\"background-color\": \"\",\"color\": \"\",\"padding\": \"\", \"border-radius\": \"\", \"font-size\": \"\",\"font-weight\": \"\", \"text-transform\": \"\",\"letter-spacing\": \"\",\"cursor\": \"\", \"transition\": \"\"});\n\t\t\tview = \"List\"\n\t\t\tif(document.getElementById(\"card-view-section\")) document.getElementById(\"card-view-section\").remove()\n\t\t\tif(document.getElementById(\"list-view-section\")) document.getElementById(\"list-view-section\").remove()\n\t\t\tif(document.getElementById(\"customer-cart-container2\")) document.getElementById(\"customer-cart-container2\").remove()\n\t\t\tif(document.getElementById(\"item-details-container\")) document.getElementById(\"item-details-container\").remove()\n\n\t\t\tthis.inti_component()\n\t\t\tthis.events.init_item_details()\n\t\t\tthis.events.init_item_cart()\n\t\t\tthis.events.change_items(this.events.get_frm())\n\n\n\t\t});\n\t\tthis.$card_view.on('click', 'a', () => {\n\t\t\tthis.$card_view.find('.card-span').css({\"display\": \"inline-block\",\"background-color\": \"#3498db\",\"color\": \"white\",\"padding\": \"5px 10px\", \"border-radius\": \"20px\", \"font-size\": \"14px\",\"font-weight\": \"bold\", \"text-transform\": \"uppercase\",\"letter-spacing\": \"1px\",\"cursor\": \"pointer\", \"transition\": \"background-color 0.3s ease\"});\n\t\t\tthis.$list_view.find('.list-span').css({\"display\": \"\",\"background-color\": \"\",\"color\": \"\",\"padding\": \"\", \"border-radius\": \"\", \"font-size\": \"\",\"font-weight\": \"\", \"text-transform\": \"\",\"letter-spacing\": \"\",\"cursor\": \"\", \"transition\": \"\"});\n\t\t\tview = \"Card\"\n\t\t\tif(document.getElementById(\"card-view-section\")) document.getElementById(\"card-view-section\").remove()\n\t\t\tif(document.getElementById(\"list-view-section\")) document.getElementById(\"list-view-section\").remove()\n\t\t\tif(document.getElementById(\"customer-cart-container2\")) document.getElementById(\"customer-cart-container2\").remove()\n\t\t\tif(document.getElementById(\"item-details-container\")) document.getElementById(\"item-details-container\").remove()\n\n\t\t\tthis.inti_component()\n\t\t\tthis.events.init_item_details()\n\t\t\tthis.events.init_item_cart()\n\t\t\tthis.events.change_items(this.events.get_frm())\n\n\t\t});\n\t}\n\tasync load_items_data() {\n\t\tif (!this.item_group) {\n\t\t\tconst res = await frappe.db.get_value(\"Item Group\", {lft: 1, is_group: 1}, \"name\");\n\t\t\tthis.parent_item_group = res.message.name;\n\t\t}\n\t\tif (!this.price_list) {\n\t\t\tconst res = await frappe.db.get_value(\"POS Profile\", this.pos_profile, \"selling_price_list\");\n\t\t\tthis.price_list = res.message.selling_price_list;\n\t\t}\n\n\t\tthis.get_items({}).then(({message}) => {\n\t\t\tthis.render_item_list(message.items);\n\t\t});\n\t}\n\n\tget_items({start = 0, page_length = 40, search_term=''}) {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst price_list = (doc && doc.selling_price_list) || this.price_list;\n\t\tlet { item_group, pos_profile } = this;\n\n\t\t!item_group && (item_group = this.parent_item_group);\n\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.get_items\",\n\t\t\tfreeze: true,\n\t\t\targs: { start, page_length, price_list, item_group, search_term, pos_profile },\n\t\t});\n\t}\n\n\n\trender_item_list(items) {\n\t\tvar  me  = this\n\t\tif(view === \"List\"){\n\t\tthis.$items_container.html('');\n\t\t\tthis.$items_container.append(\n\t\t\t\t`<div class=\"abs-cart-container\" style=\"overflow-y:hidden\">\n\t\t\t\t\t<div class=\"cart-header\">\n\t\t\t\t\t${get_item_code_header()}\n\t\t\t\t\t\t<div style=\"flex: 1\">${__('Rate')}</div>\n\t\t\t\t\t\t<div style=\"flex: 1\">${__('Available Qty')}</div>\n\t\t\t\t\t\t<div class=\"qty-header\">${__('UOM')}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"cart-items-section\" style=\"overflow-y:hidden\"></div>\n\t\t\t\t</div>`)\n\n\t\t\tfunction get_item_code_header() {\n\n\t\t\t\tif(me.custom_show_item_code){\n\t\t\t\t\treturn `<div style=\"flex: 2\">${__('Item')}</div>\n\t\t\t\t\t\t<div style=\"flex: 1\">${__('Item Code')}</div>`\n\t\t\t\t} else {\n\t\t\t\t\treturn `<div style=\"flex: 3\">${__('Item')}</div>`\n\t\t\t\t}\n            }\n\t\t\tthis.make_cart_items_section();\n\t\t\titems.forEach(item => {\n\n\t\t\t\tthis.render_cart_item(item);\n\n\t\t\t\t// this.$items_container.append(item_html);\n\t\t\t});\n\t\t} else {\n\t\t\titems.forEach(item => {\n                var item_html = this.get_item_html(item);\n                this.$items_container.append(item_html);\n        \t})\n\t\t}\n\n\t\t// this.$cart_container = this.$component.find('.cart-container');\n\n\n\t}\n\tmake_cart_items_section() {\n\t\tthis.$cart_header = this.$component.find('.cart-header');\n\t\tthis.$cart_items_wrapper = this.$component.find('.cart-items-section');\n\n\t}\n\tget_cart_item({ name }) {\n\t\tconst item_selector = `.cart-item-wrapper[data-row-name=\"${escape(name)}\"]`;\n\t\treturn this.$cart_items_wrapper.find(item_selector);\n\t}\n\tget_cart_item1({ item_code }) {\n\t\tconst item_selector = `.cart-item-wrapper[data-row-name=\"${escape(item_code)}\"]`;\n\t\treturn this.$cart_items_wrapper.find(item_selector);\n\t}\n\trender_cart_item(item_data) {\n\n\t\tconst me = this;\n\t\tconst currency = me.events.get_frm().currency || me.currency;\n\t\tthis.$cart_items_wrapper.append(\n\t\t\t`<div class=\"cart-item-wrapper item-wrapper\" \n\t\t\tdata-item-code=\"${escape(item_data.item_code)}\" \n\t\t\tdata-serial-no=\"${escape(item_data.serial_no)}\"\n\t\t\tdata-batch-no=\"${escape(item_data.batch_no)}\" \n\t\t\tdata-uom=\"${escape(item_data.uom)}\"\n\t\t\tdata-rate=\"${escape(item_data.price_list_rate || 0)}\"\n\t\t\ttitle=\"${item_data.item_name}\"\n\t\t\tdata-row-name=\"${escape(item_data.item_code)}\"></div>\n\t\t\t<div class=\"seperator\"></div>`\n\t\t)\n\t\tvar $item_to_update = this.get_cart_item1(item_data);\n\n\t\t$item_to_update.html(\n\t\t\t`${get_item_image_html()}\n\t\t\t${get_item_name()}\n\t\t\t\t<div class=\"item-name\" >\n\t\t\t\t\t${item_data.item_name}\n\t\t\t\t</div>\n\t\t\t\t${get_description_html()}\n\t\t\t</div>\n\t\t\t${get_item_code()}\n\t\t\t${get_rate_discount_html()}`\n\t\t)\n\t\t\tfunction get_item_name() {\n\t\t\tif(me.custom_show_item_code){\n\t\t\t\treturn `<div class=\"item-name-desc\" style=\"flex: 3\">`\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-name-desc\" style=\"flex: 4\">`\n\t\t\t}\n        }\n        function get_item_code() {\n\t\t\tif(me.custom_show_item_code){\n\t\t\t\treturn `<div class=\"item-code-desc\" style=\"flex: 1\">\n\t\t\t\t\t<div class=\"item-code\" >\n\t\t\t\t\t\t${item_data.item_code}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t\t} else {\n\t\t\t\treturn ``\n\t\t\t}\n        }\n\t\tset_dynamic_rate_header_width();\n\n\t\tfunction set_dynamic_rate_header_width() {\n\t\t\tconst rate_cols = Array.from(me.$cart_items_wrapper.find(\".item-rate-amount\"));\n\t\t\tme.$cart_header.find(\".rate-amount-header\").css(\"width\", \"\");\n\t\t\tme.$cart_items_wrapper.find(\".item-rate-amount\").css(\"width\", \"\");\n\t\t\tvar max_width = rate_cols.reduce((max_width, elm) => {\n\t\t\t\tif ($(elm).width() > max_width)\n\t\t\t\t\tmax_width = $(elm).width();\n\t\t\t\treturn max_width;\n\t\t\t}, 0);\n\n\t\t\tmax_width += 1;\n\t\t\tif (max_width == 1) max_width = \"\";\n\n\t\t\tme.$cart_header.find(\".rate-amount-header\").css(\"width\", max_width);\n\t\t\tme.$cart_items_wrapper.find(\".item-rate-amount\").css(\"width\", max_width);\n\t\t}\n\n\t\tfunction get_rate_discount_html() {\n\t\t\tif (item_data.rate && item_data.amount && item_data.rate !== item_data.amount) {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-qty-rate\" style=\"flex: 5\">\n\t\t\t\t\t\t<div class=\"item-rate-amount\" style=\"flex: 1\">\n\t\t\t\t\t\t\t<div class=\"item-rate\" style=\"text-align: center\">${format_currency(item_data.price_list_rate, currency)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"item-qty\" style=\"flex: 1;display:block;text-align: center\"><span> ${item_data.actual_qty || 0}</span></div>\n\t\t\t\t\t\t<div class=\"item-qty\" style=\"margin: 0\"><span> ${item_data.uom}</span></div>\n\t\t\t\t\t\t\n\t\t\t\t\t</div>`\n\t\t\t} else {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-qty-rate\" style=\"flex: 5\">\n\t\t\t\t\t\t<div class=\"item-rate-amount\" style=\"flex: 1\">\n\t\t\t\t\t\t\t<div class=\"item-rate\" style=\"text-align: center\">${format_currency(item_data.price_list_rate, currency)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"item-qty\" style=\"flex: 1;display:block;text-align: center\"><span> ${item_data.actual_qty || 0}</span></div>\n\t\t\t\t\t\t<div class=\"item-qty\" style=\"margin: 0\"><span> ${item_data.uom}</span></div>\n\t\t\t\t\t\t\n\t\t\t\t\t</div>`\n\t\t\t}\n\t\t}\n\n\t\tfunction get_description_html() {\n\t\t\tif (item_data.description) {\n\t\t\t\tif (item_data.description.indexOf('<div>') != -1) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\titem_data.description = $(item_data.description).text();\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\titem_data.description = item_data.description.replace(/<div>/g, ' ').replace(/<\\/div>/g, ' ').replace(/ +/g, ' ');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\titem_data.description = frappe.ellipsis(item_data.description, 45);\n\t\t\t\treturn `<div class=\"item-desc\">${item_data.description}</div>`;\n\t\t\t}\n\t\t\treturn ``;\n\t\t}\n\n\t\tfunction get_item_image_html() {\n\t\t\tconst { image, item_name } = item_data;\n\t\t\tif (!me.hide_images && image) {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-image\">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tonerror=\"cur_pos.cart.handle_broken_image(this)\"\n\t\t\t\t\t\t\tsrc=\"${image}\" alt=\"${frappe.get_abbr(item_name)}\"\">\n\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-image item-abbr\">${frappe.get_abbr(item_name)}</div>`;\n\t\t\t}\n\t\t}\n\t}\n\tget_item_html(item) {\n\t\tconst me = this;\n\t\titem.currency = item.currency  || me.currency\n\t\t// eslint-disable-next-line no-unused-vars\n\t\tconst { item_image, serial_no, batch_no, barcode, actual_qty, uom, price_list_rate } = item;\n\t\tconst precision = flt(price_list_rate, 2) % 1 != 0 ? 2 : 0;\n\t\tlet indicator_color;\n\t\tlet qty_to_display = actual_qty;\n\n\t\tif (item.is_stock_item) {\n\t\t\tindicator_color = (actual_qty > 10 ? \"green\" : actual_qty <= 0 ? \"red\" : \"orange\");\n\n\t\t\tif (Math.round(qty_to_display) > 999) {\n\t\t\t\tqty_to_display = Math.round(qty_to_display)/1000;\n\t\t\t\tqty_to_display = qty_to_display.toFixed(1) + 'K';\n\t\t\t}\n\t\t} else {\n\t\t\tindicator_color = '';\n\t\t\tqty_to_display = '';\n\t\t}\n\n\t\tfunction get_item_image_html() {\n\t\t\tif (!me.hide_images && item_image) {\n\t\t\t\treturn `<div class=\"item-qty-pill\">\n\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color}\">${qty_to_display}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"flex items-center justify-center h-32 border-b-grey text-6xl text-grey-100\">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tonerror=\"cur_pos.item_selector.handle_broken_image(this)\"\n\t\t\t\t\t\t\t\tclass=\"h-full item-img\" src=\"${item_image}\"\n\t\t\t\t\t\t\t\talt=\"${frappe.get_abbr(item.item_name)}\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-qty-pill\">\n\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color}\">${qty_to_display}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"item-display abbr\">${frappe.get_abbr(item.item_name)}</div>`;\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t`<div class=\"item-wrapper\"\n\t\t\t\tdata-item-code=\"${escape(item.item_code)}\" data-serial-no=\"${escape(serial_no)}\"\n\t\t\t\tdata-batch-no=\"${escape(batch_no)}\" data-uom=\"${escape(uom)}\"\n\t\t\t\tdata-rate=\"${escape(price_list_rate || 0)}\"\n\t\t\t\ttitle=\"${item.item_name}\">\n\n\t\t\t\t${get_item_image_html()}\n\n\t\t\t\t<div class=\"item-detail\">\n\t\t\t\t\t<div class=\"item-name\">\n\t\t\t\t\t\t${frappe.ellipsis(item.item_name, 18)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"item-rate\">${format_currency(price_list_rate, item.currency, precision) || 0} / ${uom}</div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t);\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr('alt');\n\t\t$($img).parent().replaceWith(`<div class=\"item-display abbr\">${item_abbr}</div>`);\n\t}\n\n\tmake_search_bar() {\n\t\tconst me = this;\n\t\tconst doc = me.events.get_frm().doc;\n\t\tthis.$component.find('.search-field').html('');\n\t\tthis.$component.find('.pos-profile').html('');\n\t\tthis.$component.find('.item-group-field').html('');\n\t\tthis.pos_profile_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('POS Profile'),\n\t\t\t\tfieldtype: 'Link',\n\t\t\t\toptions: 'POS Profile',\n\t\t\t\tplaceholder: __('POS Profile'),\n                onchange: function () {\n\n\t\t\t\t\tif(me.reload_status && me.pos_profile !== this.value){\n\t\t\t\t\t\tfrappe.pages['posnext'].refresh(window.wrapper,window.onScan,this.value)\n\t\t\t\t\t}\n\n\t\t\t\t\t// console.log(\"ON ON CHANGE\")\n\t\t\t\t\t// console.log(this.pos_profile_field)\n\t\t\t\t\t// var value = this.pos_profile_field.get_value()\n\t\t\t\t\t// if(value !== me.pos_profile){\n\t\t\t\t\t// \tthis.events.check_opening_entry()\n\t\t\t\t\t// }\n\t\t\t\t\t// window.wrapper.please_refresh = true\n\t\t\t\t\t// frappe.pages['posnext'].refresh_data(window.wrapper)\n\t\t\t\t\t// console.log(\"HEEEERE\")\n                }\n\t\t\t},\n\t\t\tparent: this.$component.find('.pos-profile'),\n\t\t\trender_input: false,\n\t\t});\n\t\tthis.search_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Search'),\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tplaceholder: __('Search by item code, serial number or barcode')\n\t\t\t},\n\t\t\tparent: this.$component.find('.search-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.item_group_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Item Group'),\n\t\t\t\tfieldtype: 'Link',\n\t\t\t\toptions: 'Item Group',\n\t\t\t\tplaceholder: __('Select item group'),\n\t\t\t\tonchange: function() {\n\t\t\t\t\tme.item_group = this.value;\n\t\t\t\t\t!me.item_group && (me.item_group = me.parent_item_group);\n\t\t\t\t\tme.filter_items();\n\t\t\t\t},\n\t\t\t\tget_query: function () {\n\t\t\t\t\t//const doc = me.events.get_frm().doc;\n\t\t\t\t\treturn {\n\t\t\t\t\t\tquery: 'erpnext.selling.page.point_of_sale.point_of_sale.item_group_query',\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\tpos_profile: doc ? doc.pos_profile : ''\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$component.find('.item-group-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.pos_profile_field.set_value(me.pos_profile)\n\t\tthis.pos_profile_field.refresh()\n\t\tthis.pos_profile_field.toggle_label(false);\n\t\tthis.search_field.toggle_label(false);\n\t\tthis.item_group_field.toggle_label(false);\n\n\t\tthis.attach_clear_btn();\n\t}\n\n\tattach_clear_btn() {\n\t\tthis.search_field.$wrapper.find('.control-input').append(\n\t\t\t`<span class=\"link-btn\" style=\"top: 2px;\">\n\t\t\t\t<a class=\"btn-open no-decoration\" title=\"${__(\"Clear\")}\">\n\t\t\t\t\t${frappe.utils.icon('close', 'sm')}\n\t\t\t\t</a>\n\t\t\t</span>`\n\t\t);\n\n\t\tthis.$clear_search_btn = this.search_field.$wrapper.find('.link-btn');\n\n\t\tthis.$clear_search_btn.on('click', 'a', () => {\n\t\t\tthis.set_search_value('');\n\t\t\tthis.search_field.set_focus();\n\t\t});\n\t}\n\n\tset_search_value(value) {\n\t\t$(this.search_field.$input[0]).val(value).trigger(\"input\");\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\t\twindow.onScan = onScan;\n\n\t\t\tonScan.decodeKeyEvent = function (oEvent) {\n\t\t\t\tvar iCode = this._getNormalizedKeyNum(oEvent);\n\t\t\t\tswitch (true) {\n\t\t\t\t\tcase iCode >= 48 && iCode <= 90: // numbers and letters\n\t\t\t\t\tcase iCode >= 106 && iCode <= 111: // operations on numeric keypad (+, -, etc.)\n\t\t\t\t\tcase (iCode >= 160 && iCode <= 164) || iCode == 170: // ^ ! # $ *\n\t\t\t\t\tcase iCode >= 186 && iCode <= 194: // (; = , - . / `)\n\t\t\t\t\tcase iCode >= 219 && iCode <= 222: // ([ \\ ] ')\n\t\t\t\t\tcase iCode == 32: // spacebar\n\t\t\t\t\t\tif (oEvent.key !== undefined && oEvent.key !== '') {\n\t\t\t\t\t\t\treturn oEvent.key;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar sDecoded = String.fromCharCode(iCode);\n\t\t\t\t\t\tswitch (oEvent.shiftKey) {\n\t\t\t\t\t\t\tcase false: sDecoded = sDecoded.toLowerCase(); break;\n\t\t\t\t\t\t\tcase true: sDecoded = sDecoded.toUpperCase(); break;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn sDecoded;\n\t\t\t\t\tcase iCode >= 96 && iCode <= 105: // numbers on numeric keypad\n\t\t\t\t\t\treturn 0 + (iCode - 96);\n\t\t\t\t}\n\t\t\t\treturn '';\n\t\t\t};\n\n\t\t\tonScan.attachTo(document, {\n\t\t\t\tonScan: (sScancode) => {\n\t\t\t\t\tif (this.search_field && this.$component.is(':visible')) {\n\t\t\t\t\t\tthis.search_field.set_focus();\n\t\t\t\t\t\tthis.set_search_value(sScancode);\n\t\t\t\t\t\tthis.barcode_scanned = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\n\t\tthis.$component.on('click', '.item-wrapper', function() {\n\t\t\tconst $item = $(this);\n\t\t\tconst item_code = unescape($item.attr('data-item-code'));\n\t\t\tlet batch_no = unescape($item.attr('data-batch-no'));\n\t\t\tlet serial_no = unescape($item.attr('data-serial-no'));\n\t\t\tlet uom = unescape($item.attr('data-uom'));\n\t\t\tlet rate = unescape($item.attr('data-rate'));\n\n\t\t\t// escape(undefined) returns \"un\tdefined\" then unescape returns \"undefined\"\n\t\t\tbatch_no = batch_no === \"undefined\" ? undefined : batch_no;\n\t\t\tserial_no = serial_no === \"undefined\" ? undefined : serial_no;\n\t\t\tuom = uom === \"undefined\" ? undefined : uom;\n\t\t\trate = rate === \"undefined\" ? undefined : rate;\n\t\t\tme.events.item_selected({\n\t\t\t\tfield: 'qty',\n\t\t\t\tvalue: \"+1\",\n\t\t\t\titem: { item_code, batch_no, serial_no, uom, rate }\n\t\t\t});\n\t\t\tme.search_field.set_focus();\n\t\t});\n\n\t\tthis.search_field.$input.on('input', (e) => {\n\t\t\tclearTimeout(this.last_search);\n\t\t\tthis.last_search = setTimeout(() => {\n\t\t\t\tconst search_term = e.target.value;\n\t\t\t\tthis.filter_items({ search_term });\n\t\t\t}, 300);\n\n\t\t\tthis.$clear_search_btn.toggle(\n\t\t\t\tBoolean(this.search_field.$input.val())\n\t\t\t);\n\t\t});\n\n\t\tthis.search_field.$input.on('focus', () => {\n\t\t\tthis.$clear_search_btn.toggle(\n\t\t\t\tBoolean(this.search_field.$input.val())\n\t\t\t);\n\t\t});\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '\u2318' : 'Ctrl';\n\t\tthis.search_field.parent.attr(\"title\", `${ctrl_label}+I`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+i\",\n\t\t\taction: () => this.search_field.set_focus(),\n\t\t\tcondition: () => this.$component.is(':visible'),\n\t\t\tdescription: __(\"Focus on search input\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tthis.item_group_field.parent.attr(\"title\", `${ctrl_label}+G`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+g\",\n\t\t\taction: () => this.item_group_field.set_focus(),\n\t\t\tcondition: () => this.$component.is(':visible'),\n\t\t\tdescription: __(\"Focus on Item Group filter\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\n\t\t// for selecting the last filtered item on search\n\t\tfrappe.ui.keys.on(\"enter\", () => {\n\t\t\tconst selector_is_visible = this.$component.is(':visible');\n\t\t\tif (!selector_is_visible || this.search_field.get_value() === \"\") return;\n\n\t\t\tif (this.items.length == 1) {\n\t\t\t\tthis.$items_container.find(\".item-wrapper\").click();\n\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\tthis.set_search_value('');\n\t\t\t} else if (this.items.length == 0 && this.barcode_scanned) {\n\t\t\t\t// only show alert of barcode is scanned and enter is pressed\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"No items found. Scan barcode again.\"),\n\t\t\t\t\tindicator: 'orange'\n\t\t\t\t});\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\tthis.barcode_scanned = false;\n\t\t\t\tthis.set_search_value('');\n\t\t\t}\n\t\t});\n\t}\n\n\tfilter_items({ search_term='' }={}) {\n\t\tif (search_term) {\n\t\t\tsearch_term = search_term.toLowerCase();\n\n\t\t\t// memoize\n\t\t\tthis.search_index = this.search_index || {};\n\t\t\tif (this.search_index[search_term]) {\n\t\t\t\tconst items = this.search_index[search_term];\n\t\t\t\tthis.items = items;\n\t\t\t\tthis.render_item_list(items);\n\t\t\t\tthis.auto_add_item && this.items.length == 1 && this.add_filtered_item_to_cart();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.get_items({ search_term })\n\t\t\t.then(({ message }) => {\n\t\t\t\t// eslint-disable-next-line no-unused-vars\n\t\t\t\tconst { items, serial_no, batch_no, barcode } = message;\n\t\t\t\tif (search_term && !barcode) {\n\t\t\t\t\tthis.search_index[search_term] = items;\n\t\t\t\t}\n\t\t\t\tthis.items = items;\n\t\t\t\tthis.render_item_list(items);\n\t\t\t\tthis.auto_add_item && this.items.length == 1 && this.add_filtered_item_to_cart();\n\t\t\t});\n\t}\n\n\tadd_filtered_item_to_cart() {\n\t\tthis.$items_container.find(\".item-wrapper\").click();\n\t\tthis.set_search_value('');\n\t}\n\n\tresize_selector(minimize) {\n\t\tminimize ?\n\t\t\tthis.$component.find('.filter-section').css('grid-template-columns', 'repeat(1, minmax(0, 1fr))') :\n\t\t\tthis.$component.find('.filter-section').css('grid-template-columns', 'repeat(12, minmax(0, 1fr))');\n\n\t\tminimize ?\n\t\t\tthis.$component.find('.search-field').css('margin', 'var(--margin-sm) 0px') :\n\t\t\tthis.$component.find('.search-field').css('margin', '0px var(--margin-sm)');\n\n\t\tminimize ?\n\t\t\tthis.$component.css('grid-column', 'span 2 / span 2') :\n\t\t\tthis.$component.css('grid-column', 'span 6 / span 6');\n\n\t\tminimize ?\n\t\t\tthis.$items_container.css('grid-template-columns', 'repeat(1, minmax(0, 1fr))') :\n\t\t\tthis.$items_container.css('grid-template-columns', 'repeat(4, minmax(0, 1fr))');\n\t}\n\n\ttoggle_component(show) {\n\t\tthis.set_search_value('');\n\t\tthis.$component.css('display', show ? 'flex': 'none');\n\t}\n};\n", "frappe.provide('posnext.PointOfSale');\nposnext.PointOfSale.ItemCart = class {\n\tconstructor({ wrapper, events, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.customer_info = undefined;\n\t\tthis.hide_images = settings.hide_images;\n\t\tthis.allowed_customer_groups = settings.customer_groups;\n\t\tthis.allow_rate_change = settings.allow_rate_change;\n\t\tthis.allow_discount_change = settings.allow_discount_change;\n\t\tthis.show_held_button = settings.custom_show_held_button;\n\t\tthis.show_order_list_button = settings.custom_show_order_list_button;\n\t\tthis.mobile_number_based_customer = settings.custom_mobile_number_based_customer;\n\t\tthis.show_checkout_button = settings.custom_show_checkout_button;\n\t\tthis.settings = settings;\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_child_components();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"customer-cart-container customer-cart-container1 \" id=\"customer-cart-container2\"></section>`\n\t\t)\n\t\tthis.$component = this.wrapper.find('.customer-cart-container1');\n\t}\n\n\tinit_child_components() {\n\t\tthis.init_customer_selector();\n\t\tthis.init_cart_components();\n\t}\n\n\tinit_customer_selector() {\n\t\tthis.$component.append(\n\t\t\t`<div class=\"customer-section\"></div>`\n\t\t)\n\t\tthis.$customer_section = this.$component.find('.customer-section');\n\t\tthis.make_customer_selector();\n\t}\n\n\treset_customer_selector() {\n\t\tconst frm = this.events.get_frm();\n\t\tfrm.set_value('customer', '');\n\t\tthis.make_customer_selector();\n\t\tthis.customer_field.set_focus();\n\t}\n\n\tinit_cart_components() {\n\t\tthis.$component.append(\n\t\t\t`<div class=\"cart-container\">\n\t\t\t\t<div class=\"abs-cart-container\">\n\t\t\t\t\t<div class=\"cart-label\">${__('Item Cart')}</div>\n\t\t\t\t\t<div class=\"cart-header\">\n\t\t\t\t\t\t<div class=\"name-header\">${__('Item')}</div>\n\t\t\t\t\t\t<div class=\"qty-header\">${__('Quantity')}</div>\n\t\t\t\t\t\t<div class=\"rate-amount-header\">${__('Amount')}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"cart-items-section\"></div>\n\t\t\t\t\t<div class=\"cart-totals-section\"></div>\n\t\t\t\t\t<div class=\"numpad-section\"></div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t);\n\t\tthis.$cart_container = this.$component.find('.cart-container');\n\n\t\tthis.make_cart_totals_section();\n\t\tthis.make_cart_items_section();\n\t\tthis.make_cart_numpad();\n\t}\n\n\tmake_cart_items_section() {\n\t\tthis.$cart_header = this.$component.find('.cart-header');\n\t\tthis.$cart_items_wrapper = this.$component.find('.cart-items-section');\n\n\t\tthis.make_no_items_placeholder();\n\t}\n\n\tmake_no_items_placeholder() {\n\t\tthis.$cart_header.css('display', 'none');\n\t\tthis.$cart_items_wrapper.html(\n\t\t\t`<div class=\"no-item-wrapper\">${__('No items in cart')}</div>`\n\t\t);\n\t}\n\n\tget_discount_icon() {\n\t\treturn (\n\t\t\t`<svg class=\"discount-icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t<path d=\"M19 15.6213C19 15.2235 19.158 14.842 19.4393 14.5607L20.9393 13.0607C21.5251 12.4749 21.5251 11.5251 20.9393 10.9393L19.4393 9.43934C19.158 9.15804 19 8.7765 19 8.37868V6.5C19 5.67157 18.3284 5 17.5 5H15.6213C15.2235 5 14.842 4.84196 14.5607 4.56066L13.0607 3.06066C12.4749 2.47487 11.5251 2.47487 10.9393 3.06066L9.43934 4.56066C9.15804 4.84196 8.7765 5 8.37868 5H6.5C5.67157 5 5 5.67157 5 6.5V8.37868C5 8.7765 4.84196 9.15804 4.56066 9.43934L3.06066 10.9393C2.47487 11.5251 2.47487 12.4749 3.06066 13.0607L4.56066 14.5607C4.84196 14.842 5 15.2235 5 15.6213V17.5C5 18.3284 5.67157 19 6.5 19H8.37868C8.7765 19 9.15804 19.158 9.43934 19.4393L10.9393 20.9393C11.5251 21.5251 12.4749 21.5251 13.0607 20.9393L14.5607 19.4393C14.842 19.158 15.2235 19 15.6213 19H17.5C18.3284 19 19 18.3284 19 17.5V15.6213Z\" stroke-miterlimit=\"10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M15 9L9 15\" stroke-miterlimit=\"10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M10.5 9.5C10.5 10.0523 10.0523 10.5 9.5 10.5C8.94772 10.5 8.5 10.0523 8.5 9.5C8.5 8.94772 8.94772 8.5 9.5 8.5C10.0523 8.5 10.5 8.94772 10.5 9.5Z\" fill=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M15.5 14.5C15.5 15.0523 15.0523 15.5 14.5 15.5C13.9477 15.5 13.5 15.0523 13.5 14.5C13.5 13.9477 13.9477 13.5 14.5 13.5C15.0523 13.5 15.5 13.9477 15.5 14.5Z\" fill=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t</svg>`\n\t\t);\n\t}\n\nmake_cart_totals_section() {\n    this.$totals_section = this.$component.find('.cart-totals-section');\n\n    this.$totals_section.append(\n        `<div class=\"add-discount-wrapper\">\n            ${this.get_discount_icon()} ${__('Add Discount')}\n        </div>\n        <div class=\"item-qty-total-container\">\n            <div class=\"item-qty-total-label\">${__('Total Items')}</div>\n            <div class=\"item-qty-total-value\">0.00</div>\n        </div>\n        <div class=\"net-total-container\">\n            <div class=\"net-total-label\">${__(\"Net Total\")}</div>\n            <div class=\"net-total-value\">0.00</div>\n        </div>\n        <div class=\"taxes-container\"></div>\n        <div class=\"grand-total-container\">\n            <div>${__('Grand Total')}</div>\n            <div>0.00</div>\n        </div>\n        <div style=\"display: flex; justify-content: space-between; gap: 10px;\">\n         ${!frappe.user_roles.includes('Waiter') ? `\n                <div class=\"checkout-btn\" style=\"\n                    padding: 10px;\n                    align-items: center;\n                    justify-content: center;\n                    color: white;\n                    border: none;\n                    border-radius: 5px;\n                    cursor: pointer;\n                    flex: 1;\">${__('Checkout')}</div>\n            ` : ''}\n            <div class=\"checkout-btn-held\" style=\"\n                padding: 10px;\n                align-items: center;\n                justify-content: center;\n                color: white;\n                border: none;\n                border-radius: 5px;\n                cursor: pointer;\n                flex: 1;\">${__('Held')}</div>\n            <div class=\"checkout-btn-order\" style=\"\n                padding: 10px;\n                align-items: center;\n                justify-content: center;\n                color: white;\n                border: none;\n                border-radius: 5px;\n                cursor: pointer;\n                flex: 1;\">${__('Order List')}</div>\n        </div>    \n        <div class=\"edit-cart-btn\">${__('Edit Cart')}</div>`\n    );\n\n    this.$add_discount_elem = this.$component.find(\".add-discount-wrapper\");\n    this.highlight_checkout_btn(true);\n}\n\n\tmake_cart_numpad() {\n\t\tthis.$numpad_section = this.$component.find('.numpad-section');\n\n\t\tthis.number_pad = new posnext.PointOfSale.NumberPad({\n\t\t\twrapper: this.$numpad_section,\n\t\t\tevents: {\n\t\t\t\tnumpad_event: this.on_numpad_event.bind(this)\n\t\t\t},\n\t\t\tcols: 5,\n\t\t\tkeys: [\n\t\t\t\t[ 1, 2, 3, 'Quantity' ],\n\t\t\t\t[ 4, 5, 6, 'Discount' ],\n\t\t\t\t[ 7, 8, 9, 'Rate' ],\n\t\t\t\t[ '.', 0, 'Delete', 'Remove' ]\n\t\t\t],\n\t\t\tcss_classes: [\n\t\t\t\t[ '', '', '', 'col-span-2' ],\n\t\t\t\t[ '', '', '', 'col-span-2' ],\n\t\t\t\t[ '', '', '', 'col-span-2' ],\n\t\t\t\t[ '', '', '', 'col-span-2 remove-btn' ]\n\t\t\t],\n\t\t\tfieldnames_map: { 'Quantity': 'qty', 'Discount': 'discount_percentage' }\n\t\t})\n\n\t\tthis.$numpad_section.prepend(\n\t\t\t`<div class=\"numpad-totals\">\n\t\t\t<span class=\"numpad-item-qty-total\"></span>\n\t\t\t\t<span class=\"numpad-net-total\"></span>\n\t\t\t\t<span class=\"numpad-grand-total\"></span>\n\t\t\t</div>`\n\t\t)\n\n\t\tthis.$numpad_section.append(\n\t\t\t`<div class=\"numpad-btn checkout-btn\" data-button-value=\"checkout\">${__('Checkout')}</div>`\n\t\t)\n\t}\n\n\t// Optimized mobile number dialog creation\n\tcreate_mobile_dialog(callback) {\n\t\tconst me = this;\n\t\tlet dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Enter Mobile Number',\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Mobile Number',\n\t\t\t\t\tfieldname: 'mobile_number',\n\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\treqd: 1\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: '',\n\t\t\t\t\tfieldname: 'mobile_number_numpad',\n\t\t\t\t\tfieldtype: 'HTML',\n\t\t\t\t\toptions: `<div class=\"mobile_number_numpad\">\n\t\t\t\t\t\t<div class=\"custom-numpad\">\n\t\t\t\t\t\t\t<style>\n\t\t\t\t\t\t\t.custom-numpad {\n\t\t\t\t\t\t\t\tdisplay: grid;\n\t\t\t\t\t\t\t\tgrid-template-columns: repeat(3, 1fr);\n\t\t\t\t\t\t\t\tgap: 10px;\n\t\t\t\t\t\t\t\tmax-width: 350px;\n\t\t\t\t\t\t\t\tmargin: 0 auto;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t.numpad-button {\n\t\t\t\t\t\t\t\tpadding: 15px;\n\t\t\t\t\t\t\t\tfont-size: 18px;\n\t\t\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\t\t\tbackground-color: #f1f1f1;\n\t\t\t\t\t\t\t\tborder: 1px solid #ccc;\n\t\t\t\t\t\t\t\tborder-radius: 5px;\n\t\t\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t.numpad-button:hover {\n\t\t\t\t\t\t\t\tbackground-color: #ddd;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t</style>\n\t\t\t\t\t\t\t<button class=\"numpad-button one\">1</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button two\">2</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button three\">3</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button four\">4</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button five\">5</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button six\">6</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button seven\">7</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button eight\">8</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button nine\">9</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button delete\" style=\"color: red\">x</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button zero\">0</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button clear\">C</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`\n\t\t\t\t},\n\t\t\t],\n\t\t\tsize: 'small',\n\t\t\tprimary_action_label: 'Continue',\n\t\t\tprimary_action: callback\n\t\t});\n\n\t\t// Bind numpad events efficiently\n\t\tconst numpad = dialog.wrapper.find(\".custom-numpad\");\n\t\tconst numbers = [\"one\", \"two\", \"three\", \"four\", \"five\", \"six\", \"seven\", \"eight\", \"nine\", \"zero\"];\n\t\t\n\t\tnumbers.forEach(num => {\n\t\t\tnumpad.on('click', '.' + num, function() {\n\t\t\t\tconst current_value = dialog.get_value(\"mobile_number\") || \"\";\n\t\t\t\tdialog.set_value('mobile_number', current_value + $(this).text());\n\t\t\t});\n\t\t});\n\n\t\tnumpad.on('click', '.clear', () => dialog.set_value('mobile_number', \"\"));\n\t\tnumpad.on('click', '.delete', function() {\n\t\t\tconst current_value = dialog.get_value(\"mobile_number\") || \"\";\n\t\t\tdialog.set_value('mobile_number', current_value.slice(0, -1));\n\t\t});\n\n\t\treturn dialog;\n\t}\n\n\t// Optimized secret key dialog creation\n\tcreate_secret_dialog(callback) {\n\t\tlet dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Enter Secret Key',\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Secret Key',\n\t\t\t\t\tfieldname: 'secret_key',\n\t\t\t\t\tfieldtype: 'Password',\n\t\t\t\t\treqd: 1\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: '',\n\t\t\t\t\tfieldname: 'secret_key_numpad',\n\t\t\t\t\tfieldtype: 'HTML',\n\t\t\t\t\toptions: `<div class=\"secret_key_numpad\">\n\t\t\t\t\t\t<div class=\"custom-numpad\">\n\t\t\t\t\t\t\t<style>\n\t\t\t\t\t\t\t.custom-numpad {\n\t\t\t\t\t\t\t\tdisplay: grid;\n\t\t\t\t\t\t\t\tgrid-template-columns: repeat(3, 1fr);\n\t\t\t\t\t\t\t\tgap: 10px;\n\t\t\t\t\t\t\t\tmax-width: 350px;\n\t\t\t\t\t\t\t\tmargin: 0 auto;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t.numpad-button {\n\t\t\t\t\t\t\t\tpadding: 15px;\n\t\t\t\t\t\t\t\tfont-size: 18px;\n\t\t\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\t\t\tbackground-color: #f1f1f1;\n\t\t\t\t\t\t\t\tborder: 1px solid #ccc;\n\t\t\t\t\t\t\t\tborder-radius: 5px;\n\t\t\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t.numpad-button:hover {\n\t\t\t\t\t\t\t\tbackground-color: #ddd;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t</style>\n\t\t\t\t\t\t\t<button class=\"numpad-button one\">1</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button two\">2</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button three\">3</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button four\">4</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button five\">5</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button six\">6</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button seven\">7</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button eight\">8</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button nine\">9</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button delete\" style=\"color: red\">x</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button zero\">0</button>\n\t\t\t\t\t\t\t<button class=\"numpad-button clear\">C</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`\n\t\t\t\t},\n\t\t\t],\n\t\t\tsize: 'small',\n\t\t\tprimary_action_label: 'Continue',\n\t\t\tprimary_action: callback\n\t\t});\n\n\t\t// Bind numpad events efficiently\n\t\tconst numpad = dialog.wrapper.find(\".custom-numpad\");\n\t\tconst numbers = [\"one\", \"two\", \"three\", \"four\", \"five\", \"six\", \"seven\", \"eight\", \"nine\", \"zero\"];\n\t\t\n\t\tnumbers.forEach(num => {\n\t\t\tnumpad.on('click', '.' + num, function() {\n\t\t\t\tconst current_value = dialog.get_value(\"secret_key\") || \"\";\n\t\t\t\tdialog.set_value('secret_key', current_value + $(this).text());\n\t\t\t});\n\t\t});\n\n\t\tnumpad.on('click', '.clear', () => dialog.set_value('secret_key', \"\"));\n\t\tnumpad.on('click', '.delete', function() {\n\t\t\tconst current_value = dialog.get_value(\"secret_key\") || \"\";\n\t\t\tdialog.set_value('secret_key', current_value.slice(0, -1));\n\t\t});\n\n\t\treturn dialog;\n\t}\n\n\t// Optimized customer creation process\n\tasync create_customer_and_proceed(mobile_number, next_action) {\n\t\tconst me = this;\n\t\ttry {\n\t\t\tawait frappe.call({\n\t\t\t\tmethod: \"posnext.posnext.page.posnext.point_of_sale.create_customer\",\n\t\t\t\targs: { customer: mobile_number },\n\t\t\t\tfreeze: true,\n\t\t\t\tfreeze_message: \"Processing...\"\n\t\t\t});\n\n\t\t\tconst frm = me.events.get_frm();\n\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, 'customer', mobile_number);\n\t\t\t\n\t\t\tawait frm.script_manager.trigger('customer', frm.doc.doctype, frm.doc.name);\n\t\t\tawait me.fetch_customer_details(mobile_number);\n\t\t\tme.events.customer_details_updated(me.customer_info);\n\t\t\tme.update_customer_section();\n\t\t\t\n\t\t\tif (next_action) await next_action(mobile_number);\n\t\t} catch (error) {\n\t\t\tfrappe.show_alert({ message: __(\"Failed to process customer\"), indicator: 'red' });\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\t\n\t\tthis.$customer_section.on('click', '.reset-customer-btn', function () {\n\t\t\tme.reset_customer_selector();\n\t\t});\n\n\t\tthis.$customer_section.on('click', '.close-details-btn', function () {\n\t\t\tme.toggle_customer_info(false);\n\t\t});\n\n\t\tthis.$customer_section.on('click', '.customer-display', function(e) {\n\t\t\tif ($(e.target).closest('.reset-customer-btn').length) return;\n\t\t\tconst show = me.$cart_container.is(':visible');\n\t\t\tme.toggle_customer_info(show);\n\t\t});\n\n\t\tthis.$cart_items_wrapper.on('click', '.cart-item-wrapper', function() {\n\t\t\tconst $cart_item = $(this);\n\t\t\tme.toggle_item_highlight(this);\n\t\t\tconst payment_section_hidden = !me.$totals_section.find('.edit-cart-btn').is(':visible');\n\t\t\tif (!payment_section_hidden) {\n\t\t\t\tme.$totals_section.find(\".edit-cart-btn\").click();\n\t\t\t}\n\t\t\tconst item_row_name = unescape($cart_item.attr('data-row-name'));\n\t\t\tme.events.cart_item_clicked({ name: item_row_name });\n\t\t\tthis.numpad_value = '';\n\t\t});\n\t\t\n\t\tthis.$component.on('click', '.checkout-btn:not(.checkout-btn-held):not(.checkout-btn-order)', async function() {\n        if ($(this).attr('style').indexOf('--blue-500') == -1) return;\n        \n        console.log('Checkout button clicked');\n        try {\n            if (!cur_frm.doc.customer && me.mobile_number_based_customer) {\n                const dialog = me.create_mobile_dialog(async function(values) {\n                    if (values['mobile_number'].length !== me.settings.custom_mobile_number_length) {\n                        frappe.throw(\"Mobile Number Length is \" + me.settings.custom_mobile_number_length.toString());\n                        return;\n                    }\n                    \n                    try {\n                        await me.create_customer_and_proceed(values['mobile_number']);\n                        await me.events.checkout();\n                        me.toggle_checkout_btn(false);\n                        me.allow_discount_change && me.$add_discount_elem.removeClass(\"d-none\");\n                        dialog.hide();\n                    } catch (error) {\n                        console.error('Error in mobile dialog checkout:', error);\n                    }\n                });\n                dialog.show();\n            } else {\n                if (!cur_frm.doc.customer && !me.mobile_number_based_customer) {\n                    frappe.throw(\"Please Select a customer and add items first\");\n                    return;\n                }\n                await me.events.checkout();\n                me.toggle_checkout_btn(false);\n                me.allow_discount_change && me.$add_discount_elem.removeClass(\"d-none\");\n            }\n        } catch (error) {\n            console.error('Error in checkout:', error);\n            frappe.msgprint(__('Error during checkout. Please try again.'));\n        }\n    });\n\n\n\t    this.$component.on('click', '.checkout-btn-held', function() {\n        if ($(this).attr('style').indexOf('--blue-500') == -1) return;\n        if (!cur_frm.doc.items.length) {\n            frappe.throw(\"Cannot save empty invoice\");\n            return;\n        }\n\n        console.log('Hold button clicked');\n\n        const show_secret_key_popup = (mobile_number = null) => {\n            const secret_dialog = me.create_secret_dialog(function(values) {\n                const frm = me.events.get_frm();\n                const invoice_name = frm.doc.name;\n                \n                // Set created_by_name before saving\n                frm.doc.created_by_name = frm.doc.created_by_name || frappe.session.user;\n                console.log('Setting created_by_name before hold:', frm.doc.created_by_name);\n\n                // Check if save_draft_invoice is defined\n                if (!me.events.save_draft_invoice) {\n                    console.error('save_draft_invoice is undefined');\n                    frappe.show_alert({\n                        message: __('Save draft invoice function is not available. Please check POS configuration.'),\n                        indicator: 'red'\n                    });\n                    secret_dialog.hide();\n                    return;\n                }\n\n                if (invoice_name && !frm.doc.__islocal) {\n                    // Existing draft invoice\n                    frappe.call({\n                        method: \"posnext.posnext.page.posnext.point_of_sale.check_edit_permission\",\n                        args: {\n                            invoice_name: invoice_name,\n                            secret_key: values['secret_key']\n                        },\n                        freeze: true,\n                        freeze_message: \"Validating Secret Key...\",\n                        callback: function(r) {\n                            if (r.message.can_edit) {\n                                frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'created_by_name', r.message.created_by_name || frappe.session.user);\n                                frm.script_manager.trigger('created_by_name', frm.doc.doctype, frm.doc.name).then(() => {\n                                    console.log('Calling save_draft_invoice for existing invoice:', invoice_name);\n                                    me.events.save_draft_invoice().then((result) => {\n                                        const saved_invoice_name = result.invoice_name || frm.doc.name;\n                                        const creator_name = result.created_by_name || r.message.created_by_name || frappe.session.user;\n                                        console.log('Hold successful, invoice:', saved_invoice_name, 'creator:', creator_name);\n                                        me.handle_successful_hold(saved_invoice_name, creator_name);\n                                    }).catch(error => {\n                                        console.error('Error saving draft invoice (existing):', error);\n                                        frappe.show_alert({\n                                            message: __('Failed to save draft invoice: {0}', [error.message]),\n                                            indicator: 'red'\n                                        });\n                                    });\n                                }).catch(error => {\n                                    console.error('Error triggering created_by_name (existing):', error);\n                                });\n                                secret_dialog.hide();\n                            } else {\n                                frappe.show_alert({\n                                    message: __(`You did not create this invoice, hence you cannot edit it. Only the creator (${r.message.created_by_name}) can edit it.`),\n                                    indicator: 'red'\n                                });\n                                secret_dialog.hide();\n                            }\n                        },\n                        error: (xhr, status, error) => {\n                            console.error('Error validating secret key (existing):', error);\n                            frappe.show_alert({\n                                message: __(\"Failed to validate secret key. Please try again or contact support.\"),\n                                indicator: 'red'\n                            });\n                            secret_dialog.hide();\n                        }\n                    });\n                } else {\n                    // New invoice\n                    frappe.call({\n                        method: \"posnext.posnext.page.posnext.point_of_sale.get_user_name_from_secret_key\",\n                        args: {\n                            secret_key: values['secret_key']\n                        },\n                        //freeze: true,\n                        freeze_message: \"Validating Secret Key...\",\n                        callback: function(r) {\n                            if (r.message) {\n                                const created_by_name = r.message;\n                                frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'created_by_name', created_by_name);\n                                frm.script_manager.trigger('created_by_name', frm.doc.doctype, frm.doc.name).then(() => {\n                                    console.log('Calling save_draft_invoice for new invoice:', frm.doc.name);\n                                    me.events.save_draft_invoice().then((result) => {\n                                        const saved_invoice_name = result.invoice_name || frm.doc.name;\n                                        console.log('Hold successful, invoice:', saved_invoice_name, 'creator:', created_by_name);\n                                        me.handle_successful_hold(saved_invoice_name, created_by_name);\n                                    }).catch(error => {\n                                        console.error('Error saving draft invoice (new):', error);\n                                        frappe.show_alert({\n                                            message: __('Failed to save draft invoice: {0}', [error.message]),\n                                            indicator: 'red'\n                                        });\n                                    });\n                                }).catch(error => {\n                                    console.error('Error triggering created_by_name (new):', error);\n                                });\n                                secret_dialog.hide();\n                            } else {\n                                frappe.show_alert({\n                                    message: __(\"Invalid secret key\"),\n                                    indicator: 'red'\n                                });\n                                secret_dialog.hide();\n                            }\n                        },\n                        error: (xhr, status, error) => {\n                            console.error('Error validating secret key (new):', error);\n                            frappe.show_alert({\n                                message: __(\"Failed to validate secret key. Please try again or contact support.\"),\n                                indicator: 'red'\n                            });\n                            secret_dialog.hide();\n                        }\n                    });\n                }\n            });\n            secret_dialog.show();\n        };\n\n        if (!cur_frm.doc.customer && me.mobile_number_based_customer) {\n            const mobile_dialog = me.create_mobile_dialog(function(values) {\n                if (values['mobile_number'].length !== me.settings.custom_mobile_number_length) {\n                    frappe.throw(\"Mobile Number Length is \" + me.settings.custom_mobile_number_length.toString());\n                    return;\n                }\n                frappe.call({\n                    method: \"posnext.posnext.page.posnext.point_of_sale.create_customer\",\n                    args: {\n                        customer: values['mobile_number']\n                    },\n                    freeze: true,\n                    freeze_message: \"Creating Customer....\",\n                    callback: function() {\n                        const frm = me.events.get_frm();\n                        frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'customer', values['mobile_number']);\n                        frm.script_manager.trigger('customer', frm.doc.doctype, frm.doc.name).then(() => {\n                            frappe.run_serially([\n                                () => me.fetch_customer_details(values['mobile_number']),\n                                () => me.events.customer_details_updated(me.customer_info),\n                                () => me.update_customer_section(),\n                                () => show_secret_key_popup(values['mobile_number'])\n                            ]);\n                        });\n                        mobile_dialog.hide();\n                    }\n                });\n            });\n            mobile_dialog.show();\n        } else {\n            if (!cur_frm.doc.customer && !me.mobile_number_based_customer) {\n                frappe.throw(\"Please select a customer before holding the invoice\");\n                return;\n            }\n            show_secret_key_popup();\n        }\n    });\n\n\n\t\tthis.$component.on('click', '.checkout-btn-order', () => {\n\t\t\tme.events.toggle_recent_order();\n\t\t});\n\n\t\tthis.$totals_section.on('click', '.edit-cart-btn', () => {\n\t\t\tme.events.edit_cart();\n\t\t\tme.toggle_checkout_btn(true);\n\t\t});\n\n\t\tthis.$component.on('click', '.add-discount-wrapper', () => {\n\t\t\tconst can_edit_discount = this.$add_discount_elem.find('.edit-discount-btn').length;\n\t\t\tif (!this.discount_field || can_edit_discount) this.show_discount_control();\n\t\t});\n\n\t\tfrappe.ui.form.on(\"Sales Invoice\", \"paid_amount\", frm => {\n\t\t\tthis.update_totals_section(frm);\n\t\t});\n\t}\n\nasync handle_successful_hold(invoice_name, creator_name) {\n    console.log('Handling successful hold:', invoice_name, creator_name);\n    try {\n        //frappe.dom.freeze();\n        // Show recent order list\n        await this.events.show_recent_order_list();\n        // Refresh PastOrderList with held invoice\n        if (posnext.PointOfSale.PastOrderList.current_instance) {\n            await posnext.PointOfSale.PastOrderList.current_instance.set_filter_and_refresh_with_held_invoice(creator_name, invoice_name);\n            // Load held invoice into PastOrderSummary\n            if (posnext.PointOfSale.PastOrderSummary.current_instance) {\n                await frappe.db.get_doc('Sales Invoice', invoice_name).then(doc => {\n                    posnext.PointOfSale.PastOrderSummary.current_instance.load_summary_of(doc);\n                });\n            }\n        } else {\n            console.warn('PastOrderList not initialized');\n            frappe.show_alert({\n                message: __('Recent order list is not available. Please refresh the page.'),\n                indicator: 'orange'\n            });\n        }\n        // Reset cart state after list is shown\n        await this.reset_cart_state(true); // Pass from_held=true\n        //frappe.dom.unfreeze();\n    } catch (error) {\n        console.error('Error in handle_successful_hold:', error);\n        frappe.show_alert({\n            message: __('Failed to show the held invoice in the orders list: {0}', [error.message]),\n            indicator: 'red'\n        });\n        frappe.utils.play_sound(\"error\");\n        //frappe.dom.unfreeze();\n    }\n}\n\n// Modify reset_cart_state to accept from_held\nreset_cart_state(from_held = false) {\n    this.$cart_items_wrapper.html('');\n    this.update_totals_section();\n    this.toggle_checkout_btn(true);\n    this.toggle_numpad(false);\n    this.events.load_new_invoice(from_held); // Pass from_held\n}\n\tattach_shortcuts() {\n\t\tfor (let row of this.number_pad.keys) {\n\t\t\tfor (let btn of row) {\n\t\t\t\tif (typeof btn !== 'string') continue; // do not make shortcuts for numbers\n\n\t\t\t\tlet shortcut_key = `ctrl+${frappe.scrub(String(btn))[0]}`;\n\t\t\t\tif (btn === 'Delete') shortcut_key = 'ctrl+backspace';\n\t\t\t\tif (btn === 'Remove') shortcut_key = 'shift+ctrl+backspace'\n\t\t\t\tif (btn === '.') shortcut_key = 'ctrl+>';\n\n\t\t\t\t// to account for fieldname map\n\t\t\t\tconst fieldname = this.number_pad.fieldnames[btn] ? this.number_pad.fieldnames[btn] :\n\t\t\t\t\ttypeof btn === 'string' ? frappe.scrub(btn) : btn;\n\n\t\t\t\tlet shortcut_label = shortcut_key.split('+').map(frappe.utils.to_title_case).join('+');\n\t\t\t\tshortcut_label = frappe.utils.is_mac() ? shortcut_label.replace('Ctrl', '\u2318') : shortcut_label;\n\t\t\t\tthis.$numpad_section.find(`.numpad-btn[data-button-value=\"${fieldname}\"]`).attr(\"title\", shortcut_label);\n\n\t\t\t\tfrappe.ui.keys.on(`${shortcut_key}`, () => {\n\t\t\t\t\tconst cart_is_visible = this.$component.is(\":visible\");\n\t\t\t\t\tif (cart_is_visible && this.item_is_selected && this.$numpad_section.is(\":visible\")) {\n\t\t\t\t\t\tthis.$numpad_section.find(`.numpad-btn[data-button-value=\"${fieldname}\"]`).click();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '\u2318' : 'Ctrl';\n\t\tthis.$component.find(\".checkout-btn\").attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+enter\",\n\t\t\taction: () => this.$component.find(\".checkout-btn\").click(),\n\t\t\tcondition: () => this.$component.is(\":visible\") && !this.$totals_section.find('.edit-cart-btn').is(':visible'),\n\t\t\tdescription: __(\"Checkout Order / Submit Order / New Order\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tthis.$component.find(\".edit-cart-btn\").attr(\"title\", `${ctrl_label}+E`);\n\t\tfrappe.ui.keys.on(\"ctrl+e\", () => {\n\t\t\tconst item_cart_visible = this.$component.is(\":visible\");\n\t\t\tconst checkout_btn_invisible = !this.$totals_section.find('.checkout-btn').is('visible');\n\t\t\tif (item_cart_visible && checkout_btn_invisible) {\n\t\t\t\tthis.$component.find(\".edit-cart-btn\").click();\n\t\t\t}\n\t\t});\n\t\tthis.$component.find(\".add-discount-wrapper\").attr(\"title\", `${ctrl_label}+D`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+d\",\n\t\t\taction: () => this.$component.find(\".add-discount-wrapper\").click(),\n\t\t\tcondition: () => this.$add_discount_elem.is(\":visible\"),\n\t\t\tdescription: __(\"Add Order Discount\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tfrappe.ui.keys.on(\"escape\", () => {\n\t\t\tconst item_cart_visible = this.$component.is(\":visible\");\n\t\t\tif (item_cart_visible && this.discount_field && this.discount_field.parent.is(\":visible\")) {\n\t\t\t\tthis.discount_field.set_value(0);\n\t\t\t}\n\t\t});\n\t}\n\n\ttoggle_item_highlight(item) {\n\t\tconst $cart_item = $(item);\n\t\tconst item_is_highlighted = $cart_item.attr(\"style\") == \"background-color:var(--gray-50);\";\n\n\t\tif (!item || item_is_highlighted) {\n\t\t\tthis.item_is_selected = false;\n\t\t\tthis.$cart_container.find('.cart-item-wrapper').css(\"background-color\", \"\");\n\t\t} else {\n\t\t\t$cart_item.css(\"background-color\", \"var(--control-bg)\");\n\t\t\tthis.item_is_selected = true;\n\t\t\tthis.$cart_container.find('.cart-item-wrapper').not(item).css(\"background-color\", \"\");\n\t\t}\n\t}\n\n\tmake_customer_selector() {\n    this.$customer_section.html(`\n        <div class=\"customer-field\"></div>\n    `);\n    const me = this;\n    const query = { query: 'posnext.controllers.queries.customer_query' };\n    const allowed_customer_group = this.allowed_customer_groups || [];\n    if (allowed_customer_group.length) {\n        query.filters = {\n            customer_group: ['in', allowed_customer_group]\n        }\n    }\n    this.customer_field = frappe.ui.form.make_control({\n        df: {\n            label: __('Customer'),\n            fieldtype: 'Link',\n            options: 'Customer',\n            placeholder: __('Search by customer name, phone, email.'),\n            read_only: this.mobile_number_based_customer,\n            get_query: () => query,\n            onchange: function() {\n                if (this.value) {\n                    const frm = me.events.get_frm();\n                    \n                    // ADD FREEZING HERE FOR CUSTOMER SELECTION\n                    frappe.dom.freeze();\n                    \n                    frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'customer', this.value);\n                    frm.script_manager.trigger('customer', frm.doc.doctype, frm.doc.name).then(() => {\n                        frappe.run_serially([\n                            () => me.fetch_customer_details(this.value),\n                            () => me.events.customer_details_updated(me.customer_info),\n                            () => me.update_customer_section(),\n                            () => me.update_totals_section(),\n                            () => frappe.dom.unfreeze()  // UNFREEZE AFTER CUSTOMER OPERATIONS\n                        ]);\n                    })\n                }\n            },\n        },\n        parent: this.$customer_section.find('.customer-field'),\n        render_input: true,\n    });\n    this.customer_field.toggle_label(false);\n}\n\n\tfetch_customer_details(customer) {\n\t\tif (customer) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tfrappe.db.get_value('Customer', customer, [\"email_id\", \"mobile_no\", \"image\", \"loyalty_program\"]).then(({ message }) => {\n\t\t\t\t\tconst { loyalty_program } = message;\n\t\t\t\t\t// if loyalty program then fetch loyalty points too\n\t\t\t\t\tif (loyalty_program) {\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: \"erpnext.accounts.doctype.loyalty_program.loyalty_program.get_loyalty_program_details_with_points\",\n\t\t\t\t\t\t\targs: { customer, loyalty_program, \"silent\": true },\n\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\tconst { loyalty_points, conversion_factor } = r.message;\n\t\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\t\tthis.customer_info = { ...message, customer, loyalty_points, conversion_factor };\n\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.customer_info = { ...message, customer };\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tthis.customer_info = {}\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\t}\n\n\tshow_discount_control() {\n\t\tthis.$add_discount_elem.css({ 'padding': '0px', 'border': 'none' });\n\t\tthis.$add_discount_elem.html(\n\t\t\t`<div class=\"add-discount-field\"></div>`\n\t\t);\n\t\tconst me = this;\n\t\tconst frm = me.events.get_frm();\n\t\tlet discount = frm.doc.additional_discount_percentage;\n\n\t\tthis.discount_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Discount'),\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tplaceholder: ( discount ? discount + '%' :  __('Enter discount percentage.') ),\n\t\t\t\tinput_class: 'input-xs',\n\t\t\t\tonchange: function() {\n\t\t\t\t\tif (flt(this.value) != 0) {\n\t\t\t\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, 'additional_discount_percentage', flt(this.value));\n\t\t\t\t\t\tme.hide_discount_control(this.value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, 'additional_discount_percentage', 0);\n\t\t\t\t\t\tme.$add_discount_elem.css({\n\t\t\t\t\t\t\t'border': '1px dashed var(--gray-500)',\n\t\t\t\t\t\t\t'padding': 'var(--padding-sm) var(--padding-md)'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tme.$add_discount_elem.html(`${me.get_discount_icon()} ${__('Add Discount')}`);\n\t\t\t\t\t\tme.discount_field = undefined;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$add_discount_elem.find('.add-discount-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.discount_field.toggle_label(false);\n\t\tthis.discount_field.set_focus();\n\t}\n\n\thide_discount_control(discount) {\n\t\tif (!discount) {\n\t\t\tthis.$add_discount_elem.css({ 'padding': '0px', 'border': 'none' });\n\t\t\tthis.$add_discount_elem.html(\n\t\t\t\t`<div class=\"add-discount-field\"></div>`\n\t\t\t);\n\t\t} else {\n\t\t\tthis.$add_discount_elem.css({\n\t\t\t\t'border': '1px dashed var(--dark-green-500)',\n\t\t\t\t'padding': 'var(--padding-sm) var(--padding-md)'\n\t\t\t});\n\t\t\tthis.$add_discount_elem.html(\n\t\t\t\t`<div class=\"edit-discount-btn\">\n\t\t\t\t\t${this.get_discount_icon()} ${__(\"Additional\")}&nbsp;${String(discount).bold()}% ${__(\"discount applied\")}\n\t\t\t\t</div>`\n\t\t\t);\n\t\t}\n\t}\n\n\tupdate_customer_section() {\n\t\tconst me = this;\n\t\tconst { customer, email_id='', mobile_no='', image } = this.customer_info || {};\n\n\t\tif (customer) {\n\t\t\tthis.$customer_section.html(\n\t\t\t\t`<div class=\"customer-details\">\n\t\t\t\t\t<div class=\"customer-display\">\n\t\t\t\t\t\t${this.get_customer_image()}\n\t\t\t\t\t\t<div class=\"customer-name-desc\">\n\t\t\t\t\t\t\t<div class=\"customer-name\">${customer}</div>\n\t\t\t\t\t\t\t${get_customer_description()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"reset-customer-btn\" data-customer=\"${escape(customer)}\">\n\t\t\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t\t);\n\t\t\tif(this.mobile_number_based_customer){\n\t\t\t\tthis.$customer_section.find('.reset-customer-btn').css('display', 'none');\n\t\t\t} else {\n\t\t\t\tthis.$customer_section.find('.reset-customer-btn').css('display', 'flex');\n\t\t\t}\n\t\t} else {\n\t\t\t// reset customer selector\n\t\t\tthis.reset_customer_selector();\n\t\t}\n\n\t\tfunction get_customer_description() {\n\t\t\tif (!email_id && !mobile_no) {\n\t\t\t\treturn `<div class=\"customer-desc\">${__('Click to add email / phone')}</div>`;\n\t\t\t} else if (email_id && !mobile_no) {\n\t\t\t\treturn `<div class=\"customer-desc\">${email_id}</div>`;\n\t\t\t} else if (mobile_no && !email_id) {\n\t\t\t\treturn `<div class=\"customer-desc\">${mobile_no}</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"customer-desc\">${email_id} - ${mobile_no}</div>`;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tget_customer_image() {\n\t\tconst { customer, image } = this.customer_info || {};\n\t\tif (image) {\n\t\t\treturn `<div class=\"customer-image\"><img src=\"${image}\" alt=\"${image}\"\"></div>`;\n\t\t} else {\n\t\t\treturn `<div class=\"customer-image customer-abbr\">${frappe.get_abbr(customer)}</div>`;\n\t\t}\n\t}\n\n\tupdate_totals_section(frm) {\n\t\tif (!frm) frm = this.events.get_frm();\n\n\t\tthis.render_net_total(frm.doc.net_total);\n\t\tthis.render_total_item_qty(frm.doc.items);\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? frm.doc.grand_total : frm.doc.rounded_total;\n\t\tthis.render_grand_total(grand_total);\n\n\t\tthis.render_taxes(frm.doc.taxes);\n\t}\n\n\trender_net_total(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section.find('.net-total-container').html(\n\t\t\t`<div>${__('Net Total')}</div><div>${format_currency(value, currency)}</div>`\n\t\t)\n\n\t\tthis.$numpad_section.find('.numpad-net-total').html(\n\t\t\t`<div>${__('Net Total')}: <span>${format_currency(value, currency)}</span></div>`\n\t\t);\n\t}\n\n\trender_total_item_qty(items) {\n\t\tvar total_item_qty = 0;\n\t\titems.map((item) => {\n\t\t\ttotal_item_qty = total_item_qty + item.qty;\n\t\t});\n\n\t\tthis.$totals_section.find('.item-qty-total-container').html(\n\t\t\t`<div>${__('Total Quantity')}</div><div>${total_item_qty}</div>`\n\t\t);\n\n\t\tthis.$numpad_section.find('.numpad-item-qty-total').html(\n\t\t\t`<div>${__('Total Quantity')}: <span>${total_item_qty}</span></div>`\n\t\t);\n\t}\n\n\trender_grand_total(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section.find('.grand-total-container').html(\n\t\t\t`<div>${__('Grand Total')}</div><div>${format_currency(value, currency)}</div>`\n\t\t)\n\n\t\tthis.$numpad_section.find('.numpad-grand-total').html(\n\t\t\t`<div>${__('Grand Total')}: <span>${format_currency(value, currency)}</span></div>`\n\t\t);\n\t}\n\n\trender_taxes(taxes) {\n\t\tif (taxes && taxes.length) {\n\t\t\tconst currency = this.events.get_frm().doc.currency;\n\t\t\tconst taxes_html = taxes.map(t => {\n\t\t\t\tif (t.tax_amount_after_discount_amount == 0.0) return;\n\t\t\t\t// if tax rate is 0, don't print it.\n\t\t\t\tconst description = /[0-9]+/.test(t.description) ? t.description : ((t.rate != 0) ? `${t.description} @ ${t.rate}%`: t.description);\n\t\t\t\treturn `<div class=\"tax-row\">\n\t\t\t\t\t<div class=\"tax-label\">${description}</div>\n\t\t\t\t\t<div class=\"tax-value\">${format_currency(t.tax_amount_after_discount_amount, currency)}</div>\n\t\t\t\t</div>`;\n\t\t\t}).join('');\n\t\t\tthis.$totals_section.find('.taxes-container').css('display', 'flex').html(taxes_html);\n\t\t} else {\n\t\t\tthis.$totals_section.find('.taxes-container').css('display', 'none').html('');\n\t\t}\n\t}\n\n\tget_cart_item({ name }) {\n\t\tconst item_selector = `.cart-item-wrapper[data-row-name=\"${escape(name)}\"]`;\n\t\treturn this.$cart_items_wrapper.find(item_selector);\n\t}\n\n\tget_item_from_frm(item) {\n\t\tconst doc = this.events.get_frm().doc;\n\t\treturn doc.items.find(i => i.name == item.name);\n\t}\n\n\tupdate_item_html(item, remove_item) {\n\t\tconst $item = this.get_cart_item(item);\n\n\t\tif (remove_item) {\n\t\t\t$item && $item.next().remove() && $item.remove();\n\t\t} else {\n\t\t\tconst item_row = this.get_item_from_frm(item);\n\t\t\tthis.render_cart_item(item_row, $item);\n\t\t}\n\n\t\tconst no_of_cart_items = this.$cart_items_wrapper.find('.cart-item-wrapper').length;\n\t\tthis.highlight_checkout_btn(true);\n\n\t\tthis.update_empty_cart_section(no_of_cart_items);\n\t}\n\n\trender_cart_item(item_data, $item_to_update) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tconst me = this;\n\n\t\tif (!$item_to_update.length) {\n\t\t\tthis.$cart_items_wrapper.append(\n\t\t\t\t`<div class=\"cart-item-wrapper\" data-row-name=\"${escape(item_data.name)}\"></div>\n\t\t\t\t<div class=\"seperator\"></div>`\n\t\t\t)\n\t\t\t$item_to_update = this.get_cart_item(item_data);\n\t\t}\n\n\t\t$item_to_update.html(\n\t\t\t`${get_item_image_html()}\n\t\t\t<div class=\"item-name-desc\">\n\t\t\t\t<div class=\"item-name\">\n\t\t\t\t\t${item_data.item_name}\n\t\t\t\t</div>\n\t\t\t\t${get_description_html()}\n\t\t\t</div>\n\t\t\t${get_rate_discount_html()}`\n\t\t)\n\n\t\tset_dynamic_rate_header_width();\n\n\t\tfunction set_dynamic_rate_header_width() {\n\t\t\tconst rate_cols = Array.from(me.$cart_items_wrapper.find(\".item-rate-amount\"));\n\t\t\tme.$cart_header.find(\".rate-amount-header\").css(\"width\", \"\");\n\t\t\tme.$cart_items_wrapper.find(\".item-rate-amount\").css(\"width\", \"\");\n\t\t\tlet max_width = rate_cols.reduce((max_width, elm) => {\n\t\t\t\tif ($(elm).width() > max_width)\n\t\t\t\t\tmax_width = $(elm).width();\n\t\t\t\treturn max_width;\n\t\t\t}, 0);\n\n\t\t\tmax_width += 1;\n\t\t\tif (max_width == 1) max_width = \"\";\n\n\t\t\tme.$cart_header.find(\".rate-amount-header\").css(\"width\", max_width);\n\t\t\tme.$cart_items_wrapper.find(\".item-rate-amount\").css(\"width\", max_width);\n\t\t}\n\n\t\tfunction get_rate_discount_html() {\n\t\t\tif (item_data.rate && item_data.amount && item_data.rate !== item_data.amount) {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t<div class=\"item-qty\"><span>${item_data.qty || 0} ${item_data.uom}</span></div>\n\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.amount, currency)}</div>\n\t\t\t\t\t\t\t<div class=\"item-amount\">${format_currency(item_data.rate, currency)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`\n\t\t\t} else {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t<div class=\"item-qty\"><span>${item_data.qty || 0} ${item_data.uom}</span></div>\n\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.rate, currency)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`\n\t\t\t}\n\t\t}\n\n\t\tfunction get_description_html() {\n\t\t\tif (item_data.description) {\n\t\t\t\tif (item_data.description.indexOf('<div>') != -1) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\titem_data.description = $(item_data.description).text();\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\titem_data.description = item_data.description.replace(/<div>/g, ' ').replace(/<\\/div>/g, ' ').replace(/ +/g, ' ');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\titem_data.description = frappe.ellipsis(item_data.description, 45);\n\t\t\t\treturn `<div class=\"item-desc\">${item_data.description}</div>`;\n\t\t\t}\n\t\t\treturn ``;\n\t\t}\n\n\t\tfunction get_item_image_html() {\n\t\t\tconst { image, item_name } = item_data;\n\t\t\tif (!me.hide_images && image) {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-image\">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tonerror=\"cur_pos.cart.handle_broken_image(this)\"\n\t\t\t\t\t\t\tsrc=\"${image}\" alt=\"${frappe.get_abbr(item_name)}\"\">\n\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-image item-abbr\">${frappe.get_abbr(item_name)}</div>`;\n\t\t\t}\n\t\t}\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr('alt');\n\t\t$($img).parent().replaceWith(`<div class=\"item-image item-abbr\">${item_abbr}</div>`);\n\t}\n\n\tupdate_selector_value_in_cart_item(selector, value, item) {\n\t\tconst $item_to_update = this.get_cart_item(item);\n\t\t$item_to_update.attr(`data-${selector}`, escape(value));\n\t}\n\n\ttoggle_checkout_btn(show_checkout) {\n\t\tif (show_checkout) {\n\t\t\tif(this.show_checkout_button){\n\t\t\t\tthis.$totals_section.find('.checkout-btn').css('display', 'flex');\n\t\t\t} else {\n\t\t\t\tthis.$totals_section.find('.checkout-btn').css('display', 'none');\n\t\t\t}\n\n\t\t\tif(this.show_held_button){\n\t\t\t\tthis.$totals_section.find('.checkout-btn-held').css('display', 'flex');\n\t\t\t} else {\n\t\t\t\tthis.$totals_section.find('.checkout-btn-held').css('display', 'none');\n\t\t\t}\n\t\t\tif(this.show_order_list_button){\n\t\t\t\tthis.$totals_section.find('.checkout-btn-order').css('display', 'flex');\n\t\t\t} else {\n\t\t\t\tthis.$totals_section.find('.checkout-btn-order').css('display', 'none');\n\t\t\t}\n\t\t\tthis.$totals_section.find('.edit-cart-btn').css('display', 'none');\n\t\t} else {\n\t\t\tthis.$totals_section.find('.checkout-btn').css('display', 'none');\n\t\t\t\tthis.$totals_section.find('.checkout-btn-held').css('display', 'none');\n\t\t\tthis.$totals_section.find('.checkout-btn-held').css('display', 'none');\n\t\t\t\tthis.$totals_section.find('.checkout-btn-order').css('display', 'none');\n\t\t\tthis.$totals_section.find('.edit-cart-btn').css('display', 'flex');\n\t\t}\n\t}\n\n\thighlight_checkout_btn(toggle) {\n\t\tif (toggle) {\n\t\t\tthis.$add_discount_elem.css('display', 'flex');\n\t\t\tthis.$cart_container.find('.checkout-btn').css({\n\t\t\t\t'background-color': 'var(--blue-500)'\n\t\t\t});\n\t\t\tif(this.show_held_button){\n\t\t\t\tthis.$cart_container.find('.checkout-btn-held').css({\n\t\t\t\t\t'background-color': 'var(--blue-500)'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.$cart_container.find('.checkout-btn-held').css({\n\t\t\t\t\t'background-color': 'var(--blue-200)'\n\t\t\t\t});\n\t\t\t}\n\t\t\tif(this.show_order_list_button){\n\t\t\t\tthis.$cart_container.find('.checkout-btn-order').css({\n\t\t\t\t\t'background-color': 'var(--blue-500)'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.$cart_container.find('.checkout-btn-order').css({\n\t\t\t\t\t'background-color': 'var(--blue-500)'\n\t\t\t\t});\n\t\t\t}\n\n\t\t} else {\n\t\t\tthis.$add_discount_elem.css('display', 'none');\n\t\t\tthis.$cart_container.find('.checkout-btn').css({\n\t\t\t\t'background-color': 'var(--blue-200)'\n\t\t\t});\n\t\t\tthis.$cart_container.find('.checkout-btn-held').css({\n\t\t\t\t'background-color': 'var(--blue-200)'\n\t\t\t});\n\n\t\t\tthis.$cart_container.find('.checkout-btn-order').css({\n\t\t\t\t'background-color': 'var(--blue-500)'\n\t\t\t});\n\t\t}\n\t}\n\n\tupdate_empty_cart_section(no_of_cart_items) {\n\t\tconst $no_item_element = this.$cart_items_wrapper.find('.no-item-wrapper');\n\n\t\t// if cart has items and no item is present\n\t\tno_of_cart_items > 0 && $no_item_element && $no_item_element.remove() && this.$cart_header.css('display', 'flex');\n\n\t\tno_of_cart_items === 0 && !$no_item_element.length && this.make_no_items_placeholder();\n\t}\n\n\ton_numpad_event($btn) {\n\t\tconst current_action = $btn.attr('data-button-value');\n\t\tconst action_is_field_edit = ['qty', 'discount_percentage', 'rate'].includes(current_action);\n\t\tconst action_is_allowed = action_is_field_edit ? (\n\t\t\t(current_action == 'rate' && this.allow_rate_change) ||\n\t\t\t(current_action == 'discount_percentage' && this.allow_discount_change) ||\n\t\t\t(current_action == 'qty')) : true;\n\n\t\tconst action_is_pressed_twice = this.prev_action === current_action;\n\t\tconst first_click_event = !this.prev_action;\n\t\tconst field_to_edit_changed = this.prev_action && this.prev_action != current_action;\n\n\t\tif (action_is_field_edit) {\n\t\t\tif (!action_is_allowed) {\n\t\t\t\tconst label = current_action == 'rate' ? 'Rate'.bold() : 'Discount'.bold();\n\t\t\t\tconst message = __('Editing {0} is not allowed as per POS Profile settings', [label]);\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\tmessage: message\n\t\t\t\t});\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (first_click_event || field_to_edit_changed) {\n\t\t\t\tthis.prev_action = current_action;\n\t\t\t} else if (action_is_pressed_twice) {\n\t\t\t\tthis.prev_action = undefined;\n\t\t\t}\n\t\t\tthis.numpad_value = '';\n\n\t\t} else if (current_action === 'checkout') {\n\t\t\tthis.prev_action = undefined;\n\t\t\tthis.toggle_item_highlight();\n\t\t\tthis.events.numpad_event(undefined, current_action);\n\t\t\treturn;\n\t\t} else if (current_action === 'remove') {\n\t\t\tthis.prev_action = undefined;\n\t\t\tthis.toggle_item_highlight();\n\t\t\tthis.events.numpad_event(undefined, current_action);\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.numpad_value = current_action === 'delete' ? this.numpad_value.slice(0, -1) : this.numpad_value + current_action;\n\t\t\tthis.numpad_value = this.numpad_value || 0;\n\t\t}\n\n\t\tconst first_click_event_is_not_field_edit = !action_is_field_edit && first_click_event;\n\n\t\tif (first_click_event_is_not_field_edit) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tindicator: 'red',\n\t\t\t\tmessage: __('Please select a field to edit from numpad')\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (flt(this.numpad_value) > 100 && this.prev_action === 'discount_percentage') {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __('Discount cannot be greater than 100%'),\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\tthis.numpad_value = current_action;\n\t\t}\n\n\t\tthis.highlight_numpad_btn($btn, current_action);\n\t\tthis.events.numpad_event(this.numpad_value, this.prev_action);\n\t}\n\n\thighlight_numpad_btn($btn, curr_action) {\n\t\tconst curr_action_is_highlighted = $btn.hasClass('highlighted-numpad-btn');\n\t\tconst curr_action_is_action = ['qty', 'discount_percentage', 'rate', 'done'].includes(curr_action);\n\n\t\tif (!curr_action_is_highlighted) {\n\t\t\t$btn.addClass('highlighted-numpad-btn');\n\t\t}\n\t\tif (this.prev_action === curr_action && curr_action_is_highlighted) {\n\t\t\t// if Qty is pressed twice\n\t\t\t$btn.removeClass('highlighted-numpad-btn');\n\t\t}\n\t\tif (this.prev_action && this.prev_action !== curr_action && curr_action_is_action) {\n\t\t\t// Order: Qty -> Rate then remove Qty highlight\n\t\t\tconst prev_btn = $(`[data-button-value='${this.prev_action}']`);\n\t\t\tprev_btn.removeClass('highlighted-numpad-btn');\n\t\t}\n\t\tif (!curr_action_is_action || curr_action === 'done') {\n\t\t\t// if numbers are clicked\n\t\t\tsetTimeout(() => {\n\t\t\t\t$btn.removeClass('highlighted-numpad-btn');\n\t\t\t}, 200);\n\t\t}\n\t}\n\n\ttoggle_numpad(show) {\n\t\tif (show) {\n\t\t\tthis.$totals_section.css('display', 'none');\n\t\t\tthis.$numpad_section.css('display', 'flex');\n\t\t} else {\n\t\t\tthis.$totals_section.css('display', 'flex');\n\t\t\tthis.$numpad_section.css('display', 'none');\n\t\t}\n\t\tthis.reset_numpad();\n\t}\n\n\treset_numpad() {\n\t\tthis.numpad_value = '';\n\t\tthis.prev_action = undefined;\n\t\tthis.$numpad_section.find('.highlighted-numpad-btn').removeClass('highlighted-numpad-btn');\n\t}\n\n\ttoggle_numpad_field_edit(fieldname) {\n\t\tif (['qty', 'discount_percentage', 'rate'].includes(fieldname)) {\n\t\t\tthis.$numpad_section.find(`[data-button-value=\"${fieldname}\"]`).click();\n\t\t}\n\t}\n\n\ttoggle_customer_info(show) {\n\t\tif (show) {\n\t\t\tconst { customer } = this.customer_info || {};\n\n\t\t\tthis.$cart_container.css('display', 'none');\n\t\t\tthis.$customer_section.css({\n\t\t\t\t'height': '100%',\n\t\t\t\t'padding-top': '0px'\n\t\t\t});\n\t\t\tthis.$customer_section.find('.customer-details').html(\n\t\t\t\t`<div class=\"header\">\n\t\t\t\t\t<div class=\"label\">Contact Details</div>\n\t\t\t\t\t<div class=\"close-details-btn\">\n\t\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"customer-display\">\n\t\t\t\t\t${this.get_customer_image()}\n\t\t\t\t\t<div class=\"customer-name-desc\">\n\t\t\t\t\t\t<div class=\"customer-name\">${customer}</div>\n\t\t\t\t\t\t<div class=\"customer-desc\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"customer-fields-container\">\n\t\t\t\t\t<div class=\"email_id-field\"></div>\n\t\t\t\t\t<div class=\"mobile_no-field\"></div>\n\t\t\t\t\t<div class=\"loyalty_program-field\"></div>\n\t\t\t\t\t<div class=\"loyalty_points-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"transactions-label\">Recent Transactions</div>`\n\t\t\t);\n\t\t\t// transactions need to be in diff div from sticky elem for scrolling\n\t\t\tthis.$customer_section.append(`<div class=\"customer-transactions\"></div>`);\n\t\t\tif(this.mobile_number_based_customer){\n\t\t\t\tthis.$customer_section.find('.mobile_no-field').css('display', 'none');\n\t\t\t\tthis.$customer_section.find('.close-details-btn').css('display', 'none');\n\t\t\t} else {\n\t\t\t\tthis.$customer_section.find('.mobile_no-field').css('display', 'flex');\n\t\t\t\tthis.$customer_section.find('.close-details-btn').css('display', 'flex');\n\t\t\t}\n\t\t\tthis.render_customer_fields();\n\t\t\tthis.fetch_customer_transactions();\n\n\t\t} else {\n\t\t\tthis.$cart_container.css('display', 'flex');\n\t\t\tthis.$customer_section.css({\n\t\t\t\t'height': '',\n\t\t\t\t'padding-top': ''\n\t\t\t});\n\n\t\t\tthis.update_customer_section();\n\t\t}\n\t}\n\n\trender_customer_fields() {\n\t\tconst $customer_form = this.$customer_section.find('.customer-fields-container');\n\n\t\tconst dfs = [{\n\t\t\tfieldname: 'email_id',\n\t\t\tlabel: __('Email'),\n\t\t\tfieldtype: 'Data',\n\t\t\toptions: 'email',\n\t\t\tplaceholder: __(\"Enter customer's email\")\n\t\t},{\n\t\t\tfieldname: 'mobile_no',\n\t\t\tlabel: __('Phone Number'),\n\t\t\tfieldtype: 'Data',\n\t\t\tplaceholder: __(\"Enter customer's phone number\")\n\t\t},{\n\t\t\tfieldname: 'loyalty_program',\n\t\t\tlabel: __('Loyalty Program'),\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: 'Loyalty Program',\n\t\t\tplaceholder: __(\"Select Loyalty Program\")\n\t\t},{\n\t\t\tfieldname: 'loyalty_points',\n\t\t\tlabel: __('Loyalty Points'),\n\t\t\tfieldtype: 'Data',\n\t\t\tread_only: 1\n\t\t}];\n\n\t\tconst me = this;\n\t\tdfs.forEach(df => {\n\t\t\tthis[`customer_${df.fieldname}_field`] = frappe.ui.form.make_control({\n\t\t\t\tdf: { ...df,\n\t\t\t\t\tonchange: handle_customer_field_change,\n\t\t\t\t},\n\t\t\t\tparent: $customer_form.find(`.${df.fieldname}-field`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`customer_${df.fieldname}_field`].set_value(this.customer_info[df.fieldname]);\n\t\t})\n\n\t\tfunction handle_customer_field_change() {\n\t\t\tconst current_value = me.customer_info[this.df.fieldname];\n\t\t\tconst current_customer = me.customer_info.customer;\n\n\t\t\tif (this.value && current_value != this.value && this.df.fieldname != 'loyalty_points') {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'erpnext.selling.page.point_of_sale.point_of_sale.set_customer_info',\n\t\t\t\t\targs: {\n\t\t\t\t\t\tfieldname: this.df.fieldname,\n\t\t\t\t\t\tcustomer: current_customer,\n\t\t\t\t\t\tvalue: this.value\n\t\t\t\t\t},\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\t\tme.customer_info[this.df.fieldname] = this.value;\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __(\"Customer contact updated successfully.\"),\n\t\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tfetch_customer_transactions() {\n\t\tfrappe.db.get_list('Sales Invoice', {\n\t\t\tfilters: { customer: this.customer_info.customer, docstatus: 1 },\n\t\t\tfields: ['name', 'grand_total', 'status', 'posting_date', 'posting_time', 'currency'],\n\t\t\tlimit: 20\n\t\t}).then((res) => {\n\t\t\tconst transaction_container = this.$customer_section.find('.customer-transactions');\n\n\t\t\tif (!res.length) {\n\t\t\t\ttransaction_container.html(\n\t\t\t\t\t`<div class=\"no-transactions-placeholder\">No recent transactions found</div>`\n\t\t\t\t)\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst elapsed_time = moment(res[0].posting_date+\" \"+res[0].posting_time).fromNow();\n\t\t\tthis.$customer_section.find('.customer-desc').html(`Last transacted ${elapsed_time}`);\n\n\t\t\tres.forEach(invoice => {\n\t\t\t\tconst posting_datetime = moment(invoice.posting_date+\" \"+invoice.posting_time).format(\"Do MMMM, h:mma\");\n\t\t\t\tlet indicator_color = {\n\t\t\t\t\t'Paid': 'green',\n\t\t\t\t\t'Draft': 'red',\n\t\t\t\t\t'Return': 'gray',\n\t\t\t\t\t'Consolidated': 'blue'\n\t\t\t\t};\n\n\t\t\t\ttransaction_container.append(\n\t\t\t\t\t`<div class=\"invoice-wrapper\" data-invoice-name=\"${escape(invoice.name)}\">\n\t\t\t\t\t\t<div class=\"invoice-name-date\">\n\t\t\t\t\t\t\t<div class=\"invoice-name\">${invoice.name}</div>\n\t\t\t\t\t\t\t<div class=\"invoice-date\">${posting_datetime}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"invoice-total-status\">\n\t\t\t\t\t\t\t<div class=\"invoice-total\">\n\t\t\t\t\t\t\t\t${format_currency(invoice.grand_total, invoice.currency, 0) || 0}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"invoice-status\">\n\t\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color[invoice.status]}\">\n\t\t\t\t\t\t\t\t\t<span>${invoice.status}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"seperator\"></div>`\n\t\t\t\t)\n\t\t\t});\n\t\t});\n\t}\n\n\tattach_refresh_field_event(frm) {\n\t\t$(frm.wrapper).off('refresh-fields');\n\t\t$(frm.wrapper).on('refresh-fields', () => {\n\t\t\tif (frm.doc.items.length) {\n\t\t\t\tthis.$cart_items_wrapper.html('');\n\t\t\t\tfrm.doc.items.forEach(item => {\n\t\t\t\t\tthis.update_item_html(item);\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.update_totals_section(frm);\n\t\t});\n\t}\n\n\tload_invoice() {\n\t\tconst frm = this.events.get_frm();\n\n\t\tthis.attach_refresh_field_event(frm);\n\n\t\tthis.fetch_customer_details(frm.doc.customer).then(() => {\n\t\t\tthis.events.customer_details_updated(this.customer_info);\n\t\t\tthis.update_customer_section();\n\t\t});\n\n\t\tthis.$cart_items_wrapper.html('');\n\t\tif (frm.doc.items.length) {\n\t\t\tfrm.doc.items.forEach(item => {\n\t\t\t\tthis.update_item_html(item);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.make_no_items_placeholder();\n\t\t\tthis.highlight_checkout_btn(true);\n\t\t}\n\n\t\tthis.update_totals_section(frm);\n\n\t\tif(frm.doc.docstatus === 1) {\n\t\t\tthis.$totals_section.find('.checkout-btn').css('display', 'none');\n\t\t\tthis.$totals_section.find('.checkout-btn-held').css('display', 'none');\n\t\t\tif(this.show_order_list_button){\n\t\t\t\tthis.$totals_section.find('.checkout-btn-order').css('display', 'flex');\n\t\t\t} else {\n\t\t\t\tthis.$totals_section.find('.checkout-btn-order').css('display', 'none');\n\t\t\t}\n\t\t\tthis.$totals_section.find('.edit-cart-btn').css('display', 'none');\n\t\t} else {\n\t\t\tif(this.show_checkout_button) {\n                this.$totals_section.find('.checkout-btn').css('display', 'flex');\n            } else {\n\t\t\t\t                this.$totals_section.find('.checkout-btn').css('display', 'none');\n\n\t\t\t}\n\t\t\tif(this.show_held_button){\n\t\t\t\tthis.$totals_section.find('.checkout-btn-held').css('display', 'flex');\n\t\t\t} else {\n\t\t\tthis.$totals_section.find('.checkout-btn-held').css('display', 'none');\n\t\t\t}\n\t\t\tif(this.show_order_list_button){\n\t\t\t\tthis.$totals_section.find('.checkout-btn-order').css('display', 'flex');\n\t\t\t} else {\n\t\t\t\tthis.$totals_section.find('.checkout-btn-order').css('display', 'none');\n\t\t\t}\n\t\t\tthis.$totals_section.find('.edit-cart-btn').css('display', 'none');\n\t\t}\n\n\t\tthis.toggle_component(true);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n\n};", "frappe.provide('posnext.PointOfSale');\nposnext.PointOfSale.ItemDetails = class {\n\tconstructor({ wrapper, events, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.hide_images = settings.hide_images;\n\t\tthis.allow_rate_change = settings.allow_rate_change;\n\t\tthis.allow_discount_change = settings.allow_discount_change;\n\t\tthis.custom_edit_rate_and_uom = settings.custom_edit_rate_and_uom;\n\t\tthis.current_item = {};\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_child_components();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"item-details-container\" id=\"item-details-container\"></section>`\n\t\t)\n\n\t\tthis.$component = this.wrapper.find('.item-details-container');\n\t}\n\n\tinit_child_components() {\n\t\tthis.$component.html(\n\t\t\t`<div class=\"item-details-header\">\n\t\t\t\t<div class=\"label\">${__('Item Detailss')}</div>\n\t\t\t\t<div class=\"close-btn\">\n\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"item-display\">\n\t\t\t\t<div class=\"item-name-desc-price\">\n\t\t\t\t\t<div class=\"item-name\"></div>\n\t\t\t\t\t<div class=\"item-desc\"></div>\n\t\t\t\t\t<div class=\"item-price\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"item-image\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"discount-section\"></div>\n\t\t\t<div class=\"form-container\"></div>\n\t\t\t<div class=\"serial-batch-container\"></div>`\n\t\t)\n\n\t\tthis.$item_name = this.$component.find('.item-name');\n\t\tthis.$item_description = this.$component.find('.item-desc');\n\t\tthis.$item_price = this.$component.find('.item-price');\n\t\tthis.$item_image = this.$component.find('.item-image');\n\t\tthis.$form_container = this.$component.find('.form-container');\n\t\tthis.$dicount_section = this.$component.find('.discount-section');\n\t\tthis.$serial_batch_container = this.$component.find('.serial-batch-container');\n\t}\n\n\tcompare_with_current_item(item) {\n\t\t// returns true if `item` is currently being edited\n\t\treturn item && item.name == this.current_item.name;\n\t}\n\n\tasync toggle_item_details_section(item) {\n\t\tconst current_item_changed = !this.compare_with_current_item(item);\n\n\t\t// if item is null or highlighted cart item is clicked twice\n\t\tconst hide_item_details = !Boolean(item) || !current_item_changed;\n\n\t\tif ((!hide_item_details && current_item_changed) || hide_item_details) {\n\t\t\t// if item details is being closed OR if item details is opened but item is changed\n\t\t\t// in both cases, if the current item is a serialized item, then validate and remove the item\n\t\t\tawait this.validate_serial_batch_item();\n\t\t}\n\t\tif(!this.custom_edit_rate_and_uom){\n\t\t\tthis.events.toggle_item_selector(!hide_item_details);\n\t\t\tthis.toggle_component(!hide_item_details);\n\t\t}\n\n\n\t\tif (item && current_item_changed) {\n\t\t\tthis.doctype = item.doctype;\n\t\t\tthis.item_meta = frappe.get_meta(this.doctype);\n\t\t\tthis.name = item.name;\n\t\t\tthis.item_row = item;\n\t\t\tthis.currency = this.events.get_frm().doc.currency;\n\n\t\t\tthis.current_item = item;\n\n\t\t\tthis.render_dom(item);\n\t\t\tthis.render_discount_dom(item);\n\t\t\tthis.render_form(item);\n\t\t\tthis.events.highlight_cart_item(item);\n\t\t} else {\n\t\t\tthis.current_item = {};\n\t\t}\n\t}\n\n\tvalidate_serial_batch_item() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst item_row = doc.items.find(item => item.name === this.name);\n\n\t\tif (!item_row) return;\n\n\t\tconst serialized = item_row.has_serial_no;\n\t\tconst batched = item_row.has_batch_no;\n\t\tconst no_bundle_selected = !item_row.serial_and_batch_bundle;\n\n\t\tif ((serialized && no_bundle_selected) || (batched && no_bundle_selected)) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Item is removed since no serial / batch no selected.\"),\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"cancel\");\n\t\t\treturn this.events.remove_item_from_cart();\n\t\t}\n\t}\n\n\trender_dom(item) {\n\t\tlet { item_name, description, image, price_list_rate } = item;\n\n\t\tfunction get_description_html() {\n\t\t\tif (description) {\n\t\t\t\tdescription = description.indexOf('...') === -1 && description.length > 140 ? description.substr(0, 139) + '...' : description;\n\t\t\t\treturn description;\n\t\t\t}\n\t\t\treturn ``;\n\t\t}\n\n\t\tthis.$item_name.html(item_name);\n\t\tthis.$item_description.html(get_description_html());\n\t\tthis.$item_price.html(format_currency(price_list_rate, this.currency));\n\t\tif (!this.hide_images && image) {\n\t\t\tthis.$item_image.html(\n\t\t\t\t`<img\n\t\t\t\t\tonerror=\"cur_pos.item_details.handle_broken_image(this)\"\n\t\t\t\t\tclass=\"h-full\" src=\"${image}\"\n\t\t\t\t\talt=\"${frappe.get_abbr(item_name)}\"\n\t\t\t\t\tstyle=\"object-fit: cover;\">`\n\t\t\t);\n\t\t} else {\n\t\t\tthis.$item_image.html(`<div class=\"item-abbr\">${frappe.get_abbr(item_name)}</div>`);\n\t\t}\n\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr('alt');\n\t\t$($img).replaceWith(`<div class=\"item-abbr\">${item_abbr}</div>`);\n\t}\n\n\trender_discount_dom(item) {\n\t\tif (item.discount_percentage) {\n\t\t\tthis.$dicount_section.html(\n\t\t\t\t`<div class=\"item-rate\">${format_currency(item.price_list_rate, this.currency)}</div>\n\t\t\t\t<div class=\"item-discount\">${item.discount_percentage}% off</div>`\n\t\t\t)\n\t\t\tthis.$item_price.html(format_currency(item.rate, this.currency));\n\t\t} else {\n\t\t\tthis.$dicount_section.html(``)\n\t\t}\n\t}\n\n\trender_form(item) {\n\t\tconst fields_to_display = this.get_form_fields(item);\n\t\tthis.$form_container.html('');\n\n\t\tfields_to_display.forEach((fieldname, idx) => {\n\t\t\tthis.$form_container.append(\n\t\t\t\t`<div class=\"${fieldname}-control\" data-fieldname=\"${fieldname}\"></div>`\n\t\t\t)\n\n\t\t\tconst field_meta = this.item_meta.fields.find(df => df.fieldname === fieldname);\n\t\t\tfieldname === 'discount_percentage' ? (field_meta.label = __('Discount (%)')) : '';\n\t\t\tconst me = this;\n\t\t\tvar uoms = []\n\t\t\tfrappe.db.get_doc(\"Item\",me.current_item.item_code).then(doc => {\n\t\t\t\tuoms = doc.uoms.map(item => item.uom);\n\t\t\t})\n\t\t\tthis[`${fieldname}_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\t...field_meta,\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tme.events.form_updated(me.current_item, fieldname, this.value);\n\t\t\t\t\t},\n\t\t\t\t\tget_query:function () {\n\t\t\t\t\t\tif(fieldname === 'uom'){\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\tname: ['in',uoms]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn\n                    }\n\t\t\t\t},\n\t\t\t\tparent: this.$form_container.find(`.${fieldname}-control`),\n\t\t\t\trender_input: true,\n\t\t\t})\n\t\t\tthis[`${fieldname}_control`].set_value(item[fieldname]);\n\t\t});\n\n\t\tthis.make_auto_serial_selection_btn(item);\n\n\t\tthis.bind_custom_control_change_event();\n\t}\n\n\tget_form_fields(item) {\n\t\tconst fields = ['qty', 'uom', 'rate', 'conversion_factor', 'discount_percentage', 'warehouse', 'actual_qty', 'price_list_rate'];\n\t\tif (item.has_serial_no) fields.push('serial_no');\n\t\tif (item.has_batch_no) fields.push('batch_no');\n\t\treturn fields;\n\t}\n\n\tmake_auto_serial_selection_btn(item) {\n\t\tif (item.has_serial_no || item.has_batch_no) {\n\t\t\tconst label = item.has_serial_no ? __('Select Serial No') : __('Select Batch No');\n\t\t\tthis.$form_container.append(\n\t\t\t\t`<div class=\"btn btn-sm btn-secondary auto-fetch-btn\">${label}</div>`\n\t\t\t);\n\t\t\tthis.$form_container.find('.serial_no-control').find('textarea').css('height', '6rem');\n\t\t}\n\t}\n\n\tbind_custom_control_change_event() {\n\t\tconst me = this;\n\t\tif (this.rate_control) {\n\t\t\tthis.rate_control.df.onchange = function() {\n\t\t\t\tif (this.value || flt(this.value) === 0) {\n\t\t\t\t\tme.events.form_updated(me.current_item, 'rate', this.value).then(() => {\n\t\t\t\t\t\tconst item_row = frappe.get_doc(me.doctype, me.name);\n\t\t\t\t\t\tconst doc = me.events.get_frm().doc;\n\t\t\t\t\t\tme.$item_price.html(format_currency(item_row.rate, doc.currency));\n\t\t\t\t\t\tme.render_discount_dom(item_row);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.rate_control.df.read_only = !this.allow_rate_change;\n\t\t\tthis.rate_control.refresh();\n\t\t}\n\n\t\tif (this.discount_percentage_control && !this.allow_discount_change) {\n\t\t\tthis.discount_percentage_control.df.read_only = 1;\n\t\t\tthis.discount_percentage_control.refresh();\n\t\t}\n\n\t\tif (this.warehouse_control) {\n\t\t\tthis.warehouse_control.df.reqd = 1;\n\t\t\tthis.warehouse_control.df.onchange = function() {\n\t\t\t\tif (this.value) {\n\t\t\t\t\tme.events.form_updated(me.current_item, 'warehouse', this.value).then(() => {\n\t\t\t\t\t\tme.item_stock_map = me.events.get_item_stock_map();\n\t\t\t\t\t\tconst available_qty = me.item_stock_map[me.item_row.item_code][this.value][0];\n\t\t\t\t\t\tconst is_stock_item = Boolean(me.item_stock_map[me.item_row.item_code][this.value][1]);\n\t\t\t\t\t\tif (available_qty === undefined) {\n\t\t\t\t\t\t\tme.events.get_available_stock(me.item_row.item_code, this.value).then(() => {\n\t\t\t\t\t\t\t\t// item stock map is updated now reset warehouse\n\t\t\t\t\t\t\t\tme.warehouse_control.set_value(this.value);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t} else if (available_qty === 0 && is_stock_item) {\n\t\t\t\t\t\t\tme.warehouse_control.set_value('');\n\t\t\t\t\t\t\tconst bold_item_code = me.item_row.item_code.bold();\n\t\t\t\t\t\t\tconst bold_warehouse = this.value.bold();\n\t\t\t\t\t\t\tfrappe.throw(\n\t\t\t\t\t\t\t\t__('Item Code: {0} is not available under warehouse {1}.', [bold_item_code, bold_warehouse])\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tme.actual_qty_control.set_value(available_qty);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.warehouse_control.df.get_query = () => {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: { company: this.events.get_frm().doc.company }\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.warehouse_control.refresh();\n\t\t}\n\n\t\tif (this.serial_no_control) {\n\t\t\tthis.serial_no_control.df.reqd = 1;\n\t\t\tthis.serial_no_control.df.onchange = async function() {\n\t\t\t\t!me.current_item.batch_no && await me.auto_update_batch_no();\n\t\t\t\tme.events.form_updated(me.current_item, 'serial_no', this.value);\n\t\t\t}\n\t\t\tthis.serial_no_control.refresh();\n\t\t}\n\n\t\tif (this.batch_no_control) {\n\t\t\tthis.batch_no_control.df.reqd = 1;\n\t\t\tthis.batch_no_control.df.get_query = () => {\n\t\t\t\treturn {\n\t\t\t\t\tquery: 'erpnext.controllers.queries.get_batch_no',\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\titem_code: me.item_row.item_code,\n\t\t\t\t\t\twarehouse: me.item_row.warehouse,\n\t\t\t\t\t\tposting_date: me.events.get_frm().doc.posting_date\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.batch_no_control.refresh();\n\t\t}\n\n\t\tif (this.uom_control) {\n\t\t\tthis.uom_control.df.onchange = function() {\n\t\t\t\tme.events.form_updated(me.current_item, 'uom', this.value);\n\n\t\t\t\tconst item_row = frappe.get_doc(me.doctype, me.name);\n\t\t\t\tme.conversion_factor_control.df.read_only = (item_row.stock_uom == this.value);\n\t\t\t\tme.conversion_factor_control.refresh();\n\t\t\t}\n\t\t}\n\n\t\tfrappe.model.on(\"Sales Invoice Item\", \"*\", (fieldname, value, item_row) => {\n\t\t\tconst field_control = this[`${fieldname}_control`];\n\t\t\tconst item_row_is_being_edited = this.compare_with_current_item(item_row);\n\n\t\t\tif (item_row_is_being_edited && field_control && field_control.get_value() !== value) {\n\t\t\t\tfield_control.set_value(value);\n\t\t\t\tcur_pos.update_cart_html(item_row);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync auto_update_batch_no() {\n\t\tif (this.serial_no_control && this.batch_no_control) {\n\t\t\tconst selected_serial_nos = this.serial_no_control.get_value().split(`\\n`).filter(s => s);\n\t\t\tif (!selected_serial_nos.length) return;\n\n\t\t\t// find batch nos of the selected serial no\n\t\t\tconst serials_with_batch_no = await frappe.db.get_list(\"Serial No\", {\n\t\t\t\tfilters: { 'name': [\"in\", selected_serial_nos]},\n\t\t\t\tfields: [\"batch_no\", \"name\"]\n\t\t\t});\n\t\t\tconst batch_serial_map = serials_with_batch_no.reduce((acc, r) => {\n\t\t\t\tif (!acc[r.batch_no]) {\n\t\t\t\t\tacc[r.batch_no] = [];\n\t\t\t\t}\n\t\t\t\tacc[r.batch_no] = [...acc[r.batch_no], r.name];\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\t\t\t// set current item's batch no and serial no\n\t\t\tconst batch_no = Object.keys(batch_serial_map)[0];\n\t\t\tconst batch_serial_nos = batch_serial_map[batch_no].join(`\\n`);\n\t\t\t// eg. 10 selected serial no. -> 5 belongs to first batch other 5 belongs to second batch\n\t\t\tconst serial_nos_belongs_to_other_batch = selected_serial_nos.length !== batch_serial_map[batch_no].length;\n\n\t\t\tconst current_batch_no = this.batch_no_control.get_value();\n\t\t\tcurrent_batch_no != batch_no && await this.batch_no_control.set_value(batch_no);\n\n\t\t\tif (serial_nos_belongs_to_other_batch) {\n\t\t\t\tthis.serial_no_control.set_value(batch_serial_nos);\n\t\t\t\tthis.qty_control.set_value(batch_serial_map[batch_no].length);\n\n\t\t\t\tdelete batch_serial_map[batch_no];\n\t\t\t\tthis.events.clone_new_batch_item_in_frm(batch_serial_map, this.current_item);\n\t\t\t}\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tthis.bind_auto_serial_fetch_event();\n\t\tthis.bind_fields_to_numpad_fields();\n\n\t\tthis.$component.on('click', '.close-btn', () => {\n\t\t\tthis.events.close_item_details();\n\t\t});\n\t}\n\n\tattach_shortcuts() {\n\t\tthis.wrapper.find('.close-btn').attr(\"title\", \"Esc\");\n\t\tfrappe.ui.keys.on(\"escape\", () => {\n\t\t\tconst item_details_visible = this.$component.is(\":visible\");\n\t\t\tif (item_details_visible) {\n\t\t\t\tthis.events.close_item_details();\n\t\t\t}\n\t\t});\n\t}\n\n\tbind_fields_to_numpad_fields() {\n\t\tconst me = this;\n\t\tthis.$form_container.on('click', '.input-with-feedback', function() {\n\t\t\tconst fieldname = $(this).attr('data-fieldname');\n\t\t\tif (this.last_field_focused != fieldname) {\n\t\t\t\tme.events.item_field_focused(fieldname);\n\t\t\t\tthis.last_field_focused = fieldname;\n\t\t\t}\n\t\t});\n\t}\n\n\tbind_auto_serial_fetch_event() {\n\t\tthis.$form_container.on('click', '.auto-fetch-btn', () => {\n\t\t\tfrappe.require(\"assets/erpnext/js/utils/serial_no_batch_selector.js\", () => {\n\t\t\t\tlet frm = this.events.get_frm();\n\t\t\t\tlet item_row = this.item_row;\n\t\t\t\titem_row.type_of_transaction = \"Outward\";\n\n\t\t\t\tnew erpnext.SerialBatchPackageSelector(frm, item_row, (r) => {\n\t\t\t\t\tif (r) {\n\t\t\t\t\t\tfrappe.model.set_value(item_row.doctype, item_row.name, {\n\t\t\t\t\t\t\t\"serial_and_batch_bundle\": r.name,\n\t\t\t\t\t\t\t\"qty\": Math.abs(r.total_qty)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t})\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n}\n", "frappe.provide('posnext.PointOfSale');\nposnext.PointOfSale.NumberPad = class {\n\tconstructor({ wrapper, events, cols, keys, css_classes, fieldnames_map }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.cols = cols;\n\t\tthis.keys = keys;\n\t\tthis.css_classes = css_classes || [];\n\t\tthis.fieldnames = fieldnames_map || {};\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.bind_events();\n\t}\n\n\tprepare_dom() {\n\t\tconst { cols, keys, css_classes, fieldnames } = this;\n\n\t\tfunction get_keys() {\n\t\t\treturn keys.reduce((a, row, i) => {\n\t\t\t\treturn a + row.reduce((a2, number, j) => {\n\t\t\t\t\tconst class_to_append = css_classes && css_classes[i] ? css_classes[i][j] : '';\n\t\t\t\t\tconst fieldname = fieldnames && fieldnames[number] ?\n\t\t\t\t\t\tfieldnames[number] : typeof number === 'string' ? frappe.scrub(number) : number;\n\n\t\t\t\t\treturn a2 + `<div class=\"numpad-btn ${class_to_append}\" data-button-value=\"${fieldname}\">${__(number)}</div>`;\n\t\t\t\t}, '');\n\t\t\t}, '');\n\t\t}\n\n\t\tthis.wrapper.html(\n\t\t\t`<div class=\"numpad-container\">\n\t\t\t\t${get_keys()}\n\t\t\t</div>`\n\t\t)\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\tthis.wrapper.on('click', '.numpad-btn', function() {\n\t\t\tconst $btn = $(this);\n\t\t\tme.events.numpad_event($btn);\n\t\t});\n\t}\n}\n", "/* eslint-disable no-unused-vars */\nfrappe.provide('posnext.PointOfSale');\nposnext.PointOfSale.Payment = class {\n\tconstructor({ events, wrapper }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.initialize_numpad();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<style>\n\t\t\t\t.action-buttons {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tgap: 12px;\n\t\t\t\t\tmargin-top: 16px;\n\t\t\t\t}\n\t\t\t\t.send-kot-btn, .submit-order-btn {\n\t\t\t\t\tflex: 1;\n\t\t\t\t\tpadding: 12px 16px;\n\t\t\t\t\tborder-radius: 6px;\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tfont-weight: 600;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\ttransition: all 0.2s;\n\t\t\t\t\tfont-size: 14px;\n\t\t\t\t}\n\t\t\t\t.send-kot-btn {\n\t\t\t\t\tbackground: #f59e0b;\n\t\t\t\t\tcolor: #fff;\n\t\t\t\t\tborder: 2px solid #f59e0b;\n\t\t\t\t}\n\t\t\t\t.send-kot-btn:hover:not(:disabled) {\n\t\t\t\t\tbackground: #d97706;\n\t\t\t\t\tborder-color: #d97706;\n\t\t\t\t}\n\t\t\t\t.submit-order-btn {\n\t\t\t\t\tbackground: #4CAF50;\n\t\t\t\t\tcolor: #fff;\n\t\t\t\t\tborder: 2px solid #4CAF50;\n\t\t\t\t}\n\t\t\t\t.submit-order-btn:hover:not(:disabled) {\n\t\t\t\t\tbackground: #3d8b40;\n\t\t\t\t\tborder-color: #3d8b40;\n\t\t\t\t}\n\t\t\t\t.send-kot-btn:disabled, .submit-order-btn:disabled {\n\t\t\t\t\topacity: 0.5;\n\t\t\t\t\tcursor: not-allowed;\n\t\t\t\t}\n\t\t\t</style>\n\t\t\t<section class=\"payment-container\">\n\t\t\t\t<div class=\"section-label payment-section\">${__('Payment Method')}</div>\n\t\t\t\t<div class=\"payment-modes\"></div>\n\t\t\t\t<div class=\"fields-numpad-container\">\n\t\t\t\t\t<div class=\"fields-section\">\n\t\t\t\t\t\t<div class=\"section-label\">${__('Additional Information')}</div>\n\t\t\t\t\t\t<div class=\"invoice-fields\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"number-pad\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"totals-section\">\n\t\t\t\t\t<div class=\"totals\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"action-buttons\">\n\t\t\t\t\t<div class=\"send-kot-btn\">${__(\"Send to Kitchen\")}</div>\n\t\t\t\t\t<div class=\"submit-order-btn\">${__(\"Complete Order\")}</div>\n\t\t\t\t</div>\n\t\t\t</section>`\n\t\t);\n\t\tthis.$component = this.wrapper.find('.payment-container');\n\t\tthis.$payment_modes = this.$component.find('.payment-modes');\n\t\tthis.$totals_section = this.$component.find('.totals-section');\n\t\tthis.$totals = this.$component.find('.totals');\n\t\tthis.$numpad = this.$component.find('.number-pad');\n\t\tthis.$invoice_fields_section = this.$component.find('.fields-section');\n\t}\n\n\tmake_invoice_fields_control() {\n\t\tfrappe.db.get_doc(\"POS Settings\", undefined).then((doc) => {\n\t\t\tconst fields = doc.invoice_fields;\n\t\t\tif (!fields.length) return;\n\n\t\t\tthis.$invoice_fields = this.$invoice_fields_section.find('.invoice-fields');\n\t\t\tthis.$invoice_fields.html('');\n\t\t\tconst frm = this.events.get_frm();\n\n\t\t\tfields.forEach(df => {\n\t\t\t\tthis.$invoice_fields.append(\n\t\t\t\t\t`<div class=\"invoice_detail_field ${df.fieldname}-field\" data-fieldname=\"${df.fieldname}\"></div>`\n\t\t\t\t);\n\t\t\t\tlet df_events = {\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tfrm.set_value(this.df.fieldname, this.get_value());\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (df.fieldtype == \"Button\") {\n\t\t\t\t\tdf_events = {\n\t\t\t\t\t\tclick: function() {\n\t\t\t\t\t\t\tif (frm.script_manager.has_handlers(df.fieldname, frm.doc.doctype)) {\n\t\t\t\t\t\t\t\tfrm.script_manager.trigger(df.fieldname, frm.doc.doctype, frm.doc.docname);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tthis[`${df.fieldname}_field`] = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\t...df,\n\t\t\t\t\t\t...df_events\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$invoice_fields.find(`.${df.fieldname}-field`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tthis[`${df.fieldname}_field`].set_value(frm.doc[df.fieldname]);\n\t\t\t});\n\t\t});\n\t}\n\n\tinitialize_numpad() {\n\t\tconst me = this;\n\t\tthis.number_pad = new posnext.PointOfSale.NumberPad({\n\t\t\twrapper: this.$numpad,\n\t\t\tevents: {\n\t\t\t\tnumpad_event: function($btn) {\n\t\t\t\t\tme.on_numpad_clicked($btn);\n\t\t\t\t}\n\t\t\t},\n\t\t\tcols: 3,\n\t\t\tkeys: [\n\t\t\t\t[ 1, 2, 3 ],\n\t\t\t\t[ 4, 5, 6 ],\n\t\t\t\t[ 7, 8, 9 ],\n\t\t\t\t[ '.', 0, 'Delete' ]\n\t\t\t],\n\t\t});\n\n\t\tthis.numpad_value = '';\n\t}\n\n\ton_numpad_clicked($btn) {\n\t\tconst button_value = $btn.attr('data-button-value');\n\n\t\thighlight_numpad_btn($btn);\n\t\tthis.numpad_value = button_value === 'delete' ? this.numpad_value.slice(0, -1) : this.numpad_value + button_value;\n\t\tthis.selected_mode.$input.get(0).focus();\n\t\tthis.selected_mode.set_value(this.numpad_value);\n\n\t\tfunction highlight_numpad_btn($btn) {\n\t\t\t$btn.addClass('shadow-base-inner bg-selected');\n\t\t\tsetTimeout(() => {\n\t\t\t\t$btn.removeClass('shadow-base-inner bg-selected');\n\t\t\t}, 100);\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\n\t\tthis.$payment_modes.on('click', '.mode-of-payment', function(e) {\n\t\t\tconst mode_clicked = $(this);\n\t\t\t// if clicked element doesn't have .mode-of-payment class then return\n\t\t\tif (!$(e.target).is(mode_clicked)) return;\n\n\t\t\tconst scrollLeft = mode_clicked.offset().left - me.$payment_modes.offset().left + me.$payment_modes.scrollLeft();\n\t\t\tme.$payment_modes.animate({ scrollLeft });\n\n\t\t\tconst mode = mode_clicked.attr('data-mode');\n\n\t\t\t// hide all control fields and shortcuts\n\t\t\t$(`.mode-of-payment-control`).css('display', 'none');\n\t\t\t$(`.cash-shortcuts`).css('display', 'none');\n\t\t\tme.$payment_modes.find(`.pay-amount`).css('display', 'inline');\n\t\t\tme.$payment_modes.find(`.loyalty-amount-name`).css('display', 'none');\n\n\t\t\t// remove highlight from all mode-of-payments\n\t\t\t$('.mode-of-payment').removeClass('border-primary');\n\n\t\t\tif (mode_clicked.hasClass('border-primary')) {\n\t\t\t\t// clicked one is selected then unselect it\n\t\t\t\tmode_clicked.removeClass('border-primary');\n\t\t\t\tme.selected_mode = '';\n\t\t\t} else {\n\t\t\t\t// clicked one is not selected then select it\n\t\t\t\tmode_clicked.addClass('border-primary');\n\t\t\t\tmode_clicked.find('.mode-of-payment-control').css('display', 'flex');\n\t\t\t\tmode_clicked.find('.cash-shortcuts').css('display', 'grid');\n\t\t\t\tme.$payment_modes.find(`.${mode}-amount`).css('display', 'none');\n\t\t\t\tme.$payment_modes.find(`.${mode}-name`).css('display', 'inline');\n\n\t\t\t\tme.selected_mode = me[`${mode}_control`];\n\t\t\t\tme.selected_mode && me.selected_mode.$input.get(0).focus();\n\t\t\t\tme.auto_set_remaining_amount();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'contact_mobile', (frm) => {\n\t\t\tconst contact = frm.doc.contact_mobile;\n\t\t\tconst request_button = $(this.request_for_payment_field?.$input[0]);\n\t\t\tif (contact) {\n\t\t\t\trequest_button.removeClass('btn-default').addClass('btn-primary');\n\t\t\t} else {\n\t\t\t\trequest_button.removeClass('btn-primary').addClass('btn-default');\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'coupon_code', (frm) => {\n\t\t\tif (frm.doc.coupon_code && !frm.applying_pos_coupon_code) {\n\t\t\t\tif (!frm.doc.ignore_pricing_rule) {\n\t\t\t\t\tfrm.applying_pos_coupon_code = true;\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => frm.doc.ignore_pricing_rule=1,\n\t\t\t\t\t\t() => frm.trigger('ignore_pricing_rule'),\n\t\t\t\t\t\t() => frm.doc.ignore_pricing_rule=0,\n\t\t\t\t\t\t() => frm.trigger('apply_pricing_rule'),\n\t\t\t\t\t\t() => frm.save(),\n\t\t\t\t\t\t() => this.update_totals_section(frm.doc),\n\t\t\t\t\t\t() => (frm.applying_pos_coupon_code = false)\n\t\t\t\t\t]);\n\t\t\t\t} else if (frm.doc.ignore_pricing_rule) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"Ignore Pricing Rule is enabled. Cannot apply coupon code.\"),\n\t\t\t\t\t\tindicator: \"orange\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.setup_listener_for_payments();\n\n\t\tthis.$payment_modes.on('click', '.shortcut', function() {\n\t\t\tconst value = $(this).attr('data-value');\n\t\t\tme.selected_mode.set_value(value);\n\t\t});\n\n\t\tthis.$component.on('click', '.submit-order-btn', () => {\n\t\t\tconst doc = this.events.get_frm().doc;\n\t\t\tconst paid_amount = doc.paid_amount;\n\t\t\tconst items = doc.items;\n\n\t\t\tif (paid_amount == 0 || !items.length) {\n\t\t\t\tconst message = items.length ? __(\"You cannot submit the order without payment.\") : __(\"You cannot submit empty order.\");\n\t\t\t\tfrappe.show_alert({ message, indicator: \"orange\" });\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.events.submit_invoice();\n\t\t});\n\n\t\tthis.$component.on('click', '.send-kot-btn', () => {\n\t\t\tconst doc = this.events.get_frm().doc;\n\t\t\tconst items = doc.items;\n\n\t\t\tif (!items.length) {\n\t\t\t\tfrappe.show_alert({ message: __(\"You cannot send empty order to kitchen.\"), indicator: \"orange\" });\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.send_to_kitchen(doc);\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'paid_amount', (frm) => {\n\t\t\tthis.update_totals_section(frm.doc);\n\n\t\t\t// need to re calculate cash shortcuts after discount is applied\n\t\t\tconst is_cash_shortcuts_invisible = !this.$payment_modes.find('.cash-shortcuts').is(':visible');\n\t\t\tthis.attach_cash_shortcuts(frm.doc);\n\t\t\t!is_cash_shortcuts_invisible && this.$payment_modes.find('.cash-shortcuts').css('display', 'grid');\n\t\t\tthis.render_payment_mode_dom();\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'loyalty_amount', (frm) => {\n\t\t\tconst formatted_currency = format_currency(frm.doc.loyalty_amount, frm.doc.currency);\n\t\t\tthis.$payment_modes.find(`.loyalty-amount-amount`).html(formatted_currency);\n\t\t});\n\n\t\tfrappe.ui.form.on(\"Sales Invoice Payment\", \"amount\", (frm, cdt, cdn) => {\n\t\t\t// for setting correct amount after loyalty points are redeemed\n\t\t\tconst default_mop = locals[cdt][cdn];\n\t\t\tconst mode = default_mop.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tif (this[`${mode}_control`] && this[`${mode}_control`].get_value() != default_mop.amount) {\n\t\t\t\tthis[`${mode}_control`].set_value(default_mop.amount);\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_listener_for_payments() {\n\t\tfrappe.realtime.on(\"process_phone_payment\", (data) => {\n\t\t\tconst doc = this.events.get_frm().doc;\n\t\t\tconst { response, amount, success, failure_message } = data;\n\t\t\tlet message, title;\n\n\t\t\tif (success) {\n\t\t\t\ttitle = __(\"Payment Received\");\n\t\t\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\t\t\tif (amount >= grand_total) {\n\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t\tmessage = __(\"Payment of {0} received successfully.\", [format_currency(amount, doc.currency, 0)]);\n\t\t\t\t\tthis.events.submit_invoice();\n\t\t\t\t\tcur_frm.reload_doc();\n\n\t\t\t\t} else {\n\t\t\t\t\tmessage = __(\"Payment of {0} received successfully. Waiting for other requests to complete...\", [format_currency(amount, doc.currency, 0)]);\n\t\t\t\t}\n\t\t\t} else if (failure_message) {\n\t\t\t\tmessage = failure_message;\n\t\t\t\ttitle = __(\"Payment Failed\");\n\t\t\t}\n\n\t\t\tfrappe.msgprint({ \"message\": message, \"title\": title });\n\t\t});\n\t}\n\n\tauto_set_remaining_amount() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\tconst remaining_amount = grand_total - doc.paid_amount;\n\t\tconst current_value = this.selected_mode ? this.selected_mode.get_value() : undefined;\n\t\tif (!current_value && remaining_amount > 0 && this.selected_mode) {\n\t\t\tthis.selected_mode.set_value(remaining_amount);\n\t\t}\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '\u2318' : 'Ctrl';\n\t\tthis.$component.find('.submit-order-btn').attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.on(\"ctrl+enter\", () => {\n\t\t\tconst payment_is_visible = this.$component.is(\":visible\");\n\t\t\tconst active_mode = this.$payment_modes.find(\".border-primary\");\n\t\t\tif (payment_is_visible && active_mode.length) {\n\t\t\t\tthis.$component.find('.submit-order-btn').click();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"tab\",\n\t\t\taction: () => {\n\t\t\t\tconst payment_is_visible = this.$component.is(\":visible\");\n\t\t\t\tlet active_mode = this.$payment_modes.find(\".border-primary\");\n\t\t\t\tactive_mode = active_mode.length ? active_mode.attr(\"data-mode\") : undefined;\n\n\t\t\t\tif (!active_mode) return;\n\n\t\t\t\tconst mode_of_payments = Array.from(this.$payment_modes.find(\".mode-of-payment\")).map(m => $(m).attr(\"data-mode\"));\n\t\t\t\tconst mode_index = mode_of_payments.indexOf(active_mode);\n\t\t\t\tconst next_mode_index = (mode_index + 1) % mode_of_payments.length;\n\t\t\t\tconst next_mode_to_be_clicked = this.$payment_modes.find(`.mode-of-payment[data-mode=\"${mode_of_payments[next_mode_index]}\"]`);\n\n\t\t\t\tif (payment_is_visible && mode_index != next_mode_index) {\n\t\t\t\t\tnext_mode_to_be_clicked.click();\n\t\t\t\t}\n\t\t\t},\n\t\t\tcondition: () => this.$component.is(':visible') && this.$payment_modes.find(\".border-primary\").length,\n\t\t\tdescription: __(\"Switch Between Payment Modes\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t}\n\n\ttoggle_numpad() {\n\t\t// pass\n\t}\n\n\trender_payment_section() {\n\t\tthis.render_payment_mode_dom();\n\t\tthis.make_invoice_fields_control();\n\t\tthis.update_totals_section();\n\t\tthis.focus_on_default_mop();\n\t}\n\n\tafter_render() {\n\t\tconst frm = this.events.get_frm();\n\t\tfrm.script_manager.trigger(\"after_payment_render\", frm.doc.doctype, frm.doc.docname);\n\t}\n\n\tedit_cart() {\n\t\tthis.events.toggle_other_sections(false);\n\t\tthis.toggle_component(false);\n\t}\n\n\tcheckout() {\n\t\tthis.events.toggle_other_sections(true);\n\t\tthis.toggle_component(true);\n\n\t\tthis.render_payment_section();\n\t\tthis.after_render();\n\t}\n\n\ttoggle_remarks_control() {\n\t\tif (this.$remarks.find('.frappe-control').length) {\n\t\t\tthis.$remarks.html('+ Add Remark');\n\t\t} else {\n\t\t\tthis.$remarks.html('');\n\t\t\tthis[`remark_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: __('Remark'),\n\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\tonchange: function() {}\n\t\t\t\t},\n\t\t\t\tparent: this.$totals_section.find(`.remarks`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`remark_control`].set_value('');\n\t\t}\n\t}\n\n\trender_payment_mode_dom() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst payments = doc.payments;\n\t\tconst currency = doc.currency;\n\n\t\tthis.$payment_modes.html(`${\n\t\t\tpayments.map((p, i) => {\n\t\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\t\tconst payment_type = p.type;\n\t\t\t\tconst margin = i % 2 === 0 ? 'pr-2' : 'pl-2';\n\t\t\t\tconst amount = p.amount > 0 ? format_currency(p.amount, currency) : '';\n\n\t\t\t\treturn (`\n\t\t\t\t\t<div class=\"payment-mode-wrapper\">\n\t\t\t\t\t\t<div class=\"mode-of-payment\" data-mode=\"${mode}\" data-payment-type=\"${payment_type}\">\n\t\t\t\t\t\t\t${p.mode_of_payment}\n\t\t\t\t\t\t\t<div class=\"${mode}-amount pay-amount\">${amount}</div>\n\t\t\t\t\t\t\t<div class=\"${mode} mode-of-payment-control\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`);\n\t\t\t}).join('')\n\t\t}`);\n\n\t\tpayments.forEach(p => {\n\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tconst me = this;\n\t\t\tthis[`${mode}_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: p.mode_of_payment,\n\t\t\t\t\tfieldtype: 'Currency',\n\t\t\t\t\tplaceholder: __('Enter {0} amount.', [p.mode_of_payment]),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst current_value = frappe.model.get_value(p.doctype, p.name, 'amount');\n\t\t\t\t\t\tif (current_value != this.value) {\n\t\t\t\t\t\t\tfrappe.model\n\t\t\t\t\t\t\t\t.set_value(p.doctype, p.name, 'amount', flt(this.value))\n\t\t\t\t\t\t\t\t.then(() => me.update_totals_section())\n\n\t\t\t\t\t\t\tconst formatted_currency = format_currency(this.value, currency);\n\t\t\t\t\t\t\tme.$payment_modes.find(`.${mode}-amount`).html(formatted_currency);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tparent: this.$payment_modes.find(`.${mode}.mode-of-payment-control`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`${mode}_control`].toggle_label(false);\n\t\t\tthis[`${mode}_control`].set_value(p.amount);\n\t\t});\n\n\t\tthis.render_loyalty_points_payment_mode();\n\n\t\tthis.attach_cash_shortcuts(doc);\n\t}\n\n\tfocus_on_default_mop() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst payments = doc.payments;\n\t\tpayments.forEach(p => {\n\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tif (p.default) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.$payment_modes.find(`.${mode}.mode-of-payment-control`).parent().click();\n\t\t\t\t}, 500);\n\t\t\t}\n\t\t});\n\t}\n\n\tattach_cash_shortcuts(doc) {\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\tconst currency = doc.currency;\n\n\t\tconst shortcuts = this.get_cash_shortcuts(flt(grand_total));\n\n\t\tthis.$payment_modes.find('.cash-shortcuts').remove();\n\t\tlet shortcuts_html = shortcuts.map(s => {\n\t\t\treturn `<div class=\"shortcut\" data-value=\"${s}\">${format_currency(s, currency, 0)}</div>`;\n\t\t}).join('');\n\n\t\tthis.$payment_modes.find('[data-payment-type=\"Cash\"]').find('.mode-of-payment-control')\n\t\t\t.after(`<div class=\"cash-shortcuts\">${shortcuts_html}</div>`);\n\t}\n\n\tget_cash_shortcuts(grand_total) {\n\t\tlet steps = [1, 5, 10];\n\t\tconst digits = String(Math.round(grand_total)).length;\n\n\t\tsteps = steps.map(x => x * (10 ** (digits - 2)));\n\n\t\tconst get_nearest = (amount, x) => {\n\t\t\tlet nearest_x = Math.ceil((amount / x)) * x;\n\t\t\treturn nearest_x === amount ? nearest_x + x : nearest_x;\n\t\t};\n\n\t\treturn steps.reduce((finalArr, x) => {\n\t\t\tlet nearest_x = get_nearest(grand_total, x);\n\t\t\tnearest_x = finalArr.indexOf(nearest_x) != -1 ? nearest_x + x : nearest_x;\n\t\t\treturn [...finalArr, nearest_x];\n\t\t}, []);\n\t}\n\n\trender_loyalty_points_payment_mode() {\n\t\tconst me = this;\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst { loyalty_program, loyalty_points, conversion_factor } = this.events.get_customer_details();\n\n\t\tthis.$payment_modes.find(`.mode-of-payment[data-mode=\"loyalty-amount\"]`).parent().remove();\n\n\t\tif (!loyalty_program) return;\n\n\t\tlet description, read_only, max_redeemable_amount;\n\t\tif (!loyalty_points) {\n\t\t\tdescription = __(\"You don't have enough points to redeem.\");\n\t\t\tread_only = true;\n\t\t} else {\n\t\t\tmax_redeemable_amount = flt(flt(loyalty_points) * flt(conversion_factor), precision(\"loyalty_amount\", doc));\n\t\t\tdescription = __(\"You can redeem upto {0}.\", [format_currency(max_redeemable_amount)]);\n\t\t\tread_only = false;\n\t\t}\n\n\t\tconst margin = this.$payment_modes.children().length % 2 === 0 ? 'pr-2' : 'pl-2';\n\t\tconst amount = doc.loyalty_amount > 0 ? format_currency(doc.loyalty_amount, doc.currency) : '';\n\t\tthis.$payment_modes.append(\n\t\t\t`<div class=\"payment-mode-wrapper\">\n\t\t\t\t<div class=\"mode-of-payment loyalty-card\" data-mode=\"loyalty-amount\" data-payment-type=\"loyalty-amount\">\n\t\t\t\t\tRedeem Loyalty Points\n\t\t\t\t\t<div class=\"loyalty-amount-amount pay-amount\">${amount}</div>\n\t\t\t\t\t<div class=\"loyalty-amount-name\">${loyalty_program}</div>\n\t\t\t\t\t<div class=\"loyalty-amount mode-of-payment-control\"></div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t);\n\n\t\tthis['loyalty-amount_control'] = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Redeem Loyalty Points\"),\n\t\t\t\tfieldtype: 'Currency',\n\t\t\t\tplaceholder: __(\"Enter amount to be redeemed.\"),\n\t\t\t\toptions: 'company:currency',\n\t\t\t\tread_only,\n\t\t\t\tonchange: async function() {\n\t\t\t\t\tif (!loyalty_points) return;\n\n\t\t\t\t\tif (this.value > max_redeemable_amount) {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"You cannot redeem more than {0}.\", [format_currency(max_redeemable_amount)]),\n\t\t\t\t\t\t\tindicator: \"red\"\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\tme['loyalty-amount_control'].set_value(0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst redeem_loyalty_points = this.value > 0 ? 1 : 0;\n\t\t\t\t\tawait frappe.model.set_value(doc.doctype, doc.name, 'redeem_loyalty_points', redeem_loyalty_points);\n\t\t\t\t\tfrappe.model.set_value(doc.doctype, doc.name, 'loyalty_points', parseInt(this.value / conversion_factor));\n\t\t\t\t},\n\t\t\t\tdescription\n\t\t\t},\n\t\t\tparent: this.$payment_modes.find(`.loyalty-amount.mode-of-payment-control`),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis['loyalty-amount_control'].toggle_label(false);\n\n\t\t// this.render_add_payment_method_dom();\n\t}\n\n\trender_add_payment_method_dom() {\n\t\tconst docstatus = this.events.get_frm().doc.docstatus;\n\t\tif (docstatus === 0)\n\t\t\tthis.$payment_modes.append(\n\t\t\t\t`<div class=\"w-full pr-2\">\n\t\t\t\t\t<div class=\"add-mode-of-payment w-half text-grey mb-4 no-select pointer\">+ Add Payment Method</div>\n\t\t\t\t</div>`\n\t\t\t);\n\t}\n\n\tupdate_totals_section(doc) {\n\t\tif (!doc) doc = this.events.get_frm().doc;\n\t\tconst paid_amount = doc.paid_amount;\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\tconst remaining = grand_total - doc.paid_amount;\n\t\tconst change = doc.change_amount || remaining <= 0 ? -1 * remaining : undefined;\n\t\tconst currency = doc.currency;\n\t\tconst label = change ? __('Change') : __('To Be Paid');\n\n\t\tthis.$totals.html(\n\t\t\t`<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${__('Grand Total')}</div>\n\t\t\t\t<div class=\"value\">${format_currency(grand_total, currency)}</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator-y\"></div>\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${__('Paid Amount')}</div>\n\t\t\t\t<div class=\"value\">${format_currency(paid_amount, currency)}</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator-y\"></div>\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${label}</div>\n\t\t\t\t<div class=\"value\">${format_currency(change || remaining, currency)}</div>\n\t\t\t</div>`\n\t\t);\n\t}\n\n\tsend_to_kitchen(doc) {\n\t\t// Convert items to the format expected by KOT API\n\t\tconst current_items = doc.items.map(item => ({\n\t\t\titem_code: item.item_code,\n\t\t\titem_name: item.item_name,\n\t\t\tqty: item.qty,\n\t\t\tcomments: item.comments || \"\"\n\t\t}));\n\n\t\t// Disable the button during processing\n\t\tthis.$component.find('.send-kot-btn').prop('disabled', true).text(__('Sending...'));\n\n\t\tfrappe.call({\n\t\t\tmethod: 'posnext.posnext.page.posnext.point_of_sale.kot_execute',\n\t\t\targs: {\n\t\t\t\tinvoice_id: doc.name,\n\t\t\t\tcustomer: doc.customer,\n\t\t\t\trestaurant_table: doc.pos_table,\n\t\t\t\tcurrent_items: current_items,\n\t\t\t\tprevious_items: [], // Empty for new orders\n\t\t\t\tcomments: doc.order_comments || \"\"\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tthis.$component.find('.send-kot-btn').prop('disabled', false).text(__('Send to Kitchen'));\n\t\t\t\tif (r.exc) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __('Failed to send order to kitchen. Please try again.'),\n\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t});\n\t\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __('Order sent to kitchen successfully!'),\n\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t});\n\t\t\t\t\tfrappe.utils.play_sound(\"success\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n};\n", "frappe.provide('posnext.PointOfSale');\nvar invoicess = []\nposnext.PointOfSale.PastOrderList = class {\n\tconstructor({ wrapper, events }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.selected_invoices = new Set(); // Track selected invoices\n\t\tthis.can_merge_invoices = this.check_merge_permission(); // Check if user can merge\n\t\tthis.user_list = []; // Store list of users from User Secret Key\n\t\tposnext.PointOfSale.PastOrderList.current_instance = this;\n\t\tthis._just_held_invoice = null; // Explicitly initialize\n\t\tthis._pending_created_by = null; // Store pending created_by filter\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.make_filter_section();\n\t\tthis.bind_events();\n\t\tthis.load_user_list(); // Load users for dropdown\n\t}\n\n\tcheck_merge_permission() {\n\t\t// Check if user has Waiter role - if they do, disable merge functionality\n\t\tconst user_roles = frappe.user_roles || [];\n\t\treturn !user_roles.includes('Waiter');\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"past-order-list\">\n\t\t\t\t<div class=\"filter-section\">\n\t\t\t\t\t<div class=\"label back\" style=\"font-size: 13px \">\n\t\t\t\t\t\t<a>\n\t\t\t\t\t\t\t<svg class=\"es-line\" style=\"width: 13px;height: 13px\">\n\t\t\t\t\t\t\t\t<use class=\"\" href=\"#es-line-left-chevron\"></use></svg> Back\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<br>\n\t\t\t\t\t<div class=\"label\">${__('Recent Orders')}</div>\n\t\t\t\t\t<div class=\"search-field\"></div>\n\t\t\t\t\t<div class=\"status-field\"></div>\n\t\t\t\t\t<div class=\"created-by-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoices-container\"></div>\n\t\t\t\t<div class=\"merge-section\" style=\"display: none; padding: 15px; border-top: 1px solid #d1d8dd; background-color: #f8f9fa;\">\n\t\t\t\t\t<div class=\"selected-count\" style=\"margin-bottom: 10px; font-size: 12px; color: #6c757d;\">\n\t\t\t\t\t\t<span class=\"count\">0</span> invoices selected\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class=\"btn btn-primary btn-sm merge-btn\" disabled>\n\t\t\t\t\t\t<svg style=\"width: 14px; height: 14px; margin-right: 5px;\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n\t\t\t\t\t\t\t<path d=\"M17,20.5V19H7V20.5L3,16.5L7,12.5V14H17V12.5L21,16.5L17,20.5M7,3.5V5H17V3.5L21,7.5L17,11.5V10H7V11.5L3,7.5L7,3.5Z\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t${__('Merge Selected Invoices')}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</section>`\n\t\t);\n\n\t\tthis.$component = this.wrapper.find('.past-order-list');\n\t\tthis.$invoices_container = this.$component.find('.invoices-container');\n\t\tthis.$merge_section = this.$component.find('.merge-section');\n\t\tthis.$merge_btn = this.$component.find('.merge-btn');\n\t\tthis.$selected_count = this.$component.find('.selected-count .count');\n\t}\n\n\tbind_events() {\n\t\tthis.search_field.$input.on('input', (e) => {\n\t\t\tclearTimeout(this.last_search);\n\t\t\tthis.last_search = setTimeout(() => {\n\t\t\t\tconst search_term = e.target.value;\n\t\t\t\tconsole.log('Search input changed to:', search_term);\n\t\t\t\tthis.refresh_list(search_term, this.status_field.get_value(), this.created_by_field.get_value());\n\t\t\t}, 300);\n\t\t});\n\n\t\tconst me = this;\n\t\t\n\t\t// Handle invoice click (only if not clicking checkbox)\n\t\tthis.$invoices_container.on('click', '.invoice-wrapper', function(e) {\n\t\t\tif (!$(e.target).closest('.invoice-checkbox-container').length) {\n\t\t\t\tconst invoice_name = unescape($(this).attr('data-invoice-name'));\n\t\t\t\tme.events.open_invoice_data(invoice_name);\n\t\t\t}\n\t\t});\n\n\t\t// Handle checkbox changes\n\t\tthis.$invoices_container.on('change', '.invoice-checkbox', function(e) {\n\t\t\te.stopPropagation();\n\t\t\tconst invoice_name = unescape($(this).closest('.invoice-wrapper').attr('data-invoice-name'));\n\t\t\t\n\t\t\tif ($(this).is(':checked')) {\n\t\t\t\tme.selected_invoices.add(invoice_name);\n\t\t\t} else {\n\t\t\t\tme.selected_invoices.delete(invoice_name);\n\t\t\t}\n\t\t\t\n\t\t\tme.update_merge_section();\n\t\t});\n\n\t\t// Handle merge button click\n\t\tthis.$merge_btn.on('click', function() {\n\t\t\tme.merge_selected_invoices();\n\t\t});\n\n\t\tthis.$component.on('click', '.back', function() {\n\t\t\tme.events.reset_summary();\n\t\t\tme.events.previous_screen();\n\t\t\t// Do not clear _just_held_invoice here; let ItemCart set it\n\t\t});\n\n\t\t// Add additional event listeners for select fields to ensure they trigger\n\t\tthis.$component.on('change', '.status-field select', function() {\n\t\t\tconsole.log('Status select changed via DOM event');\n\t\t\tme.refresh_list(\n\t\t\t\tme.search_field.get_value(), \n\t\t\t\t$(this).val(), \n\t\t\t\tme.created_by_field.get_value()\n\t\t\t);\n\t\t});\n\n\t\tthis.$component.on('change', '.created-by-field select', function() {\n\t\t\tconsole.log('Created by select changed via DOM event');\n\t\t\tme.refresh_list(\n\t\t\t\tme.search_field.get_value(), \n\t\t\t\tme.status_field.get_value(), \n\t\t\t\t$(this).val()\n\t\t\t);\n\t\t});\n\t}\n\n\tload_user_list() {\n\t\t// Load users from User Secret Key doctype\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.client.get_list\",\n\t\t\targs: {\n\t\t\t\tdoctype: \"User Secret Key\",\n\t\t\t\tfields: [\"name\", \"user_name\"],\n\t\t\t\tfilters: [[\"user_name\", \"!=\", \"\"]],  // Only get records with user_name\n\t\t\t\torder_by: \"modified desc\"\n\t\t\t},\n\t\t\tcallback: (response) => {\n\t\t\t\tif (response.message) {\n\t\t\t\t\tthis.user_list = response.message;\n\t\t\t\t\tthis.setup_created_by_field();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_created_by_field() {\n\t\t// Create options string for the dropdown using user_name field\n\t\tlet options = \"All\\n\" + this.user_list.map(user => user.user_name).join('\\n');\n\t\t\n\t\t// Update the created_by_field with the loaded options\n\t\tthis.created_by_field.df.options = options;\n\t\tthis.created_by_field.refresh();\n\t\t\n\t\t// Get the most recent created_by_name from invoices to set as default\n\t\tthis.get_most_recent_creator();\n\t}\n\n\tget_most_recent_creator() {\n\t\t// Make a quick call to get the most recent invoice's creator\n\t\tfrappe.call({\n\t\t\tmethod: \"posnext.posnext.page.posnext.point_of_sale.get_past_order_list\",\n\t\t\targs: { \n\t\t\t\tsearch_term: '', \n\t\t\t\tstatus: 'Draft',\n\t\t\t\tlimit: 1 // Just get the most recent one\n\t\t\t},\n\t\t\tcallback: (response) => {\n\t\t\t\tif (response.message && response.message.length > 0) {\n\t\t\t\t\tconst most_recent_creator = response.message[0].created_by_name;\n\t\t\t\t\tif (most_recent_creator) {\n\t\t\t\t\t\tthis.created_by_field.set_value(most_recent_creator);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tmake_filter_section() {\n\t\tconst me = this;\n\t\tthis.search_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Search'),\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tplaceholder: __('Search by invoice id or customer name')\n\t\t\t},\n\t\t\tparent: this.$component.find('.search-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\t\n\t\tthis.status_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Invoice Status'),\n\t\t\t\tfieldtype: 'Select',\n\t\t\t\toptions: `Draft\\nPaid\\nPartly Paid\\nUnpaid\\nOverdue\\nReturn`,\n\t\t\t\tplaceholder: __('Filter by invoice status'),\n\t\t\t\tonchange: function() {\n\t\t\t\t\tconsole.log('Status field changed to:', me.status_field.get_value());\n\t\t\t\t\tif (me.$component.is(':visible')) {\n\t\t\t\t\t\tme.refresh_list(\n\t\t\t\t\t\t\tme.search_field.get_value(), \n\t\t\t\t\t\t\tme.status_field.get_value(), \n\t\t\t\t\t\t\tme.created_by_field.get_value()\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tparent: this.$component.find('.status-field'),\n\t\t\trender_input: true,\n\t\t});\n\n\t\tthis.created_by_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Created By'),\n\t\t\t\tfieldtype: 'Select',\n\t\t\t\toptions: 'All', // Will be updated when user list is loaded\n\t\t\t\tplaceholder: __('Filter by creator'),\n\t\t\t\tonchange: function() {\n\t\t\t\t\tconsole.log('Created by field changed to:', me.created_by_field.get_value());\n\t\t\t\t\tif (me.$component.is(':visible')) {\n\t\t\t\t\t\tme.refresh_list(\n\t\t\t\t\t\t\tme.search_field.get_value(), \n\t\t\t\t\t\t\tme.status_field.get_value(), \n\t\t\t\t\t\t\tme.created_by_field.get_value()\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tparent: this.$component.find('.created-by-field'),\n\t\t\trender_input: true,\n\t\t});\n\n\t\tthis.search_field.toggle_label(false);\n\t\tthis.status_field.toggle_label(false);\n\t\tthis.created_by_field.toggle_label(false);\n\t\tthis.status_field.set_value('Draft');\n\t}\n\nrefresh_list(search_term = '', status = 'Draft', created_by = '') {\n\t// Always clear the container first, before any other operations\n\tthis.$invoices_container.html('');\n\t\n\tfrappe.dom.freeze();\n\tthis.events.reset_summary();\n\t\n\t// Handle pending created_by filter\n\tif (this._pending_created_by) {\n\t\tcreated_by = this._pending_created_by;\n\t\tthis.created_by_field.set_value(created_by);\n\t\tthis._pending_created_by = null;\n\t}\n\t\n\t// Get current values from form controls if not provided\n\tif (!search_term && this.search_field) {\n\t\tsearch_term = this.search_field.get_value() || '';\n\t}\n\tif (!status && this.status_field) {\n\t\tstatus = this.status_field.get_value() || 'Draft';\n\t}\n\tif (!created_by && this.created_by_field) {\n\t\tcreated_by = this.created_by_field.get_value() || '';\n\t}\n\t\n\t// Clear selected invoices when refreshing\n\tthis.selected_invoices.clear();\n\tthis.update_merge_section();\n\treturn frappe.call({\n\t\tmethod: \"posnext.posnext.page.posnext.point_of_sale.get_past_order_list\",\n\t\tfreeze: true,\n\t\targs: { \n\t\t\tsearch_term: search_term || '', \n\t\t\tstatus: status || 'Draft',\n\t\t\tcreated_by: created_by === 'All' ? '' : created_by,\n\t\t\t_force_refresh: this._just_held_invoice ? Date.now() : undefined\n\t\t},\n\t\tcallback: (response) => {\n\t\t\tfrappe.dom.unfreeze();\n\t\t\tconsole.log('Server response:', response.message);\n\t\t\t\n\t\t\t// Double-check container is empty before adding new content\n\t\t\tthis.$invoices_container.empty();\n\t\t\t\n\t\t\tthis.invoices = response.message || [];\n\t\t\tinvoicess = response.message || [];\n\t\t\t\n\t\t\tif (response.message && response.message.length > 0) {\n\t\t\t\t// Use a document fragment for better performance and to avoid multiple DOM updates\n\t\t\t\tconst fragment = document.createDocumentFragment();\n\t\t\t\t\n\t\t\t\tresponse.message.forEach(invoice => {\n\t\t\t\t\tconst invoice_html = this.get_invoice_html(invoice);\n\t\t\t\t\tconst temp_div = document.createElement('div');\n\t\t\t\t\ttemp_div.innerHTML = invoice_html;\n\t\t\t\t\tfragment.appendChild(temp_div.firstChild);\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tthis.$invoices_container.append(fragment);\n\t\t\t} else {\n\t\t\t\tthis.$invoices_container.html('<div style=\"padding: 20px; text-align: center; color: #999;\">No invoices found matching the current filters.</div>');\n\t\t\t}\n\t\t\t\n\t\t\tthis.auto_load_most_recent_summary(response.message);\n\t\t},\n\t\terror: (error) => {\n\t\t\tfrappe.dom.unfreeze();\n\t\t\tconsole.error('Error fetching past orders:', error);\n\t\t\tthis.$invoices_container.html('<div style=\"padding: 20px; text-align: center; color: #f56565;\">Error loading past orders. Please try again.</div>');\n\t\t\tfrappe.msgprint(__('Error loading past orders. Please try again.'));\n\t\t}\n\t});\n}\n\tauto_load_most_recent_summary(invoices) {\n\t\tif (!invoices || invoices.length === 0) {\n\t\t\tthis.events.reset_summary();\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tconst most_recent_invoice = this._just_held_invoice \n\t\t\t? invoices.find(inv => inv.name === this._just_held_invoice) || invoices[0]\n\t\t\t: invoices[0];\n\t\t\n\t\tif (most_recent_invoice) {\n\t\t\tthis.events.open_invoice_data(most_recent_invoice.name);\n\t\t\tthis.highlight_invoice_in_list(most_recent_invoice.name);\n\t\t\tif (this._just_held_invoice && this._just_held_invoice === most_recent_invoice.name) {\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __('Invoice held successfully: ') + most_recent_invoice.name,\n\t\t\t\t\tindicator: 'green'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tthis._just_held_invoice = null; // Clear after processing\n\t}\n\n\thighlight_invoice_in_list(invoice_name) {\n\t\t// Remove previous highlighting\n\t\tthis.$invoices_container.find('.invoice-wrapper').removeClass('highlighted');\n\t\t\n\t\t// Add highlighting to the specified invoice\n\t\tthis.$invoices_container.find(`[data-invoice-name=\"${escape(invoice_name)}\"]`).addClass('highlighted');\n\t}\n\n\tset_filter_and_refresh_with_held_invoice(created_by_name, held_invoice_name = null) {\n\t\tif (held_invoice_name) {\n\t\t\tthis._just_held_invoice = held_invoice_name;\n\t\t}\n\t\tthis._pending_created_by = created_by_name; // Store pending filter\n\t\treturn this.toggle_component(true); // Trigger refresh via toggle\n\t}\n\n\tget_invoice_html(invoice) {\n\t\tconst posting_datetime = moment(invoice.posting_date+\" \"+invoice.posting_time).format(\"Do MMMM, h:mma\");\n\t\t\n\t\t// Show checkbox only if user can merge invoices\n\t\tconst checkbox_html = this.can_merge_invoices ? \n\t\t\t`<div class=\"invoice-checkbox-container\" style=\"margin-right: 10px; display: flex; align-items: center;\">\n\t\t\t\t<input type=\"checkbox\" class=\"invoice-checkbox\" style=\"margin: 0;\">\n\t\t\t</div>` : '';\n\t\t\n\t\t// Show created by info if available\n\t\tconst created_by_html = invoice.created_by_name ? \n\t\t\t`<div class=\"invoice-creator\" style=\"font-size: 11px; color: #8d99a6; margin-top: 2px;\">\n\t\t\t\t<svg style=\"width: 10px; height: 10px; margin-right: 3px;\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n\t\t\t\t\t<path d=\"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z\"/>\n\t\t\t\t</svg>\n\t\t\t\t${frappe.ellipsis(invoice.created_by_name, 15)}\n\t\t\t</div>` : '';\n\t\t\n\t\treturn (\n\t\t\t`<div class=\"invoice-wrapper\" data-invoice-name=\"${escape(invoice.name)}\" style=\"display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #d1d8dd; cursor: pointer;\">\n\t\t\t\t${checkbox_html}\n\t\t\t\t<div style=\"flex: 1; display: flex; justify-content: space-between; align-items: center;\">\n\t\t\t\t\t<div class=\"invoice-name-date\">\n\t\t\t\t\t\t<div class=\"invoice-name\" style=\"font-weight: 600; margin-bottom: 4px;\">${invoice.name}</div>\n\t\t\t\t\t\t<div class=\"invoice-date\" style=\"font-size: 12px; color: #6c757d; display: flex; align-items: center;\">\n\t\t\t\t\t\t\t<svg class=\"mr-2\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n\t\t\t\t\t\t\t\t<path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"/><circle cx=\"12\" cy=\"7\" r=\"4\"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t${frappe.ellipsis(invoice.customer, 20)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t${created_by_html}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"invoice-total-status\" style=\"text-align: right;\">\n\t\t\t\t\t\t<div class=\"invoice-total\" style=\"font-weight: 600; margin-bottom: 4px;\">${format_currency(invoice.grand_total, invoice.currency, 0) || 0}</div>\n\t\t\t\t\t\t<div class=\"invoice-date\" style=\"font-size: 12px; color: #6c757d;\">${posting_datetime}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t);\n\t}\n\n\tupdate_merge_section() {\n\t\t// Don't show merge section if user doesn't have permission\n\t\tif (!this.can_merge_invoices) {\n\t\t\tthis.$merge_section.hide();\n\t\t\treturn;\n\t\t}\n\n\t\tconst count = this.selected_invoices.size;\n\t\tthis.$selected_count.text(count);\n\t\t\n\t\tif (count >= 2) {\n\t\t\tthis.$merge_section.show();\n\t\t\tthis.$merge_btn.prop('disabled', false);\n\t\t} else if (count === 1) {\n\t\t\tthis.$merge_section.show();\n\t\t\tthis.$merge_btn.prop('disabled', true);\n\t\t} else {\n\t\t\tthis.$merge_section.hide();\n\t\t}\n\t}\n\n\tmerge_selected_invoices() {\n\t\t// Additional check for permission\n\t\tif (!this.can_merge_invoices) {\n\t\t\tfrappe.msgprint(__('You do not have permission to merge invoices.'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.selected_invoices.size < 2) {\n\t\t\tfrappe.msgprint(__('Please select at least 2 invoices to merge.'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst selected_names = Array.from(this.selected_invoices);\n\t\tconst selected_invoices_data = invoicess.filter(inv => selected_names.includes(inv.name));\n\n\t\t// Validate that all selected invoices have the same customer\n\t\tconst customers = [...new Set(selected_invoices_data.map(inv => inv.customer))];\n\t\tif (customers.length > 1) {\n\t\t\tfrappe.msgprint(__('Cannot merge invoices with different customers. Please select invoices from the same customer.'));\n\t\t\treturn;\n\t\t}\n\n\t\t// Show confirmation dialog\n\t\tfrappe.confirm(\n\t\t\t__('Are you sure you want to merge {0} selected invoices? This action cannot be undone.', [selected_names.length]),\n\t\t\t() => {\n\t\t\t\tthis.perform_merge(selected_names, selected_invoices_data[0].customer);\n\t\t\t}\n\t\t);\n\t}\n\n\tperform_merge(invoice_names, customer) {\n\t\tfrappe.dom.freeze(__('Merging invoices...'));\n\n\t\tfrappe.call({\n\t\t\tmethod: \"posnext.posnext.page.posnext.point_of_sale.merge_invoices\",\n\t\t\targs: {\n\t\t\t\tinvoice_names: invoice_names,\n\t\t\t\tcustomer: customer\n\t\t\t},\n\t\t\tcallback: (response) => {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tif (response.message && response.message.success) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __('Invoices merged successfully. New invoice: {0}', [response.message.new_invoice]),\n\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t// Clear selections and refresh list\n\t\t\t\t\tthis.selected_invoices.clear();\n\t\t\t\t\tthis.refresh_list();\n\t\t\t\t\t\n\t\t\t\t\t// Optionally open the new merged invoice\n\t\t\t\t\tif (response.message.new_invoice) {\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tthis.events.open_invoice_data(response.message.new_invoice);\n\t\t\t\t\t\t}, 1);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.msgprint(__('Error merging invoices: {0}', [response.message.error || 'Unknown error']));\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: (error) => {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tfrappe.msgprint(__('Error merging invoices. Please try again.'));\n\t\t\t\tconsole.error('Merge error:', error);\n\t\t\t}\n\t\t});\n\t}\n\n\ttoggle_component(show) {\n\t\treturn frappe.run_serially([\n\t\t\t() => {\n\t\t\t\tif (show) {\n\t\t\t\t\tthis.$component.css('display', 'flex');\n\t\t\t\t\treturn this.refresh_list();\n\t\t\t\t} else {\n\t\t\t\t\tthis.$component.css('display', 'none');\n\t\t\t\t\t// Clear selections when hiding component\n\t\t\t\t\tthis.selected_invoices.clear();\n\t\t\t\t\tthis.update_merge_section();\n\t\t\t\t}\n\t\t\t}\n\t\t]);\n\t}\n}; ", "frappe.provide('posnext.PointOfSale');\nposnext.PointOfSale.PastOrderSummary = class {\n\tconstructor({ wrapper, pos_profile, events }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.pos_profile = pos_profile;\n\t\tthis.events = events;\n\t\t\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_email_print_dialog();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"past-order-summary\">\n\t\t\t\t<div class=\"no-summary-placeholder\">\n\t\t\t\t\t${__('Select an invoice to load summary data')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoice-summary-wrapper\" >\n\t\t\t\t\t<div class=\"abs-container\" >\n\t\t\t\t\t\t<div class=\"upper-section\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Items')}</div>\n\t\t\t\t\t\t<div class=\"items-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Totals')}</div>\n\t\t\t\t\t\t<div class=\"totals-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Payments')}</div>\n\t\t\t\t\t\t<div class=\"payments-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"summary-btns\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</section>`\n\t\t);\n\n\t\tthis.$component = this.wrapper.find('.past-order-summary');\n\t\tthis.$summary_wrapper = this.$component.find('.invoice-summary-wrapper');\n\t\tthis.$summary_container = this.$component.find('.abs-container');\n\t\tthis.$upper_section = this.$summary_container.find('.upper-section');\n\t\tthis.$items_container = this.$summary_container.find('.items-container');\n\t\tthis.$totals_container = this.$summary_container.find('.totals-container');\n\t\tthis.$payment_container = this.$summary_container.find('.payments-container');\n\t\tthis.$summary_btns = this.$summary_container.find('.summary-btns');\n\t}\n\n\tinit_email_print_dialog() {\n\t\tconst email_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Email Receipt',\n\t\t\tfields: [\n\t\t\t\t{fieldname: 'email_id', fieldtype: 'Data', options: 'Email', label: 'Email ID', reqd: 1},\n\t\t\t\t{fieldname:'content', fieldtype:'Small Text', label:'Message (if any)'}\n\t\t\t],\n\t\t\tprimary_action: () => {\n\t\t\t\tthis.send_email();\n\t\t\t},\n\t\t\tprimary_action_label: __('Send'),\n\t\t});\n\t\tthis.email_dialog = email_dialog;\n\n\t\tconst payment_dialog = new frappe.ui.Dialog({\n    \t\ttitle: 'Add Payment',\n   \t\t\tfields: [\n       \t\t {\n           \t\tfieldname: 'mode_of_payment', \n            \tfieldtype: 'Link', \n            \toptions: 'Mode of Payment', \n            \tlabel: 'Mode of Payment', \n            \treqd: 1\n       \t\t },\n       \t\t {\n          \t\tfieldname: 'amount', \n           \t\tfieldtype: 'Currency', \n            \tlabel: 'Amount', \n            \treqd: 1,\n            \tdefault: 0  // Set a static default, we'll update it when showing\n       \t\t }\n   \t\t\t ],\n    \tprimary_action: () => {\n        \tthis.create_payment_entry();\n   \t\t\t },\n   \t\tprimary_action_label: __('Add-Payment'),\n\t\t\t});\n\t\tthis.payment_dialog = payment_dialog;\n\n\t\tconst print_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Print Receipt',\n\t\t\tfields: [\n\t\t\t\t{fieldname: 'print', fieldtype: 'Data', label: 'Print Preview'}\n\t\t\t],\n\t\t\tprimary_action: () => {\n\t\t\t\tthis.print_receipt();\n\t\t\t},\n\t\t\tprimary_action_label: __('Print'),\n\t\t});\n\t\tthis.print_dialog = print_dialog;\n\n\t\tconst print_order_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Print-Order',\n\t\t\tfields: [\n\t\t\t\t{fieldname: 'print', fieldtype: 'Data', label: 'Print Preview'}\n\t\t\t],\n\t\t\tprimary_action: () => {\n\t\t\t\tthis.print_order();\n\t\t\t},\n\t\t\tprimary_action_label: __('Print'),\n\t\t});\n\t\tthis.print_order_dialog = print_order_dialog;\n\t}\n\n\tget_upper_section_html(doc) {\n\t\tconst { status } = doc;\n\t\tlet indicator_color = '';\n\n\t\tin_list(['Paid', 'Consolidated'], status) && (indicator_color = 'green');\n\t\tstatus === 'Draft' && (indicator_color = 'red');\n\t\tstatus === 'Return' && (indicator_color = 'grey');\n\n\t\treturn `<div class=\"left-section\">\n\t\t\t\t\t<div class=\"customer-name\">${doc.customer}</div>\n\t\t\t\t\t<div class=\"customer-email\">${this.customer_email}</div>\n\t\t\t\t\t<div class=\"cashier\">${__('Sold by')}: ${doc.created_by_name}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"right-section\">\n\t\t\t\t\t<div class=\"paid-amount\">${format_currency(doc.paid_amount, doc.currency)}</div>\n\t\t\t\t\t<div class=\"invoice-name\">${doc.name}</div>\n\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color}\"><span>${doc.status}</span></span>\n\t\t\t\t</div>`;\n\t}\n\n\tget_item_html(doc, item_data) {\n\t\treturn `<div class=\"item-row-wrapper\">\n\t\t\t\t\t<div class=\"item-name\">${item_data.item_name}</div>\n\t\t\t\t\t<div class=\"item-qty\">${item_data.qty || 0} ${item_data.uom}</div>\n\t\t\t\t\t<div class=\"item-rate-disc\">${get_rate_discount_html()}</div>\n\t\t\t\t</div>`;\n\n\t\tfunction get_rate_discount_html() {\n\t\t\tif (item_data.rate && item_data.price_list_rate && item_data.rate !== item_data.price_list_rate) {\n\t\t\t\treturn `<span class=\"item-disc\">(${item_data.discount_percentage}% off)</span>\n\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.rate, doc.currency)}</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-rate\">${format_currency(item_data.price_list_rate || item_data.rate, doc.currency)}</div>`;\n\t\t\t}\n\t\t}\n\t}\n\n\tget_discount_html(doc) {\n\t\tif (doc.discount_amount) {\n\t\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t\t<div>Discount (${doc.additional_discount_percentage} %)</div>\n\t\t\t\t\t\t<div>${format_currency(doc.discount_amount, doc.currency)}</div>\n\t\t\t\t\t</div>`;\n\t\t} else {\n\t\t\treturn ``;\n\t\t}\n\t}\n\n\tget_net_total_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t<div>${__('Net Total')}</div>\n\t\t\t\t\t<div>${format_currency(doc.net_total, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tget_taxes_html(doc) {\n\t\tif (!doc.taxes.length) return '';\n\n\t\tlet taxes_html = doc.taxes.map(t => {\n\t\t\tconst description = /[0-9]+/.test(t.description) ? t.description : ((t.rate != 0) ? `${t.description} @ ${t.rate}%`: t.description);\n\t\t\treturn `\n\t\t\t\t<div class=\"tax-row\">\n\t\t\t\t\t<div class=\"tax-label\">${description}</div>\n\t\t\t\t\t<div class=\"tax-value\">${format_currency(t.tax_amount_after_discount_amount, doc.currency)}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}).join('');\n\n\t\treturn `<div class=\"taxes-wrapper\">${taxes_html}</div>`;\n\t}\n\n\tget_grand_total_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper grand-total\">\n\t\t\t\t\t<div>${__('Grand Total')}</div>\n\t\t\t\t\t<div>${format_currency(doc.grand_total, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tget_payment_html(doc, payment) {\n\t\treturn `<div class=\"summary-row-wrapper payments\">\n\t\t\t\t\t<div>${__(payment.mode_of_payment)}</div>\n\t\t\t\t\t<div>${format_currency(payment.amount, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tbind_events() {\n\t\tthis.$summary_container.on('click', '.return-btn', () => {\n\t\t\tthis.events.process_return(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.edit-btn', () => {\n\t\t\tthis.events.edit_order(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.delete-btn', () => {\n\t\t\tthis.events.delete_order(this.doc.name);\n\t\t\tthis.show_summary_placeholder();\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.add-payment-btn', () => {\n\t\t\tconsole.log('Add payment button clicked', this.doc);\n    \t\tif (!this.doc.outstanding_amount || this.doc.outstanding_amount <= 0) {\n       \t\t frappe.show_alert({\n             message: __('No outstanding amount to pay'),\n             indicator: 'orange'\n        \t});\n        \treturn;\n    \t\t}\n    \t\tthis.payment_dialog.fields_dict.amount.set_value(this.doc.outstanding_amount);\n    \t\tthis.payment_dialog.show();\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.send-btn', () => {\n\t\t\tvar field_names = this.pos_profile.custom_whatsapp_field_names.map(x => this.doc[x.field_names.toString()]);\n\t\t\tvar message = \"https://wa.me/\" +  this.doc.customer +\"?text=\"\n\t\t\tmessage += formatString(this.pos_profile.custom_whatsapp_message, field_names);\n\t\t\t\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"posnext.posnext.page.posnext.point_of_sale.generate_pdf_and_save\",\n\t\t\t\targs: {\n\t\t\t\t\tdocname: this.doc.name,\n\t\t\t\t\tdoctype: this.doc.doctype,\n\t\t\t\t\tprint_format: this.pos_profile.print_format\n\t\t\t\t},\n\t\t\t\t//freeze: true,\n\t\t\t\tfreeze_message: \"Creating file then send to whatsapp thru link....\",\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tmessage += \"Please Find your invoice here \\n \"+window.origin+r.message.file_url\n\t\t\t\t\twindow.open(message)\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\t\t\n\t\tfunction formatString(str, args) {\n\t\t\treturn str.replace(/{(\\d+)}/g, function(match, number) {\n\t\t\t\treturn typeof args[number] !== 'undefined'\n\t\t\t\t\t? args[number]\n\t\t\t\t\t: match;\n\t\t\t});\n\t\t}\n\n\t\tthis.$summary_container.on('click', '.new-btn', () => {\n\t\t\tthis.events.new_order();\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.email-btn', () => {\n\t\t\tthis.email_dialog.fields_dict.email_id.set_value(this.customer_email);\n\t\t\tthis.email_dialog.show();\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.print-order-btn', () => {\n\t\t\tthis.print_order();\n\t\t});\n        \n        this.$summary_container.on('click', '.split-order-btn', () => {\n\t\t\tthis.split_order();\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.print-btn', () => {\n\t\t\tthis.print_receipt();\n\t\t});\n\t}\n\n\tcreate_payment_entry() {\n    const values = this.payment_dialog.get_values();\n    \n    if (!values.mode_of_payment) {\n        frappe.show_alert({\n            message: __('Please select a mode of payment'),\n            indicator: 'red'\n        });\n        return;\n    }\n\tif (values.mode_of_payment.toLowerCase().replace(/ +/g, \"_\") === 'mpesa-tenacity') {\n        this.handle_mpesa_paybill_payment(values);\n        return;\n    }\n    \n    if (!values.amount || values.amount <= 0) {\n        frappe.show_alert({\n            message: __('Please enter a valid amount'),\n            indicator: 'red'\n        });\n        return;\n    }\n    \n    if (values.amount > this.doc.outstanding_amount) {\n        frappe.show_alert({\n            message: __('Payment amount cannot exceed outstanding amount of {0}', \n                [format_currency(this.doc.outstanding_amount, this.doc.currency)]),\n            indicator: 'red'\n        });\n        return;\n    }\n\n    frappe.dom.freeze(__('Creating Payment Entry...'));\n\n    // Use our custom method instead of the standard ERPNext method\n    frappe.call({\n        method: \"posnext.posnext.page.posnext.point_of_sale.create_simple_payment_entry\",\n        args: {\n            invoice_name: this.doc.name,\n            mode_of_payment: values.mode_of_payment,\n            amount: values.amount\n        },\n        callback: (r) => {\n            frappe.dom.unfreeze();\n            if (!r.exc && r.message && r.message.success) {\n                frappe.show_alert({\n                    message: __('Payment added successfully'),\n                    indicator: 'green'\n                });\n                this.payment_dialog.hide();\n                // Refresh the invoice data\n                frappe.db.get_doc('Sales Invoice', this.doc.name)\n                    .then(doc => this.load_summary_of(doc));\n            } else {\n                frappe.show_alert({\n                    message: __('Error creating payment: ') + (r.message?.error || r.exc || 'Unknown error'),\n                    indicator: 'red'\n                });\n            }\n        }\n    });\n}\n\nhandle_mpesa_paybill_payment(values) {\n    const me = this;\n    const doc = this.doc;\n    const outstanding_amount = doc.outstanding_amount;\n    \n    // Fetch available Mpesa payments\n    frappe.call({\n        method: 'posnext.posnext.page.posnext.point_of_sale.get_available_mpesa_payments',\n        callback: function(r) {\n            if (r.message && r.message.length > 0) {\n                me.create_partial_mpesa_dialog(r.message, doc, outstanding_amount, values);\n            } else {\n                frappe.msgprint({\n                    title: __('No Available Payments'),\n                    message: __('No Mpesa payments with available amounts found.'),\n                    indicator: 'orange'\n                });\n            }\n        }\n    });\n}\n\ncreate_partial_mpesa_dialog(payments, doc, outstanding_amount, payment_values) {\n    const me = this;\n    \n    // Create table rows for payments\n    const payment_rows = payments.map(payment => {\n        const formatted_amount = format_currency(payment.transamount, doc.currency);\n        const available_amount = format_currency(payment.available_amount, doc.currency);\n        const formatted_time = frappe.datetime.str_to_user(payment.transtime);\n        const status_color = payment.payment_status === 'Unapplied' ? '#28a745' : \n                           payment.payment_status === 'Partly Applied' ? '#ffc107' : '#6c757d';\n        \n        return `\n            <tr data-payment-id=\"${payment.name}\" data-available=\"${payment.available_amount}\">\n                <td style=\"text-align: center;\">\n                    <input type=\"checkbox\" class=\"payment-checkbox\" />\n                </td>\n                <td>${payment.full_name || ''}</td>\n                <td>${payment.transid || ''}</td>\n                <td style=\"text-align: right;\">${formatted_amount}</td>\n                <td style=\"text-align: right; font-weight: bold;\">${available_amount}</td>\n                <td>\n                    <span style=\"color: ${status_color}; font-size: 12px; font-weight: bold;\">\n                        ${__(payment.payment_status)}\n                    </span>\n                </td>\n                <td style=\"text-align: center;\">\n                    <input type=\"number\" class=\"form-control amount-input\" \n                           style=\"width: 100px; font-size: 12px;\" \n                           min=\"0\" max=\"${payment.available_amount}\" \n                           step=\"0.01\" placeholder=\"Amount\" disabled />\n                </td>\n                <td>${formatted_time}</td>\n            </tr>\n        `;\n    }).join('');\n\n    const dialog_html = `\n        <div class=\"mpesa-payment-dialog\">\n            <div style=\"margin-bottom: 15px;\">\n                <div style=\"display: flex; justify-content: space-between; align-items: center; padding: 10px; background-color: #f8f9fa; border-radius: 6px;\">\n                    <strong>${__('Outstanding Amount')}: ${format_currency(outstanding_amount, doc.currency)}</strong>\n                    <span id=\"selected-total\" style=\"color: #28a745; font-weight: bold;\">\n                        ${__('Selected')}: ${format_currency(0, doc.currency)}\n                    </span>\n                </div>\n            </div>\n\n            <div style=\"max-height: 500px; overflow-y: auto; border: 1px solid #ddd; border-radius: 6px;\">\n                <table class=\"table table-striped\" style=\"margin: 0;\">\n                    <thead style=\"background-color: #f8f9fa; position: sticky; top: 0;\">\n                        <tr>\n                            <th style=\"text-align: center; width: 50px;\">${__('Select')}</th>\n                            <th>${__('Name')}</th>\n                            <th>${__('Trans ID')}</th>\n                            <th style=\"text-align: right;\">${__('Original')}</th>\n                            <th style=\"text-align: right;\">${__('Available')}</th>\n                            <th>${__('Status')}</th>\n                            <th style=\"text-align: center;\">${__('Apply Amount')}</th>\n                            <th>${__('Time')}</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        ${payment_rows}\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    `;\n\n    const dialog = new frappe.ui.Dialog({\n        title: __('Apply Partial Mpesa Payments'),\n        fields: [\n            {\n                fieldtype: 'HTML',\n                fieldname: 'payment_selection',\n                options: dialog_html\n            }\n        ],\n        size: 'extra-large',\n        primary_action_label: __('Apply Selected Payments'),\n        primary_action: function() {\n            me.apply_partial_mpesa_payments(dialog, doc, payment_values);\n        },\n        secondary_action_label: __('Cancel')\n    });\n\n    dialog.show();\n\n    // Add event listeners\n    setTimeout(() => {\n        const dialog_wrapper = dialog.$wrapper;\n        \n        // Handle checkbox changes\n        dialog_wrapper.find('.payment-checkbox').on('change', function() {\n            const row = $(this).closest('tr');\n            const amount_input = row.find('.amount-input');\n            const available_amount = parseFloat(row.data('available'));\n            \n            if ($(this).is(':checked')) {\n                amount_input.prop('disabled', false);\n                // Auto-fill with available amount or remaining amount, whichever is smaller\n                const auto_amount = Math.min(available_amount, outstanding_amount);\n                amount_input.val(auto_amount);\n            } else {\n                amount_input.prop('disabled', true).val('');\n            }\n            \n            me.update_partial_payment_total(dialog_wrapper, doc.currency);\n        });\n\n        // Handle amount input changes\n        dialog_wrapper.find('.amount-input').on('input', function() {\n            me.update_partial_payment_total(dialog_wrapper, doc.currency);\n        });\n    }, 100);\n}\nupdate_partial_payment_total(dialog_wrapper, currency) {\n    let total = 0;\n    dialog_wrapper.find('.payment-checkbox:checked').each(function() {\n        const row = $(this).closest('tr');\n        const amount_input = row.find('.amount-input');\n        const amount = parseFloat(amount_input.val()) || 0;\n        total += amount;\n    });\n    \n    dialog_wrapper.find('#selected-total').html(\n        `${__('Selected')}: ${format_currency(total, currency)}`\n    );\n}\n\napply_partial_mpesa_payments(dialog, doc, payment_values) {\n    const me = this;\n    const selected_payments = [];\n    let total_amount = 0;\n    let has_error = false;\n\n    dialog.$wrapper.find('.payment-checkbox:checked').each(function() {\n        const row = $(this).closest('tr');\n        const payment_id = row.data('payment-id');\n        const available_amount = parseFloat(row.data('available'));\n        const amount_input = row.find('.amount-input');\n        const apply_amount = parseFloat(amount_input.val()) || 0;\n        \n        if (apply_amount <= 0) {\n            frappe.msgprint({\n                title: __('Invalid Amount'),\n                message: __('Please enter a valid amount for all selected payments.'),\n                indicator: 'red'\n            });\n            has_error = true;\n            return false;\n        }\n        \n        if (apply_amount > available_amount) {\n            frappe.msgprint({\n                title: __('Amount Exceeds Available'),\n                message: __('Applied amount cannot exceed available amount for payment {0}', [payment_id]),\n                indicator: 'red'\n            });\n            has_error = true;\n            return false;\n        }\n\n        selected_payments.push({\n            id: payment_id,\n            amount: apply_amount\n        });\n        total_amount += apply_amount;\n    });\n\n    const outstanding_amount = doc.outstanding_amount;\n    if (total_amount > outstanding_amount) {\n        frappe.msgprint({\n            title: __('Amount Exceeds Outstanding'),\n            message: __('Total applied amount ({0}) cannot exceed outstanding amount ({1})', [\n                format_currency(total_amount, doc.currency),\n                format_currency(outstanding_amount, doc.currency)\n            ]),\n            indicator: 'red'\n        });\n        return;\n    }\n\n    if (has_error || selected_payments.length === 0) {\n        if (selected_payments.length === 0) {\n            frappe.msgprint({\n                title: __('No Selection'),\n                message: __('Please select at least one payment to apply.'),\n                indicator: 'orange'\n            });\n        }\n        return;\n    }\n\n    // Show confirmation\n    frappe.confirm(\n        __('Apply {0} selected payments totaling {1}?', [\n            selected_payments.length,\n            format_currency(total_amount, doc.currency)\n        ]),\n        function() {\n            me.process_partial_mpesa_payments(selected_payments, doc, total_amount, payment_values);\n            dialog.hide();\n        }\n    );\n}\n\nprocess_partial_mpesa_payments(selected_payments, doc, total_amount, payment_values) {\n    const me = this;\n    \n    frappe.show_alert({\n        message: __('Processing partial Mpesa payments...'),\n        indicator: 'blue'\n    });\n\n    frappe.call({\n        method: 'posnext.posnext.page.posnext.point_of_sale.apply_partial_mpesa_payments',\n        args: {\n            payments_data: selected_payments,\n            invoice_name: doc.name\n        },\n        callback: function(r) {\n            if (r.message && r.message.success) {\n                // Create the payment entry with the total amount\n                frappe.call({\n                    method: \"posnext.posnext.page.posnext.point_of_sale.create_simple_payment_entry\",\n                    args: {\n                        invoice_name: doc.name,\n                        mode_of_payment: payment_values.mode_of_payment,\n                        amount: total_amount\n                    },\n                    callback: function(payment_r) {\n                        if (payment_r.message && payment_r.message.success) {\n                            frappe.show_alert({\n                                message: __('Partial Mpesa payments applied successfully!'),\n                                indicator: 'green'\n                            });\n                            \n                            me.payment_dialog.hide();\n                            \n                            // Refresh the invoice data\n                            frappe.db.get_doc('Sales Invoice', doc.name)\n                                .then(updated_doc => me.load_summary_of(updated_doc));\n                        } else {\n                            frappe.msgprint({\n                                title: __('Payment Entry Error'),\n                                message: payment_r.message?.error || __('Failed to create payment entry.'),\n                                indicator: 'red'\n                            });\n                        }\n                    }\n                });\n            } else {\n                frappe.msgprint({\n                    title: __('Error'),\n                    message: r.message?.message || __('Failed to apply payments. Please try again.'),\n                    indicator: 'red'\n                });\n            }\n        },\n        error: function(error) {\n            console.error('Error applying partial payments:', error);\n            frappe.msgprint({\n                title: __('Error'),\n                message: __('Failed to apply payments. Please try again.'),\n                indicator: 'red'\n            });\n        }\n    });\n}\n\n\tprint_receipt() {\n\t\tconst frm = this.events.get_frm();\n\t\tconst print_format = this.pos_profile.custom_sales_invoice_print_format || frm.pos_print_format;\n\t\tconst doctype = this.doc.doctype;\n\t\tconst docname = this.doc.name;\n\t\tconst letterhead = this.doc.letter_head || __(\"No Letterhead\");\n\t\tconst lang_code = this.doc.language || frappe.boot.lang;\n\t\t\n\t\tfrappe.db.get_value(\"Print Settings\", \"Print Settings\", \"enable_raw_printing\")\n\t\t\t.then(({ message }) => {\n\t\t\t\tif (message && message.enable_raw_printing === \"1\") {\n\t\t\t\t\tthis._print_via_qz(doctype, docname, print_format, letterhead, lang_code);\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.utils.print(\n\t\t\t\t\t\tdoctype,\n\t\t\t\t\t\tdocname,\n\t\t\t\t\t\tprint_format,\n\t\t\t\t\t\tletterhead,\n\t\t\t\t\t\tlang_code\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tsplit_order() {\n\t\tif (!this.doc || !this.doc.items || this.doc.items.length === 0) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"No items available to split.\"),\n\t\t\t\tindicator: 'red'\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.doc.docstatus !== 0) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Cannot split submitted invoices.\"),\n\t\t\t\tindicator: 'red'\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tthis.show_simple_split_dialog();\n\t}\n\n\tshow_simple_split_dialog() {\n\t\tconst items_data = this.doc.items.map((item, index) => ({\n\t\t\tidx: index + 1,\n\t\t\titem_code: item.item_code,\n\t\t\titem_name: item.item_name || item.item_code,\n\t\t\tavailable_qty: item.qty,\n\t\t\tsplit_qty: 0,\n\t\t\trate: item.rate,\n\t\t\tuom: item.uom,\n\t\t\tinvoice_number: 1,\n\t\t\tselected: false\n\t\t}));\n\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Split Order'),\n\t\t\tsize: 'large',\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'HTML',\n\t\t\t\t\tfieldname: 'instructions',\n\t\t\t\t\toptions: `\n\t\t\t\t\t\t<div class=\"alert alert-info mb-3\">\n\t\t\t\t\t\t\t<strong>How to split:</strong>\n\t\t\t\t\t\t\t<ol class=\"mb-0\">\n\t\t\t\t\t\t\t\t<li>Check items you want to move to new invoices</li>\n\t\t\t\t\t\t\t\t<li>Enter quantities to split</li>\n\t\t\t\t\t\t\t\t<li>Choose which invoice each item goes to</li>\n\t\t\t\t\t\t\t\t<li>Click \"Split Order\" to complete</li>\n\t\t\t\t\t\t\t</ol>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Int',\n\t\t\t\t\tfieldname: 'number_of_invoices',\n\t\t\t\t\tlabel: __('Number of New Invoices'),\n\t\t\t\t\tdefault: 1,\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tdescription: __('How many new invoices to create (1-5)'),\n\t\t\t\t\tchange: () => {\n\t\t\t\t\t\tconst count = dialog.get_value('number_of_invoices');\n\t\t\t\t\t\tif (count >= 1 && count <= 5) {\n\t\t\t\t\t\t\tthis.update_split_table(dialog, items_data, count);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'HTML',\n\t\t\t\t\tfieldname: 'split_table',\n\t\t\t\t\toptions: this.get_split_table_html(items_data, 1)\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action: () => {\n\t\t\t\tthis.execute_simple_split(dialog, items_data);\n\t\t\t},\n\t\t\tprimary_action_label: __('Split Order'),\n\t\t\tsecondary_action_label: __('Cancel')\n\t\t});\n\n\t\tthis.split_dialog = dialog;\n\t\tthis.split_items_data = items_data;\n\n\t\tdialog.show();\n\n\t\tsetTimeout(() => {\n\t\t\tthis.bind_split_events(dialog);\n\t\t}, 1);\n\t}\n\n\tget_split_table_html(items_data, invoice_count) {\n\t\tlet invoice_options = '';\n\t\tfor (let i = 1; i <= invoice_count; i++) {\n\t\t\tinvoice_options += `<option value=\"${i}\">Invoice ${i}</option>`;\n\t\t}\n\n\t\tlet html = `\n\t\t\t<div class=\"split-table-container\">\n\t\t\t\t<table class=\"table table-bordered\">\n\t\t\t\t\t<thead class=\"thead-light\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th width=\"5%\">\n\t\t\t\t\t\t\t\t<input type=\"checkbox\" id=\"select-all\" title=\"Select All\">\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th width=\"25%\">${__('Item')}</th>\n\t\t\t\t\t\t\t<th width=\"15%\">${__('Available Qty')}</th>\n\t\t\t\t\t\t\t<th width=\"15%\">${__('Split Qty')}</th>\n\t\t\t\t\t\t\t<th width=\"15%\">${__('Rate')}</th>\n\t\t\t\t\t\t\t<th width=\"15%\">${__('Amount')}</th>\n\t\t\t\t\t\t\t<th width=\"10%\">${__('Invoice')}</th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t`;\n\n\t\titems_data.forEach((item, index) => {\n\t\t\thtml += `\n\t\t\t\t<tr data-index=\"${index}\">\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input type=\"checkbox\" class=\"item-select\" data-index=\"${index}\">\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div><strong>${item.item_code}</strong></div>\n\t\t\t\t\t\t<small class=\"text-muted\">${item.item_name}</small>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span class=\"badge badge-secondary\">${item.available_qty} ${item.uom}</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input type=\"number\" \n\t\t\t\t\t\t\t   class=\"form-control split-qty\" \n\t\t\t\t\t\t\t   data-index=\"${index}\"\n\t\t\t\t\t\t\t   min=\"0\" \n\t\t\t\t\t\t\t   max=\"${item.available_qty}\" \n\t\t\t\t\t\t\t   step=\"0.01\"\n\t\t\t\t\t\t\t   value=\"0\">\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t${format_currency(item.rate, this.doc.currency)}\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span class=\"split-amount\" data-index=\"${index}\">\n\t\t\t\t\t\t\t${format_currency(0, this.doc.currency)}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<select class=\"form-control invoice-select\" data-index=\"${index}\">\n\t\t\t\t\t\t\t${invoice_options}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t`;\n\t\t});\n\n\t\thtml += `\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t\t<div class=\"row mt-3\">\n\t\t\t\t\t<div class=\"col-md-6\">\n\t\t\t\t\t\t<div class=\"alert alert-light\">\n\t\t\t\t\t\t\t<strong>Selected Items:</strong> <span id=\"selected-count\">0</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"col-md-6\">\n\t\t\t\t\t\t<div class=\"alert alert-light\">\n\t\t\t\t\t\t\t<strong>Total Split Amount:</strong> <span id=\"total-amount\">${format_currency(0, this.doc.currency)}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn html;\n\t}\n\n\tupdate_split_table(dialog, items_data, invoice_count) {\n\t\tif (invoice_count < 1 || invoice_count > 5) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Number of invoices must be between 1 and 5\"),\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tconst new_html = this.get_split_table_html(items_data, invoice_count);\n\t\tdialog.fields_dict.split_table.$wrapper.html(new_html);\n\n\t\tthis.restore_selections(dialog, items_data);\n\n\t\tsetTimeout(() => {\n\t\t\tthis.bind_split_events(dialog);\n\t\t}, 1);\n\t}\n\n\trestore_selections(dialog, items_data) {\n\t\tconst wrapper = dialog.$wrapper;\n\t\t\n\t\titems_data.forEach((item, index) => {\n\t\t\tconst row = wrapper.find(`tr[data-index=\"${index}\"]`);\n\t\t\t\n\t\t\trow.find('.item-select').prop('checked', item.selected);\n\t\t\trow.find('.split-qty').val(item.split_qty);\n\t\t\trow.find('.invoice-select').val(item.invoice_number);\n\t\t\t\n\t\t\tthis.update_split_amount(index, item.split_qty, item.rate);\n\t\t});\n\n\t\tthis.update_summary();\n\t}\n\n\tbind_split_events(dialog) {\n\t\tconst wrapper = dialog.$wrapper;\n\n\t\twrapper.find('#select-all').on('change', (e) => {\n\t\t\tconst checked = $(e.target).is(':checked');\n\t\t\twrapper.find('.item-select').prop('checked', checked);\n\t\t\t\n\t\t\twrapper.find('.split-qty').each((i, input) => {\n\t\t\t\tconst index = $(input).data('index');\n\t\t\t\tconst max_qty = parseFloat($(input).attr('max'));\n\t\t\t\tconst qty = checked ? max_qty : 0;\n\t\t\t\t\n\t\t\t\t$(input).val(qty);\n\t\t\t\tthis.split_items_data[index].selected = checked;\n\t\t\t\tthis.split_items_data[index].split_qty = qty;\n\t\t\t\tthis.update_split_amount(index, qty, this.split_items_data[index].rate);\n\t\t\t});\n\t\t\t\n\t\t\tthis.update_summary();\n\t\t});\n\n\t\twrapper.find('.item-select').on('change', (e) => {\n\t\t\tconst checkbox = $(e.target);\n\t\t\tconst index = checkbox.data('index');\n\t\t\tconst checked = checkbox.is(':checked');\n\t\t\tconst qty_input = wrapper.find(`.split-qty[data-index=\"${index}\"]`);\n\t\t\t\n\t\t\tthis.split_items_data[index].selected = checked;\n\t\t\t\n\t\t\tif (checked) {\n\t\t\t\tconst max_qty = parseFloat(qty_input.attr('max'));\n\t\t\t\tqty_input.val(max_qty);\n\t\t\t\tthis.split_items_data[index].split_qty = max_qty;\n\t\t\t\tthis.update_split_amount(index, max_qty, this.split_items_data[index].rate);\n\t\t\t} else {\n\t\t\t\tqty_input.val(0);\n\t\t\t\tthis.split_items_data[index].split_qty = 0;\n\t\t\t\tthis.update_split_amount(index, 0, this.split_items_data[index].rate);\n\t\t\t}\n\t\t\t\n\t\t\tthis.update_summary();\n\t\t});\n\n\t\twrapper.find('.split-qty').on('input change', (e) => {\n\t\t\tconst input = $(e.target);\n\t\t\tconst index = input.data('index');\n\t\t\tlet qty = parseFloat(input.val()) || 0;\n\t\t\tconst max_qty = parseFloat(input.attr('max'));\n\t\t\t\n\t\t\tif (qty > max_qty) {\n\t\t\t\tqty = max_qty;\n\t\t\t\tinput.val(qty);\n\t\t\t}\n\t\t\tif (qty < 0) {\n\t\t\t\tqty = 0;\n\t\t\t\tinput.val(qty);\n\t\t\t}\n\t\t\t\n\t\t\tconst checkbox = wrapper.find(`.item-select[data-index=\"${index}\"]`);\n\t\t\tcheckbox.prop('checked', qty > 0);\n\t\t\t\n\t\t\tthis.split_items_data[index].split_qty = qty;\n\t\t\tthis.split_items_data[index].selected = qty > 0;\n\t\t\t\n\t\t\tthis.update_split_amount(index, qty, this.split_items_data[index].rate);\n\t\t\tthis.update_summary();\n\t\t});\n\n\t\twrapper.find('.invoice-select').on('change', (e) => {\n\t\t\tconst select = $(e.target);\n\t\t\tconst index = select.data('index');\n\t\t\tconst invoice_num = parseInt(select.val());\n\t\t\t\n\t\t\tthis.split_items_data[index].invoice_number = invoice_num;\n\t\t});\n\t}\n\n\tupdate_split_amount(index, qty, rate) {\n\t\tconst amount = qty * rate;\n\t\tthis.split_dialog.$wrapper.find(`.split-amount[data-index=\"${index}\"]`)\n\t\t\t.text(format_currency(amount, this.doc.currency));\n\t}\n\n\tupdate_summary() {\n\t\tconst selected_items = this.split_items_data.filter(item => item.selected && item.split_qty > 0);\n\t\tconst total_amount = selected_items.reduce((sum, item) => sum + (item.split_qty * item.rate), 0);\n\t\t\n\t\tthis.split_dialog.$wrapper.find('#selected-count').text(selected_items.length);\n\t\tthis.split_dialog.$wrapper.find('#total-amount').text(format_currency(total_amount, this.doc.currency));\n\t}\n\n\texecute_simple_split(dialog, items_data) {\n\t\tconst selected_items = items_data.filter(item => item.selected && item.split_qty > 0);\n\t\t\n\t\tif (selected_items.length === 0) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Please select at least one item to split.\"),\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tconst invoice_groups = {};\n\t\tselected_items.forEach(item => {\n\t\t\tconst invoice_key = item.invoice_number.toString();\n\t\t\tif (!invoice_groups[invoice_key]) {\n\t\t\t\tinvoice_groups[invoice_key] = [];\n\t\t\t}\n\t\t\tinvoice_groups[invoice_key].push({\n\t\t\t\titem_code: item.item_code,\n\t\t\t\tsplit_qty: item.split_qty\n\t\t\t});\n\t\t});\n\n\t\tconst payment_distribution = this.calculate_payment_distribution(selected_items, invoice_groups);\n\n\t\tconst invoice_count = Object.keys(invoice_groups).length;\n\t\tconst total_items = selected_items.length;\n\t\tconst total_amount = selected_items.reduce((sum, item) => sum + (item.split_qty * item.rate), 0);\n\n\t\tfrappe.confirm(\n\t\t\t__(`This will create ${invoice_count} new invoice(s) with ${total_items} items (${format_currency(total_amount, this.doc.currency)}). Continue?`),\n\t\t\t() => {\n\t\t\t\tthis.process_split_order(invoice_groups, payment_distribution);\n\t\t\t\tdialog.hide();\n\t\t\t}\n\t\t);\n\t}\n\n\tcalculate_payment_distribution(selected_items, invoice_groups) {\n\t\tconst total_split_amount = selected_items.reduce((sum, item) => sum + (item.split_qty * item.rate), 0);\n\t\tconst original_total_paid = this.doc.paid_amount || 0;\n\t\t\n\t\tconst payment_distribution = {};\n\t\t\n\t\tObject.keys(invoice_groups).forEach(invoice_key => {\n\t\t\tconst group_items = invoice_groups[invoice_key];\n\t\t\tconst group_amount = group_items.reduce((sum, group_item) => {\n\t\t\t\tconst item_data = selected_items.find(item => item.item_code === group_item.item_code);\n\t\t\t\treturn sum + (group_item.split_qty * item_data.rate);\n\t\t\t}, 0);\n\t\t\t\n\t\t\tconst payment_ratio = group_amount / total_split_amount;\n\t\t\tconst allocated_payment = original_total_paid * payment_ratio;\n\t\t\t\n\t\t\tpayment_distribution[invoice_key] = {\n\t\t\t\tamount: group_amount,\n\t\t\t\tpayment_amount: allocated_payment,\n\t\t\t\tpayment_ratio: payment_ratio\n\t\t\t};\n\t\t});\n\t\t\n\t\treturn payment_distribution;\n\t}\n\n\tprocess_split_order(invoice_groups, payment_distribution) {\n\t\tfrappe.dom.freeze(__('Splitting order...'));\n\t\t\n\t\tfrappe.call({\n\t\t\tmethod: \"posnext.posnext.page.posnext.point_of_sale.split_pos_invoice\",\n\t\t\targs: {\n\t\t\t\toriginal_invoice: this.doc.name,\n\t\t\t\tinvoice_groups: invoice_groups,\n\t\t\t\tpayment_distribution: payment_distribution,\n\t\t\t\tdistribute_evenly: false\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t\n\t\t\t\tif (!r.exc && r.message && r.message.success) {\n\t\t\t\t\tconst result = r.message;\n\t\t\t\t\t\n\t\t\t\t\t// Get the first invoice name immediately\n\t\t\t\t\tconst first_invoice_name = result.new_invoices && result.new_invoices.length > 0 ? \n\t\t\t\t\t\tresult.new_invoices[0].name : null;\n\t\t\t\t\t\n\t\t\t\t\t// Run operations in parallel for speed\n\t\t\t\t\tconst operations = [];\n\t\t\t\t\t\n\t\t\t\t\t// 1. Show success alert (non-blocking)\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __('Order split successfully. Created {0} new invoice(s)', [result.new_invoices.length]),\n\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t// 2. Refresh list and load invoice simultaneously\n\t\t\t\t\tif (posnext.PointOfSale.PastOrderList.current_instance) {\n\t\t\t\t\t\toperations.push(\n\t\t\t\t\t\t\tposnext.PointOfSale.PastOrderList.current_instance.refresh_list()\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// 3. Load first invoice immediately (no setTimeout delay)\n\t\t\t\t\tif (first_invoice_name && posnext.PointOfSale.PastOrderList.current_instance?.events.open_invoice_data) {\n\t\t\t\t\t\toperations.push(\n\t\t\t\t\t\t\tfrappe.db.get_doc('Sales Invoice', first_invoice_name).then((doc) => {\n\t\t\t\t\t\t\t\t// Direct call to load_summary_of for immediate loading\n\t\t\t\t\t\t\t\tif (posnext.PointOfSale.PastOrderList.current_instance.events.reset_summary) {\n\t\t\t\t\t\t\t\t\tposnext.PointOfSale.PastOrderList.current_instance.events.reset_summary();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tthis.load_summary_of(doc);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// Execute all operations in parallel - silent error handling\n\t\t\t\t\tPromise.all(operations).catch(() => {\n\t\t\t\t\t\t// Silent error handling - operations will continue even if some fail\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"Failed to split order: \") + (r.message || r.exc),\n\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: (r) => {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"Error occurred while splitting order.\"),\n\t\t\t\t\tindicator: 'red'\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tprint_order() {\n\t\tconst doctype = this.doc.doctype;\n\t\tconst docname = this.doc.name;\n\t\tconst print_format = \"Captain Order 2\";\n\t\tconst letterhead = this.doc.letter_head || __(\"No Letterhead\");\n\t\tconst lang_code = this.doc.language || frappe.boot.lang;\n\n\t\tconst _print_via_qz = (doctype, docname, print_format, letterhead, lang_code) => {\n\t\t\tconst print_format_printer_map = _get_print_format_printer_map();\n\t\t\tconst mapped_printer = _get_mapped_printer(print_format_printer_map, doctype, print_format);\n\n\t\t\tif (mapped_printer.length === 1) {\n\t\t\t\t_print_with_mapped_printer(doctype, docname, print_format, letterhead, lang_code, mapped_printer[0]);\n\t\t\t} else if (_is_raw_printing(print_format)) {\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"Printer mapping not set.\"),\n\t\t\t\t\tsubtitle: __(\"Please set a printer mapping for this print format in the Printer Settings\"),\n\t\t\t\t\tindicator: \"warning\"\n\t\t\t\t}, 14);\n\t\t\t\t_printer_setting_dialog(doctype, print_format);\n\t\t\t} else {\n\t\t\t\t_render_pdf_or_regular_print(doctype, docname, print_format, letterhead, lang_code);\n\t\t\t}\n\t\t};\n\n\t\tconst _print_with_mapped_printer = (doctype, docname, print_format, letterhead, lang_code, printer_map) => {\n\t\t\tif (_is_raw_printing(print_format)) {\n\t\t\t\t_get_raw_commands(doctype, docname, print_format, lang_code, (out) => {\n\t\t\t\t\tif (out.message === \"No new items to print\") {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"No new items to print for this captain order.\"),\n\t\t\t\t\t\t\tindicator: \"info\"\n\t\t\t\t\t\t}, 10);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tfrappe.ui.form.qz_connect()\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tlet config = qz.configs.create(printer_map.printer);\n\t\t\t\t\t\t\tlet data = [out.raw_commands];\n\t\t\t\t\t\t\treturn qz.print(config, data);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(frappe.ui.form.qz_success)\n\t\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\t\tfrappe.ui.form.qz_fail(err);\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __(\"Failed to print: \" + (err.message || err)),\n\t\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __('PDF printing via \"Raw Print\" is not supported.'),\n\t\t\t\t\tsubtitle: __(\"Please remove the printer mapping in Printer Settings and try again.\"),\n\t\t\t\t\tindicator: \"info\"\n\t\t\t\t}, 14);\n\t\t\t\t_render_pdf_or_regular_print(doctype, docname, print_format, letterhead, lang_code);\n\t\t\t}\n\t\t};\n\n\t\tconst _get_raw_commands = (doctype, docname, print_format, lang_code, callback) => {\n\t\t\tconst items_to_print = this.doc.items.map(item => ({\n\t\t\t\titem_code: item.item_code,\n\t\t\t\titem_name: item.item_name || item.item_code,\n\t\t\t\tqty: item.qty,\n\t\t\t\tuom: item.uom,\n\t\t\t\trate: item.rate,\n\t\t\t\tname: item.name\n\t\t\t}));\n\t\t\t\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"posnext.posnext.page.posnext.point_of_sale.print_captain_order\",\n\t\t\t\targs: {\n\t\t\t\t\tinvoice_name: docname,\n\t\t\t\t\tcurrent_items: items_to_print,\n\t\t\t\t\tprint_format: print_format,\n\t\t\t\t\t_lang: lang_code\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tif (!r.exc && r.message && r.message.success) {\n\t\t\t\t\t\tif (r.message.new_items_count === 0) {\n\t\t\t\t\t\t\tcallback({ message: \"No new items to print\" });\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!r.message.data || !r.message.data.items || r.message.data.items.length === 0) {\n\t\t\t\t\t\t\tcallback({ message: \"No new items to print\" });\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t_render_print_format(r.message.data, print_format, (raw_commands) => {\n\t\t\t\t\t\t\tcallback({ raw_commands: raw_commands, message: r.message.message });\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"Failed to generate print data: \" + (r.message?.error || \"Unknown error\")),\n\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tconst _render_print_format = (doc_data, print_format, callback) => {\n\t\t\tif (!doc_data || !doc_data.items || !doc_data.items.length) {\n\t\t\t\tcallback(\"\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Print Format\",\n\t\t\t\t\tname: print_format\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\t\tconst print_format_doc = r.message;\n\t\t\t\t\t\tif (print_format_doc.raw_printing !== 1) {\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __(\"Print format is not set for raw printing.\"),\n\t\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst template = print_format_doc.raw_commands || '';\n\t\t\t\t\t\tif (!template) {\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __(\"No raw commands defined in the print format.\"),\n\t\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst context = { doc: doc_data };\n\t\t\t\t\t\t\tconst raw_commands = frappe.render_template(template, context);\n\t\t\t\t\t\t\tcallback(raw_commands);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __(\"Error rendering print format: \" + (error.message || error)),\n\t\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\t\t\t\tcallback(\"\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"Failed to fetch print format.\"),\n\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\t\t\tcallback(\"\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tconst _is_raw_printing = (format) => {\n\t\t\tlet print_format = {};\n\t\t\tif (locals[\"Print Format\"] && locals[\"Print Format\"][format]) {\n\t\t\t\tprint_format = locals[\"Print Format\"][format];\n\t\t\t}\n\t\t\treturn print_format.raw_printing === 1;\n\t\t};\n\n\t\tconst _get_print_format_printer_map = () => {\n\t\t\ttry {\n\t\t\t\treturn JSON.parse(localStorage.print_format_printer_map || \"{}\");\n\t\t\t} catch (e) {\n\t\t\t\treturn {};\n\t\t\t}\n\t\t};\n\n\t\tconst _get_mapped_printer = (print_format_printer_map, doctype, print_format) => {\n\t\t\tif (print_format_printer_map[doctype]) {\n\t\t\t\treturn print_format_printer_map[doctype].filter(\n\t\t\t\t\t(printer_map) => printer_map.print_format === print_format\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn [];\n\t\t};\n\n\t\tconst _render_pdf_or_regular_print = (doctype, docname, print_format, letterhead, lang_code) => {\n\t\t\tfrappe.utils.print(\n\t\t\t\tdoctype,\n\t\t\t\tdocname,\n\t\t\t\tprint_format,\n\t\t\t\tletterhead,\n\t\t\t\tlang_code\n\t\t\t);\n\t\t};\n\n\t\tconst _printer_setting_dialog = (doctype, current_print_format) => {\n\t\t\tlet print_format_printer_map = _get_print_format_printer_map();\n\t\t\tlet data = print_format_printer_map[doctype] || [];\n\n\t\t\tfrappe.ui.form.qz_get_printer_list().then((printer_list) => {\n\t\t\t\tif (!(printer_list && printer_list.length)) {\n\t\t\t\t\tfrappe.throw(__(\"No Printer is Available.\"));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\t\t\ttitle: __(\"Printer Settings\"),\n\t\t\t\t\tfields: [\n\t\t\t\t\t\t{ fieldtype: \"Section Break\" },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfieldname: \"printer_mapping\",\n\t\t\t\t\t\t\tfieldtype: \"Table\",\n\t\t\t\t\t\t\tlabel: __(\"Printer Mapping\"),\n\t\t\t\t\t\t\tin_place_edit: true,\n\t\t\t\t\t\t\tdata: data,\n\t\t\t\t\t\t\tget_data: () => data,\n\t\t\t\t\t\t\tfields: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfieldtype: \"Select\",\n\t\t\t\t\t\t\t\t\tfieldname: \"print_format\",\n\t\t\t\t\t\t\t\t\tdefault: 0,\n\t\t\t\t\t\t\t\t\toptions: frappe.meta.get_print_formats(doctype),\n\t\t\t\t\t\t\t\t\tread_only: 0,\n\t\t\t\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\t\t\t\tlabel: __(\"Print Format\")\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfieldtype: \"Select\",\n\t\t\t\t\t\t\t\t\tfieldname: \"printer\",\n\t\t\t\t\t\t\t\t\tdefault: 0,\n\t\t\t\t\t\t\t\t\toptions: printer_list,\n\t\t\t\t\t\t\t\t\tread_only: 0,\n\t\t\t\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\t\t\t\tlabel: __(\"Printer\")\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tprimary_action: () => {\n\t\t\t\t\t\tlet printer_mapping = dialog.get_values()[\"printer_mapping\"];\n\t\t\t\t\t\tif (printer_mapping && printer_mapping.length) {\n\t\t\t\t\t\t\tlet print_format_list = printer_mapping.map((a) => a.print_format);\n\t\t\t\t\t\t\tlet has_duplicate = print_format_list.some(\n\t\t\t\t\t\t\t\t(item, idx) => print_format_list.indexOf(item) != idx\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (has_duplicate) {\n\t\t\t\t\t\t\t\tfrappe.throw(__(\"Cannot have multiple printers mapped to a single print format.\"));\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tprinter_mapping = [];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet saved_print_format_printer_map = _get_print_format_printer_map();\n\t\t\t\t\t\tsaved_print_format_printer_map[doctype] = printer_mapping;\n\t\t\t\t\t\tlocalStorage.print_format_printer_map = JSON.stringify(saved_print_format_printer_map);\n\n\t\t\t\t\t\tdialog.hide();\n\n\t\t\t\t\t\t_print_via_qz(doctype, docname, current_print_format, letterhead, lang_code);\n\t\t\t\t\t},\n\t\t\t\t\tprimary_action_label: __(\"Save\")\n\t\t\t\t});\n\n\t\t\t\tdialog.show();\n\t\t\t});\n\t\t};\n\n\t\tif (!this.doc.items.length) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"No items in the invoice to print.\"),\n\t\t\t\tindicator: 'red'\n\t\t\t});\n\t\t\treturn frappe.utils.play_sound(\"error\");\n\t\t}\n\n\t\t//frappe.dom.freeze();\n\t\tfrappe.db.get_value(\"Print Settings\", \"Print Settings\", \"enable_raw_printing\")\n\t\t\t.then(({ message }) => {\n\t\t\t\t//frappe.dom.unfreeze();\n\t\t\t\tif (message && message.enable_raw_printing === \"1\") {\n\t\t\t\t\t_print_via_qz(doctype, docname, print_format, letterhead, lang_code);\n\t\t\t\t} else {\n\t\t\t\t\t_render_pdf_or_regular_print(doctype, docname, print_format, letterhead, lang_code);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\t//frappe.dom.unfreeze();\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"Failed to check Print Settings.\"),\n\t\t\t\t\tindicator: 'red'\n\t\t\t\t});\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t});\n\t}\n\n\t_print_via_qz(doctype, docname, print_format, letterhead, lang_code) {\n\t\tconst print_format_printer_map = this._get_print_format_printer_map();\n\t\tconst mapped_printer = this._get_mapped_printer(print_format_printer_map, doctype, print_format);\n\t\t\n\t\tif (mapped_printer.length === 1) {\n\t\t\tthis._print_with_mapped_printer(doctype, docname, print_format, letterhead, lang_code, mapped_printer[0]);\n\t\t} else if (this._is_raw_printing(print_format)) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Printer mapping not set.\"),\n\t\t\t\tsubtitle: __(\"Please set a printer mapping for this print format in the Printer Settings\"),\n\t\t\t\tindicator: \"warning\"\n\t\t\t}, 14);\n\t\t\tthis._printer_setting_dialog(doctype, print_format);\n\t\t} else {\n\t\t\tthis._render_pdf_or_regular_print(doctype, docname, print_format, letterhead, lang_code);\n\t\t}\n\t}\n\n\t_print_with_mapped_printer(doctype, docname, print_format, letterhead, lang_code, printer_map) {\n\t\tif (this._is_raw_printing(print_format)) {\n\t\t\tthis._get_raw_commands(doctype, docname, print_format, lang_code, (out) => {\n\t\t\t\tfrappe.ui.form.qz_connect()\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tlet config = qz.configs.create(printer_map.printer);\n\t\t\t\t\t\tlet data = [out.raw_commands];\n\t\t\t\t\t\treturn qz.print(config, data);\n\t\t\t\t\t})\n\t\t\t\t\t.then(frappe.ui.form.qz_success)\n\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\tfrappe.ui.form.qz_fail(err);\n\t\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __('PDF printing via \"Raw Print\" is not supported.'),\n\t\t\t\tsubtitle: __(\"Please remove the printer mapping in Printer Settings and try again.\"),\n\t\t\t\tindicator: \"info\"\n\t\t\t}, 14);\n\t\t\tthis._render_pdf_or_regular_print(doctype, docname, print_format, letterhead, lang_code);\n\t\t}\n\t}\n\n\t_get_raw_commands(doctype, docname, print_format, lang_code, callback) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.www.printview.get_rendered_raw_commands\",\n\t\t\targs: {\n\t\t\t\tdoc: frappe.get_doc(doctype, docname),\n\t\t\t\tprint_format: print_format,\n\t\t\t\t_lang: lang_code\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tcallback(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t_is_raw_printing(format) {\n\t\tlet print_format = {};\n\t\tif (locals[\"Print Format\"] && locals[\"Print Format\"][format]) {\n\t\t\tprint_format = locals[\"Print Format\"][format];\n\t\t}\n\t\treturn print_format.raw_printing === 1;\n\t}\n\n\t_get_print_format_printer_map() {\n\t\ttry {\n\t\t\treturn JSON.parse(localStorage.print_format_printer_map || \"{}\");\n\t\t} catch (e) {\n\t\t\treturn {};\n\t\t}\n\t}\n\n\t_get_mapped_printer(print_format_printer_map, doctype, print_format) {\n\t\tif (print_format_printer_map[doctype]) {\n\t\t\treturn print_format_printer_map[doctype].filter(\n\t\t\t\t(printer_map) => printer_map.print_format === print_format\n\t\t\t);\n\t\t}\n\t\treturn [];\n\t}\n\n\t_render_pdf_or_regular_print(doctype, docname, print_format, letterhead, lang_code) {\n\t\tfrappe.utils.print(\n\t\t\tdoctype,\n\t\t\tdocname,\n\t\t\tprint_format,\n\t\t\tletterhead,\n\t\t\tlang_code\n\t\t);\n\t}\n\n\t_printer_setting_dialog(doctype, current_print_format) {\n\t\tlet print_format_printer_map = this._get_print_format_printer_map();\n\t\tlet data = print_format_printer_map[doctype] || [];\n\t\t\n\t\tfrappe.ui.form.qz_get_printer_list().then((printer_list) => {\n\t\t\tif (!(printer_list && printer_list.length)) {\n\t\t\t\tfrappe.throw(__(\"No Printer is Available.\"));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\t\ttitle: __(\"Printer Settings\"),\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Section Break\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldname: \"printer_mapping\",\n\t\t\t\t\t\tfieldtype: \"Table\",\n\t\t\t\t\t\tlabel: __(\"Printer Mapping\"),\n\t\t\t\t\t\tin_place_edit: true,\n\t\t\t\t\t\tdata: data,\n\t\t\t\t\t\tget_data: () => {\n\t\t\t\t\t\t\treturn data;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfields: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfieldtype: \"Select\",\n\t\t\t\t\t\t\t\tfieldname: \"print_format\",\n\t\t\t\t\t\t\t\tdefault: 0,\n\t\t\t\t\t\t\t\toptions: frappe.meta.get_print_formats(doctype),\n\t\t\t\t\t\t\t\tread_only: 0,\n\t\t\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\t\t\tlabel: __(\"Print Format\")\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfieldtype: \"Select\",\n\t\t\t\t\t\t\t\tfieldname: \"printer\",\n\t\t\t\t\t\t\t\tdefault: 0,\n\t\t\t\t\t\t\t\toptions: printer_list,\n\t\t\t\t\t\t\t\tread_only: 0,\n\t\t\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\t\t\tlabel: __(\"Printer\")\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tprimary_action: () => {\n\t\t\t\t\tlet printer_mapping = dialog.get_values()[\"printer_mapping\"];\n\t\t\t\t\tif (printer_mapping && printer_mapping.length) {\n\t\t\t\t\t\tlet print_format_list = printer_mapping.map((a) => a.print_format);\n\t\t\t\t\t\tlet has_duplicate = print_format_list.some(\n\t\t\t\t\t\t\t(item, idx) => print_format_list.indexOf(item) != idx\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (has_duplicate) {\n\t\t\t\t\t\t\tfrappe.throw(__(\"Cannot have multiple printers mapped to a single print format.\"));\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tprinter_mapping = [];\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tlet saved_print_format_printer_map = this._get_print_format_printer_map();\n\t\t\t\t\tsaved_print_format_printer_map[doctype] = printer_mapping;\n\t\t\t\t\tlocalStorage.print_format_printer_map = JSON.stringify(saved_print_format_printer_map);\n\t\t\t\t\t\n\t\t\t\t\tdialog.hide();\n\t\t\t\t\t\n\t\t\t\t\tthis._print_via_qz(doctype, this.doc.name, current_print_format, this.doc.letter_head, this.doc.language || frappe.boot.lang);\n\t\t\t\t},\n\t\t\t\tprimary_action_label: __(\"Save\")\n\t\t\t});\n\t\t\t\n\t\t\tdialog.show();\n\t\t});\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '\u2318' : 'Ctrl';\n\t\tthis.$summary_container.find('.print-btn').attr(\"title\", `${ctrl_label}+P`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+p\",\n\t\t\taction: () => this.$summary_container.find('.print-btn').click(),\n\t\t\tcondition: () => this.$component.is(':visible') && this.$summary_container.find('.print-btn').is(\":visible\"),\n\t\t\tdescription: __(\"Print Receipt\"),\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tthis.$summary_container.find('.print-order-btn').attr(\"title\", `${ctrl_label}+O`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+o\",\n\t\t\taction: () => this.$summary_container.find('.print-order-btn').click(),\n\t\t\tcondition: () => this.$component.is(':visible') && this.$summary_container.find('.print-order-btn').is(\":visible\"),\n\t\t\tdescription: __(\"Print-Order\"),\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tthis.$summary_container.find('.new-btn').attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.on(\"ctrl+enter\", () => {\n\t\t\tconst summary_is_visible = this.$component.is(\":visible\");\n\t\t\tif (summary_is_visible && this.$summary_container.find('.new-btn').is(\":visible\")) {\n\t\t\t\tthis.$summary_container.find('.new-btn').click();\n\t\t\t}\n\t\t});\n\t\tthis.$summary_container.find('.edit-btn').attr(\"title\", `${ctrl_label}+E`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+e\",\n\t\t\taction: () => this.$summary_container.find('.edit-btn').click(),\n\t\t\tcondition: () => this.$component.is(':visible') && this.$summary_container.find('.edit-btn').is(\":visible\"),\n\t\t\tdescription: __(\"Edit Receipt\"),\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t}\n\n\tsend_email() {\n\t\tconst frm = this.events.get_frm();\n\t\tconst recipients = this.email_dialog.get_values().email_id;\n\t\tconst content = this.email_dialog.get_values().content;\n\t\tconst doc = this.doc || frm.doc;\n\t\tconst print_format = frm.pos_print_format;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.core.doctype.communication.email.make\",\n\t\t\targs: {\n\t\t\t\trecipients: recipients,\n\t\t\t\tsubject: __(frm.meta.name) + ': ' + doc.name,\n\t\t\t\tcontent: content ? content : __(frm.meta.name) + ': ' + doc.name,\n\t\t\t\tdoctype: doc.doctype,\n\t\t\t\tname: doc.name,\n\t\t\t\tsend_email: 1,\n\t\t\t\tprint_format,\n\t\t\t\tsender_full_name: frappe.user.full_name(),\n\t\t\t\t_lang: doc.language\n\t\t\t},\n\t\t\tcallback: r => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.utils.play_sound(\"email\");\n\t\t\t\t\tif (r.message[\"emails_not_sent_to\"]) {\n\t\t\t\t\t\tfrappe.msgprint(__(\n\t\t\t\t\t\t\t\"Email not sent to {0} (unsubscribed / disabled)\",\n\t\t\t\t\t\t\t[ frappe.utils.escape_html(r.message[\"emails_not_sent_to\"]) ]\n\t\t\t\t\t\t));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __('Email sent successfully.'),\n\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.email_dialog.hide();\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.msgprint(__(\"There were errors while sending email. Please try again.\"));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tadd_summary_btns(map) {\n\t\tthis.$summary_btns.html('');\n\t\tmap.forEach(m => {\n\t\t\tif (m.condition) {\n\t\t\t\tm.visible_btns.forEach(b => {\n\t\t\t\t\tconst class_name = b.split(' ')[0].toLowerCase();\n\t\t\t\t\tconst btn = __(b);\n\t\t\t\t\tthis.$summary_btns.append(\n\t\t\t\t\t\t`<div class=\"summary-btn btn btn-default ${class_name}-btn\">${btn}</div>`\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tthis.$summary_btns.children().last().removeClass('mr-4');\n\t}\n\n\ttoggle_summary_placeholder(show) {\n\t\tif (show) {\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t} else {\n\t\t\tthis.$summary_wrapper.css('display', 'flex');\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'none');\n\t\t}\n\t}\n\n\tget_condition_btn_map(after_submission) {\n\t\tif (after_submission )\n\t\t\treturn [{ condition: true, visible_btns: ['Print Receipt', 'New Order'] }];\n\n\t\tconst hasWaiterRole = frappe.user_roles.includes('Waiter');\n\t\t\n\t\tconst draftButtons = hasWaiterRole \n\t\t\t? ['Print Receipt','Edit Order','Print-Order'] \n\t\t\t: ['Print Receipt','Edit Order','Print-Order','Split-Order'];\n\n\t\tconst submitButtons = hasWaiterRole\n    \t\t? ['Print Receipt'] \n    \t\t: this.doc.outstanding_amount > 0 \n       \t\t\t ? ['Print Receipt', 'Add-Payment', 'Return']\n       \t\t\t : ['Print Receipt', 'Return'];\n\n\t\treturn [\n\t\t\t{ condition: this.doc.docstatus === 0, visible_btns: draftButtons },\n\t\t\t{ condition: !this.doc.is_return && this.doc.docstatus === 1, visible_btns: submitButtons},\n\t\t\t{ condition: this.doc.is_return && this.doc.docstatus === 1, visible_btns: ['Print Receipt']}\n\t\t];\n\t}\n\n\tload_summary_of(doc, after_submission=false) {\n\t\tafter_submission ?\n\t\t\tthis.$component.css('grid-column', 'span 10 / span 10') :\n\t\t\tthis.$component.css('grid-column', 'span 6 / span 6');\n\n\t\tthis.toggle_summary_placeholder(false);\n\n\t\tthis.doc = doc;\n\n\t\tthis.attach_document_info(doc);\n\n\t\tthis.attach_items_info(doc);\n\n\t\tthis.attach_totals_info(doc);\n\n\t\tthis.attach_payments_info(doc);\n\n\t\tconst condition_btns_map = this.get_condition_btn_map(after_submission);\n\n\t\tthis.add_summary_btns(condition_btns_map);\n\t\tthis.$summary_wrapper.css(\"width\",after_submission ? \"35%\" : \"60%\")\n\n\t\tif (after_submission && this.print_receipt_on_order_complete) {\n\t\t\tthis.print_receipt();\n\t\t}\n\t}\n\n\tattach_document_info(doc) {\n\t\tfrappe.db.get_value('Customer', this.doc.customer, 'email_id').then(({ message }) => {\n\t\t\tthis.customer_email = message.email_id || '';\n\t\t\tconst upper_section_dom = this.get_upper_section_html(doc);\n\t\t\tthis.$upper_section.html(upper_section_dom);\n\t\t});\n\t}\n\n\tattach_items_info(doc) {\n\t\tthis.$items_container.html('');\n\t\tdoc.items.forEach(item => {\n\t\t\tconst item_dom = this.get_item_html(doc, item);\n\t\t\tthis.$items_container.append(item_dom);\n\t\t\tthis.set_dynamic_rate_header_width();\n\t\t});\n\t}\n\n\tset_dynamic_rate_header_width() {\n\t\tconst rate_cols = Array.from(this.$items_container.find(\".item-rate-disc\"));\n\t\tthis.$items_container.find(\".item-rate-disc\").css(\"width\", \"\");\n\t\tlet max_width = rate_cols.reduce((max_width, elm) => {\n\t\t\tif ($(elm).width() > max_width)\n\t\t\t\tmax_width = $(elm).width();\n\t\t\treturn max_width;\n\t\t}, 0);\n\n\t\tmax_width += 1;\n\t\tif (max_width == 1) max_width = \"\";\n\n\t\tthis.$items_container.find(\".item-rate-disc\").css(\"width\", max_width);\n\t}\n\n\tattach_payments_info(doc) {\n\t\tthis.$payment_container.html('');\n\t\tdoc.payments.forEach(p => {\n\t\t\tif (p.amount) {\n\t\t\t\tconst payment_dom = this.get_payment_html(doc, p);\n\t\t\t\tthis.$payment_container.append(payment_dom);\n\t\t\t}\n\t\t});\n\t\tif (doc.redeem_loyalty_points && doc.loyalty_amount) {\n\t\t\tconst payment_dom = this.get_payment_html(doc, {\n\t\t\t\tmode_of_payment: 'Loyalty Points',\n\t\t\t\tamount: doc.loyalty_amount,\n\t\t\t});\n\t\t\tthis.$payment_container.append(payment_dom);\n\t\t}\n\t}\n\n\tattach_totals_info(doc) {\n\t\tthis.$totals_container.html('');\n\n\t\tconst net_total_dom = this.get_net_total_html(doc);\n\t\tconst taxes_dom = this.get_taxes_html(doc);\n\t\tconst discount_dom = this.get_discount_html(doc);\n\t\tconst grand_total_dom = this.get_grand_total_html(doc);\n\t\tthis.$totals_container.append(net_total_dom);\n\t\tthis.$totals_container.append(taxes_dom);\n\t\tthis.$totals_container.append(discount_dom);\n\t\tthis.$totals_container.append(grand_total_dom);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n\n\tshow_summary_placeholder() {\n\t\tthis.toggle_summary_placeholder(true);\n\t}\n};", "frappe.provide('posnext.PointOfSale');\n\nposnext.PointOfSale.TableSelector = class {\n    constructor({ wrapper, events, pos_profile }) {\n        console.log('Wrapper check:', wrapper, wrapper.length, wrapper.is(':visible'));\n        if (!wrapper || !wrapper.length) {\n            console.error('Invalid wrapper: Element not found or not provided');\n            return;\n        }\n        this.wrapper = wrapper;\n        this.events = events;\n        this.pos_profile = pos_profile;\n        this.selected_table = null;\n        this.init_component();\n    }\n\n    init_component() {\n        this.prepare_dom();\n        this.load_tables();\n        this.bind_events();\n    }\n\n    prepare_dom() {\n        this.wrapper.html(`\n            <style>\n                .table-selector {\n                    display: flex;\n                    flex-direction: column;\n                    height: 100%;\n                    width: 90vw; /* Wider layout, 90% of viewport width */\n                    max-width: 1200px; /* Cap width for very large screens */\n                    margin: 0 auto; /* Center the container */\n                    padding: 16px;\n                    background: #f9fafb;\n                    font-family: 'Inter', sans-serif;\n                    box-sizing: border-box;\n                }\n\n                .table-selector-header {\n                    text-align: center;\n                    margin-bottom: 24px;\n                    position: relative;\n                }\n\n                .header-actions {\n                    position: absolute;\n                    top: 0;\n                    right: 0;\n                }\n\n                .order-list-btn {\n                    font-size: 0.875rem;\n                    padding: 6px 12px;\n                }\n\n                .restaurant-title {\n                    font-size: 1.5rem;\n                    font-weight: 600;\n                    color: #1f2a44;\n                    margin: 0;\n                }\n\n                .restaurant-subtitle {\n                    font-size: 0.875rem;\n                    color: #4CAF50;\n                    margin: 4px 0 0;\n                }\n\n                .table-search-container {\n                    max-width: 400px; /* Slightly wider search bar */\n                    margin: 0 auto 24px;\n                    position: relative;\n                }\n\n                .table-search-input {\n                    width: 100%;\n                    padding: 8px 36px 8px 12px;\n                    border: 1px solid #e5e7eb;\n                    border-radius: 6px;\n                    font-size: 0.875rem;\n                    color: #1f2a44;\n                    transition: border-color 0.2s;\n                }\n\n                .table-search-input:focus {\n                    border-color: #4CAF50;\n                    outline: none;\n                    box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);\n                }\n\n                .table-search-input::placeholder {\n                    color: #9ca3af;\n                }\n\n                .search-icon {\n                    position: absolute;\n                    right: 12px;\n                    top: 50%;\n                    transform: translateY(-50%);\n                    color: #9ca3af;\n                    font-size: 0.875rem;\n                }\n\n                .table-grid {\n                    display: grid;\n                    grid-template-columns: repeat(6, minmax(160px, 1fr)); /* Wider columns */\n                    grid-template-rows: repeat(5, minmax(0, auto));\n                    gap: 16px;\n                    max-height: calc(5 * (110px + 16px)); /* Adjusted for 5 rows */\n                    overflow-y: auto;\n                    padding: 8px 0;\n                    scrollbar-width: thin;\n                }\n\n                .table-card {\n                    background: #fff;\n                    border: 2px solid #e5e7eb;\n                    border-radius: 8px;\n                    padding: 12px;\n                    cursor: pointer;\n                    transition: all 0.2s;\n                    display: flex;\n                    flex-direction: column;\n                    justify-content: space-between;\n                    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\n                    min-height: 110px; /* Slightly taller for wider layout */\n                    visibility: visible;\n                }\n\n                .table-card.available {\n                    border-color: #4CAF50;\n                    background: linear-gradient(135deg, #4CAF50, #6cc070);\n                    color: #fff;\n                }\n\n                .table-card.occupied-with-orders {\n                    border-color: #f59e0b;\n                    background: linear-gradient(135deg, #f59e0b, #fbbf24);\n                    color: #fff;\n                }\n\n                .table-card.occupied-urgent {\n                    border-color: #dc2626;\n                    background: linear-gradient(135deg, #dc2626, #ef4444);\n                    color: #fff;\n                }\n\n                .table-card.empty {\n                    border-color: #4CAF50;\n                    background: #fff;\n                    color: #4CAF50;\n                }\n\n                .table-card:hover {\n                    transform: translateY(-2px);\n                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n                }\n\n                .table-card.selected {\n                    border-color: #2563eb;\n                    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);\n                }\n\n                .table-header {\n                    display: flex;\n                    justify-content: space-between;\n                    margin-bottom: 8px;\n                }\n\n                .table-name {\n                    font-size: 1rem;\n                    font-weight: 600;\n                    margin: 0;\n                }\n\n                .table-time {\n                    font-size: 0.75rem;\n                    opacity: 0.9;\n                    margin: 0;\n                }\n\n                .table-info {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 4px;\n                }\n\n                .order-status {\n                    font-size: 0.75rem;\n                    font-weight: 500;\n                    margin: 0;\n                }\n\n                .table-details {\n                    font-size: 0.6875rem;\n                    opacity: 0.8;\n                    margin: 0;\n                }\n\n                .table-card.empty .table-time {\n                    display: none;\n                }\n\n                .table-selector-footer {\n                    text-align: center;\n                    padding-top: 16px;\n                    margin-top: 16px;\n                    border-top: 1px solid #e5e7eb;\n                }\n\n                .proceed-btn {\n                    padding: 8px 16px;\n                    font-size: 0.875rem;\n                    font-weight: 600;\n                    border-radius: 6px;\n                    border: none;\n                    background: #4CAF50;\n                    color: #fff;\n                    cursor: pointer;\n                    transition: background 0.2s;\n                }\n\n                .proceed-btn:hover:not(:disabled) {\n                    background: #3d8b40;\n                }\n\n                .proceed-btn:disabled {\n                    opacity: 0.5;\n                    cursor: not-allowed;\n                }\n\n                .no-tables {\n                    grid-column: 1 / -1;\n                    text-align: center;\n                    padding: 32px;\n                    color: #6b7280;\n                    font-size: 0.875rem;\n                }\n\n                .no-tables i {\n                    font-size: 1.5rem;\n                    margin-bottom: 8px;\n                    opacity: 0.5;\n                }\n\n                .table-card-skeleton {\n                    background: #fff;\n                    border: 2px solid #e5e7eb;\n                    border-radius: 8px;\n                    padding: 12px;\n                    animation: pulse 1.5s infinite;\n                }\n\n                @keyframes pulse {\n                    0%, 100% { opacity: 0.7; }\n                    50% { opacity: 1; }\n                }\n\n                .skeleton-header {\n                    display: flex;\n                    justify-content: space-between;\n                    margin-bottom: 8px;\n                }\n\n                .skeleton-text {\n                    background: #e5e7eb;\n                    border-radius: 4px;\n                }\n\n                .skeleton-text.large { width: 60px; height: 16px; }\n                .skeleton-text.medium { width: 40px; height: 16px; }\n                .skeleton-text.small { width: 80px; height: 12px; margin-top: 4px; }\n\n                @media (max-width: 768px) {\n                    .table-selector {\n                        padding: 12px;\n                        width: 100%; /* Full width on smaller screens */\n                        max-width: none;\n                    }\n\n                    .restaurant-title {\n                        font-size: 1.25rem;\n                    }\n\n                    .restaurant-subtitle {\n                        font-size: 0.75rem;\n                    }\n\n                    .table-grid {\n                        grid-template-columns: repeat(4, minmax(140px, 1fr));\n                        gap: 12px;\n                    }\n\n                    .table-card {\n                        padding: 10px;\n                        min-height: 90px;\n                    }\n\n                    .table-name {\n                        font-size: 0.875rem;\n                    }\n\n                    .table-time, .order-status {\n                        font-size: 0.6875rem;\n                    }\n\n                    .table-details {\n                        font-size: 0.625rem;\n                    }\n                }\n\n                @media (max-width: 480px) {\n                    .table-grid {\n                        grid-template-columns: repeat(2, minmax(120px, 1fr));\n                        gap: 8px;\n                    }\n\n                    .table-card {\n                        padding: 8px;\n                        min-height: 80px;\n                    }\n                }\n            </style>\n            <div class=\"table-selector\">\n                <div class=\"table-selector-header\">\n                    <div class=\"header-actions\">\n                        <button class=\"btn btn-secondary btn-sm order-list-btn\">\n                            <i class=\"fa fa-list\"></i> ${__('Order List')}\n                        </button>\n                    </div>\n                    <h1 class=\"restaurant-title\">${__('Table Selection')}</h1>\n                    <p class=\"restaurant-subtitle\">${__('Choose a table to start taking orders')}</p>\n                </div>\n                <div class=\"table-search-container\">\n                    <input type=\"text\" class=\"table-search-input\" placeholder=\"${__('Search tables...')}\" />\n                    <i class=\"fa fa-search search-icon\"></i>\n                </div>\n                <div class=\"table-grid\"></div>\n                <div class=\"table-selector-footer\">\n                    <button class=\"btn btn-primary btn-sm proceed-btn\" disabled aria-label=\"${__('Proceed to order for selected table')}\">\n                        ${__('Proceed to Order')}\n                    </button>\n                </div>\n            </div>\n        `);\n    }\n\n    load_tables() {\n        const $grid = this.wrapper.find('.table-grid');\n        $grid.empty();\n        this.show_loading_skeleton();\n\n        frappe.call({\n            method: 'posnext.posnext.page.posnext.point_of_sale.get_tables',\n            callback: (r) => {\n                console.log('frappe.call response:', r);\n                $grid.empty();\n                if (r.exc) {\n                    frappe.msgprint(__('Error loading tables. Please try again.'));\n                    this.render_tables([]);\n                } else {\n                    this.all_tables = r.message || [];\n                    this.render_tables(this.all_tables);\n                }\n            }\n        });\n    }\n\n    show_loading_skeleton() {\n        const $grid = this.wrapper.find('.table-grid');\n        for (let i = 0; i < 6; i++) {\n            $grid.append(`\n                <div class=\"table-card-skeleton\">\n                    <div class=\"skeleton-header\">\n                        <div class=\"skeleton-text large\"></div>\n                        <div class=\"skeleton-text medium\"></div>\n                    </div>\n                    <div class=\"skeleton-text small\"></div>\n                </div>\n            `);\n        }\n    }\n\n    render_tables(tables) {\n        console.log('Rendering tables:', tables);\n        const $grid = this.wrapper.find('.table-grid');\n        $grid.empty();\n\n        if (!tables.length) {\n            $grid.append(`\n                <div class=\"no-tables\">\n                    <i class=\"fa fa-table\"></i>\n                    <p>${__('No tables available')}</p>\n                    <small>${__('Please check back later')}</small>\n                </div>\n            `);\n            return;\n        }\n\n        tables.forEach(table => {\n            const minutes = table.elapsed_time ? parseInt(table.elapsed_time.split(':')[0]) : 0;\n            const statusClass = table.status === 'Available' ? 'empty' :\n                minutes >= 8 ? 'occupied-urgent' :\n                minutes >= 4 ? 'occupied-with-orders' : 'available';\n            const orderText = table.status === 'Available' ? 'No Order' : `Ordered ${table.order_count || 0} items`;\n\n            $grid.append(`\n                <div class=\"table-card ${statusClass} ${this.selected_table === table.name ? 'selected' : ''}\"\n                     data-table=\"${table.name}\" \n                     tabindex=\"0\" \n                     role=\"button\" \n                     aria-label=\"${__('Table')} ${table.table_name}, ${orderText}\">\n                    <div class=\"table-header\">\n                        <h3 class=\"table-name\">${table.table_name}</h3>\n                        ${table.elapsed_time ? `<p class=\"table-time\">${table.elapsed_time}</p>` : ''}\n                    </div>\n                    <div class=\"table-info\">\n                        <p class=\"order-status\">${orderText}</p>\n                        <p class=\"table-details\">${__('Capacity')}: ${table.seating_capacity} ${__('seats')}</p>\n                    </div>\n                </div>\n            `);\n        });\n        console.log('Table cards appended:', $grid.find('.table-card').length);\n    }\n\n    filter_tables(searchTerm) {\n        if (!this.all_tables) return;\n        const filteredTables = searchTerm ?\n            this.all_tables.filter(table =>\n                table.table_name.toLowerCase().includes(searchTerm) ||\n                table.seating_capacity.toString().includes(searchTerm) ||\n                table.status.toLowerCase().includes(searchTerm)\n            ) : this.all_tables;\n        console.log('Filtered tables:', filteredTables);\n        this.render_tables(filteredTables);\n    }\n\n    bind_events() {\n        const me = this;\n\n        this.wrapper.on('input', '.table-search-input', frappe.utils.debounce(function() {\n            const searchTerm = $(this).val().toLowerCase().trim();\n            me.filter_tables(searchTerm);\n        }, 300));\n\n        this.wrapper.on('click', '.table-card', function() {\n            me.wrapper.find('.table-card').removeClass('selected');\n            $(this).addClass('selected');\n            me.selected_table = $(this).data('table');\n            me.wrapper.find('.proceed-btn').prop('disabled', false);\n        });\n\n        this.wrapper.on('keydown', '.table-card', function(e) {\n            if (e.key === 'Enter' || e.key === ' ') {\n                e.preventDefault();\n                $(this).click();\n            }\n        });\n\n        this.wrapper.on('click', '.proceed-btn', function() {\n            if (me.selected_table) {\n                me.events.table_selected?.(me.selected_table);\n            }\n        });\n\n        this.wrapper.on('click', '.order-list-btn', function() {\n            me.events.toggle_recent_order?.();\n        });\n    }\n\n    get_selected_table() {\n        return this.selected_table;\n    }\n\n    toggle_component(show) {\n        if (show) {\n            this.wrapper.show();\n        } else {\n            this.wrapper.hide();\n        }\n    }\n};"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAGC,OAAC,SAAU,QAAQ,SAAS;AACzB,eAAO,YAAY,YAAY,OAAO,WAAW,cAAc,OAAO,UAAU,QAAQ,IACxF,OAAO,WAAW,cAAc,OAAO,MAAM,OAAO,QAAQ,CAAC,IAC7D,OAAO,SAAS,QAAQ;AAAA,MAC5B,GAAE,SAAO,WAAY;AACpB,YAAIA,UAAS;AAAA,UAQZ,UAAU,SAAS,aAAa,UAAU;AAEzC,gBAAG,YAAY,yBAAyB,QAAU;AACjD,oBAAM,IAAI,MAAM,sDAAsD,WAAW;AAAA,YAClF;AAEA,gBAAI,YAAY;AAAA,cACf,QAAQ,SAAS,UAAU,MAAK;AAAA,cAAC;AAAA,cACjC,aAAa,SAAS,QAAO;AAAA,cAAC;AAAA,cAC9B,cAAc,SAAS,OAAO,QAAO;AAAA,cAAC;AAAA,cACtC,aAAa,SAAS,UAAU,QAAO;AAAA,cAAC;AAAA,cACxC,SAAS,SAAS,SAAS,QAAO;AAAA,cAAC;AAAA,cACnC,eAAe,SAAS,QAAQ;AAAC,uBAAOA,QAAO,eAAe,MAAM;AAAA,cAAC;AAAA,cACrE,uBAAuB,WAAU;AAAA,cAAC;AAAA,cAClC,mBAAkB;AAAA,cAClB,yBAAwB;AAAA,cACxB,oBAAmB;AAAA,cACnB,eAAc;AAAA,cACd,WAAU;AAAA,cACV,gBAAe,CAAC,GAAE,EAAE;AAAA,cACpB,gBAAe,CAAC;AAAA,cAChB,iBAAgB;AAAA,cAChB,iBAAgB;AAAA,cAChB,gBAAe;AAAA,cACf,eAAc;AAAA,cACd,gBAAe;AAAA,cACf,cAAa;AAAA,cACb,eAAe;AAAA,YAChB;AAEA,uBAAW,KAAK,cAAc,WAAW,QAAQ;AAGjD,wBAAY,uBAAuB;AAAA,cACjC,SAAS;AAAA,cACT,MAAK;AAAA,gBACJ,eAAe;AAAA,gBACf,cAAc;AAAA,gBACd,mBAAmB;AAAA,gBACnB,WAAW;AAAA,gBACX,oBAAoB;AAAA,gBACpB,aAAa;AAAA,cACd;AAAA,YAEF;AAGA,gBAAI,SAAS,iBAAiB,MAAK;AAClC,0BAAY,iBAAiB,SAAS,KAAK,cAAc,SAAS,aAAa;AAAA,YAChF;AACA,gBAAI,SAAS,sBAAsB,OAAM;AACxC,0BAAY,iBAAiB,SAAS,KAAK,cAAc,SAAS,aAAa;AAAA,YAChF;AACA,gBAAI,SAAS,mBAAmB,QAAQ,SAAS,sBAAsB,OAAM;AAC5E,0BAAY,iBAAiB,WAAW,KAAK,gBAAgB,SAAS,aAAa;AAAA,YACpF;AACA,mBAAO;AAAA,UACR;AAAA,UAOA,YAAY,SAAS,aAAa;AAEjC,gBAAI,YAAY,qBAAqB,QAAQ,cAAa;AACzD,0BAAY,oBAAoB,SAAS,KAAK,YAAY;AAAA,YAC3D;AACA,gBAAI,YAAY,qBAAqB,QAAQ,sBAAsB,OAAM;AACxE,0BAAY,oBAAoB,SAAS,KAAK,YAAY;AAAA,YAC3D;AACA,wBAAY,oBAAoB,WAAW,KAAK,cAAc;AAG9D,wBAAY,uBAAuB;AACnC;AAAA,UACD;AAAA,UAOA,YAAY,SAAS,aAAY;AAChC,mBAAO,YAAY,qBAAqB;AAAA,UACzC;AAAA,UAQA,YAAY,SAAS,aAAa,UAAS;AAE1C,oBAAQ,YAAY,qBAAqB,QAAQ;AAAA,mBAC3C;AACJ,oBAAI,SAAS,iBAAiB,OAAM;AACnC,8BAAY,oBAAoB,SAAS,KAAK,YAAY;AAAA,gBAC3D;AACA;AAAA,mBACI;AACJ,oBAAI,SAAS,iBAAiB,MAAK;AAClC,8BAAY,iBAAiB,SAAS,KAAK,YAAY;AAAA,gBACxD;AACA;AAAA;AAGF,oBAAQ,YAAY,qBAAqB,QAAQ;AAAA,mBAC3C;AACJ,oBAAI,SAAS,sBAAsB,OAAM;AACxC,8BAAY,iBAAiB,SAAS,KAAK,YAAY;AAAA,gBACxD;AACA;AAAA;AAEA,oBAAI,SAAS,sBAAsB,OAAM;AACxC,8BAAY,oBAAoB,SAAS,KAAK,YAAY;AAAA,gBAC3D;AACA;AAAA;AAIF,wBAAY,qBAAqB,UAAU,KAAK,cAAc,YAAY,qBAAqB,SAAS,QAAQ;AAGhH,iBAAK,cAAc,WAAW;AAC9B,mBAAO;AAAA,UACR;AAAA,UAoBA,gBAAiB,SAAU,QAAQ;AAClC,gBAAI,QAAQ,KAAK,qBAAqB,MAAM;AAC5C,oBAAQ;AAAA,oBACF,SAAS,MAAM,SAAS;AAAA,oBACxB,SAAS,OAAO,SAAS;AAC7B,oBAAI,OAAO,QAAQ,UAAa,OAAO,QAAQ,IAAI;AAClD,yBAAO,OAAO;AAAA,gBACf;AAEA,oBAAI,WAAW,OAAO,aAAa,KAAK;AACxC,wBAAQ,OAAO;AAAA,uBACT;AAAO,+BAAW,SAAS,YAAY;AAAG;AAAA,uBAC1C;AAAM,+BAAW,SAAS,YAAY;AAAG;AAAA;AAE/C,uBAAO;AAAA,oBACH,SAAS,MAAM,SAAS;AAC5B,uBAAO,KAAG,QAAM;AAAA;AAElB,mBAAO;AAAA,UACR;AAAA,UAkBA,UAAU,SAAS,aAAa,gBAAe;AAC9C,iBAAK,cAAc,WAAW;AAC9B,gBAAI,MAAM,QAAQ,cAAc,GAAE;AACjC,6BAAe,QAAQ,SAAS,MAAK;AACpC,oBAAI,cAAc,CAAC;AACnB,qBAAK,OAAO,SAAS,YAAY,OAAO,SAAS,eAAgB,SAAS,MAAQ;AACjF,gCAAc;AAAA,gBACf,OAAO;AACN,8BAAY,UAAU,SAAS,IAAI;AAAA,gBACpC;AACA,oBAAI,SAAS,IAAI,cAAc,WAAW,WAAW;AACrD,yBAAS,cAAc,MAAM;AAAA,cAC9B,CAAC;AAAA,YACF,OAAO;AACN,mBAAK,kBAAkB,aAAa,cAAc;AAAA,YACnD;AACA,mBAAO;AAAA,UACR;AAAA,UAOA,eAAe,SAAS,aAAY;AACnC,gBAAI,QAAQ,YAAY,qBAAqB;AAC7C,kBAAM,gBAAgB;AACtB,kBAAM,eAAe;AACrB,kBAAM,oBAAoB;AAC1B;AAAA,UACD;AAAA,UAOA,0BAA0B,SAAS,aAAY;AAE9C,gBAAI,kBAAkB,YAAY,qBAAqB,QAAQ;AAEzD,gBAAG,CAAC,iBAAgB;AACzB,qBAAO;AAAA,YACR;AAEA,gBAAI,WAAW,SAAS;AAGxB,gBAAI,MAAM,QAAQ,eAAe,GAAE;AAClC,uBAAQ,IAAE,GAAG,IAAE,gBAAgB,QAAQ,KAAI;AAC1C,oBAAG,SAAS,QAAQ,gBAAgB,EAAE,MAAM,MAAK;AAChD,yBAAO;AAAA,gBACR;AAAA,cACD;AAAA,YAED,WAAW,SAAS,QAAQ,eAAe,GAAE;AAC5C,qBAAO;AAAA,YACR;AAGG,mBAAO;AAAA,UACR;AAAA,UASH,mBAAmB,SAAS,aAAa,WAAU;AAClD,gBAAI,eAAe,YAAY;AAC/B,gBAAI,WAAW,aAAa;AAC5B,gBAAI,iBAAiB,aAAa,QAAQ;AAC1C,gBAAI,iBAAiB,aAAa,KAAK;AACvC,gBAAI,gBAAgB,aAAa,KAAK;AACtC,gBAAI,aAAa,CAAC;AACZ,gBAAI;AAEV,oBAAO;AAAA,mBAGA,UAAU,SAAS,SAAS;AACjC,6BAAa;AAAA,kBACZ,SAAS;AAAA,gBACV;AACA;AAAA,mBAGM,gBAAgB,iBAAmB,UAAU,SAAS,SAAS;AACrE,6BAAa;AAAA,kBACZ,SAAS;AAAA,gBACV;AACA;AAAA;AAIA,yBAAS,OAAO,KAAK,aAAa,WAAW,cAAc;AAC3D,yBAAS,IAAI;AAAA,kBACZ;AAAA,kBACA;AAAA,oBACC,QAAQ;AAAA,sBACP,UAAU;AAAA,sBACV,KAAK;AAAA,oBACN;AAAA,kBACD;AAAA,gBACD;AACA,4BAAY,cAAc,MAAM;AAChC,gBAAAA,QAAO,cAAc,WAAW;AAChC,uBAAO;AAAA;AAIT,uBAAW,WAAW;AACtB,uBAAW,eAAe,gBAAgB;AAC1C,uBAAW,gBAAgB,SAAS;AACpC,uBAAW,YAAY,SAAS;AAEhC,qBAAS,YAAY,KAAK,aAAa,UAAU;AAEjD,qBAAS,IAAI;AAAA,cACZ;AAAA,cACA,EAAC,QAAQ,WAAU;AAAA,YACpB;AACA,wBAAY,cAAc,MAAM;AAEhC,YAAAA,QAAO,cAAc,WAAW;AAChC,mBAAO;AAAA,UACL;AAAA,UAQH,eAAe,SAAS,WAAW,UAAS;AAC3C,gBAAI,YAAY,CAAC;AACjB,gBAAI;AACJ,iBAAK,QAAQ,WAAU;AACtB,kBAAI,OAAO,UAAU,eAAe,KAAK,WAAW,IAAI,GAAE;AACzD,0BAAU,QAAQ,UAAU;AAAA,cAC7B;AAAA,YACD;AACA,iBAAK,QAAQ,UAAS;AACrB,kBAAI,OAAO,UAAU,eAAe,KAAK,UAAU,IAAI,GAAE;AACxD,0BAAU,QAAQ,SAAS;AAAA,cAC5B;AAAA,YACD;AACA,mBAAO;AAAA,UACR;AAAA,UAQA,sBAAsB,SAAS,GAAE;AAChC,mBAAO,EAAE,SAAS,EAAE;AAAA,UACrB;AAAA,UAQA,gBAAgB,SAAS,GAAE;AAC1B,gBAAI,WAAWA,QAAO,qBAAqB,CAAC;AAC5C,gBAAI,WAAW,KAAK,qBAAqB;AACzC,gBAAI,QAAQ,KAAK,qBAAqB;AACtC,gBAAI,gBAAgB;AAEpB,gBAAI,SAAS,YAAY,KAAK,MAAM,UAAU,CAAC,MAAM,OAAO;AAC3D;AAAA,YACD;AAEA,gBAAIA,QAAO,yBAAyB,IAAI,GAAE;AACzC;AAAA,YACD;AAGG,gBAAG,SAAS,sBAAsB,SAAS,YAAU,SAAS,mBAAmB;AAGnF,kBAAI,CAAC,MAAM,aAAY;AACtB,sBAAM,iBAAiB,WAAY,SAAS,uBAAuB,SAAS,yBAAyB,IAAI;AACzG,sBAAM,cAAc;AAAA,cACrB;AAEA;AAAA,YACK;AAEN,oBAAO;AAAA,oBAEA,MAAM,iBAAiB,SAAS,eAAe,QAAQ,QAAQ,MAAI;AACxE,kBAAE,eAAe;AACjB,kBAAE,yBAAyB;AAC3B,gCAAc;AACd;AAAA,oBAGK,CAAC,MAAM,iBAAiB,SAAS,eAAe,QAAQ,QAAQ,MAAI;AACzE,kBAAE,eAAe;AACjB,kBAAE,yBAAyB;AAC3B,gCAAc;AACd;AAAA;AAIA,oBAAI,YAAY,SAAS,cAAc,KAAK,MAAM,CAAC;AACnD,oBAAI,cAAc,MAAK;AACtB;AAAA,gBACD;AACA,sBAAM,qBAAqB;AAE3B,oBAAI,SAAS,gBAAgB;AAC5B,oBAAE,eAAe;AAAA,gBAClB;AACA,oBAAI,SAAS,iBAAiB;AAC7B,oBAAE,yBAAyB;AAAA,gBAC5B;AAEA,gCAAc;AACd;AAAA;AAGF,gBAAG,CAAC,MAAM,eAAc;AACvB,oBAAM,gBAAc,KAAK,IAAI;AAAA,YAC9B;AAEA,kBAAM,eAAa,KAAK,IAAI;AAE5B,gBAAG,MAAM,WAAU;AAClB,2BAAa,MAAM,SAAS;AAAA,YAC7B;AAEA,gBAAG,eAAc;AAChB,cAAAA,QAAO,kBAAkB,MAAM,MAAM,iBAAiB;AACtD,oBAAM,YAAU;AAAA,YACjB,OAAO;AACN,oBAAM,YAAU,WAAWA,QAAO,mBAAmB,SAAS,oBAAoB,MAAM,MAAM,iBAAiB;AAAA,YAChH;AAEA,qBAAS,aAAa,KAAK,MAAM,WAAW,CAAC;AAC7C;AAAA,UACD;AAAA,UAOA,cAAc,SAAS,GAAE;AAExB,gBAAI,WAAW,KAAK,qBAAqB;AACzC,gBAAI,QAAQ,KAAK,qBAAqB;AACtC,gBAAI,gBAAgB,MAAM,iBAAiB,OAAO,eAAe,QAAQ,MAAM;AAG/E,gBAAIA,QAAO,yBAAyB,IAAI,GAAE;AACzC;AAAA,YACD;AAEA,cAAE,eAAe;AAEjB,gBAAI,SAAS,iBAAiB;AAC7B,gBAAE,yBAAyB;AAAA,YAC5B;AAEA,qBAAS,QAAQ,KAAK,MAAM,cAAc,KAAK;AAE/C,kBAAM,gBAAgB;AACtB,kBAAM,eAAe;AAGrB,YAAAA,QAAO,kBAAkB,MAAM,YAAY;AAC3C;AAAA,UACD;AAAA,UAOA,cAAc,SAAS,GAAE;AAExB,gBAAIA,QAAO,yBAAyB,IAAI,GAAE;AACzC;AAAA,YACD;AAEA,gBAAI,WAAWA,QAAO,qBAAqB,CAAC;AAG5C,gBAAI,YAAY,KAAK,qBAAqB,QAAQ,mBAAkB;AACnE,2BAAa,KAAK,qBAAqB,KAAK,cAAc;AAC1D,mBAAK,qBAAqB,KAAK,cAAc;AAAA,YAC9C;AACA;AAAA,UACD;AAAA,UAQA,qBAAqB,SAAS,aAAa;AAC1C,mBAAO,YAAY,qBAAqB,KAAK,gBAAgB;AAAA,UAC9D;AAAA,UAQA,cAAc,SAAS,aAAa;AACnC,mBAAQ,YAAY,yBAAyB;AAAA,UAC9C;AAAA,QACD;AAEA,eAAOA;AAAA,MACR,CAAE;AAAA;AAAA;;;AC7gBF,SAAO,QAAQ,qBAAqB;AACpC,MAAI,gBAAgB;AAEpB,UAAQ,YAAY,aAAa,MAAM;AAAA,IACtC,YAAY,SAAS;AACpB,cAAQ,IAAI,iCAAiC;AAC7C,WAAK,UAAU,EAAE,OAAO,EAAE,KAAK,sBAAsB;AACrD,WAAK,OAAO,QAAQ;AACpB,aAAO,aAAa;AAAA,QACnB,MAAM,KAAK,gBAAgB;AAAA,QAC3B,MAAM,KAAK,oBAAoB,EAAE;AAAA,QACjC,MAAM,KAAK,gBAAgB;AAAA,MAC5B,CAAC;AAAA,IAIF;AAAA,IAEA,oBAAoB,OAAO;AAC1B,aAAO,OAAO,KAAK,kEAAkE,EAAE,QAAQ,OAAO,QAAQ,MAAM,SAAS,MAAM,CAAC;AAAA,IACrI;AAAA,IAED,oBAAoB,QAAQ,IAAI;AAC/B,UAAI,OAAO,WAAW,SAAS,QAAQ,GAAG;AACzC,aAAK,6BAA6B;AAAA,MACnC,OAAO;AACN,aAAK,oBAAoB,KAAK,EAAE,KAAK,CAAC,MAAM;AAC3C,cAAI,EAAE,QAAQ,QAAQ;AAErB,iBAAK,qBAAqB,EAAE,QAAQ,EAAE;AAAA,UACvC,OAAO;AACN,iBAAK,uBAAuB;AAAA,UAC7B;AAAA,QACD,CAAC;AAAA,MACF;AAAA,IACD;AAAA,IAGA,+BAA+B;AAC9B,YAAM,KAAK;AAGX,aAAO,KAAK;AAAA,QACX,QAAQ;AAAA,QACR,UAAU,CAAC,MAAM;AAChB,cAAI,EAAE,WAAW,EAAE,QAAQ,SAAS,GAAG;AAEtC,eAAG,qBAAqB,EAAE,QAAQ,EAAE;AAGpC,mBAAO,WAAW;AAAA,cACjB,SAAS,GAAG,yCAAyC,CAAC,EAAE,QAAQ,GAAG,IAAI,CAAC;AAAA,cACxE,WAAW;AAAA,YACZ,CAAC;AAAA,UACF,OAAO;AAEN,mBAAO,SAAS;AAAA,cACf,OAAO,GAAG,gCAAgC;AAAA,cAC1C,SAAS,GAAG,yFAAyF;AAAA,cACrG,WAAW;AAAA,YACZ,CAAC;AAAA,UACF;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEC,yBAAyB;AACxB,YAAM,KAAK;AACX,YAAM,eAAe;AAAA,QACpB;AAAA,UACC,WAAW;AAAA,UAAmB,WAAW;AAAA,UACzC,cAAc;AAAA,UAAG,OAAO;AAAA,UACxB,SAAS;AAAA,UAAmB,MAAM;AAAA,QACnC;AAAA,QACA;AAAA,UACC,WAAW;AAAA,UAAkB,WAAW;AAAA,UACxC,cAAc;AAAA,UAAG,OAAO;AAAA,UACxB,SAAS;AAAA,UACT,QAAQ,WAAY;AACnB,mBAAO,YAAY,gBAAgB,GAAG,KAAK,KAAK,OAAK;AACpD,kBAAI,EAAE,OAAO,KAAK,IAAI,KAAK;AAC1B,kBAAE,iBAAiB,KAAK;AACxB,uBAAO,YAAY,gBAAgB,KAAK,QAAQ;AAChD,uBAAO;AAAA,cACR;AAAA,YACD,CAAC;AAAA,UACF;AAAA,QACD;AAAA,MACD;AACA,YAAM,4BAA4B,MAAM;AACvC,cAAM,cAAc,OAAO,YAAY,YAAY,UAAU;AAC7D,YAAI,CAAC;AAAa;AAClB,eAAO,GAAG,QAAQ,eAAe,WAAW,EAAE,KAAK,CAAC,EAAE,SAAS,MAAM;AACpE,iBAAO,YAAY,gBAAgB,GAAG,OAAO,CAAC;AAC9C,mBAAS,QAAQ,SAAO;AACvB,kBAAM,EAAE,gBAAgB,IAAI;AAC5B,mBAAO,YAAY,gBAAgB,GAAG,KAAK,KAAK,EAAE,iBAAiB,gBAAgB,IAAI,CAAC;AAAA,UACzF,CAAC;AACD,iBAAO,YAAY,gBAAgB,KAAK,QAAQ;AAAA,QACjD,CAAC;AAAA,MACF;AACA,YAAM,SAAS,IAAI,OAAO,GAAG,OAAO;AAAA,QACnC,OAAO,GAAG,0BAA0B;AAAA,QACpC,QAAQ;AAAA,QACR,QAAQ;AAAA,UACP;AAAA,YACC,WAAW;AAAA,YAAQ,OAAO,GAAG,SAAS;AAAA,YAAG,SAAS,OAAO,SAAS,YAAY,SAAS;AAAA,YACvF,SAAS;AAAA,YAAW,WAAW;AAAA,YAAW,MAAM;AAAA,UACjD;AAAA,UACA;AAAA,YACC,WAAW;AAAA,YAAQ,OAAO,GAAG,aAAa;AAAA,YAC1C,SAAS;AAAA,YAAe,WAAW;AAAA,YAAe,MAAM;AAAA,YACxD,WAAW,MAAM,kBAAkB;AAAA,YACnC,UAAU,MAAM,0BAA0B;AAAA,UAC3C;AAAA,UACA;AAAA,YACC,WAAW;AAAA,YACX,WAAW;AAAA,YACX,OAAO;AAAA,YACP,iBAAiB;AAAA,YACjB,eAAe;AAAA,YACf,MAAM;AAAA,YACN,MAAM,CAAC;AAAA,YACP,QAAQ;AAAA,UACT;AAAA,QACD;AAAA,QACA,gBAAgB,eAAe,EAAE,SAAS,aAAa,gBAAgB,GAAG;AACzE,cAAI,CAAC,gBAAgB,QAAQ;AAC5B,mBAAO,WAAW;AAAA,cACjB,SAAS,GAAG,0DAA0D;AAAA,cACtE,WAAW;AAAA,YACZ,CAAC;AACD,mBAAO,OAAO,MAAM,WAAW,OAAO;AAAA,UACvC;AAGA,4BAAkB,gBAAgB,OAAO,OAAK,EAAE,eAAe;AAE/D,gBAAM,SAAS;AACf,gBAAM,MAAM,MAAM,OAAO,KAAK,EAAE,QAAQ,MAAM,EAAE,aAAa,SAAS,gBAAgB,GAAG,QAAO,KAAK,CAAC;AACtG,WAAC,IAAI,OAAO,GAAG,qBAAqB,IAAI,OAAO;AAC/C,iBAAO,KAAK;AAAA,QACb;AAAA,QACA,sBAAsB,GAAG,QAAQ;AAAA,MAClC,CAAC;AACD,aAAO,KAAK;AACZ,YAAM,oBAAoB,MAAM;AAC/B,eAAO;AAAA,UACN,OAAO;AAAA,UACP,SAAS,EAAE,SAAS,OAAO,YAAY,QAAQ,UAAU,EAAE;AAAA,QAC5D;AAAA,MACD;AAAA,IACD;AAAA,IAEA,MAAM,qBAAqB,MAAM;AAChC,WAAK,cAAc,KAAK;AACxB,WAAK,UAAU,KAAK;AACpB,WAAK,cAAc,KAAK;AACxB,WAAK,mBAAmB,KAAK;AAC7B,WAAK,iBAAiB,CAAC;AACvB,WAAK,WAAW,CAAC;AACjB,aAAO,sBAAsB,KAAK;AAClC,aAAO,GAAG,UAAU,kBAAkB,QAAW,sBAAsB,EAAE,KAAK,CAAC,EAAE,QAAQ,MAAM;AAC9F,aAAK,uBAAuB,IAAI,QAAQ,oBAAoB,KAAK;AAAA,MAClE,CAAC;AAED,aAAO,KAAK;AAAA,QACX,QAAQ;AAAA,QACR,MAAM,EAAE,eAAe,KAAK,YAAY;AAAA,QACxC,UAAU,CAAC,QAAQ;AAClB,gBAAM,UAAU,IAAI;AAEpB,iBAAO,OAAO,KAAK,UAAU,OAAO;AACpC,eAAK,SAAS,kBAAkB,QAAQ,gBAAgB,IAAI,WAAS,MAAM,IAAI;AAE/E,eAAK,SAAS;AAAA,QACf;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,2BAA2B;AAC1B,WAAK,KAAK;AAAA,QACT;AAAA,8DAC2D,KAAK;AAAA,iBAClD,OAAO,KAAK,gBAAgB,EAAE,OAAO,gBAAgB;AAAA;AAAA;AAAA,MAE3D;AAAA,IACV;AAAA,IAEA,WAAW;AACV,WAAK,YAAY;AACjB,WAAK,oBAAoB;AAAA,IAC1B;AAAA,IAEA,sBAAsB;AAErB,UAAI,CAAC,KAAK,mBAAmB;AAC5B,aAAK,uBAAuB;AAAA,MAC7B;AACA,WAAK,iBAAiB,IAAI,QAAQ,YAAY,cAAc;AAAA,QAC3D,SAAS,KAAK;AAAA,QACd,QAAQ;AAAA,UACP,gBAAgB,CAAC,UAAU;AAC1B,iBAAK,iBAAiB;AACtB,iBAAK,eAAe;AAAA,UACrB;AAAA,UACA,qBAAqB,MAAM;AAC1B,iBAAK,oBAAoB;AAAA,UAC1B;AAAA,QACD;AAAA,QACA,aAAa,KAAK;AAAA,MACnB,CAAC;AAAA,IACF;AAAA,IAEA,iBAAiB;AAEhB,WAAK,oBAAoB,MAAM;AAE/B,WAAK,mBAAmB;AACxB,WAAK,aAAa;AAClB,WAAK,iBAAiB;AAAA,IACvB;AAAA,IAEA,cAAc;AACb,WAAK,QAAQ;AAAA,QACZ;AAAA,MACD;AAEA,WAAK,sBAAsB,KAAK,QAAQ,KAAK,oBAAoB;AAAA,IAClE;AAAA,IAEA,qBAAqB;AACpB,WAAK,mBAAmB;AACxB,WAAK,kBAAkB;AACvB,WAAK,eAAe;AACpB,WAAK,cAAc;AACnB,WAAK,uBAAuB;AAC5B,WAAK,mBAAmB;AAAA,IACzB;AAAA,IAEA,eAAe;AACd,WAAK,KAAK,WAAW;AACrB,UAAG,KAAK,SAAS,4BAA2B;AAC3C,aAAK,KAAK,cAAc,GAAG,gBAAgB,GAAG,KAAK,eAAe,KAAK,IAAI,GAAG,OAAO,QAAQ;AAAA,MAC9F;AACA,UAAG,KAAK,SAAS,kCAAkC;AAClD,aAAK,KAAK,cAAc,GAAG,sBAAsB,GAAG,KAAK,oBAAoB,KAAK,IAAI,GAAG,OAAO,QAAQ;AAAA,MACzG;AACA,UAAG,KAAK,SAAS,2BAA2B;AAC3C,aAAK,KAAK,cAAc,GAAG,eAAe,GAAG,KAAK,mBAAmB,KAAK,IAAI,GAAG,OAAO,QAAQ;AAAA,MACjG;AACA,UAAG,KAAK,SAAS,6BAA6B,CAAC,OAAO,WAAW,SAAS,QAAQ,GAAG;AACpF,aAAK,KAAK,cAAc,GAAG,eAAe,GAAG,KAAK,UAAU,KAAK,IAAI,GAAG,OAAO,cAAc;AAAA,MAC9F;AAAA,IACD;AAAA,IAEA,iBAAiB;AAChB,aAAO,MAAM,KAAK,KAAK,IAAI,GAAG;AAC9B,aAAO,UAAU,QAAQ,KAAK,IAAI,IAAI,SAAS,KAAK,IAAI,IAAI,IAAI;AAAA,IACjE;AAAA,IAED,yBAAyB;AACrB,aAAO,KAAK,yBAAyB,IAAI;AAAA,IAC7C;AAAA,IAEA,sBAAsB;AAClB,YAAM,OAAO,KAAK,kBAAkB,WAAW,GAAG,SAAS;AAC3D,aAAO,KAAK,yBAAyB,IAAI;AAAA,IAC7C;AAAA,IAEA,qBAAqB;AACjB,UAAI,CAAC,KAAK,oBAAoB,GAAG,UAAU,GAAG;AAC1C,eAAO,WAAW;AAAA,UACd,SAAS,GAAG,+BAA+B;AAAA,UAC3C,WAAW;AAAA,QACf,CAAC;AACD,eAAO,IAAI,SAAS;AACpB,eAAO,QAAQ,OAAO,IAAI,MAAM,8BAA8B,CAAC;AAAA,MACnE;AACA,YAAM,MAAM,KAAK;AACjB,UAAI,CAAC,KAAK;AACN,eAAO,WAAW;AAAA,UACd,SAAS,GAAG,yCAAyC;AAAA,UACrD,WAAW;AAAA,QACf,CAAC;AACD,eAAO,IAAI,SAAS;AACpB,eAAO,QAAQ,OAAO,IAAI,MAAM,sBAAsB,CAAC;AAAA,MAC3D;AACA,UAAI,CAAC,IAAI,IAAI,MAAM,QAAQ;AACvB,eAAO,WAAW;AAAA,UACd,SAAS,GAAG,qDAAqD;AAAA,UACjE,WAAW;AAAA,QACf,CAAC;AACD,eAAO,MAAM,WAAW,OAAO;AAC/B,eAAO,IAAI,SAAS;AACpB,eAAO,QAAQ,OAAO,IAAI,MAAM,qBAAqB,CAAC;AAAA,MAC1D;AACA,UAAI,CAAC,IAAI,IAAI,aAAa;AACtB,eAAO,WAAW;AAAA,UACd,SAAS,GAAG,2CAA2C;AAAA,UACvD,WAAW;AAAA,QACf,CAAC;AACD,eAAO,IAAI,SAAS;AACpB,eAAO,QAAQ,OAAO,IAAI,MAAM,sBAAsB,CAAC;AAAA,MAC3D;AACA,UAAI,CAAC,IAAI,IAAI,UAAU;AACnB,eAAO,WAAW;AAAA,UACd,SAAS,GAAG,wCAAwC;AAAA,UACpD,WAAW;AAAA,QACf,CAAC;AACD,eAAO,IAAI,SAAS;AACpB,eAAO,QAAQ,OAAO,IAAI,MAAM,mBAAmB,CAAC;AAAA,MACxD;AACA,cAAQ,IAAI,0BAA0B,IAAI,GAAG;AAC7C,aAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACpC,eAAO,KAAK;AAAA,UACR,QAAQ;AAAA,UACR,MAAM;AAAA,YACF,KAAK;AAAA,cACD,MAAM,IAAI,IAAI;AAAA,cACd,UAAU,IAAI,IAAI;AAAA,cAClB,OAAO,IAAI,IAAI,MAAM,IAAI,WAAS;AAAA,gBAC9B,WAAW,KAAK;AAAA,gBAChB,KAAK,KAAK;AAAA,gBACV,MAAM,KAAK;AAAA,gBACX,KAAK,KAAK;AAAA,gBACV,WAAW,KAAK;AAAA,gBAChB,WAAW,KAAK;AAAA,gBAChB,UAAU,KAAK;AAAA,cACnB,EAAE;AAAA,cACF,iBAAiB,IAAI,IAAI,mBAAmB,OAAO,QAAQ;AAAA,cAC3D,aAAa,IAAI,IAAI;AAAA,cACrB,SAAS,IAAI,IAAI;AAAA,YACrB;AAAA,UACJ;AAAA,UACA,UAAU,CAAC,MAAM;AACb,oBAAQ,IAAI,wBAAwB,CAAC;AACrC,mBAAO,IAAI,SAAS;AACpB,gBAAI,EAAE,KAAK;AACP,kBAAI,YAAY,EAAE;AAClB,kBAAI;AACA,sBAAM,MAAM,KAAK,MAAM,EAAE,GAAG;AAC5B,4BAAY,IAAI,kBAAkB,IAAI,WAAW,EAAE;AAAA,cACvD,SAAS,GAAP;AAAA,cAEF;AACA,qBAAO,WAAW;AAAA,gBACd,SAAS,GAAG,uBAAuB,WAAW;AAAA,gBAC9C,WAAW;AAAA,cACf,CAAC;AACD,qBAAO,MAAM,WAAW,OAAO;AAC/B,qBAAO,IAAI,MAAM,SAAS,CAAC;AAC3B;AAAA,YACJ;AACA,gBAAI,EAAE,SAAS;AACX,qBAAO,WAAW;AAAA,gBACd,SAAS,GAAG,kCAAkC;AAAA,gBAC9C,WAAW;AAAA,cACf,CAAC;AAED,kBAAI,IAAI,OAAO,EAAE,QAAQ,QAAQ,IAAI,IAAI;AACzC,kBAAI,IAAI,kBAAkB,EAAE,QAAQ,mBAAmB,IAAI,IAAI;AAC/D,sBAAQ;AAAA,gBACJ,cAAc,IAAI,IAAI;AAAA,gBACtB,iBAAiB,IAAI,IAAI;AAAA,cAC7B,CAAC;AAED,kBAAI,CAAC,EAAE,QAAQ,WAAW;AACtB,uBAAO,aAAa;AAAA,kBAChB,MAAM,OAAO,IAAI,OAAO;AAAA,kBACxB,MAAM,KAAK,iBAAiB,IAAI;AAAA,kBAChC,MAAM,OAAO,IAAI,SAAS;AAAA,gBAC9B,CAAC;AAAA,cACL;AAAA,YACJ;AAAA,UACJ;AAAA,UACA,OAAO,CAAC,KAAK,QAAQ,UAAU;AAC3B,oBAAQ,MAAM,0BAA0B,QAAQ,KAAK;AACrD,mBAAO,IAAI,SAAS;AACpB,mBAAO,WAAW;AAAA,cACd,SAAS,GAAG,wEAAwE;AAAA,cACpF,WAAW;AAAA,YACf,CAAC;AACD,mBAAO,MAAM,WAAW,OAAO;AAC/B,mBAAO,IAAI,MAAM,2BAA2B,KAAK,CAAC;AAAA,UACtD;AAAA,QACJ,CAAC;AAAA,MACL,CAAC;AAAA,IACL;AAAA,IAEC,YAAY;AACX,UAAI,CAAC,KAAK,oBAAoB,GAAG,UAAU;AAAG;AAE9C,UAAI,UAAU,OAAO,MAAM,YAAY,mBAAmB;AAC1D,cAAQ,cAAc,KAAK,IAAI,IAAI;AACnC,cAAQ,OAAO,OAAO,QAAQ;AAC9B,cAAQ,UAAU,KAAK,IAAI,IAAI;AAC/B,cAAQ,oBAAoB,KAAK;AACjC,cAAQ,kBAAkB,OAAO,SAAS,aAAa;AACvD,cAAQ,eAAe,OAAO,SAAS,SAAS;AAChD,cAAQ,eAAe,OAAO,SAAS,SAAS;AAChD,aAAO,UAAU,QAAQ,qBAAqB,QAAQ,IAAI;AAAA,IAC3D;AAAA,IAEA,qBAAqB;AACpB,UAAG,KAAK,KAAI;AACZ,aAAK,IAAI,IAAI,gBAAgB,KAAK,SAAS;AAAA,MAC3C;AACA,WAAK,gBAAgB,IAAI,QAAQ,YAAY,aAAa;AAAA,QACzD,SAAS,KAAK;AAAA,QACd,aAAa,KAAK;AAAA,QAClB,UAAU,KAAK;AAAA,QACf,eAAe,KAAK;AAAA,QACpB,UAAU,KAAK,SAAS;AAAA,QACxB,QAAQ;AAAA,UACP,qBAAqB,MAAM,KAAK,oBAAoB;AAAA,UACpD,eAAe,UAAQ,KAAK,eAAe,IAAI;AAAA,UAE/C,gBAAgB,MAAM,KAAK,eAAe;AAAA,UAC1C,mBAAmB,MAAM,KAAK,kBAAkB;AAAA,UAChD,cAAc,CAAC,SAAS,KAAK,aAAa,IAAI;AAAA,UAC9C,SAAS,MAAM,KAAK,OAAO,CAAC;AAAA,QAC7B;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IACA,aAAa,OAAM;AAClB,UAAI,KAAK;AACT,WAAK,MAAM;AACX,WAAK,KAAK,aAAa;AAAA,IAcxB;AAAA,IAID,iBAAiB;AACb,WAAK,OAAO,IAAI,QAAQ,YAAY,SAAS;AAAA,QACzC,SAAS,KAAK;AAAA,QACd,UAAU,KAAK;AAAA,QACf,QAAQ;AAAA,UACJ,SAAS,MAAM,KAAK;AAAA,UACpB,mBAAmB,CAAC,SAAS;AACrC,gBAAI,OAAO,WAAW,SAAS,QAAQ,GAAG;AAAA,YAC1C,OAAK;AAEO,oBAAM,WAAW,KAAK,IAAI,IAAI,MAAM,KAAK,OAAK,EAAE,SAAS,KAAK,IAAI;AAClE,kBAAI,UAAU;AAEV,oBAAI,CAAC,KAAK,aAAa,WAAW,GAAG,UAAU,GAAG;AAC9C,uBAAK,aAAa,iBAAiB,IAAI;AAAA,gBAC3C;AAEA,qBAAK,aAAa,4BAA4B,QAAQ;AAEtD,gCAAgB;AAGhB,qBAAK,cAAc,gBAAgB,IAAI;AACvC,qBAAK,KAAK,cAAc,IAAI;AAAA,cAChC;AAAA,YAAC;AAAA,UACL;AAAA,UACA,cAAc,CAAC,OAAO,WAAW,KAAK,kBAAkB,OAAO,MAAM;AAAA,UACrE,UAAU,MAAM,KAAK,kBAAkB;AAAA,UACvC,WAAW,MAAM,KAAK,QAAQ,UAAU;AAAA,UACxC,oBAAoB,MAAM,KAAK,mBAAmB;AAAA,UAClD,qBAAqB,MAAM,KAAK,oBAAoB;AAAA,UACpD,wBAAwB,MAAM,KAAK,uBAAuB;AAAA,UAC1D,0BAA0B,CAAC,YAAY;AAAA,UAAuC;AAAA,UAC9E,kBAAkB,CAAC,cAAc,KAAK,iBAAiB,SAAS;AAAA,QACpE;AAAA,MACJ,CAAC;AAAA,IACL;AAAA,IACC,oBAAoB;AACnB,WAAK,eAAe,IAAI,QAAQ,YAAY,YAAY;AAAA,QACvD,SAAS,KAAK;AAAA,QACd,UAAU,KAAK;AAAA,QACf,QAAQ;AAAA,UACP,SAAS,MAAM,KAAK;AAAA,UAEpB,sBAAsB,CAAC,aAAa;AACnC,iBAAK,cAAc,gBAAgB,QAAQ;AAC3C,iBAAK,KAAK,cAAc,QAAQ;AAAA,UACjC;AAAA,UAEA,cAAc,CAAC,MAAM,OAAO,UAAU;AACrC,kBAAM,WAAW,OAAO,MAAM,QAAQ,KAAK,SAAS,KAAK,IAAI;AAC7D,gBAAI,YAAY,SAAS,UAAU,OAAO;AACzC,oBAAM,OAAO;AAAA,gBACZ;AAAA,gBACA;AAAA,gBACA,MAAM,KAAK,aAAa;AAAA,cACzB;AACA,qBAAO,KAAK,eAAe,IAAI;AAAA,YAChC;AAEA,mBAAO,QAAQ,QAAQ;AAAA,UACxB;AAAA,UAEA,qBAAqB,CAAC,SAAS;AAC9B,kBAAM,YAAY,KAAK,KAAK,cAAc,IAAI;AAC9C,iBAAK,KAAK,sBAAsB,SAAS;AAAA,UAC1C;AAAA,UAEA,oBAAoB,CAAC,cAAc;AAClC,iBAAK,KAAK,yBAAyB,SAAS;AAAA,UAC7C;AAAA,UACA,gCAAgC,CAAC,UAAU,UAAU;AACpD,iBAAK,KAAK,mCAAmC,UAAU,OAAO,KAAK,aAAa,YAAY;AAAA,UAC7F;AAAA,UACA,6BAA6B,CAAC,kBAAkB,SAAS;AAGxD,mBAAO,KAAK,gBAAgB,EAAE,QAAQ,WAAS;AAC9C,oBAAM,gBAAgB,KAAK,IAAI,IAAI,MAAM,KAAK,OAAK,EAAE,QAAQ,KAAK,IAAI;AACtE,oBAAM,UAAU,KAAK,IAAI,UAAU,SAAS,mBAAK,cAAe;AAEhE,sBAAQ,WAAW;AACnB,sBAAQ,YAAY,iBAAiB,OAAO,KAAK;AAAA,CAAI;AACrD,sBAAQ,MAAM,iBAAiB,OAAO;AACtC,mBAAK,IAAI,IAAI,MAAM,QAAQ,SAAO;AACjC,oBAAI,KAAK,cAAc,IAAI,WAAW;AACrC,uBAAK,iBAAiB,GAAG;AAAA,gBAC1B;AAAA,cACD,CAAC;AAAA,YACF,CAAC;AAAA,UACF;AAAA,UACA,uBAAuB,MAAM,KAAK,sBAAsB;AAAA,UACxD,oBAAoB,MAAM,KAAK;AAAA,UAC/B,oBAAoB,MAAM;AACzB,4BAAgB;AAChB,iBAAK,aAAa,4BAA4B,IAAI;AAClD,iBAAK,KAAK,cAAc;AACxB,iBAAK,KAAK,sBAAsB;AAAA,UACjC;AAAA,UACA,qBAAqB,CAAC,WAAW,cAAc,KAAK,oBAAoB,WAAW,SAAS;AAAA,QAC7F;AAAA,MACD,CAAC;AACD,UAAG,eAAc;AAChB,aAAK,aAAa,4BAA4B,aAAa;AAAA,MAC5D;AAAA,IACD;AAAA,IAEA,gBAAgB;AACf,WAAK,UAAU,IAAI,QAAQ,YAAY,QAAQ;AAAA,QAC9C,SAAS,KAAK;AAAA,QACd,QAAQ;AAAA,UACP,SAAS,MAAM,KAAK,OAAO,CAAC;AAAA,UAE5B,sBAAsB,MAAM,KAAK,oBAAoB,CAAC;AAAA,UAEtD,uBAAuB,CAAC,SAAS;AAChC,gBAAI,MAAM;AACT,mBAAK,aAAa,WAAW,GAAG,UAAU,IAAI,KAAK,aAAa,WAAW,IAAI,WAAW,MAAM,IAAI;AACpG,mBAAK,cAAc,iBAAiB,KAAK;AAAA,YAC1C,OAAO;AACN,mBAAK,cAAc,iBAAiB,IAAI;AAAA,YACzC;AAAA,UACD;AAAA,UAEA,gBAAgB,MAAM;AACrB,iBAAK,IAAI,WAAW,EAClB,KAAK,CAAC,MAAM;AACZ,mBAAK,kBAAkB,KAAK;AAC5B,mBAAK,cAAc,iBAAiB,IAAI;AACxC,mBAAK,cAAc,gBAAgB,KAAK,IAAI,KAAK,IAAI;AACrD,qBAAO,WAAW;AAAA,gBACjB,WAAW;AAAA,gBACX,SAAS,GAAG,yCAAyC,CAAC,EAAE,IAAI,IAAI,CAAC;AAAA,cAClE,CAAC;AAAA,YACF,CAAC;AAAA,UACH;AAAA,UACA,oBAAoB,MAAM;AAC1B,iBAAK,kBAAkB,KAAK;AACnB,iBAAK,kBAAkB,iBAAiB,IAAI;AAClD,iBAAK,cAAc,iBAAiB,IAAI;AAAA,UACvC;AAAA,QACL;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,yBAAyB;AACxB,WAAK,oBAAoB,IAAI,QAAQ,YAAY,cAAc;AAAA,QAC9D,SAAS,KAAK;AAAA,QACd,QAAQ;AAAA,UACP,mBAAmB,CAAC,SAAS;AAC5B,mBAAO,GAAG,QAAQ,iBAAiB,IAAI,EAAE,KAAK,CAAC,QAAQ;AACtD,mBAAK,cAAc,gBAAgB,GAAG;AAAA,YACvC,CAAC;AAAA,UACF;AAAA,UACA,eAAe,MAAM,KAAK,cAAc,2BAA2B,IAAI;AAAA,UACvE,iBAAiB,MAAM;AACtB,iBAAK,kBAAkB,iBAAiB,KAAK;AAC7C,iBAAK,KAAK,aAAa;AACvB,iBAAK,cAAc,iBAAiB,IAAI;AACxC,iBAAK,QAAQ,KAAK,qBAAqB,EAAE,IAAI,WAAU,MAAM;AAAA,UAC9D;AAAA,QAED;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,qBAAqB;AACpB,WAAK,gBAAgB,IAAI,QAAQ,YAAY,iBAAiB;AAAA,QAC7D,SAAS,KAAK;AAAA,QACd,aAAa,KAAK;AAAA,QAClB,QAAQ;AAAA,UACP,SAAS,MAAM,KAAK;AAAA,UAEpB,gBAAgB,CAAC,SAAS;AACzB,iBAAK,kBAAkB,iBAAiB,KAAK;AAC7C,mBAAO,GAAG,QAAQ,iBAAiB,IAAI,EAAE,KAAK,CAAC,QAAQ;AACtD,qBAAO,aAAa;AAAA,gBACnB,MAAM,KAAK,oBAAoB,GAAG;AAAA,gBAClC,MAAM,KAAK,KAAK,aAAa;AAAA,gBAC7B,MAAM,KAAK,cAAc,iBAAiB,IAAI;AAAA,cAC/C,CAAC;AAAA,YACF,CAAC;AAAA,UACF;AAAA,UACA,YAAY,CAAC,SAAS;AACrB,iBAAK,eAAe,iBAAiB,KAAK;AAC1C,iBAAK,kBAAkB,iBAAiB,KAAK;AAC7C,mBAAO,aAAa;AAAA,cACnB,MAAM,KAAK,IAAI,QAAQ,IAAI;AAAA,cAC3B,MAAM,KAAK,IAAI,KAAK,wBAAwB;AAAA,cAC5C,MAAM,KAAK,KAAK,aAAa;AAAA,cAC7B,MAAM,KAAK,cAAc,iBAAiB,IAAI;AAAA,YAC/C,CAAC;AAAA,UACF;AAAA,UACA,cAAc,CAAC,SAAS;AACvB,mBAAO,MAAM,WAAW,KAAK,IAAI,IAAI,SAAS,MAAM,MAAM;AACzD,mBAAK,kBAAkB,aAAa;AAAA,YACrC,CAAC;AAAA,UACF;AAAA,UACA,WAAW,MAAM;AAChB,mBAAO,aAAa;AAAA,cACnB,MAAM,OAAO,IAAI,OAAO;AAAA,cACxB,MAAM,KAAK,iBAAiB;AAAA,cAC5B,MAAM,KAAK,eAAe,iBAAiB,IAAI;AAAA,cAC/C,MAAM,OAAO,IAAI,SAAS;AAAA,YAC3B,CAAC;AAAA,UACF;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,yBAAyB,MAAM;AAC5B,WAAK,kBAAkB,CAAC,IAAI;AAC5B,WAAK,kBAAkB,iBAAiB,IAAI;AAC5C,WAAK,cAAc,iBAAiB,IAAI;AAGxC,aAAO,QAAQ,QAAQ;AAAA,IAC3B;AAAA,IAEC,kBAAkB,MAAM;AACvB,WAAK,KAAK,iBAAiB,IAAI;AAC/B,WAAK,cAAc,iBAAiB,IAAI;AACxC,UAAI,KAAK,gBAAgB;AACxB,aAAK,eAAe,iBAAiB,CAAC,IAAI;AAAA,MAC3C;AAGA,OAAC,OAAQ,KAAK,aAAa,iBAAiB,KAAK,KAAK,KAAK,QAAQ,iBAAiB,KAAK,IAAK;AAAA,IAC/F;AAAA,IAED,iBAAiB,YAAY,OAAO;AAChC,YAAM,QAAQ;AAAA,QACV,MAAM,OAAO,IAAI,OAAO;AAAA,QACxB,MAAM,KAAK,uBAAuB;AAAA,QAClC,MAAM,KAAK,qBAAqB;AAAA,QAChC,MAAM,KAAK,uBAAuB;AAAA,QAClC,MAAM,KAAK,KAAK,aAAa;AAAA,QAC7B,MAAM,OAAO,IAAI,SAAS;AAAA,MAC9B;AACA,UAAI,WAAW;AAEX,cAAM,KAAK,MAAM,KAAK,kBAAkB,KAAK,CAAC;AAC9C,cAAM,KAAK,MAAM,KAAK,kBAAkB,iBAAiB,IAAI,CAAC;AAC9D,cAAM,KAAK,MAAM,KAAK,cAAc,iBAAiB,IAAI,CAAC;AAAA,MAC9D;AACA,aAAO,OAAO,aAAa,KAAK;AAAA,IACpC;AAAA,IAEC,yBAAyB;AACxB,YAAM,UAAU;AAChB,aAAO,IAAI,QAAQ,aAAW;AAC7B,YAAI,KAAK,KAAK;AACb,eAAK,MAAM,KAAK,YAAY,KAAK,GAAG;AACpC,eAAK,IAAI,IAAI,QAAQ,CAAC;AACtB,eAAK,IAAI,IAAI,SAAS;AACtB,eAAK,IAAI,IAAI,gBAAgB,KAAK,SAAS;AAC3C,cAAI,KAAK,kBAAkB,CAAC,KAAK,IAAI,IAAI,WAAW;AACnD,iBAAK,IAAI,IAAI,YAAY,KAAK;AAAA,UAC/B;AACA,kBAAQ;AAAA,QACT,OAAO;AACN,iBAAO,MAAM,aAAa,SAAS,MAAM;AACxC,iBAAK,MAAM,KAAK,YAAY;AAC5B,iBAAK,IAAI,IAAI,QAAQ,CAAC;AACtB,iBAAK,IAAI,IAAI,SAAS;AACtB,iBAAK,IAAI,IAAI,gBAAgB,KAAK,SAAS;AAC3C,gBAAI,KAAK,kBAAkB,CAAC,KAAK,IAAI,IAAI,WAAW;AACnD,mBAAK,IAAI,IAAI,YAAY,KAAK;AAAA,YAC/B;AACA,oBAAQ,IAAI,aAAa;AACzB,oBAAQ,IAAI,KAAK,IAAI,GAAG;AACxB,oBAAQ;AAAA,UACT,CAAC;AAAA,QACF;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,YAAY,MAAM;AACjB,YAAM,UAAU;AAChB,YAAM,OAAO,EAAE,OAAO;AACtB,YAAM,MAAM,QAAQ,IAAI,OAAO,GAAG,KAAK,KAAK,SAAS,MAAM,KAAK;AAChE,YAAM,OAAO,OAAO,MAAM,0BAA0B,SAAS,IAAI;AACjE,UAAI,QAAQ,IAAI;AAEhB,aAAO;AAAA,IACR;AAAA,IAEA,MAAM,oBAAoB,KAAK;AAC9B,aAAO,IAAI,OAAO;AAClB,WAAK,MAAM,KAAK,YAAY,KAAK,GAAG;AACpC,WAAK,IAAI,IAAI,QAAQ,CAAC;AACtB,aAAO,OAAO,KAAK;AAAA,QAClB,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,eAAe,IAAI;AAAA,UACnB,cAAc,KAAK,IAAI;AAAA,QACxB;AAAA,QACA,UAAU,CAAC,MAAM;AAEhB,iBAAO,MAAM,KAAK,EAAE,OAAO;AAC3B,iBAAO,QAAQ,EAAE,QAAQ,SAAS,EAAE,QAAQ,IAAI,EAAE,sBAAsB;AACxE,eAAK,qBAAqB,EAAE,KAAK,MAAM;AACtC,mBAAO,IAAI,SAAS;AAAA,UACrB,CAAC;AAAA,QACF;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,uBAAuB;AACtB,UAAI,KAAK,WAAW,CAAC,KAAK,IAAI,IAAI;AAAS,aAAK,IAAI,IAAI,UAAU,KAAK;AACvE,WAAK,KAAK,eAAe,CAAC,KAAK,IAAI,IAAI,gBAAgB,KAAK,IAAI,IAAI,aAAa,KAAK,eAAe,KAAK,IAAI,IAAI,cAAc;AAC/H,aAAK,IAAI,IAAI,cAAc,KAAK;AAAA,MACjC;AAEA,UAAI,CAAC,KAAK,IAAI,IAAI;AAAS;AAE3B,aAAO,KAAK,IAAI,QAAQ,cAAc;AAAA,IACvC;AAAA,IAEA,yBAAyB;AACxB,WAAK,KAAK,cAAc,KAAK,aAAa,MAAM;AAAA,IACjD;AAAA,IAED,MAAM,eAAe,MAAM;AAEvB,UAAI,WAAW;AACf,UAAI;AACA,YAAI,EAAE,OAAO,OAAO,KAAK,IAAI;AAC7B,mBAAW,KAAK,kBAAkB,IAAI;AACtC,cAAM,kBAAkB,CAAC,EAAE,cAAc,QAAQ;AAEjD,cAAM,gBAAgB,UAAU,SAAS,UAAU;AACnD,YAAI;AACA,kBAAQ,IAAI,SAAS,SAAS,IAAI,IAAI,KAAK;AAE/C,YAAI,iBAAiB;AACjB,cAAI,UAAU;AACV,oBAAQ,IAAI,KAAK;AAErB,cAAI,CAAC,OAAO,mBAAmB,EAAE,SAAS,KAAK,KAAK,QAAQ,KAAK,CAAC,KAAK,sBAAsB;AACzF,kBAAM,aAAa,UAAU,QAAQ,QAAQ,SAAS,oBAAoB,SAAS,MAAM;AACzF,kBAAM,KAAK,yBAAyB,UAAU,YAAY,KAAK,IAAI,IAAI,aAAa;AAAA,UACxF;AAEA,cAAI,KAAK,6BAA6B,QAAQ,KAAK,eAAe;AAC9D,kBAAM,OAAO,MAAM,UAAU,SAAS,SAAS,SAAS,MAAM,OAAO,KAAK;AAC1E,iBAAK,iBAAiB,QAAQ;AAAA,UAClC;AAAA,QAEJ,OAAO;AACH,cAAI,CAAC,KAAK,IAAI,IAAI,YAAY,CAAC,KAAK,SAAS,qCAAoC;AAC7E,mBAAO,KAAK,+BAA+B;AAAA,UAC/C;AACA,iBAAO,MAAM,kCAAkC;AAC/C,gBAAM,EAAE,WAAW,UAAU,WAAW,MAAM,IAAI,IAAI;AAEtD,cAAI,CAAC;AACD;AAEJ,gBAAM,WAAW,EAAE,WAAW,UAAU,MAAM,KAAK,CAAC,QAAQ,MAAM;AAClE,cAAG,OAAM;AACL,qBAAS,SAAS;AAAA,UACtB;AACA,cAAI,WAAW;AACX,kBAAM,KAAK,6BAA6B,WAAW,KAAK,IAAI,IAAI,eAAe,SAAS;AACxF,qBAAS,eAAe;AAAA,UAC5B;AAEA,cAAI,UAAU;AACV,qBAAS,SAAS,MAAM,MAAM;AAAA,CAAI,EAAE,UAAU;AAElD,qBAAW,KAAK,IAAI,UAAU,SAAS,QAAQ;AAE/C,cAAI,UAAU,SAAS,UAAU,KAAK,CAAC,KAAK,sBAAsB;AAC9D,kBAAM,aAAa,QAAQ,SAAS;AACpC,kBAAM,KAAK,yBAAyB,UAAU,YAAY,KAAK,IAAI,IAAI,aAAa;AAAA,UACxF;AAEA,gBAAM,KAAK,wBAAwB,QAAQ;AAC3C,eAAK,iBAAiB,QAAQ;AAE9B,cAAI,KAAK,aAAa,WAAW,GAAG,UAAU;AAC1C,iBAAK,qBAAqB,QAAQ;AAEtC,cAAI,KAAK,oCAAoC,QAAQ,KAAK,CAAC,KAAK,aAAa,WAAW,GAAG,UAAU;AACjG,iBAAK,qBAAqB,QAAQ;AAAA,QAC1C;AAAA,MAEJ,SAAS,OAAP;AACE,gBAAQ,IAAI,KAAK;AAAA,MACrB,UAAE;AAEE,eAAO;AAAA,MACX;AAAA,IACJ;AAAA,IAEC,iCAAiC;AAChC,aAAO,IAAI,SAAS;AACpB,aAAO,WAAW;AAAA,QACjB,SAAS,GAAG,mDAAmD;AAAA,QAC/D,WAAW;AAAA,MACZ,CAAC;AACD,aAAO,MAAM,WAAW,OAAO;AAAA,IAChC;AAAA,IAED,kBAAkB,EAAE,MAAM,WAAW,UAAU,KAAK,KAAK,GAAG;AACxD,UAAI,WAAW;AAEf,UAAI,MAAM;AACN,mBAAW,KAAK,IAAI,IAAI,MAAM,KAAK,OAAK,EAAE,QAAQ,IAAI;AAAA,MAC1D,OAAO;AAEH,mBAAW,KAAK,IAAI,IAAI,MAAM,KAAK,OAAK;AACpC,gBAAM,cAAc,EAAE,cAAc,aAChB,EAAE,QAAQ,OACV,EAAE,SAAS,IAAI,IAAI;AAEvC,cAAI,CAAC;AAAa,mBAAO;AAEzB,gBAAM,iBAAiB,EAAE;AACzB,gBAAM,qBAAsB,YAAY,aAAa,UAAU,aAAa;AAE5E,cAAI,kBAAkB,oBAAoB;AACtC,mBAAO,EAAE,aAAa;AAAA,UAC1B,WAAW,CAAC,kBAAkB,CAAC,oBAAoB;AAC/C,mBAAO;AAAA,UACX,OAAO;AACH,mBAAO;AAAA,UACX;AAAA,QACJ,CAAC;AAAA,MACL;AACA,aAAO,YAAY,CAAC;AAAA,IACxB;AAAA,IAEC,qBAAqB,UAAU;AAC9B,WAAK,aAAa,4BAA4B,QAAQ;AAAA,IACvD;AAAA,IAEA,6BAA6B,UAAU;AACtC,aAAO,SAAS,QAAQ,KAAK,aAAa,aAAa;AAAA,IACxD;AAAA,IAEA,iBAAiB,UAAU,aAAa;AACvC,WAAK,KAAK,iBAAiB,UAAU,WAAW;AAChD,WAAK,KAAK,sBAAsB,KAAK,GAAG;AAAA,IACzC;AAAA,IAEA,oCAAoC,UAAU;AAG7C,YAAM,aAAa,SAAS;AAC5B,YAAM,UAAU,SAAS;AACzB,YAAM,qBAAqB,CAAC,SAAS;AACrC,YAAM,oBAAoB,CAAC,SAAS;AAEpC,UAAK,cAAc,sBAAwB,WAAW,qBACpD,cAAc,YAAY,qBAAqB,qBAAsB;AACtE,eAAO;AAAA,MACR;AACA,aAAO;AAAA,IACR;AAAA,IAEA,MAAM,wBAAwB,UAAU;AACvC,YAAM,KAAK,IAAI,eAAe,QAAQ,aAAa,SAAS,SAAS,SAAS,IAAI;AAClF,YAAM,KAAK,IAAI,eAAe,QAAQ,OAAO,SAAS,SAAS,SAAS,IAAI;AAAA,IAC7E;AAAA,IAEA,MAAM,yBAAyB,UAAU,YAAY,WAAW;AAC7D,YAAM,QAAQ,MAAM,KAAK,oBAAoB,SAAS,WAAW,SAAS,GAAG;AAC7E,YAAM,gBAAgB,KAAK,GAAG,cAAc;AAC5C,YAAM,gBAAgB,KAAK;AAC9B,cAAQ,IAAI,UAAU;AAAA,QACf,WAAW,SAAS;AAAA,QACpB;AAAA,QACA;AAAA,QACA;AAAA,MACJ,CAAC;AAGD,cAAQ,IAAI,QAAQ;AACpB,YAAM,WAAW,SAAS,IAAI,KAAK;AACnC,YAAM,iBAAiB,SAAS,UAAU,KAAK;AAC/C,YAAM,iBAAiB,UAAU,KAAK;AACtC,YAAM,qBAAqB,cAAc,SAAS,EAAE,KAAK;AAEzD,UAAI,EAAE,gBAAgB,IAAI;AACtB,YAAI,eAAe;AACf,iBAAO,MAAM,UAAU,SAAS,SAAS,SAAS,IAAI;AACtD,iBAAO,MAAM;AAAA,YACT,OAAO,GAAG,eAAe;AAAA,YACzB,SAAS,GAAG,wDAAwD,CAAC,gBAAgB,cAAc,CAAC;AAAA,UACxG,CAAC;AAAA,QACL,OAAO;AACH;AAAA,QACJ;AAAA,MACJ,WAAW,iBAAiB,gBAAgB,YAAY;AACpD,eAAO,MAAM;AAAA,UACT,SAAS,GAAG,iGAAiG,CAAC,gBAAgB,gBAAgB,oBAAoB,QAAQ,CAAC;AAAA,UAC3K,WAAW;AAAA,QACf,CAAC;AACD,eAAO,MAAM,WAAW,OAAO;AAAA,MACnC;AAAA,IAEJ;AAAA,IAEC,MAAM,6BAA6B,WAAW,WAAW,WAAW;AACnE,YAAM,SAAS;AACf,YAAM,OAAO,EAAC,SAAS,EAAE,WAAW,UAAU,EAAC;AAC/C,YAAM,MAAM,MAAM,OAAO,KAAK,EAAE,QAAQ,KAAK,CAAC;AAE9C,UAAI,IAAI,QAAQ,SAAS,SAAS,GAAG;AACpC,eAAO,MAAM;AAAA,UACZ,OAAO,GAAG,eAAe;AAAA,UACzB,SAAS,GAAG,0EAA0E,CAAC,UAAU,KAAK,CAAC,CAAC;AAAA,QACzG,CAAC;AAAA,MACF;AAAA,IACD;AAAA,IAEA,oBAAoB,WAAW,WAAW;AACzC,YAAM,KAAK;AACX,aAAO,OAAO,KAAK;AAAA,QAClB,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,aAAa;AAAA,UACb,aAAa;AAAA,QACd;AAAA,QACA,SAAS,KAAK;AACb,cAAI,CAAC,GAAG,eAAe;AACtB,eAAG,eAAe,aAAa,CAAC;AACjC,aAAG,eAAe,WAAW,aAAa,IAAI;AAAA,QAC/C;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,kBAAkB,OAAO,iBAAiB;AACzC,UAAI,oBAAoB,YAAY;AACnC,aAAK,aAAa,4BAA4B,IAAI;AAAA,MACnD,WAAW,oBAAoB,UAAU;AACxC,aAAK,sBAAsB;AAAA,MAC5B,OAAO;AACN,cAAM,gBAAgB,KAAK,aAAa,GAAG;AAC3C,YAAI,CAAC;AAAe;AACpB,sBAAc,UAAU;AACxB,iBAAS,MAAM,cAAc,UAAU,KAAK;AAAA,MAC7C;AAAA,IACD;AAAA,IAEA,wBAAwB;AACvB,aAAO,IAAI,OAAO;AAClB,YAAM,EAAE,SAAS,MAAM,aAAa,IAAI,KAAK;AAE7C,aAAO,OAAO,MAAM,UAAU,SAAS,MAAM,OAAO,CAAC,EACnD,KAAK,MAAM;AACX,eAAO,MAAM,UAAU,SAAS,IAAI;AACpC,aAAK,iBAAiB,cAAc,IAAI;AACxC,aAAK,aAAa,4BAA4B,IAAI;AAClD,eAAO,IAAI,SAAS;AAAA,MACrB,CAAC,EACA,MAAM,OAAK,QAAQ,IAAI,CAAC,CAAC;AAAA,IAC5B;AAAA,IAEA,MAAM,oBAAoB;AACzB,UAAI,KAAK,IAAI,SAAS,GAAG;AACxB,YAAI,aAAa;AACjB,cAAM,KAAK,IAAI,KAAK,MAAM,MAAM,MAAM,MAAM,aAAa,IAAI;AAE7D,SAAC,cAAc,KAAK,QAAQ,SAAS;AAErC,sBAAc,WAAW,MAAM;AAC9B,eAAK,KAAK,oBAAoB,IAAI;AAAA,QACnC,GAAG,GAAG;AAAA,MACP,OAAO;AACN,aAAK,QAAQ,SAAS;AAAA,MACvB;AAAA,IACD;AAAA,EACD;;;AC3/BA,sBAAmB;AAFnB,SAAO,QAAQ,qBAAqB;AACpC,MAAI,OAAO;AAGX,UAAQ,YAAY,eAAe,MAAM;AAAA,IAExC,YAAY,EAAE,KAAK,SAAS,QAAQ,aAAa,UAAS,UAAS,gBAAe,cAAc,GAAG;AAClG,WAAK,UAAU;AACf,WAAK,SAAS;AACd,WAAK,WAAW;AAChB,WAAK,cAAc;AACnB,WAAK,cAAc,SAAS;AAC5B,WAAK,gBAAgB;AACrB,WAAK,gBAAgB,SAAS;AAC9B,UAAG,SAAS,qBAAoB;AAC/B,eAAO,SAAS;AAAA,MACjB;AACA,UAAG,SAAS,4BAA2B;AACtC,eAAO;AAAA,MACR;AACA,UAAG,SAAS,4BAA2B;AACtC,eAAO;AAAA,MACR;AACA,WAAK,wBAAwB,SAAS;AACtC,WAAK,sBAAsB,SAAS;AACpC,WAAK,sBAAsB,SAAS;AACpC,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,iBAAiB;AAEhB,WAAK,YAAY;AACjB,WAAK,gBAAgB;AACrB,WAAK,gBAAgB;AACrB,WAAK,YAAY;AACjB,WAAK,iBAAiB;AAAA,IACvB;AAAA,IAEA,cAAc;AACb,UAAG,SAAS,UAAU,CAAC,KAAK,qBAAoB;AAE/C,aAAK,QAAQ;AAAA,UACZ;AAAA;AAAA,gEAE4D,GAAG,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAS3E;AAEA,aAAK,aAAa,KAAK,QAAQ,KAAK,iBAAiB;AACrD,aAAK,mBAAmB,KAAK,WAAW,KAAK,kBAAkB;AAAA,MAChE,WAAU,SAAS,UAAU,CAAC,KAAK,qBAAqB;AAEvD,aAAK,QAAQ;AAAA,UACZ;AAAA;AAAA,gEAE4D,GAAG,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAS3E;AAEA,aAAK,aAAa,KAAK,QAAQ,KAAK,0BAA0B;AAC9D,aAAK,mBAAmB,KAAK,WAAW,KAAK,iBAAiB;AAAA,MAC/D;AAEA,WAAK,aAAa,KAAK,WAAW,KAAK,YAAY;AACnD,WAAK,aAAa,KAAK,WAAW,KAAK,YAAY;AACnD,UAAG,SAAS,UAAU,CAAC,KAAK,qBAAoB;AAC/C,aAAK,WAAW,KAAK,YAAY,EAAE,IAAI,EAAC,WAAW,gBAAe,oBAAoB,WAAU,SAAS,SAAQ,WAAW,YAAY,iBAAiB,QAAQ,aAAa,QAAO,eAAe,QAAQ,kBAAkB,aAAY,kBAAkB,OAAM,UAAU,WAAW,cAAc,6BAA4B,CAAC;AAClU,aAAK,WAAW,KAAK,YAAY,EAAE,IAAI,EAAC,WAAY,IAAG,oBAAoB,IAAG,SAAS,IAAG,WAAW,IAAI,iBAAiB,IAAI,aAAa,IAAG,eAAe,IAAI,kBAAkB,IAAG,kBAAkB,IAAG,UAAU,IAAI,cAAc,GAAE,CAAC;AAAA,MAC3O,WAAU,SAAS,UAAU,CAAC,KAAK,qBAAoB;AACtD,aAAK,WAAW,KAAK,YAAY,EAAE,IAAI,EAAC,WAAW,gBAAe,oBAAoB,WAAU,SAAS,SAAQ,WAAW,YAAY,iBAAiB,QAAQ,aAAa,QAAO,eAAe,QAAQ,kBAAkB,aAAY,kBAAkB,OAAM,UAAU,WAAW,cAAc,6BAA4B,CAAC;AAClU,aAAK,WAAW,KAAK,YAAY,EAAE,IAAI,EAAC,WAAY,IAAG,oBAAoB,IAAG,SAAS,IAAG,WAAW,IAAI,iBAAiB,IAAI,aAAa,IAAG,eAAe,IAAI,kBAAkB,IAAG,kBAAkB,IAAG,UAAU,IAAI,cAAc,GAAE,CAAC;AAAA,MAC3O,OAAO;AACN,aAAK,WAAW,KAAK,YAAY,EAAE,IAAI,EAAC,WAAW,OAAM,CAAC;AAC1D,aAAK,WAAW,KAAK,YAAY,EAAE,IAAI,EAAC,WAAY,OAAM,CAAC;AAAA,MAE5D;AACA,UAAG,CAAC,KAAK,uBAAuB,CAAC,KAAK,qBAAoB;AACzD,aAAK,gBAAgB;AAAA,MACtB;AAAA,IACD;AAAA,IACA,kBAAiB;AAChB,WAAK,WAAW,GAAG,SAAS,KAAK,MAAM;AAEtC,aAAK,WAAW,KAAK,YAAY,EAAE,IAAI,EAAC,WAAW,gBAAe,oBAAoB,WAAU,SAAS,SAAQ,WAAW,YAAY,iBAAiB,QAAQ,aAAa,QAAO,eAAe,QAAQ,kBAAkB,aAAY,kBAAkB,OAAM,UAAU,WAAW,cAAc,6BAA4B,CAAC;AAClU,aAAK,WAAW,KAAK,YAAY,EAAE,IAAI,EAAC,WAAW,IAAG,oBAAoB,IAAG,SAAS,IAAG,WAAW,IAAI,iBAAiB,IAAI,aAAa,IAAG,eAAe,IAAI,kBAAkB,IAAG,kBAAkB,IAAG,UAAU,IAAI,cAAc,GAAE,CAAC;AACzO,eAAO;AACP,YAAG,SAAS,eAAe,mBAAmB;AAAG,mBAAS,eAAe,mBAAmB,EAAE,OAAO;AACrG,YAAG,SAAS,eAAe,mBAAmB;AAAG,mBAAS,eAAe,mBAAmB,EAAE,OAAO;AACrG,YAAG,SAAS,eAAe,0BAA0B;AAAG,mBAAS,eAAe,0BAA0B,EAAE,OAAO;AACnH,YAAG,SAAS,eAAe,wBAAwB;AAAG,mBAAS,eAAe,wBAAwB,EAAE,OAAO;AAE/G,aAAK,eAAe;AACpB,aAAK,OAAO,kBAAkB;AAC9B,aAAK,OAAO,eAAe;AAC3B,aAAK,OAAO,aAAa,KAAK,OAAO,QAAQ,CAAC;AAAA,MAG/C,CAAC;AACD,WAAK,WAAW,GAAG,SAAS,KAAK,MAAM;AACtC,aAAK,WAAW,KAAK,YAAY,EAAE,IAAI,EAAC,WAAW,gBAAe,oBAAoB,WAAU,SAAS,SAAQ,WAAW,YAAY,iBAAiB,QAAQ,aAAa,QAAO,eAAe,QAAQ,kBAAkB,aAAY,kBAAkB,OAAM,UAAU,WAAW,cAAc,6BAA4B,CAAC;AAClU,aAAK,WAAW,KAAK,YAAY,EAAE,IAAI,EAAC,WAAW,IAAG,oBAAoB,IAAG,SAAS,IAAG,WAAW,IAAI,iBAAiB,IAAI,aAAa,IAAG,eAAe,IAAI,kBAAkB,IAAG,kBAAkB,IAAG,UAAU,IAAI,cAAc,GAAE,CAAC;AACzO,eAAO;AACP,YAAG,SAAS,eAAe,mBAAmB;AAAG,mBAAS,eAAe,mBAAmB,EAAE,OAAO;AACrG,YAAG,SAAS,eAAe,mBAAmB;AAAG,mBAAS,eAAe,mBAAmB,EAAE,OAAO;AACrG,YAAG,SAAS,eAAe,0BAA0B;AAAG,mBAAS,eAAe,0BAA0B,EAAE,OAAO;AACnH,YAAG,SAAS,eAAe,wBAAwB;AAAG,mBAAS,eAAe,wBAAwB,EAAE,OAAO;AAE/G,aAAK,eAAe;AACpB,aAAK,OAAO,kBAAkB;AAC9B,aAAK,OAAO,eAAe;AAC3B,aAAK,OAAO,aAAa,KAAK,OAAO,QAAQ,CAAC;AAAA,MAE/C,CAAC;AAAA,IACF;AAAA,IACA,MAAM,kBAAkB;AACvB,UAAI,CAAC,KAAK,YAAY;AACrB,cAAM,MAAM,MAAM,OAAO,GAAG,UAAU,cAAc,EAAC,KAAK,GAAG,UAAU,EAAC,GAAG,MAAM;AACjF,aAAK,oBAAoB,IAAI,QAAQ;AAAA,MACtC;AACA,UAAI,CAAC,KAAK,YAAY;AACrB,cAAM,MAAM,MAAM,OAAO,GAAG,UAAU,eAAe,KAAK,aAAa,oBAAoB;AAC3F,aAAK,aAAa,IAAI,QAAQ;AAAA,MAC/B;AAEA,WAAK,UAAU,CAAC,CAAC,EAAE,KAAK,CAAC,EAAC,QAAO,MAAM;AACtC,aAAK,iBAAiB,QAAQ,KAAK;AAAA,MACpC,CAAC;AAAA,IACF;AAAA,IAEA,UAAU,EAAC,QAAQ,GAAG,cAAc,IAAI,cAAY,GAAE,GAAG;AACxD,YAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,YAAM,aAAc,OAAO,IAAI,sBAAuB,KAAK;AAC3D,UAAI,EAAE,YAAY,YAAY,IAAI;AAElC,OAAC,eAAe,aAAa,KAAK;AAElC,aAAO,OAAO,KAAK;AAAA,QAClB,QAAQ;AAAA,QACR,QAAQ;AAAA,QACR,MAAM,EAAE,OAAO,aAAa,YAAY,YAAY,aAAa,YAAY;AAAA,MAC9E,CAAC;AAAA,IACF;AAAA,IAGA,iBAAiB,OAAO;AACvB,UAAK,KAAM;AACX,UAAG,SAAS,QAAO;AAalB,YAAS,uBAAT,WAAgC;AAE/B,cAAG,GAAG,uBAAsB;AAC3B,mBAAO,wBAAwB,GAAG,MAAM;AAAA,6BAChB,GAAG,WAAW;AAAA,UACvC,OAAO;AACN,mBAAO,wBAAwB,GAAG,MAAM;AAAA,UACzC;AAAA,QACQ;AApBV,aAAK,iBAAiB,KAAK,EAAE;AAC5B,aAAK,iBAAiB;AAAA,UACrB;AAAA;AAAA,OAEG,qBAAqB;AAAA,6BACC,GAAG,MAAM;AAAA,6BACT,GAAG,eAAe;AAAA,gCACf,GAAG,KAAK;AAAA;AAAA;AAAA;AAAA,QAG7B;AAWR,aAAK,wBAAwB;AAC7B,cAAM,QAAQ,UAAQ;AAErB,eAAK,iBAAiB,IAAI;AAAA,QAG3B,CAAC;AAAA,MACF,OAAO;AACN,cAAM,QAAQ,UAAQ;AACT,cAAI,YAAY,KAAK,cAAc,IAAI;AACvC,eAAK,iBAAiB,OAAO,SAAS;AAAA,QAC7C,CAAC;AAAA,MACR;AAAA,IAKD;AAAA,IACA,0BAA0B;AACzB,WAAK,eAAe,KAAK,WAAW,KAAK,cAAc;AACvD,WAAK,sBAAsB,KAAK,WAAW,KAAK,qBAAqB;AAAA,IAEtE;AAAA,IACA,cAAc,EAAE,KAAK,GAAG;AACvB,YAAM,gBAAgB,qCAAqC,OAAO,IAAI;AACtE,aAAO,KAAK,oBAAoB,KAAK,aAAa;AAAA,IACnD;AAAA,IACA,eAAe,EAAE,UAAU,GAAG;AAC7B,YAAM,gBAAgB,qCAAqC,OAAO,SAAS;AAC3E,aAAO,KAAK,oBAAoB,KAAK,aAAa;AAAA,IACnD;AAAA,IACA,iBAAiB,WAAW;AAE3B,YAAM,KAAK;AACX,YAAM,WAAW,GAAG,OAAO,QAAQ,EAAE,YAAY,GAAG;AACpD,WAAK,oBAAoB;AAAA,QACxB;AAAA,qBACkB,OAAO,UAAU,SAAS;AAAA,qBAC1B,OAAO,UAAU,SAAS;AAAA,oBAC3B,OAAO,UAAU,QAAQ;AAAA,eAC9B,OAAO,UAAU,GAAG;AAAA,gBACnB,OAAO,UAAU,mBAAmB,CAAC;AAAA,YACzC,UAAU;AAAA,oBACF,OAAO,UAAU,SAAS;AAAA;AAAA,MAE5C;AACA,UAAI,kBAAkB,KAAK,eAAe,SAAS;AAEnD,sBAAgB;AAAA,QACf,GAAG,oBAAoB;AAAA,KACrB,cAAc;AAAA;AAAA,OAEZ,UAAU;AAAA;AAAA,MAEX,qBAAqB;AAAA;AAAA,KAEtB,cAAc;AAAA,KACd,uBAAuB;AAAA,MAC1B;AACC,eAAS,gBAAgB;AACzB,YAAG,GAAG,uBAAsB;AAC3B,iBAAO;AAAA,QACR,OAAO;AACN,iBAAO;AAAA,QACR;AAAA,MACK;AACA,eAAS,gBAAgB;AAC9B,YAAG,GAAG,uBAAsB;AAC3B,iBAAO;AAAA;AAAA,QAEH,UAAU;AAAA;AAAA;AAAA,QAGf,OAAO;AACN,iBAAO;AAAA,QACR;AAAA,MACK;AACN,oCAA8B;AAE9B,eAAS,gCAAgC;AACxC,cAAM,YAAY,MAAM,KAAK,GAAG,oBAAoB,KAAK,mBAAmB,CAAC;AAC7E,WAAG,aAAa,KAAK,qBAAqB,EAAE,IAAI,SAAS,EAAE;AAC3D,WAAG,oBAAoB,KAAK,mBAAmB,EAAE,IAAI,SAAS,EAAE;AAChE,YAAI,YAAY,UAAU,OAAO,CAACC,YAAW,QAAQ;AACpD,cAAI,EAAE,GAAG,EAAE,MAAM,IAAIA;AACpB,YAAAA,aAAY,EAAE,GAAG,EAAE,MAAM;AAC1B,iBAAOA;AAAA,QACR,GAAG,CAAC;AAEJ,qBAAa;AACb,YAAI,aAAa;AAAG,sBAAY;AAEhC,WAAG,aAAa,KAAK,qBAAqB,EAAE,IAAI,SAAS,SAAS;AAClE,WAAG,oBAAoB,KAAK,mBAAmB,EAAE,IAAI,SAAS,SAAS;AAAA,MACxE;AAEA,eAAS,yBAAyB;AACjC,YAAI,UAAU,QAAQ,UAAU,UAAU,UAAU,SAAS,UAAU,QAAQ;AAC9E,iBAAO;AAAA;AAAA;AAAA,2DAGgD,gBAAgB,UAAU,iBAAiB,QAAQ;AAAA;AAAA,sFAExB,UAAU,cAAc;AAAA,uDACvD,UAAU;AAAA;AAAA;AAAA,QAG9D,OAAO;AACN,iBAAO;AAAA;AAAA;AAAA,2DAGgD,gBAAgB,UAAU,iBAAiB,QAAQ;AAAA;AAAA,sFAExB,UAAU,cAAc;AAAA,uDACvD,UAAU;AAAA;AAAA;AAAA,QAG9D;AAAA,MACD;AAEA,eAAS,uBAAuB;AAC/B,YAAI,UAAU,aAAa;AAC1B,cAAI,UAAU,YAAY,QAAQ,OAAO,KAAK,IAAI;AACjD,gBAAI;AACH,wBAAU,cAAc,EAAE,UAAU,WAAW,EAAE,KAAK;AAAA,YACvD,SAAS,OAAP;AACD,wBAAU,cAAc,UAAU,YAAY,QAAQ,UAAU,GAAG,EAAE,QAAQ,YAAY,GAAG,EAAE,QAAQ,OAAO,GAAG;AAAA,YACjH;AAAA,UACD;AACA,oBAAU,cAAc,OAAO,SAAS,UAAU,aAAa,EAAE;AACjE,iBAAO,0BAA0B,UAAU;AAAA,QAC5C;AACA,eAAO;AAAA,MACR;AAEA,eAAS,sBAAsB;AAC9B,cAAM,EAAE,OAAO,UAAU,IAAI;AAC7B,YAAI,CAAC,GAAG,eAAe,OAAO;AAC7B,iBAAO;AAAA;AAAA;AAAA;AAAA,cAIG,eAAe,OAAO,SAAS,SAAS;AAAA;AAAA,QAEnD,OAAO;AACN,iBAAO,qCAAqC,OAAO,SAAS,SAAS;AAAA,QACtE;AAAA,MACD;AAAA,IACD;AAAA,IACA,cAAc,MAAM;AACnB,YAAM,KAAK;AACX,WAAK,WAAW,KAAK,YAAa,GAAG;AAErC,YAAM,EAAE,YAAY,WAAW,UAAU,SAAS,YAAY,KAAK,gBAAgB,IAAI;AACvF,YAAMC,aAAY,IAAI,iBAAiB,CAAC,IAAI,KAAK,IAAI,IAAI;AACzD,UAAI;AACJ,UAAI,iBAAiB;AAErB,UAAI,KAAK,eAAe;AACvB,0BAAmB,aAAa,KAAK,UAAU,cAAc,IAAI,QAAQ;AAEzE,YAAI,KAAK,MAAM,cAAc,IAAI,KAAK;AACrC,2BAAiB,KAAK,MAAM,cAAc,IAAE;AAC5C,2BAAiB,eAAe,QAAQ,CAAC,IAAI;AAAA,QAC9C;AAAA,MACD,OAAO;AACN,0BAAkB;AAClB,yBAAiB;AAAA,MAClB;AAEA,eAAS,sBAAsB;AAC9B,YAAI,CAAC,GAAG,eAAe,YAAY;AAClC,iBAAO;AAAA,uDAC4C,oBAAoB;AAAA;AAAA;AAAA;AAAA;AAAA,uCAKpC;AAAA,eACxB,OAAO,SAAS,KAAK,SAAS;AAAA;AAAA;AAAA,QAG1C,OAAO;AACN,iBAAO;AAAA,uDAC4C,oBAAoB;AAAA;AAAA,uCAEpC,OAAO,SAAS,KAAK,SAAS;AAAA,QAClE;AAAA,MACD;AAEA,aACC;AAAA,sBACmB,OAAO,KAAK,SAAS,sBAAsB,OAAO,SAAS;AAAA,qBAC5D,OAAO,QAAQ,gBAAgB,OAAO,GAAG;AAAA,iBAC7C,OAAO,mBAAmB,CAAC;AAAA,aAC/B,KAAK;AAAA;AAAA,MAEZ,oBAAoB;AAAA;AAAA;AAAA;AAAA,QAIlB,OAAO,SAAS,KAAK,WAAW,EAAE;AAAA;AAAA,8BAEZ,gBAAgB,iBAAiB,KAAK,UAAUA,UAAS,KAAK,OAAO;AAAA;AAAA;AAAA,IAIlG;AAAA,IAEA,oBAAoB,MAAM;AACzB,YAAM,YAAY,EAAE,IAAI,EAAE,KAAK,KAAK;AACpC,QAAE,IAAI,EAAE,OAAO,EAAE,YAAY,kCAAkC,iBAAiB;AAAA,IACjF;AAAA,IAEA,kBAAkB;AACjB,YAAM,KAAK;AACX,YAAM,MAAM,GAAG,OAAO,QAAQ,EAAE;AAChC,WAAK,WAAW,KAAK,eAAe,EAAE,KAAK,EAAE;AAC7C,WAAK,WAAW,KAAK,cAAc,EAAE,KAAK,EAAE;AAC5C,WAAK,WAAW,KAAK,mBAAmB,EAAE,KAAK,EAAE;AACjD,WAAK,oBAAoB,OAAO,GAAG,KAAK,aAAa;AAAA,QACpD,IAAI;AAAA,UACH,OAAO,GAAG,aAAa;AAAA,UACvB,WAAW;AAAA,UACX,SAAS;AAAA,UACT,aAAa,GAAG,aAAa;AAAA,UACjB,UAAU,WAAY;AAEjC,gBAAG,GAAG,iBAAiB,GAAG,gBAAgB,KAAK,OAAM;AACpD,qBAAO,MAAM,WAAW,QAAQ,OAAO,SAAQ,OAAO,QAAO,KAAK,KAAK;AAAA,YACxE;AAAA,UAWW;AAAA,QACb;AAAA,QACA,QAAQ,KAAK,WAAW,KAAK,cAAc;AAAA,QAC3C,cAAc;AAAA,MACf,CAAC;AACD,WAAK,eAAe,OAAO,GAAG,KAAK,aAAa;AAAA,QAC/C,IAAI;AAAA,UACH,OAAO,GAAG,QAAQ;AAAA,UAClB,WAAW;AAAA,UACX,aAAa,GAAG,+CAA+C;AAAA,QAChE;AAAA,QACA,QAAQ,KAAK,WAAW,KAAK,eAAe;AAAA,QAC5C,cAAc;AAAA,MACf,CAAC;AACD,WAAK,mBAAmB,OAAO,GAAG,KAAK,aAAa;AAAA,QACnD,IAAI;AAAA,UACH,OAAO,GAAG,YAAY;AAAA,UACtB,WAAW;AAAA,UACX,SAAS;AAAA,UACT,aAAa,GAAG,mBAAmB;AAAA,UACnC,UAAU,WAAW;AACpB,eAAG,aAAa,KAAK;AACrB,aAAC,GAAG,eAAe,GAAG,aAAa,GAAG;AACtC,eAAG,aAAa;AAAA,UACjB;AAAA,UACA,WAAW,WAAY;AAEtB,mBAAO;AAAA,cACN,OAAO;AAAA,cACP,SAAS;AAAA,gBACR,aAAa,MAAM,IAAI,cAAc;AAAA,cACtC;AAAA,YACD;AAAA,UACD;AAAA,QACD;AAAA,QACA,QAAQ,KAAK,WAAW,KAAK,mBAAmB;AAAA,QAChD,cAAc;AAAA,MACf,CAAC;AACD,WAAK,kBAAkB,UAAU,GAAG,WAAW;AAC/C,WAAK,kBAAkB,QAAQ;AAC/B,WAAK,kBAAkB,aAAa,KAAK;AACzC,WAAK,aAAa,aAAa,KAAK;AACpC,WAAK,iBAAiB,aAAa,KAAK;AAExC,WAAK,iBAAiB;AAAA,IACvB;AAAA,IAEA,mBAAmB;AAClB,WAAK,aAAa,SAAS,KAAK,gBAAgB,EAAE;AAAA,QACjD;AAAA,+CAC4C,GAAG,OAAO;AAAA,OAClD,OAAO,MAAM,KAAK,SAAS,IAAI;AAAA;AAAA;AAAA,MAGpC;AAEA,WAAK,oBAAoB,KAAK,aAAa,SAAS,KAAK,WAAW;AAEpE,WAAK,kBAAkB,GAAG,SAAS,KAAK,MAAM;AAC7C,aAAK,iBAAiB,EAAE;AACxB,aAAK,aAAa,UAAU;AAAA,MAC7B,CAAC;AAAA,IACF;AAAA,IAEA,iBAAiB,OAAO;AACvB,QAAE,KAAK,aAAa,OAAO,EAAE,EAAE,IAAI,KAAK,EAAE,QAAQ,OAAO;AAAA,IAC1D;AAAA,IAEA,cAAc;AACb,YAAM,KAAK;AACV,aAAO,SAAS,cAAAC;AAEhB,oBAAAA,QAAO,iBAAiB,SAAU,QAAQ;AACzC,YAAI,QAAQ,KAAK,qBAAqB,MAAM;AAC5C,gBAAQ;AAAA,gBACF,SAAS,MAAM,SAAS;AAAA,gBACxB,SAAS,OAAO,SAAS;AAAA,gBACxB,SAAS,OAAO,SAAS,OAAQ,SAAS;AAAA,gBAC3C,SAAS,OAAO,SAAS;AAAA,gBACzB,SAAS,OAAO,SAAS;AAAA,eACzB,SAAS;AACb,gBAAI,OAAO,QAAQ,UAAa,OAAO,QAAQ,IAAI;AAClD,qBAAO,OAAO;AAAA,YACf;AAEA,gBAAI,WAAW,OAAO,aAAa,KAAK;AACxC,oBAAQ,OAAO;AAAA,mBACT;AAAO,2BAAW,SAAS,YAAY;AAAG;AAAA,mBAC1C;AAAM,2BAAW,SAAS,YAAY;AAAG;AAAA;AAE/C,mBAAO;AAAA,gBACH,SAAS,MAAM,SAAS;AAC5B,mBAAO,KAAK,QAAQ;AAAA;AAEtB,eAAO;AAAA,MACR;AAEA,oBAAAA,QAAO,SAAS,UAAU;AAAA,QACzB,QAAQ,CAAC,cAAc;AACtB,cAAI,KAAK,gBAAgB,KAAK,WAAW,GAAG,UAAU,GAAG;AACxD,iBAAK,aAAa,UAAU;AAC5B,iBAAK,iBAAiB,SAAS;AAC/B,iBAAK,kBAAkB;AAAA,UACxB;AAAA,QACD;AAAA,MACD,CAAC;AAEF,WAAK,WAAW,GAAG,SAAS,iBAAiB,WAAW;AACvD,cAAM,QAAQ,EAAE,IAAI;AACpB,cAAM,YAAY,SAAS,MAAM,KAAK,gBAAgB,CAAC;AACvD,YAAI,WAAW,SAAS,MAAM,KAAK,eAAe,CAAC;AACnD,YAAI,YAAY,SAAS,MAAM,KAAK,gBAAgB,CAAC;AACrD,YAAI,MAAM,SAAS,MAAM,KAAK,UAAU,CAAC;AACzC,YAAI,OAAO,SAAS,MAAM,KAAK,WAAW,CAAC;AAG3C,mBAAW,aAAa,cAAc,SAAY;AAClD,oBAAY,cAAc,cAAc,SAAY;AACpD,cAAM,QAAQ,cAAc,SAAY;AACxC,eAAO,SAAS,cAAc,SAAY;AAC1C,WAAG,OAAO,cAAc;AAAA,UACvB,OAAO;AAAA,UACP,OAAO;AAAA,UACP,MAAM,EAAE,WAAW,UAAU,WAAW,KAAK,KAAK;AAAA,QACnD,CAAC;AACD,WAAG,aAAa,UAAU;AAAA,MAC3B,CAAC;AAED,WAAK,aAAa,OAAO,GAAG,SAAS,CAAC,MAAM;AAC3C,qBAAa,KAAK,WAAW;AAC7B,aAAK,cAAc,WAAW,MAAM;AACnC,gBAAM,cAAc,EAAE,OAAO;AAC7B,eAAK,aAAa,EAAE,YAAY,CAAC;AAAA,QAClC,GAAG,GAAG;AAEN,aAAK,kBAAkB;AAAA,UACtB,QAAQ,KAAK,aAAa,OAAO,IAAI,CAAC;AAAA,QACvC;AAAA,MACD,CAAC;AAED,WAAK,aAAa,OAAO,GAAG,SAAS,MAAM;AAC1C,aAAK,kBAAkB;AAAA,UACtB,QAAQ,KAAK,aAAa,OAAO,IAAI,CAAC;AAAA,QACvC;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,mBAAmB;AAClB,YAAM,aAAa,OAAO,MAAM,OAAO,IAAI,WAAM;AACjD,WAAK,aAAa,OAAO,KAAK,SAAS,GAAG,cAAc;AACxD,aAAO,GAAG,KAAK,aAAa;AAAA,QAC3B,UAAU;AAAA,QACV,QAAQ,MAAM,KAAK,aAAa,UAAU;AAAA,QAC1C,WAAW,MAAM,KAAK,WAAW,GAAG,UAAU;AAAA,QAC9C,aAAa,GAAG,uBAAuB;AAAA,QACvC,eAAe;AAAA,QACf,MAAM,SAAS,KAAK;AAAA,MACrB,CAAC;AACD,WAAK,iBAAiB,OAAO,KAAK,SAAS,GAAG,cAAc;AAC5D,aAAO,GAAG,KAAK,aAAa;AAAA,QAC3B,UAAU;AAAA,QACV,QAAQ,MAAM,KAAK,iBAAiB,UAAU;AAAA,QAC9C,WAAW,MAAM,KAAK,WAAW,GAAG,UAAU;AAAA,QAC9C,aAAa,GAAG,4BAA4B;AAAA,QAC5C,eAAe;AAAA,QACf,MAAM,SAAS,KAAK;AAAA,MACrB,CAAC;AAGD,aAAO,GAAG,KAAK,GAAG,SAAS,MAAM;AAChC,cAAM,sBAAsB,KAAK,WAAW,GAAG,UAAU;AACzD,YAAI,CAAC,uBAAuB,KAAK,aAAa,UAAU,MAAM;AAAI;AAElE,YAAI,KAAK,MAAM,UAAU,GAAG;AAC3B,eAAK,iBAAiB,KAAK,eAAe,EAAE,MAAM;AAClD,iBAAO,MAAM,WAAW,QAAQ;AAChC,eAAK,iBAAiB,EAAE;AAAA,QACzB,WAAW,KAAK,MAAM,UAAU,KAAK,KAAK,iBAAiB;AAE1D,iBAAO,WAAW;AAAA,YACjB,SAAS,GAAG,qCAAqC;AAAA,YACjD,WAAW;AAAA,UACZ,CAAC;AACD,iBAAO,MAAM,WAAW,OAAO;AAC/B,eAAK,kBAAkB;AACvB,eAAK,iBAAiB,EAAE;AAAA,QACzB;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,aAAa,EAAE,cAAY,GAAG,IAAE,CAAC,GAAG;AACnC,UAAI,aAAa;AAChB,sBAAc,YAAY,YAAY;AAGtC,aAAK,eAAe,KAAK,gBAAgB,CAAC;AAC1C,YAAI,KAAK,aAAa,cAAc;AACnC,gBAAM,QAAQ,KAAK,aAAa;AAChC,eAAK,QAAQ;AACb,eAAK,iBAAiB,KAAK;AAC3B,eAAK,iBAAiB,KAAK,MAAM,UAAU,KAAK,KAAK,0BAA0B;AAC/E;AAAA,QACD;AAAA,MACD;AAEA,WAAK,UAAU,EAAE,YAAY,CAAC,EAC5B,KAAK,CAAC,EAAE,QAAQ,MAAM;AAEtB,cAAM,EAAE,OAAO,WAAW,UAAU,QAAQ,IAAI;AAChD,YAAI,eAAe,CAAC,SAAS;AAC5B,eAAK,aAAa,eAAe;AAAA,QAClC;AACA,aAAK,QAAQ;AACb,aAAK,iBAAiB,KAAK;AAC3B,aAAK,iBAAiB,KAAK,MAAM,UAAU,KAAK,KAAK,0BAA0B;AAAA,MAChF,CAAC;AAAA,IACH;AAAA,IAEA,4BAA4B;AAC3B,WAAK,iBAAiB,KAAK,eAAe,EAAE,MAAM;AAClD,WAAK,iBAAiB,EAAE;AAAA,IACzB;AAAA,IAEA,gBAAgB,UAAU;AACzB,iBACC,KAAK,WAAW,KAAK,iBAAiB,EAAE,IAAI,yBAAyB,2BAA2B,IAChG,KAAK,WAAW,KAAK,iBAAiB,EAAE,IAAI,yBAAyB,4BAA4B;AAElG,iBACC,KAAK,WAAW,KAAK,eAAe,EAAE,IAAI,UAAU,sBAAsB,IAC1E,KAAK,WAAW,KAAK,eAAe,EAAE,IAAI,UAAU,sBAAsB;AAE3E,iBACC,KAAK,WAAW,IAAI,eAAe,iBAAiB,IACpD,KAAK,WAAW,IAAI,eAAe,iBAAiB;AAErD,iBACC,KAAK,iBAAiB,IAAI,yBAAyB,2BAA2B,IAC9E,KAAK,iBAAiB,IAAI,yBAAyB,2BAA2B;AAAA,IAChF;AAAA,IAEA,iBAAiB,MAAM;AACtB,WAAK,iBAAiB,EAAE;AACxB,WAAK,WAAW,IAAI,WAAW,OAAO,SAAQ,MAAM;AAAA,IACrD;AAAA,EACD;;;AC5pBA,SAAO,QAAQ,qBAAqB;AACpC,UAAQ,YAAY,WAAW,MAAM;AAAA,IACpC,YAAY,EAAE,SAAS,QAAQ,SAAS,GAAG;AAC1C,WAAK,UAAU;AACf,WAAK,SAAS;AACd,WAAK,gBAAgB;AACrB,WAAK,cAAc,SAAS;AAC5B,WAAK,0BAA0B,SAAS;AACxC,WAAK,oBAAoB,SAAS;AAClC,WAAK,wBAAwB,SAAS;AACtC,WAAK,mBAAmB,SAAS;AACjC,WAAK,yBAAyB,SAAS;AACvC,WAAK,+BAA+B,SAAS;AAC7C,WAAK,uBAAuB,SAAS;AACrC,WAAK,WAAW;AAChB,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,iBAAiB;AAChB,WAAK,YAAY;AACjB,WAAK,sBAAsB;AAC3B,WAAK,YAAY;AACjB,WAAK,iBAAiB;AAAA,IACvB;AAAA,IAEA,cAAc;AACb,WAAK,QAAQ;AAAA,QACZ;AAAA,MACD;AACA,WAAK,aAAa,KAAK,QAAQ,KAAK,2BAA2B;AAAA,IAChE;AAAA,IAEA,wBAAwB;AACvB,WAAK,uBAAuB;AAC5B,WAAK,qBAAqB;AAAA,IAC3B;AAAA,IAEA,yBAAyB;AACxB,WAAK,WAAW;AAAA,QACf;AAAA,MACD;AACA,WAAK,oBAAoB,KAAK,WAAW,KAAK,mBAAmB;AACjE,WAAK,uBAAuB;AAAA,IAC7B;AAAA,IAEA,0BAA0B;AACzB,YAAM,MAAM,KAAK,OAAO,QAAQ;AAChC,UAAI,UAAU,YAAY,EAAE;AAC5B,WAAK,uBAAuB;AAC5B,WAAK,eAAe,UAAU;AAAA,IAC/B;AAAA,IAEA,uBAAuB;AACtB,WAAK,WAAW;AAAA,QACf;AAAA;AAAA,+BAE4B,GAAG,WAAW;AAAA;AAAA,iCAEZ,GAAG,MAAM;AAAA,gCACV,GAAG,UAAU;AAAA,wCACL,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAOjD;AACA,WAAK,kBAAkB,KAAK,WAAW,KAAK,iBAAiB;AAE7D,WAAK,yBAAyB;AAC9B,WAAK,wBAAwB;AAC7B,WAAK,iBAAiB;AAAA,IACvB;AAAA,IAEA,0BAA0B;AACzB,WAAK,eAAe,KAAK,WAAW,KAAK,cAAc;AACvD,WAAK,sBAAsB,KAAK,WAAW,KAAK,qBAAqB;AAErE,WAAK,0BAA0B;AAAA,IAChC;AAAA,IAEA,4BAA4B;AAC3B,WAAK,aAAa,IAAI,WAAW,MAAM;AACvC,WAAK,oBAAoB;AAAA,QACxB,gCAAgC,GAAG,kBAAkB;AAAA,MACtD;AAAA,IACD;AAAA,IAEA,oBAAoB;AACnB,aACC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAOF;AAAA,IAED,2BAA2B;AACvB,WAAK,kBAAkB,KAAK,WAAW,KAAK,sBAAsB;AAElE,WAAK,gBAAgB;AAAA,QACjB;AAAA,cACM,KAAK,kBAAkB,KAAK,GAAG,cAAc;AAAA;AAAA;AAAA,gDAGX,GAAG,aAAa;AAAA;AAAA;AAAA;AAAA,2CAIrB,GAAG,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA,mBAKtC,GAAG,aAAa;AAAA;AAAA;AAAA;AAAA,WAIxB,CAAC,OAAO,WAAW,SAAS,QAAQ,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gCASnB,GAAG,UAAU;AAAA,gBAC7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BASY,GAAG,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAST,GAAG,YAAY;AAAA;AAAA,qCAEN,GAAG,WAAW;AAAA,MAC/C;AAEA,WAAK,qBAAqB,KAAK,WAAW,KAAK,uBAAuB;AACtE,WAAK,uBAAuB,IAAI;AAAA,IACpC;AAAA,IAEC,mBAAmB;AAClB,WAAK,kBAAkB,KAAK,WAAW,KAAK,iBAAiB;AAE7D,WAAK,aAAa,IAAI,QAAQ,YAAY,UAAU;AAAA,QACnD,SAAS,KAAK;AAAA,QACd,QAAQ;AAAA,UACP,cAAc,KAAK,gBAAgB,KAAK,IAAI;AAAA,QAC7C;AAAA,QACA,MAAM;AAAA,QACN,MAAM;AAAA,UACL,CAAE,GAAG,GAAG,GAAG,UAAW;AAAA,UACtB,CAAE,GAAG,GAAG,GAAG,UAAW;AAAA,UACtB,CAAE,GAAG,GAAG,GAAG,MAAO;AAAA,UAClB,CAAE,KAAK,GAAG,UAAU,QAAS;AAAA,QAC9B;AAAA,QACA,aAAa;AAAA,UACZ,CAAE,IAAI,IAAI,IAAI,YAAa;AAAA,UAC3B,CAAE,IAAI,IAAI,IAAI,YAAa;AAAA,UAC3B,CAAE,IAAI,IAAI,IAAI,YAAa;AAAA,UAC3B,CAAE,IAAI,IAAI,IAAI,uBAAwB;AAAA,QACvC;AAAA,QACA,gBAAgB,EAAE,YAAY,OAAO,YAAY,sBAAsB;AAAA,MACxE,CAAC;AAED,WAAK,gBAAgB;AAAA,QACpB;AAAA;AAAA;AAAA;AAAA;AAAA,MAKD;AAEA,WAAK,gBAAgB;AAAA,QACpB,qEAAqE,GAAG,UAAU;AAAA,MACnF;AAAA,IACD;AAAA,IAGA,qBAAqB,UAAU;AAC9B,YAAM,KAAK;AACX,UAAI,SAAS,IAAI,OAAO,GAAG,OAAO;AAAA,QACjC,OAAO;AAAA,QACP,QAAQ;AAAA,UACP;AAAA,YACC,OAAO;AAAA,YACP,WAAW;AAAA,YACX,WAAW;AAAA,YACX,MAAM;AAAA,UACP;AAAA,UACA;AAAA,YACC,OAAO;AAAA,YACP,WAAW;AAAA,YACX,WAAW;AAAA,YACX,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAqCV;AAAA,QACD;AAAA,QACA,MAAM;AAAA,QACN,sBAAsB;AAAA,QACtB,gBAAgB;AAAA,MACjB,CAAC;AAGD,YAAM,SAAS,OAAO,QAAQ,KAAK,gBAAgB;AACnD,YAAM,UAAU,CAAC,OAAO,OAAO,SAAS,QAAQ,QAAQ,OAAO,SAAS,SAAS,QAAQ,MAAM;AAE/F,cAAQ,QAAQ,SAAO;AACtB,eAAO,GAAG,SAAS,MAAM,KAAK,WAAW;AACxC,gBAAM,gBAAgB,OAAO,UAAU,eAAe,KAAK;AAC3D,iBAAO,UAAU,iBAAiB,gBAAgB,EAAE,IAAI,EAAE,KAAK,CAAC;AAAA,QACjE,CAAC;AAAA,MACF,CAAC;AAED,aAAO,GAAG,SAAS,UAAU,MAAM,OAAO,UAAU,iBAAiB,EAAE,CAAC;AACxE,aAAO,GAAG,SAAS,WAAW,WAAW;AACxC,cAAM,gBAAgB,OAAO,UAAU,eAAe,KAAK;AAC3D,eAAO,UAAU,iBAAiB,cAAc,MAAM,GAAG,EAAE,CAAC;AAAA,MAC7D,CAAC;AAED,aAAO;AAAA,IACR;AAAA,IAGA,qBAAqB,UAAU;AAC9B,UAAI,SAAS,IAAI,OAAO,GAAG,OAAO;AAAA,QACjC,OAAO;AAAA,QACP,QAAQ;AAAA,UACP;AAAA,YACC,OAAO;AAAA,YACP,WAAW;AAAA,YACX,WAAW;AAAA,YACX,MAAM;AAAA,UACP;AAAA,UACA;AAAA,YACC,OAAO;AAAA,YACP,WAAW;AAAA,YACX,WAAW;AAAA,YACX,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAqCV;AAAA,QACD;AAAA,QACA,MAAM;AAAA,QACN,sBAAsB;AAAA,QACtB,gBAAgB;AAAA,MACjB,CAAC;AAGD,YAAM,SAAS,OAAO,QAAQ,KAAK,gBAAgB;AACnD,YAAM,UAAU,CAAC,OAAO,OAAO,SAAS,QAAQ,QAAQ,OAAO,SAAS,SAAS,QAAQ,MAAM;AAE/F,cAAQ,QAAQ,SAAO;AACtB,eAAO,GAAG,SAAS,MAAM,KAAK,WAAW;AACxC,gBAAM,gBAAgB,OAAO,UAAU,YAAY,KAAK;AACxD,iBAAO,UAAU,cAAc,gBAAgB,EAAE,IAAI,EAAE,KAAK,CAAC;AAAA,QAC9D,CAAC;AAAA,MACF,CAAC;AAED,aAAO,GAAG,SAAS,UAAU,MAAM,OAAO,UAAU,cAAc,EAAE,CAAC;AACrE,aAAO,GAAG,SAAS,WAAW,WAAW;AACxC,cAAM,gBAAgB,OAAO,UAAU,YAAY,KAAK;AACxD,eAAO,UAAU,cAAc,cAAc,MAAM,GAAG,EAAE,CAAC;AAAA,MAC1D,CAAC;AAED,aAAO;AAAA,IACR;AAAA,IAGA,MAAM,4BAA4B,eAAe,aAAa;AAC7D,YAAM,KAAK;AACX,UAAI;AACH,cAAM,OAAO,KAAK;AAAA,UACjB,QAAQ;AAAA,UACR,MAAM,EAAE,UAAU,cAAc;AAAA,UAChC,QAAQ;AAAA,UACR,gBAAgB;AAAA,QACjB,CAAC;AAED,cAAM,MAAM,GAAG,OAAO,QAAQ;AAC9B,eAAO,MAAM,UAAU,IAAI,IAAI,SAAS,IAAI,IAAI,MAAM,YAAY,aAAa;AAE/E,cAAM,IAAI,eAAe,QAAQ,YAAY,IAAI,IAAI,SAAS,IAAI,IAAI,IAAI;AAC1E,cAAM,GAAG,uBAAuB,aAAa;AAC7C,WAAG,OAAO,yBAAyB,GAAG,aAAa;AACnD,WAAG,wBAAwB;AAE3B,YAAI;AAAa,gBAAM,YAAY,aAAa;AAAA,MACjD,SAAS,OAAP;AACD,eAAO,WAAW,EAAE,SAAS,GAAG,4BAA4B,GAAG,WAAW,MAAM,CAAC;AACjF,cAAM;AAAA,MACP;AAAA,IACD;AAAA,IAEA,cAAc;AACb,YAAM,KAAK;AAEX,WAAK,kBAAkB,GAAG,SAAS,uBAAuB,WAAY;AACrE,WAAG,wBAAwB;AAAA,MAC5B,CAAC;AAED,WAAK,kBAAkB,GAAG,SAAS,sBAAsB,WAAY;AACpE,WAAG,qBAAqB,KAAK;AAAA,MAC9B,CAAC;AAED,WAAK,kBAAkB,GAAG,SAAS,qBAAqB,SAAS,GAAG;AACnE,YAAI,EAAE,EAAE,MAAM,EAAE,QAAQ,qBAAqB,EAAE;AAAQ;AACvD,cAAM,OAAO,GAAG,gBAAgB,GAAG,UAAU;AAC7C,WAAG,qBAAqB,IAAI;AAAA,MAC7B,CAAC;AAED,WAAK,oBAAoB,GAAG,SAAS,sBAAsB,WAAW;AACrE,cAAM,aAAa,EAAE,IAAI;AACzB,WAAG,sBAAsB,IAAI;AAC7B,cAAM,yBAAyB,CAAC,GAAG,gBAAgB,KAAK,gBAAgB,EAAE,GAAG,UAAU;AACvF,YAAI,CAAC,wBAAwB;AAC5B,aAAG,gBAAgB,KAAK,gBAAgB,EAAE,MAAM;AAAA,QACjD;AACA,cAAM,gBAAgB,SAAS,WAAW,KAAK,eAAe,CAAC;AAC/D,WAAG,OAAO,kBAAkB,EAAE,MAAM,cAAc,CAAC;AACnD,aAAK,eAAe;AAAA,MACrB,CAAC;AAED,WAAK,WAAW,GAAG,SAAS,kEAAkE,iBAAiB;AACzG,YAAI,EAAE,IAAI,EAAE,KAAK,OAAO,EAAE,QAAQ,YAAY,KAAK;AAAI;AAEvD,gBAAQ,IAAI,yBAAyB;AACrC,YAAI;AACA,cAAI,CAAC,QAAQ,IAAI,YAAY,GAAG,8BAA8B;AAC1D,kBAAM,SAAS,GAAG,qBAAqB,eAAe,QAAQ;AAC1D,kBAAI,OAAO,iBAAiB,WAAW,GAAG,SAAS,6BAA6B;AAC5E,uBAAO,MAAM,6BAA6B,GAAG,SAAS,4BAA4B,SAAS,CAAC;AAC5F;AAAA,cACJ;AAEA,kBAAI;AACA,sBAAM,GAAG,4BAA4B,OAAO,gBAAgB;AAC5D,sBAAM,GAAG,OAAO,SAAS;AACzB,mBAAG,oBAAoB,KAAK;AAC5B,mBAAG,yBAAyB,GAAG,mBAAmB,YAAY,QAAQ;AACtE,uBAAO,KAAK;AAAA,cAChB,SAAS,OAAP;AACE,wBAAQ,MAAM,oCAAoC,KAAK;AAAA,cAC3D;AAAA,YACJ,CAAC;AACD,mBAAO,KAAK;AAAA,UAChB,OAAO;AACH,gBAAI,CAAC,QAAQ,IAAI,YAAY,CAAC,GAAG,8BAA8B;AAC3D,qBAAO,MAAM,8CAA8C;AAC3D;AAAA,YACJ;AACA,kBAAM,GAAG,OAAO,SAAS;AACzB,eAAG,oBAAoB,KAAK;AAC5B,eAAG,yBAAyB,GAAG,mBAAmB,YAAY,QAAQ;AAAA,UAC1E;AAAA,QACJ,SAAS,OAAP;AACE,kBAAQ,MAAM,sBAAsB,KAAK;AACzC,iBAAO,SAAS,GAAG,0CAA0C,CAAC;AAAA,QAClE;AAAA,MACJ,CAAC;AAGA,WAAK,WAAW,GAAG,SAAS,sBAAsB,WAAW;AAC1D,YAAI,EAAE,IAAI,EAAE,KAAK,OAAO,EAAE,QAAQ,YAAY,KAAK;AAAI;AACvD,YAAI,CAAC,QAAQ,IAAI,MAAM,QAAQ;AAC3B,iBAAO,MAAM,2BAA2B;AACxC;AAAA,QACJ;AAEA,gBAAQ,IAAI,qBAAqB;AAEjC,cAAM,wBAAwB,CAAC,gBAAgB,SAAS;AACpD,gBAAM,gBAAgB,GAAG,qBAAqB,SAAS,QAAQ;AAC3D,kBAAM,MAAM,GAAG,OAAO,QAAQ;AAC9B,kBAAM,eAAe,IAAI,IAAI;AAG7B,gBAAI,IAAI,kBAAkB,IAAI,IAAI,mBAAmB,OAAO,QAAQ;AACpE,oBAAQ,IAAI,wCAAwC,IAAI,IAAI,eAAe;AAG3E,gBAAI,CAAC,GAAG,OAAO,oBAAoB;AAC/B,sBAAQ,MAAM,iCAAiC;AAC/C,qBAAO,WAAW;AAAA,gBACd,SAAS,GAAG,+EAA+E;AAAA,gBAC3F,WAAW;AAAA,cACf,CAAC;AACD,4BAAc,KAAK;AACnB;AAAA,YACJ;AAEA,gBAAI,gBAAgB,CAAC,IAAI,IAAI,WAAW;AAEpC,qBAAO,KAAK;AAAA,gBACR,QAAQ;AAAA,gBACR,MAAM;AAAA,kBACF;AAAA,kBACA,YAAY,OAAO;AAAA,gBACvB;AAAA,gBACA,QAAQ;AAAA,gBACR,gBAAgB;AAAA,gBAChB,UAAU,SAAS,GAAG;AAClB,sBAAI,EAAE,QAAQ,UAAU;AACpB,2BAAO,MAAM,UAAU,IAAI,IAAI,SAAS,IAAI,IAAI,MAAM,mBAAmB,EAAE,QAAQ,mBAAmB,OAAO,QAAQ,IAAI;AACzH,wBAAI,eAAe,QAAQ,mBAAmB,IAAI,IAAI,SAAS,IAAI,IAAI,IAAI,EAAE,KAAK,MAAM;AACpF,8BAAQ,IAAI,oDAAoD,YAAY;AAC5E,yBAAG,OAAO,mBAAmB,EAAE,KAAK,CAAC,WAAW;AAC5C,8BAAM,qBAAqB,OAAO,gBAAgB,IAAI,IAAI;AAC1D,8BAAM,eAAe,OAAO,mBAAmB,EAAE,QAAQ,mBAAmB,OAAO,QAAQ;AAC3F,gCAAQ,IAAI,6BAA6B,oBAAoB,YAAY,YAAY;AACrF,2BAAG,uBAAuB,oBAAoB,YAAY;AAAA,sBAC9D,CAAC,EAAE,MAAM,WAAS;AACd,gCAAQ,MAAM,0CAA0C,KAAK;AAC7D,+BAAO,WAAW;AAAA,0BACd,SAAS,GAAG,qCAAqC,CAAC,MAAM,OAAO,CAAC;AAAA,0BAChE,WAAW;AAAA,wBACf,CAAC;AAAA,sBACL,CAAC;AAAA,oBACL,CAAC,EAAE,MAAM,WAAS;AACd,8BAAQ,MAAM,gDAAgD,KAAK;AAAA,oBACvE,CAAC;AACD,kCAAc,KAAK;AAAA,kBACvB,OAAO;AACH,2BAAO,WAAW;AAAA,sBACd,SAAS,GAAG,gFAAgF,EAAE,QAAQ,+BAA+B;AAAA,sBACrI,WAAW;AAAA,oBACf,CAAC;AACD,kCAAc,KAAK;AAAA,kBACvB;AAAA,gBACJ;AAAA,gBACA,OAAO,CAAC,KAAK,QAAQ,UAAU;AAC3B,0BAAQ,MAAM,2CAA2C,KAAK;AAC9D,yBAAO,WAAW;AAAA,oBACd,SAAS,GAAG,qEAAqE;AAAA,oBACjF,WAAW;AAAA,kBACf,CAAC;AACD,gCAAc,KAAK;AAAA,gBACvB;AAAA,cACJ,CAAC;AAAA,YACL,OAAO;AAEH,qBAAO,KAAK;AAAA,gBACR,QAAQ;AAAA,gBACR,MAAM;AAAA,kBACF,YAAY,OAAO;AAAA,gBACvB;AAAA,gBAEA,gBAAgB;AAAA,gBAChB,UAAU,SAAS,GAAG;AAClB,sBAAI,EAAE,SAAS;AACX,0BAAM,kBAAkB,EAAE;AAC1B,2BAAO,MAAM,UAAU,IAAI,IAAI,SAAS,IAAI,IAAI,MAAM,mBAAmB,eAAe;AACxF,wBAAI,eAAe,QAAQ,mBAAmB,IAAI,IAAI,SAAS,IAAI,IAAI,IAAI,EAAE,KAAK,MAAM;AACpF,8BAAQ,IAAI,+CAA+C,IAAI,IAAI,IAAI;AACvE,yBAAG,OAAO,mBAAmB,EAAE,KAAK,CAAC,WAAW;AAC5C,8BAAM,qBAAqB,OAAO,gBAAgB,IAAI,IAAI;AAC1D,gCAAQ,IAAI,6BAA6B,oBAAoB,YAAY,eAAe;AACxF,2BAAG,uBAAuB,oBAAoB,eAAe;AAAA,sBACjE,CAAC,EAAE,MAAM,WAAS;AACd,gCAAQ,MAAM,qCAAqC,KAAK;AACxD,+BAAO,WAAW;AAAA,0BACd,SAAS,GAAG,qCAAqC,CAAC,MAAM,OAAO,CAAC;AAAA,0BAChE,WAAW;AAAA,wBACf,CAAC;AAAA,sBACL,CAAC;AAAA,oBACL,CAAC,EAAE,MAAM,WAAS;AACd,8BAAQ,MAAM,2CAA2C,KAAK;AAAA,oBAClE,CAAC;AACD,kCAAc,KAAK;AAAA,kBACvB,OAAO;AACH,2BAAO,WAAW;AAAA,sBACd,SAAS,GAAG,oBAAoB;AAAA,sBAChC,WAAW;AAAA,oBACf,CAAC;AACD,kCAAc,KAAK;AAAA,kBACvB;AAAA,gBACJ;AAAA,gBACA,OAAO,CAAC,KAAK,QAAQ,UAAU;AAC3B,0BAAQ,MAAM,sCAAsC,KAAK;AACzD,yBAAO,WAAW;AAAA,oBACd,SAAS,GAAG,qEAAqE;AAAA,oBACjF,WAAW;AAAA,kBACf,CAAC;AACD,gCAAc,KAAK;AAAA,gBACvB;AAAA,cACJ,CAAC;AAAA,YACL;AAAA,UACJ,CAAC;AACD,wBAAc,KAAK;AAAA,QACvB;AAEA,YAAI,CAAC,QAAQ,IAAI,YAAY,GAAG,8BAA8B;AAC1D,gBAAM,gBAAgB,GAAG,qBAAqB,SAAS,QAAQ;AAC3D,gBAAI,OAAO,iBAAiB,WAAW,GAAG,SAAS,6BAA6B;AAC5E,qBAAO,MAAM,6BAA6B,GAAG,SAAS,4BAA4B,SAAS,CAAC;AAC5F;AAAA,YACJ;AACA,mBAAO,KAAK;AAAA,cACR,QAAQ;AAAA,cACR,MAAM;AAAA,gBACF,UAAU,OAAO;AAAA,cACrB;AAAA,cACA,QAAQ;AAAA,cACR,gBAAgB;AAAA,cAChB,UAAU,WAAW;AACjB,sBAAM,MAAM,GAAG,OAAO,QAAQ;AAC9B,uBAAO,MAAM,UAAU,IAAI,IAAI,SAAS,IAAI,IAAI,MAAM,YAAY,OAAO,gBAAgB;AACzF,oBAAI,eAAe,QAAQ,YAAY,IAAI,IAAI,SAAS,IAAI,IAAI,IAAI,EAAE,KAAK,MAAM;AAC7E,yBAAO,aAAa;AAAA,oBAChB,MAAM,GAAG,uBAAuB,OAAO,gBAAgB;AAAA,oBACvD,MAAM,GAAG,OAAO,yBAAyB,GAAG,aAAa;AAAA,oBACzD,MAAM,GAAG,wBAAwB;AAAA,oBACjC,MAAM,sBAAsB,OAAO,gBAAgB;AAAA,kBACvD,CAAC;AAAA,gBACL,CAAC;AACD,8BAAc,KAAK;AAAA,cACvB;AAAA,YACJ,CAAC;AAAA,UACL,CAAC;AACD,wBAAc,KAAK;AAAA,QACvB,OAAO;AACH,cAAI,CAAC,QAAQ,IAAI,YAAY,CAAC,GAAG,8BAA8B;AAC3D,mBAAO,MAAM,qDAAqD;AAClE;AAAA,UACJ;AACA,gCAAsB;AAAA,QAC1B;AAAA,MACJ,CAAC;AAGH,WAAK,WAAW,GAAG,SAAS,uBAAuB,MAAM;AACxD,WAAG,OAAO,oBAAoB;AAAA,MAC/B,CAAC;AAED,WAAK,gBAAgB,GAAG,SAAS,kBAAkB,MAAM;AACxD,WAAG,OAAO,UAAU;AACpB,WAAG,oBAAoB,IAAI;AAAA,MAC5B,CAAC;AAED,WAAK,WAAW,GAAG,SAAS,yBAAyB,MAAM;AAC1D,cAAM,oBAAoB,KAAK,mBAAmB,KAAK,oBAAoB,EAAE;AAC7E,YAAI,CAAC,KAAK,kBAAkB;AAAmB,eAAK,sBAAsB;AAAA,MAC3E,CAAC;AAED,aAAO,GAAG,KAAK,GAAG,iBAAiB,eAAe,SAAO;AACxD,aAAK,sBAAsB,GAAG;AAAA,MAC/B,CAAC;AAAA,IACF;AAAA,IAED,MAAM,uBAAuB,cAAc,cAAc;AACrD,cAAQ,IAAI,6BAA6B,cAAc,YAAY;AACnE,UAAI;AAGA,cAAM,KAAK,OAAO,uBAAuB;AAEzC,YAAI,QAAQ,YAAY,cAAc,kBAAkB;AACpD,gBAAM,QAAQ,YAAY,cAAc,iBAAiB,yCAAyC,cAAc,YAAY;AAE5H,cAAI,QAAQ,YAAY,iBAAiB,kBAAkB;AACvD,kBAAM,OAAO,GAAG,QAAQ,iBAAiB,YAAY,EAAE,KAAK,SAAO;AAC/D,sBAAQ,YAAY,iBAAiB,iBAAiB,gBAAgB,GAAG;AAAA,YAC7E,CAAC;AAAA,UACL;AAAA,QACJ,OAAO;AACH,kBAAQ,KAAK,+BAA+B;AAC5C,iBAAO,WAAW;AAAA,YACd,SAAS,GAAG,8DAA8D;AAAA,YAC1E,WAAW;AAAA,UACf,CAAC;AAAA,QACL;AAEA,cAAM,KAAK,iBAAiB,IAAI;AAAA,MAEpC,SAAS,OAAP;AACE,gBAAQ,MAAM,oCAAoC,KAAK;AACvD,eAAO,WAAW;AAAA,UACd,SAAS,GAAG,2DAA2D,CAAC,MAAM,OAAO,CAAC;AAAA,UACtF,WAAW;AAAA,QACf,CAAC;AACD,eAAO,MAAM,WAAW,OAAO;AAAA,MAEnC;AAAA,IACJ;AAAA,IAGA,iBAAiB,YAAY,OAAO;AAChC,WAAK,oBAAoB,KAAK,EAAE;AAChC,WAAK,sBAAsB;AAC3B,WAAK,oBAAoB,IAAI;AAC7B,WAAK,cAAc,KAAK;AACxB,WAAK,OAAO,iBAAiB,SAAS;AAAA,IAC1C;AAAA,IACC,mBAAmB;AAClB,eAAS,OAAO,KAAK,WAAW,MAAM;AACrC,iBAAS,OAAO,KAAK;AACpB,cAAI,OAAO,QAAQ;AAAU;AAE7B,cAAI,eAAe,QAAQ,OAAO,MAAM,OAAO,GAAG,CAAC,EAAE;AACrD,cAAI,QAAQ;AAAU,2BAAe;AACrC,cAAI,QAAQ;AAAU,2BAAe;AACrC,cAAI,QAAQ;AAAK,2BAAe;AAGhC,gBAAM,YAAY,KAAK,WAAW,WAAW,OAAO,KAAK,WAAW,WAAW,OAC9E,OAAO,QAAQ,WAAW,OAAO,MAAM,GAAG,IAAI;AAE/C,cAAI,iBAAiB,aAAa,MAAM,GAAG,EAAE,IAAI,OAAO,MAAM,aAAa,EAAE,KAAK,GAAG;AACrF,2BAAiB,OAAO,MAAM,OAAO,IAAI,eAAe,QAAQ,QAAQ,QAAG,IAAI;AAC/E,eAAK,gBAAgB,KAAK,kCAAkC,aAAa,EAAE,KAAK,SAAS,cAAc;AAEvG,iBAAO,GAAG,KAAK,GAAG,GAAG,gBAAgB,MAAM;AAC1C,kBAAM,kBAAkB,KAAK,WAAW,GAAG,UAAU;AACrD,gBAAI,mBAAmB,KAAK,oBAAoB,KAAK,gBAAgB,GAAG,UAAU,GAAG;AACpF,mBAAK,gBAAgB,KAAK,kCAAkC,aAAa,EAAE,MAAM;AAAA,YAClF;AAAA,UACD,CAAC;AAAA,QACF;AAAA,MACD;AACA,YAAM,aAAa,OAAO,MAAM,OAAO,IAAI,WAAM;AACjD,WAAK,WAAW,KAAK,eAAe,EAAE,KAAK,SAAS,GAAG,kBAAkB;AACzE,aAAO,GAAG,KAAK,aAAa;AAAA,QAC3B,UAAU;AAAA,QACV,QAAQ,MAAM,KAAK,WAAW,KAAK,eAAe,EAAE,MAAM;AAAA,QAC1D,WAAW,MAAM,KAAK,WAAW,GAAG,UAAU,KAAK,CAAC,KAAK,gBAAgB,KAAK,gBAAgB,EAAE,GAAG,UAAU;AAAA,QAC7G,aAAa,GAAG,2CAA2C;AAAA,QAC3D,eAAe;AAAA,QACf,MAAM,SAAS,KAAK;AAAA,MACrB,CAAC;AACD,WAAK,WAAW,KAAK,gBAAgB,EAAE,KAAK,SAAS,GAAG,cAAc;AACtE,aAAO,GAAG,KAAK,GAAG,UAAU,MAAM;AACjC,cAAM,oBAAoB,KAAK,WAAW,GAAG,UAAU;AACvD,cAAM,yBAAyB,CAAC,KAAK,gBAAgB,KAAK,eAAe,EAAE,GAAG,SAAS;AACvF,YAAI,qBAAqB,wBAAwB;AAChD,eAAK,WAAW,KAAK,gBAAgB,EAAE,MAAM;AAAA,QAC9C;AAAA,MACD,CAAC;AACD,WAAK,WAAW,KAAK,uBAAuB,EAAE,KAAK,SAAS,GAAG,cAAc;AAC7E,aAAO,GAAG,KAAK,aAAa;AAAA,QAC3B,UAAU;AAAA,QACV,QAAQ,MAAM,KAAK,WAAW,KAAK,uBAAuB,EAAE,MAAM;AAAA,QAClE,WAAW,MAAM,KAAK,mBAAmB,GAAG,UAAU;AAAA,QACtD,aAAa,GAAG,oBAAoB;AAAA,QACpC,eAAe;AAAA,QACf,MAAM,SAAS,KAAK;AAAA,MACrB,CAAC;AACD,aAAO,GAAG,KAAK,GAAG,UAAU,MAAM;AACjC,cAAM,oBAAoB,KAAK,WAAW,GAAG,UAAU;AACvD,YAAI,qBAAqB,KAAK,kBAAkB,KAAK,eAAe,OAAO,GAAG,UAAU,GAAG;AAC1F,eAAK,eAAe,UAAU,CAAC;AAAA,QAChC;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,sBAAsB,MAAM;AAC3B,YAAM,aAAa,EAAE,IAAI;AACzB,YAAM,sBAAsB,WAAW,KAAK,OAAO,KAAK;AAExD,UAAI,CAAC,QAAQ,qBAAqB;AACjC,aAAK,mBAAmB;AACxB,aAAK,gBAAgB,KAAK,oBAAoB,EAAE,IAAI,oBAAoB,EAAE;AAAA,MAC3E,OAAO;AACN,mBAAW,IAAI,oBAAoB,mBAAmB;AACtD,aAAK,mBAAmB;AACxB,aAAK,gBAAgB,KAAK,oBAAoB,EAAE,IAAI,IAAI,EAAE,IAAI,oBAAoB,EAAE;AAAA,MACrF;AAAA,IACD;AAAA,IAEA,yBAAyB;AACtB,WAAK,kBAAkB,KAAK;AAAA;AAAA,KAE3B;AACD,YAAM,KAAK;AACX,YAAM,QAAQ,EAAE,OAAO,6CAA6C;AACpE,YAAM,yBAAyB,KAAK,2BAA2B,CAAC;AAChE,UAAI,uBAAuB,QAAQ;AAC/B,cAAM,UAAU;AAAA,UACZ,gBAAgB,CAAC,MAAM,sBAAsB;AAAA,QACjD;AAAA,MACJ;AACA,WAAK,iBAAiB,OAAO,GAAG,KAAK,aAAa;AAAA,QAC9C,IAAI;AAAA,UACA,OAAO,GAAG,UAAU;AAAA,UACpB,WAAW;AAAA,UACX,SAAS;AAAA,UACT,aAAa,GAAG,wCAAwC;AAAA,UACxD,WAAW,KAAK;AAAA,UAChB,WAAW,MAAM;AAAA,UACjB,UAAU,WAAW;AACjB,gBAAI,KAAK,OAAO;AACZ,oBAAM,MAAM,GAAG,OAAO,QAAQ;AAG9B,qBAAO,IAAI,OAAO;AAElB,qBAAO,MAAM,UAAU,IAAI,IAAI,SAAS,IAAI,IAAI,MAAM,YAAY,KAAK,KAAK;AAC5E,kBAAI,eAAe,QAAQ,YAAY,IAAI,IAAI,SAAS,IAAI,IAAI,IAAI,EAAE,KAAK,MAAM;AAC7E,uBAAO,aAAa;AAAA,kBAChB,MAAM,GAAG,uBAAuB,KAAK,KAAK;AAAA,kBAC1C,MAAM,GAAG,OAAO,yBAAyB,GAAG,aAAa;AAAA,kBACzD,MAAM,GAAG,wBAAwB;AAAA,kBACjC,MAAM,GAAG,sBAAsB;AAAA,kBAC/B,MAAM,OAAO,IAAI,SAAS;AAAA,gBAC9B,CAAC;AAAA,cACL,CAAC;AAAA,YACL;AAAA,UACJ;AAAA,QACJ;AAAA,QACA,QAAQ,KAAK,kBAAkB,KAAK,iBAAiB;AAAA,QACrD,cAAc;AAAA,MAClB,CAAC;AACD,WAAK,eAAe,aAAa,KAAK;AAAA,IAC1C;AAAA,IAEC,uBAAuB,UAAU;AAChC,UAAI,UAAU;AACb,eAAO,IAAI,QAAQ,CAAC,YAAY;AAC/B,iBAAO,GAAG,UAAU,YAAY,UAAU,CAAC,YAAY,aAAa,SAAS,iBAAiB,CAAC,EAAE,KAAK,CAAC,EAAE,QAAQ,MAAM;AACtH,kBAAM,EAAE,gBAAgB,IAAI;AAE5B,gBAAI,iBAAiB;AACpB,qBAAO,KAAK;AAAA,gBACX,QAAQ;AAAA,gBACR,MAAM,EAAE,UAAU,iBAAiB,UAAU,KAAK;AAAA,gBAClD,UAAU,CAAC,MAAM;AAChB,wBAAM,EAAE,gBAAgB,kBAAkB,IAAI,EAAE;AAChD,sBAAI,CAAC,EAAE,KAAK;AACX,yBAAK,gBAAgB,iCAAK,UAAL,EAAc,UAAU,gBAAgB,kBAAkB;AAC/E,4BAAQ;AAAA,kBACT;AAAA,gBACD;AAAA,cACD,CAAC;AAAA,YACF,OAAO;AACN,mBAAK,gBAAgB,iCAAK,UAAL,EAAc,SAAS;AAC5C,sBAAQ;AAAA,YACT;AAAA,UACD,CAAC;AAAA,QACF,CAAC;AAAA,MACF,OAAO;AACN,eAAO,IAAI,QAAQ,CAAC,YAAY;AAC/B,eAAK,gBAAgB,CAAC;AACtB,kBAAQ;AAAA,QACT,CAAC;AAAA,MACF;AAAA,IACD;AAAA,IAEA,wBAAwB;AACvB,WAAK,mBAAmB,IAAI,EAAE,WAAW,OAAO,UAAU,OAAO,CAAC;AAClE,WAAK,mBAAmB;AAAA,QACvB;AAAA,MACD;AACA,YAAM,KAAK;AACX,YAAM,MAAM,GAAG,OAAO,QAAQ;AAC9B,UAAI,WAAW,IAAI,IAAI;AAEvB,WAAK,iBAAiB,OAAO,GAAG,KAAK,aAAa;AAAA,QACjD,IAAI;AAAA,UACH,OAAO,GAAG,UAAU;AAAA,UACpB,WAAW;AAAA,UACX,aAAe,WAAW,WAAW,MAAO,GAAG,4BAA4B;AAAA,UAC3E,aAAa;AAAA,UACb,UAAU,WAAW;AACpB,gBAAI,IAAI,KAAK,KAAK,KAAK,GAAG;AACzB,qBAAO,MAAM,UAAU,IAAI,IAAI,SAAS,IAAI,IAAI,MAAM,kCAAkC,IAAI,KAAK,KAAK,CAAC;AACvG,iBAAG,sBAAsB,KAAK,KAAK;AAAA,YACpC,OAAO;AACN,qBAAO,MAAM,UAAU,IAAI,IAAI,SAAS,IAAI,IAAI,MAAM,kCAAkC,CAAC;AACzF,iBAAG,mBAAmB,IAAI;AAAA,gBACzB,UAAU;AAAA,gBACV,WAAW;AAAA,cACZ,CAAC;AACD,iBAAG,mBAAmB,KAAK,GAAG,GAAG,kBAAkB,KAAK,GAAG,cAAc,GAAG;AAC5E,iBAAG,iBAAiB;AAAA,YACrB;AAAA,UACD;AAAA,QACD;AAAA,QACA,QAAQ,KAAK,mBAAmB,KAAK,qBAAqB;AAAA,QAC1D,cAAc;AAAA,MACf,CAAC;AACD,WAAK,eAAe,aAAa,KAAK;AACtC,WAAK,eAAe,UAAU;AAAA,IAC/B;AAAA,IAEA,sBAAsB,UAAU;AAC/B,UAAI,CAAC,UAAU;AACd,aAAK,mBAAmB,IAAI,EAAE,WAAW,OAAO,UAAU,OAAO,CAAC;AAClE,aAAK,mBAAmB;AAAA,UACvB;AAAA,QACD;AAAA,MACD,OAAO;AACN,aAAK,mBAAmB,IAAI;AAAA,UAC3B,UAAU;AAAA,UACV,WAAW;AAAA,QACZ,CAAC;AACD,aAAK,mBAAmB;AAAA,UACvB;AAAA,OACG,KAAK,kBAAkB,KAAK,GAAG,YAAY,UAAU,OAAO,QAAQ,EAAE,KAAK,MAAM,GAAG,kBAAkB;AAAA;AAAA,QAE1G;AAAA,MACD;AAAA,IACD;AAAA,IAEA,0BAA0B;AACzB,YAAM,KAAK;AACX,YAAM,EAAE,UAAU,WAAS,IAAI,YAAU,IAAI,MAAM,IAAI,KAAK,iBAAiB,CAAC;AAE9E,UAAI,UAAU;AACb,aAAK,kBAAkB;AAAA,UACtB;AAAA;AAAA,QAEI,KAAK,mBAAmB;AAAA;AAAA,oCAEI;AAAA,SAC3B,yBAAyB;AAAA;AAAA,uDAEqB,OAAO,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAOnE;AACA,YAAG,KAAK,8BAA6B;AACpC,eAAK,kBAAkB,KAAK,qBAAqB,EAAE,IAAI,WAAW,MAAM;AAAA,QACzE,OAAO;AACN,eAAK,kBAAkB,KAAK,qBAAqB,EAAE,IAAI,WAAW,MAAM;AAAA,QACzE;AAAA,MACD,OAAO;AAEN,aAAK,wBAAwB;AAAA,MAC9B;AAEA,eAAS,2BAA2B;AACnC,YAAI,CAAC,YAAY,CAAC,WAAW;AAC5B,iBAAO,8BAA8B,GAAG,4BAA4B;AAAA,QACrE,WAAW,YAAY,CAAC,WAAW;AAClC,iBAAO,8BAA8B;AAAA,QACtC,WAAW,aAAa,CAAC,UAAU;AAClC,iBAAO,8BAA8B;AAAA,QACtC,OAAO;AACN,iBAAO,8BAA8B,cAAc;AAAA,QACpD;AAAA,MACD;AAAA,IAED;AAAA,IAEA,qBAAqB;AACpB,YAAM,EAAE,UAAU,MAAM,IAAI,KAAK,iBAAiB,CAAC;AACnD,UAAI,OAAO;AACV,eAAO,yCAAyC,eAAe;AAAA,MAChE,OAAO;AACN,eAAO,6CAA6C,OAAO,SAAS,QAAQ;AAAA,MAC7E;AAAA,IACD;AAAA,IAEA,sBAAsB,KAAK;AAC1B,UAAI,CAAC;AAAK,cAAM,KAAK,OAAO,QAAQ;AAEpC,WAAK,iBAAiB,IAAI,IAAI,SAAS;AACvC,WAAK,sBAAsB,IAAI,IAAI,KAAK;AACxC,YAAM,cAAc,KAAK,OAAO,aAAa,qBAAqB,IAAI,IAAI,IAAI,cAAc,IAAI,IAAI;AACpG,WAAK,mBAAmB,WAAW;AAEnC,WAAK,aAAa,IAAI,IAAI,KAAK;AAAA,IAChC;AAAA,IAEA,iBAAiB,OAAO;AACvB,YAAM,WAAW,KAAK,OAAO,QAAQ,EAAE,IAAI;AAC3C,WAAK,gBAAgB,KAAK,sBAAsB,EAAE;AAAA,QACjD,QAAQ,GAAG,WAAW,eAAe,gBAAgB,OAAO,QAAQ;AAAA,MACrE;AAEA,WAAK,gBAAgB,KAAK,mBAAmB,EAAE;AAAA,QAC9C,QAAQ,GAAG,WAAW,YAAY,gBAAgB,OAAO,QAAQ;AAAA,MAClE;AAAA,IACD;AAAA,IAEA,sBAAsB,OAAO;AAC5B,UAAI,iBAAiB;AACrB,YAAM,IAAI,CAAC,SAAS;AACnB,yBAAiB,iBAAiB,KAAK;AAAA,MACxC,CAAC;AAED,WAAK,gBAAgB,KAAK,2BAA2B,EAAE;AAAA,QACtD,QAAQ,GAAG,gBAAgB,eAAe;AAAA,MAC3C;AAEA,WAAK,gBAAgB,KAAK,wBAAwB,EAAE;AAAA,QACnD,QAAQ,GAAG,gBAAgB,YAAY;AAAA,MACxC;AAAA,IACD;AAAA,IAEA,mBAAmB,OAAO;AACzB,YAAM,WAAW,KAAK,OAAO,QAAQ,EAAE,IAAI;AAC3C,WAAK,gBAAgB,KAAK,wBAAwB,EAAE;AAAA,QACnD,QAAQ,GAAG,aAAa,eAAe,gBAAgB,OAAO,QAAQ;AAAA,MACvE;AAEA,WAAK,gBAAgB,KAAK,qBAAqB,EAAE;AAAA,QAChD,QAAQ,GAAG,aAAa,YAAY,gBAAgB,OAAO,QAAQ;AAAA,MACpE;AAAA,IACD;AAAA,IAEA,aAAa,OAAO;AACnB,UAAI,SAAS,MAAM,QAAQ;AAC1B,cAAM,WAAW,KAAK,OAAO,QAAQ,EAAE,IAAI;AAC3C,cAAM,aAAa,MAAM,IAAI,OAAK;AACjC,cAAI,EAAE,oCAAoC;AAAK;AAE/C,gBAAM,cAAc,SAAS,KAAK,EAAE,WAAW,IAAI,EAAE,cAAgB,EAAE,QAAQ,IAAK,GAAG,EAAE,iBAAiB,EAAE,UAAS,EAAE;AACvH,iBAAO;AAAA,8BACmB;AAAA,8BACA,gBAAgB,EAAE,kCAAkC,QAAQ;AAAA;AAAA,QAEvF,CAAC,EAAE,KAAK,EAAE;AACV,aAAK,gBAAgB,KAAK,kBAAkB,EAAE,IAAI,WAAW,MAAM,EAAE,KAAK,UAAU;AAAA,MACrF,OAAO;AACN,aAAK,gBAAgB,KAAK,kBAAkB,EAAE,IAAI,WAAW,MAAM,EAAE,KAAK,EAAE;AAAA,MAC7E;AAAA,IACD;AAAA,IAEA,cAAc,EAAE,KAAK,GAAG;AACvB,YAAM,gBAAgB,qCAAqC,OAAO,IAAI;AACtE,aAAO,KAAK,oBAAoB,KAAK,aAAa;AAAA,IACnD;AAAA,IAEA,kBAAkB,MAAM;AACvB,YAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,aAAO,IAAI,MAAM,KAAK,OAAK,EAAE,QAAQ,KAAK,IAAI;AAAA,IAC/C;AAAA,IAEA,iBAAiB,MAAM,aAAa;AACnC,YAAM,QAAQ,KAAK,cAAc,IAAI;AAErC,UAAI,aAAa;AAChB,iBAAS,MAAM,KAAK,EAAE,OAAO,KAAK,MAAM,OAAO;AAAA,MAChD,OAAO;AACN,cAAM,WAAW,KAAK,kBAAkB,IAAI;AAC5C,aAAK,iBAAiB,UAAU,KAAK;AAAA,MACtC;AAEA,YAAM,mBAAmB,KAAK,oBAAoB,KAAK,oBAAoB,EAAE;AAC7E,WAAK,uBAAuB,IAAI;AAEhC,WAAK,0BAA0B,gBAAgB;AAAA,IAChD;AAAA,IAEA,iBAAiB,WAAW,iBAAiB;AAC5C,YAAM,WAAW,KAAK,OAAO,QAAQ,EAAE,IAAI;AAC3C,YAAM,KAAK;AAEX,UAAI,CAAC,gBAAgB,QAAQ;AAC5B,aAAK,oBAAoB;AAAA,UACxB,iDAAiD,OAAO,UAAU,IAAI;AAAA;AAAA,QAEvE;AACA,0BAAkB,KAAK,cAAc,SAAS;AAAA,MAC/C;AAEA,sBAAgB;AAAA,QACf,GAAG,oBAAoB;AAAA;AAAA;AAAA,OAGnB,UAAU;AAAA;AAAA,MAEX,qBAAqB;AAAA;AAAA,KAEtB,uBAAuB;AAAA,MAC1B;AAEA,oCAA8B;AAE9B,eAAS,gCAAgC;AACxC,cAAM,YAAY,MAAM,KAAK,GAAG,oBAAoB,KAAK,mBAAmB,CAAC;AAC7E,WAAG,aAAa,KAAK,qBAAqB,EAAE,IAAI,SAAS,EAAE;AAC3D,WAAG,oBAAoB,KAAK,mBAAmB,EAAE,IAAI,SAAS,EAAE;AAChE,YAAI,YAAY,UAAU,OAAO,CAACC,YAAW,QAAQ;AACpD,cAAI,EAAE,GAAG,EAAE,MAAM,IAAIA;AACpB,YAAAA,aAAY,EAAE,GAAG,EAAE,MAAM;AAC1B,iBAAOA;AAAA,QACR,GAAG,CAAC;AAEJ,qBAAa;AACb,YAAI,aAAa;AAAG,sBAAY;AAEhC,WAAG,aAAa,KAAK,qBAAqB,EAAE,IAAI,SAAS,SAAS;AAClE,WAAG,oBAAoB,KAAK,mBAAmB,EAAE,IAAI,SAAS,SAAS;AAAA,MACxE;AAEA,eAAS,yBAAyB;AACjC,YAAI,UAAU,QAAQ,UAAU,UAAU,UAAU,SAAS,UAAU,QAAQ;AAC9E,iBAAO;AAAA;AAAA,oCAEyB,UAAU,OAAO,KAAK,UAAU;AAAA;AAAA,gCAEpC,gBAAgB,UAAU,QAAQ,QAAQ;AAAA,kCACxC,gBAAgB,UAAU,MAAM,QAAQ;AAAA;AAAA;AAAA,QAGvE,OAAO;AACN,iBAAO;AAAA;AAAA,oCAEyB,UAAU,OAAO,KAAK,UAAU;AAAA;AAAA,gCAEpC,gBAAgB,UAAU,MAAM,QAAQ;AAAA;AAAA;AAAA,QAGrE;AAAA,MACD;AAEA,eAAS,uBAAuB;AAC/B,YAAI,UAAU,aAAa;AAC1B,cAAI,UAAU,YAAY,QAAQ,OAAO,KAAK,IAAI;AACjD,gBAAI;AACH,wBAAU,cAAc,EAAE,UAAU,WAAW,EAAE,KAAK;AAAA,YACvD,SAAS,OAAP;AACD,wBAAU,cAAc,UAAU,YAAY,QAAQ,UAAU,GAAG,EAAE,QAAQ,YAAY,GAAG,EAAE,QAAQ,OAAO,GAAG;AAAA,YACjH;AAAA,UACD;AACA,oBAAU,cAAc,OAAO,SAAS,UAAU,aAAa,EAAE;AACjE,iBAAO,0BAA0B,UAAU;AAAA,QAC5C;AACA,eAAO;AAAA,MACR;AAEA,eAAS,sBAAsB;AAC9B,cAAM,EAAE,OAAO,UAAU,IAAI;AAC7B,YAAI,CAAC,GAAG,eAAe,OAAO;AAC7B,iBAAO;AAAA;AAAA;AAAA;AAAA,cAIG,eAAe,OAAO,SAAS,SAAS;AAAA;AAAA,QAEnD,OAAO;AACN,iBAAO,qCAAqC,OAAO,SAAS,SAAS;AAAA,QACtE;AAAA,MACD;AAAA,IACD;AAAA,IAEA,oBAAoB,MAAM;AACzB,YAAM,YAAY,EAAE,IAAI,EAAE,KAAK,KAAK;AACpC,QAAE,IAAI,EAAE,OAAO,EAAE,YAAY,qCAAqC,iBAAiB;AAAA,IACpF;AAAA,IAEA,mCAAmC,UAAU,OAAO,MAAM;AACzD,YAAM,kBAAkB,KAAK,cAAc,IAAI;AAC/C,sBAAgB,KAAK,QAAQ,YAAY,OAAO,KAAK,CAAC;AAAA,IACvD;AAAA,IAEA,oBAAoB,eAAe;AAClC,UAAI,eAAe;AAClB,YAAG,KAAK,sBAAqB;AAC5B,eAAK,gBAAgB,KAAK,eAAe,EAAE,IAAI,WAAW,MAAM;AAAA,QACjE,OAAO;AACN,eAAK,gBAAgB,KAAK,eAAe,EAAE,IAAI,WAAW,MAAM;AAAA,QACjE;AAEA,YAAG,KAAK,kBAAiB;AACxB,eAAK,gBAAgB,KAAK,oBAAoB,EAAE,IAAI,WAAW,MAAM;AAAA,QACtE,OAAO;AACN,eAAK,gBAAgB,KAAK,oBAAoB,EAAE,IAAI,WAAW,MAAM;AAAA,QACtE;AACA,YAAG,KAAK,wBAAuB;AAC9B,eAAK,gBAAgB,KAAK,qBAAqB,EAAE,IAAI,WAAW,MAAM;AAAA,QACvE,OAAO;AACN,eAAK,gBAAgB,KAAK,qBAAqB,EAAE,IAAI,WAAW,MAAM;AAAA,QACvE;AACA,aAAK,gBAAgB,KAAK,gBAAgB,EAAE,IAAI,WAAW,MAAM;AAAA,MAClE,OAAO;AACN,aAAK,gBAAgB,KAAK,eAAe,EAAE,IAAI,WAAW,MAAM;AAC/D,aAAK,gBAAgB,KAAK,oBAAoB,EAAE,IAAI,WAAW,MAAM;AACtE,aAAK,gBAAgB,KAAK,oBAAoB,EAAE,IAAI,WAAW,MAAM;AACpE,aAAK,gBAAgB,KAAK,qBAAqB,EAAE,IAAI,WAAW,MAAM;AACvE,aAAK,gBAAgB,KAAK,gBAAgB,EAAE,IAAI,WAAW,MAAM;AAAA,MAClE;AAAA,IACD;AAAA,IAEA,uBAAuB,QAAQ;AAC9B,UAAI,QAAQ;AACX,aAAK,mBAAmB,IAAI,WAAW,MAAM;AAC7C,aAAK,gBAAgB,KAAK,eAAe,EAAE,IAAI;AAAA,UAC9C,oBAAoB;AAAA,QACrB,CAAC;AACD,YAAG,KAAK,kBAAiB;AACxB,eAAK,gBAAgB,KAAK,oBAAoB,EAAE,IAAI;AAAA,YACnD,oBAAoB;AAAA,UACrB,CAAC;AAAA,QACF,OAAO;AACN,eAAK,gBAAgB,KAAK,oBAAoB,EAAE,IAAI;AAAA,YACnD,oBAAoB;AAAA,UACrB,CAAC;AAAA,QACF;AACA,YAAG,KAAK,wBAAuB;AAC9B,eAAK,gBAAgB,KAAK,qBAAqB,EAAE,IAAI;AAAA,YACpD,oBAAoB;AAAA,UACrB,CAAC;AAAA,QACF,OAAO;AACN,eAAK,gBAAgB,KAAK,qBAAqB,EAAE,IAAI;AAAA,YACpD,oBAAoB;AAAA,UACrB,CAAC;AAAA,QACF;AAAA,MAED,OAAO;AACN,aAAK,mBAAmB,IAAI,WAAW,MAAM;AAC7C,aAAK,gBAAgB,KAAK,eAAe,EAAE,IAAI;AAAA,UAC9C,oBAAoB;AAAA,QACrB,CAAC;AACD,aAAK,gBAAgB,KAAK,oBAAoB,EAAE,IAAI;AAAA,UACnD,oBAAoB;AAAA,QACrB,CAAC;AAED,aAAK,gBAAgB,KAAK,qBAAqB,EAAE,IAAI;AAAA,UACpD,oBAAoB;AAAA,QACrB,CAAC;AAAA,MACF;AAAA,IACD;AAAA,IAEA,0BAA0B,kBAAkB;AAC3C,YAAM,mBAAmB,KAAK,oBAAoB,KAAK,kBAAkB;AAGzE,yBAAmB,KAAK,oBAAoB,iBAAiB,OAAO,KAAK,KAAK,aAAa,IAAI,WAAW,MAAM;AAEhH,2BAAqB,KAAK,CAAC,iBAAiB,UAAU,KAAK,0BAA0B;AAAA,IACtF;AAAA,IAEA,gBAAgB,MAAM;AACrB,YAAM,iBAAiB,KAAK,KAAK,mBAAmB;AACpD,YAAM,uBAAuB,CAAC,OAAO,uBAAuB,MAAM,EAAE,SAAS,cAAc;AAC3F,YAAM,oBAAoB,uBACxB,kBAAkB,UAAU,KAAK,qBACjC,kBAAkB,yBAAyB,KAAK,yBAChD,kBAAkB,QAAU;AAE9B,YAAM,0BAA0B,KAAK,gBAAgB;AACrD,YAAM,oBAAoB,CAAC,KAAK;AAChC,YAAM,wBAAwB,KAAK,eAAe,KAAK,eAAe;AAEtE,UAAI,sBAAsB;AACzB,YAAI,CAAC,mBAAmB;AACvB,gBAAM,QAAQ,kBAAkB,SAAS,OAAO,KAAK,IAAI,WAAW,KAAK;AACzE,gBAAM,UAAU,GAAG,0DAA0D,CAAC,KAAK,CAAC;AACpF,iBAAO,WAAW;AAAA,YACjB,WAAW;AAAA,YACX;AAAA,UACD,CAAC;AACD,iBAAO,MAAM,WAAW,OAAO;AAC/B;AAAA,QACD;AAEA,YAAI,qBAAqB,uBAAuB;AAC/C,eAAK,cAAc;AAAA,QACpB,WAAW,yBAAyB;AACnC,eAAK,cAAc;AAAA,QACpB;AACA,aAAK,eAAe;AAAA,MAErB,WAAW,mBAAmB,YAAY;AACzC,aAAK,cAAc;AACnB,aAAK,sBAAsB;AAC3B,aAAK,OAAO,aAAa,QAAW,cAAc;AAClD;AAAA,MACD,WAAW,mBAAmB,UAAU;AACvC,aAAK,cAAc;AACnB,aAAK,sBAAsB;AAC3B,aAAK,OAAO,aAAa,QAAW,cAAc;AAClD;AAAA,MACD,OAAO;AACN,aAAK,eAAe,mBAAmB,WAAW,KAAK,aAAa,MAAM,GAAG,EAAE,IAAI,KAAK,eAAe;AACvG,aAAK,eAAe,KAAK,gBAAgB;AAAA,MAC1C;AAEA,YAAM,sCAAsC,CAAC,wBAAwB;AAErE,UAAI,qCAAqC;AACxC,eAAO,WAAW;AAAA,UACjB,WAAW;AAAA,UACX,SAAS,GAAG,2CAA2C;AAAA,QACxD,CAAC;AACD,eAAO,MAAM,WAAW,OAAO;AAC/B;AAAA,MACD;AAEA,UAAI,IAAI,KAAK,YAAY,IAAI,OAAO,KAAK,gBAAgB,uBAAuB;AAC/E,eAAO,WAAW;AAAA,UACjB,SAAS,GAAG,sCAAsC;AAAA,UAClD,WAAW;AAAA,QACZ,CAAC;AACD,eAAO,MAAM,WAAW,OAAO;AAC/B,aAAK,eAAe;AAAA,MACrB;AAEA,WAAK,qBAAqB,MAAM,cAAc;AAC9C,WAAK,OAAO,aAAa,KAAK,cAAc,KAAK,WAAW;AAAA,IAC7D;AAAA,IAEA,qBAAqB,MAAM,aAAa;AACvC,YAAM,6BAA6B,KAAK,SAAS,wBAAwB;AACzE,YAAM,wBAAwB,CAAC,OAAO,uBAAuB,QAAQ,MAAM,EAAE,SAAS,WAAW;AAEjG,UAAI,CAAC,4BAA4B;AAChC,aAAK,SAAS,wBAAwB;AAAA,MACvC;AACA,UAAI,KAAK,gBAAgB,eAAe,4BAA4B;AAEnE,aAAK,YAAY,wBAAwB;AAAA,MAC1C;AACA,UAAI,KAAK,eAAe,KAAK,gBAAgB,eAAe,uBAAuB;AAElF,cAAM,WAAW,EAAE,uBAAuB,KAAK,eAAe;AAC9D,iBAAS,YAAY,wBAAwB;AAAA,MAC9C;AACA,UAAI,CAAC,yBAAyB,gBAAgB,QAAQ;AAErD,mBAAW,MAAM;AAChB,eAAK,YAAY,wBAAwB;AAAA,QAC1C,GAAG,GAAG;AAAA,MACP;AAAA,IACD;AAAA,IAEA,cAAc,MAAM;AACnB,UAAI,MAAM;AACT,aAAK,gBAAgB,IAAI,WAAW,MAAM;AAC1C,aAAK,gBAAgB,IAAI,WAAW,MAAM;AAAA,MAC3C,OAAO;AACN,aAAK,gBAAgB,IAAI,WAAW,MAAM;AAC1C,aAAK,gBAAgB,IAAI,WAAW,MAAM;AAAA,MAC3C;AACA,WAAK,aAAa;AAAA,IACnB;AAAA,IAEA,eAAe;AACd,WAAK,eAAe;AACpB,WAAK,cAAc;AACnB,WAAK,gBAAgB,KAAK,yBAAyB,EAAE,YAAY,wBAAwB;AAAA,IAC1F;AAAA,IAEA,yBAAyB,WAAW;AACnC,UAAI,CAAC,OAAO,uBAAuB,MAAM,EAAE,SAAS,SAAS,GAAG;AAC/D,aAAK,gBAAgB,KAAK,uBAAuB,aAAa,EAAE,MAAM;AAAA,MACvE;AAAA,IACD;AAAA,IAEA,qBAAqB,MAAM;AAC1B,UAAI,MAAM;AACT,cAAM,EAAE,SAAS,IAAI,KAAK,iBAAiB,CAAC;AAE5C,aAAK,gBAAgB,IAAI,WAAW,MAAM;AAC1C,aAAK,kBAAkB,IAAI;AAAA,UAC1B,UAAU;AAAA,UACV,eAAe;AAAA,QAChB,CAAC;AACD,aAAK,kBAAkB,KAAK,mBAAmB,EAAE;AAAA,UAChD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OASG,KAAK,mBAAmB;AAAA;AAAA,mCAEI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAWhC;AAEA,aAAK,kBAAkB,OAAO,2CAA2C;AACzE,YAAG,KAAK,8BAA6B;AACpC,eAAK,kBAAkB,KAAK,kBAAkB,EAAE,IAAI,WAAW,MAAM;AACrE,eAAK,kBAAkB,KAAK,oBAAoB,EAAE,IAAI,WAAW,MAAM;AAAA,QACxE,OAAO;AACN,eAAK,kBAAkB,KAAK,kBAAkB,EAAE,IAAI,WAAW,MAAM;AACrE,eAAK,kBAAkB,KAAK,oBAAoB,EAAE,IAAI,WAAW,MAAM;AAAA,QACxE;AACA,aAAK,uBAAuB;AAC5B,aAAK,4BAA4B;AAAA,MAElC,OAAO;AACN,aAAK,gBAAgB,IAAI,WAAW,MAAM;AAC1C,aAAK,kBAAkB,IAAI;AAAA,UAC1B,UAAU;AAAA,UACV,eAAe;AAAA,QAChB,CAAC;AAED,aAAK,wBAAwB;AAAA,MAC9B;AAAA,IACD;AAAA,IAEA,yBAAyB;AACxB,YAAM,iBAAiB,KAAK,kBAAkB,KAAK,4BAA4B;AAE/E,YAAM,MAAM,CAAC;AAAA,QACZ,WAAW;AAAA,QACX,OAAO,GAAG,OAAO;AAAA,QACjB,WAAW;AAAA,QACX,SAAS;AAAA,QACT,aAAa,GAAG,wBAAwB;AAAA,MACzC,GAAE;AAAA,QACD,WAAW;AAAA,QACX,OAAO,GAAG,cAAc;AAAA,QACxB,WAAW;AAAA,QACX,aAAa,GAAG,+BAA+B;AAAA,MAChD,GAAE;AAAA,QACD,WAAW;AAAA,QACX,OAAO,GAAG,iBAAiB;AAAA,QAC3B,WAAW;AAAA,QACX,SAAS;AAAA,QACT,aAAa,GAAG,wBAAwB;AAAA,MACzC,GAAE;AAAA,QACD,WAAW;AAAA,QACX,OAAO,GAAG,gBAAgB;AAAA,QAC1B,WAAW;AAAA,QACX,WAAW;AAAA,MACZ,CAAC;AAED,YAAM,KAAK;AACX,UAAI,QAAQ,QAAM;AACjB,aAAK,YAAY,GAAG,qBAAqB,OAAO,GAAG,KAAK,aAAa;AAAA,UACpE,IAAI,iCAAK,KAAL;AAAA,YACH,UAAU;AAAA,UACX;AAAA,UACA,QAAQ,eAAe,KAAK,IAAI,GAAG,iBAAiB;AAAA,UACpD,cAAc;AAAA,QACf,CAAC;AACD,aAAK,YAAY,GAAG,mBAAmB,UAAU,KAAK,cAAc,GAAG,UAAU;AAAA,MAClF,CAAC;AAED,eAAS,+BAA+B;AACvC,cAAM,gBAAgB,GAAG,cAAc,KAAK,GAAG;AAC/C,cAAM,mBAAmB,GAAG,cAAc;AAE1C,YAAI,KAAK,SAAS,iBAAiB,KAAK,SAAS,KAAK,GAAG,aAAa,kBAAkB;AACvF,iBAAO,KAAK;AAAA,YACX,QAAQ;AAAA,YACR,MAAM;AAAA,cACL,WAAW,KAAK,GAAG;AAAA,cACnB,UAAU;AAAA,cACV,OAAO,KAAK;AAAA,YACb;AAAA,YACA,UAAU,CAAC,MAAM;AAChB,kBAAG,CAAC,EAAE,KAAK;AACV,mBAAG,cAAc,KAAK,GAAG,aAAa,KAAK;AAC3C,uBAAO,WAAW;AAAA,kBACjB,SAAS,GAAG,wCAAwC;AAAA,kBACpD,WAAW;AAAA,gBACZ,CAAC;AACD,uBAAO,MAAM,WAAW,QAAQ;AAAA,cACjC;AAAA,YACD;AAAA,UACD,CAAC;AAAA,QACF;AAAA,MACD;AAAA,IACD;AAAA,IAEA,8BAA8B;AAC7B,aAAO,GAAG,SAAS,iBAAiB;AAAA,QACnC,SAAS,EAAE,UAAU,KAAK,cAAc,UAAU,WAAW,EAAE;AAAA,QAC/D,QAAQ,CAAC,QAAQ,eAAe,UAAU,gBAAgB,gBAAgB,UAAU;AAAA,QACpF,OAAO;AAAA,MACR,CAAC,EAAE,KAAK,CAAC,QAAQ;AAChB,cAAM,wBAAwB,KAAK,kBAAkB,KAAK,wBAAwB;AAElF,YAAI,CAAC,IAAI,QAAQ;AAChB,gCAAsB;AAAA,YACrB;AAAA,UACD;AACA;AAAA,QACD;AAEA,cAAM,eAAe,OAAO,IAAI,GAAG,eAAa,MAAI,IAAI,GAAG,YAAY,EAAE,QAAQ;AACjF,aAAK,kBAAkB,KAAK,gBAAgB,EAAE,KAAK,mBAAmB,cAAc;AAEpF,YAAI,QAAQ,aAAW;AACtB,gBAAM,mBAAmB,OAAO,QAAQ,eAAa,MAAI,QAAQ,YAAY,EAAE,OAAO,gBAAgB;AACtG,cAAI,kBAAkB;AAAA,YACrB,QAAQ;AAAA,YACR,SAAS;AAAA,YACT,UAAU;AAAA,YACV,gBAAgB;AAAA,UACjB;AAEA,gCAAsB;AAAA,YACrB,mDAAmD,OAAO,QAAQ,IAAI;AAAA;AAAA,mCAExC,QAAQ;AAAA,mCACR;AAAA;AAAA;AAAA;AAAA,UAIzB,gBAAgB,QAAQ,aAAa,QAAQ,UAAU,CAAC,KAAK;AAAA;AAAA;AAAA,wDAGf,gBAAgB,QAAQ;AAAA,iBAC/D,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAMrB;AAAA,QACD,CAAC;AAAA,MACF,CAAC;AAAA,IACF;AAAA,IAEA,2BAA2B,KAAK;AAC/B,QAAE,IAAI,OAAO,EAAE,IAAI,gBAAgB;AACnC,QAAE,IAAI,OAAO,EAAE,GAAG,kBAAkB,MAAM;AACzC,YAAI,IAAI,IAAI,MAAM,QAAQ;AACzB,eAAK,oBAAoB,KAAK,EAAE;AAChC,cAAI,IAAI,MAAM,QAAQ,UAAQ;AAC7B,iBAAK,iBAAiB,IAAI;AAAA,UAC3B,CAAC;AAAA,QACF;AACA,aAAK,sBAAsB,GAAG;AAAA,MAC/B,CAAC;AAAA,IACF;AAAA,IAEA,eAAe;AACd,YAAM,MAAM,KAAK,OAAO,QAAQ;AAEhC,WAAK,2BAA2B,GAAG;AAEnC,WAAK,uBAAuB,IAAI,IAAI,QAAQ,EAAE,KAAK,MAAM;AACxD,aAAK,OAAO,yBAAyB,KAAK,aAAa;AACvD,aAAK,wBAAwB;AAAA,MAC9B,CAAC;AAED,WAAK,oBAAoB,KAAK,EAAE;AAChC,UAAI,IAAI,IAAI,MAAM,QAAQ;AACzB,YAAI,IAAI,MAAM,QAAQ,UAAQ;AAC7B,eAAK,iBAAiB,IAAI;AAAA,QAC3B,CAAC;AAAA,MACF,OAAO;AACN,aAAK,0BAA0B;AAC/B,aAAK,uBAAuB,IAAI;AAAA,MACjC;AAEA,WAAK,sBAAsB,GAAG;AAE9B,UAAG,IAAI,IAAI,cAAc,GAAG;AAC3B,aAAK,gBAAgB,KAAK,eAAe,EAAE,IAAI,WAAW,MAAM;AAChE,aAAK,gBAAgB,KAAK,oBAAoB,EAAE,IAAI,WAAW,MAAM;AACrE,YAAG,KAAK,wBAAuB;AAC9B,eAAK,gBAAgB,KAAK,qBAAqB,EAAE,IAAI,WAAW,MAAM;AAAA,QACvE,OAAO;AACN,eAAK,gBAAgB,KAAK,qBAAqB,EAAE,IAAI,WAAW,MAAM;AAAA,QACvE;AACA,aAAK,gBAAgB,KAAK,gBAAgB,EAAE,IAAI,WAAW,MAAM;AAAA,MAClE,OAAO;AACN,YAAG,KAAK,sBAAsB;AACjB,eAAK,gBAAgB,KAAK,eAAe,EAAE,IAAI,WAAW,MAAM;AAAA,QACpE,OAAO;AACC,eAAK,gBAAgB,KAAK,eAAe,EAAE,IAAI,WAAW,MAAM;AAAA,QAEjF;AACA,YAAG,KAAK,kBAAiB;AACxB,eAAK,gBAAgB,KAAK,oBAAoB,EAAE,IAAI,WAAW,MAAM;AAAA,QACtE,OAAO;AACP,eAAK,gBAAgB,KAAK,oBAAoB,EAAE,IAAI,WAAW,MAAM;AAAA,QACrE;AACA,YAAG,KAAK,wBAAuB;AAC9B,eAAK,gBAAgB,KAAK,qBAAqB,EAAE,IAAI,WAAW,MAAM;AAAA,QACvE,OAAO;AACN,eAAK,gBAAgB,KAAK,qBAAqB,EAAE,IAAI,WAAW,MAAM;AAAA,QACvE;AACA,aAAK,gBAAgB,KAAK,gBAAgB,EAAE,IAAI,WAAW,MAAM;AAAA,MAClE;AAEA,WAAK,iBAAiB,IAAI;AAAA,IAC3B;AAAA,IAEA,iBAAiB,MAAM;AACtB,aAAO,KAAK,WAAW,IAAI,WAAW,MAAM,IAAI,KAAK,WAAW,IAAI,WAAW,MAAM;AAAA,IACtF;AAAA,EAED;;;ACtiDA,SAAO,QAAQ,qBAAqB;AACpC,UAAQ,YAAY,cAAc,MAAM;AAAA,IACvC,YAAY,EAAE,SAAS,QAAQ,SAAS,GAAG;AAC1C,WAAK,UAAU;AACf,WAAK,SAAS;AACd,WAAK,cAAc,SAAS;AAC5B,WAAK,oBAAoB,SAAS;AAClC,WAAK,wBAAwB,SAAS;AACtC,WAAK,2BAA2B,SAAS;AACzC,WAAK,eAAe,CAAC;AAErB,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,iBAAiB;AAChB,WAAK,YAAY;AACjB,WAAK,sBAAsB;AAC3B,WAAK,YAAY;AACjB,WAAK,iBAAiB;AAAA,IACvB;AAAA,IAEA,cAAc;AACb,WAAK,QAAQ;AAAA,QACZ;AAAA,MACD;AAEA,WAAK,aAAa,KAAK,QAAQ,KAAK,yBAAyB;AAAA,IAC9D;AAAA,IAEA,wBAAwB;AACvB,WAAK,WAAW;AAAA,QACf;AAAA,yBACsB,GAAG,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAkBzC;AAEA,WAAK,aAAa,KAAK,WAAW,KAAK,YAAY;AACnD,WAAK,oBAAoB,KAAK,WAAW,KAAK,YAAY;AAC1D,WAAK,cAAc,KAAK,WAAW,KAAK,aAAa;AACrD,WAAK,cAAc,KAAK,WAAW,KAAK,aAAa;AACrD,WAAK,kBAAkB,KAAK,WAAW,KAAK,iBAAiB;AAC7D,WAAK,mBAAmB,KAAK,WAAW,KAAK,mBAAmB;AAChE,WAAK,0BAA0B,KAAK,WAAW,KAAK,yBAAyB;AAAA,IAC9E;AAAA,IAEA,0BAA0B,MAAM;AAE/B,aAAO,QAAQ,KAAK,QAAQ,KAAK,aAAa;AAAA,IAC/C;AAAA,IAEA,MAAM,4BAA4B,MAAM;AACvC,YAAM,uBAAuB,CAAC,KAAK,0BAA0B,IAAI;AAGjE,YAAM,oBAAoB,CAAC,QAAQ,IAAI,KAAK,CAAC;AAE7C,UAAK,CAAC,qBAAqB,wBAAyB,mBAAmB;AAGtE,cAAM,KAAK,2BAA2B;AAAA,MACvC;AACA,UAAG,CAAC,KAAK,0BAAyB;AACjC,aAAK,OAAO,qBAAqB,CAAC,iBAAiB;AACnD,aAAK,iBAAiB,CAAC,iBAAiB;AAAA,MACzC;AAGA,UAAI,QAAQ,sBAAsB;AACjC,aAAK,UAAU,KAAK;AACpB,aAAK,YAAY,OAAO,SAAS,KAAK,OAAO;AAC7C,aAAK,OAAO,KAAK;AACjB,aAAK,WAAW;AAChB,aAAK,WAAW,KAAK,OAAO,QAAQ,EAAE,IAAI;AAE1C,aAAK,eAAe;AAEpB,aAAK,WAAW,IAAI;AACpB,aAAK,oBAAoB,IAAI;AAC7B,aAAK,YAAY,IAAI;AACrB,aAAK,OAAO,oBAAoB,IAAI;AAAA,MACrC,OAAO;AACN,aAAK,eAAe,CAAC;AAAA,MACtB;AAAA,IACD;AAAA,IAEA,6BAA6B;AAC5B,YAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,YAAM,WAAW,IAAI,MAAM,KAAK,UAAQ,KAAK,SAAS,KAAK,IAAI;AAE/D,UAAI,CAAC;AAAU;AAEf,YAAM,aAAa,SAAS;AAC5B,YAAM,UAAU,SAAS;AACzB,YAAM,qBAAqB,CAAC,SAAS;AAErC,UAAK,cAAc,sBAAwB,WAAW,oBAAqB;AAC1E,eAAO,WAAW;AAAA,UACjB,SAAS,GAAG,sDAAsD;AAAA,UAClE,WAAW;AAAA,QACZ,CAAC;AACD,eAAO,MAAM,WAAW,QAAQ;AAChC,eAAO,KAAK,OAAO,sBAAsB;AAAA,MAC1C;AAAA,IACD;AAAA,IAEA,WAAW,MAAM;AAChB,UAAI,EAAE,WAAW,aAAa,OAAO,gBAAgB,IAAI;AAEzD,eAAS,uBAAuB;AAC/B,YAAI,aAAa;AAChB,wBAAc,YAAY,QAAQ,KAAK,MAAM,MAAM,YAAY,SAAS,MAAM,YAAY,OAAO,GAAG,GAAG,IAAI,QAAQ;AACnH,iBAAO;AAAA,QACR;AACA,eAAO;AAAA,MACR;AAEA,WAAK,WAAW,KAAK,SAAS;AAC9B,WAAK,kBAAkB,KAAK,qBAAqB,CAAC;AAClD,WAAK,YAAY,KAAK,gBAAgB,iBAAiB,KAAK,QAAQ,CAAC;AACrE,UAAI,CAAC,KAAK,eAAe,OAAO;AAC/B,aAAK,YAAY;AAAA,UAChB;AAAA;AAAA,2BAEuB;AAAA,YACf,OAAO,SAAS,SAAS;AAAA;AAAA,QAElC;AAAA,MACD,OAAO;AACN,aAAK,YAAY,KAAK,0BAA0B,OAAO,SAAS,SAAS,SAAS;AAAA,MACnF;AAAA,IAED;AAAA,IAEA,oBAAoB,MAAM;AACzB,YAAM,YAAY,EAAE,IAAI,EAAE,KAAK,KAAK;AACpC,QAAE,IAAI,EAAE,YAAY,0BAA0B,iBAAiB;AAAA,IAChE;AAAA,IAEA,oBAAoB,MAAM;AACzB,UAAI,KAAK,qBAAqB;AAC7B,aAAK,iBAAiB;AAAA,UACrB,0BAA0B,gBAAgB,KAAK,iBAAiB,KAAK,QAAQ;AAAA,iCAChD,KAAK;AAAA,QACnC;AACA,aAAK,YAAY,KAAK,gBAAgB,KAAK,MAAM,KAAK,QAAQ,CAAC;AAAA,MAChE,OAAO;AACN,aAAK,iBAAiB,KAAK,EAAE;AAAA,MAC9B;AAAA,IACD;AAAA,IAEA,YAAY,MAAM;AACjB,YAAM,oBAAoB,KAAK,gBAAgB,IAAI;AACnD,WAAK,gBAAgB,KAAK,EAAE;AAE5B,wBAAkB,QAAQ,CAAC,WAAW,QAAQ;AAC7C,aAAK,gBAAgB;AAAA,UACpB,eAAe,sCAAsC;AAAA,QACtD;AAEA,cAAM,aAAa,KAAK,UAAU,OAAO,KAAK,QAAM,GAAG,cAAc,SAAS;AAC9E,sBAAc,wBAAyB,WAAW,QAAQ,GAAG,cAAc,IAAK;AAChF,cAAM,KAAK;AACX,YAAI,OAAO,CAAC;AACZ,eAAO,GAAG,QAAQ,QAAO,GAAG,aAAa,SAAS,EAAE,KAAK,SAAO;AAC/D,iBAAO,IAAI,KAAK,IAAI,CAAAC,UAAQA,MAAK,GAAG;AAAA,QACrC,CAAC;AACD,aAAK,GAAG,uBAAuB,OAAO,GAAG,KAAK,aAAa;AAAA,UAC1D,IAAI,iCACA,aADA;AAAA,YAEH,UAAU,WAAW;AACpB,iBAAG,OAAO,aAAa,GAAG,cAAc,WAAW,KAAK,KAAK;AAAA,YAC9D;AAAA,YACA,WAAU,WAAY;AACrB,kBAAG,cAAc,OAAM;AACtB,uBAAO;AAAA,kBACN,SAAS;AAAA,oBACR,MAAM,CAAC,MAAK,IAAI;AAAA,kBACjB;AAAA,gBACD;AAAA,cACD;AACA;AAAA,YACc;AAAA,UAChB;AAAA,UACA,QAAQ,KAAK,gBAAgB,KAAK,IAAI,mBAAmB;AAAA,UACzD,cAAc;AAAA,QACf,CAAC;AACD,aAAK,GAAG,qBAAqB,UAAU,KAAK,UAAU;AAAA,MACvD,CAAC;AAED,WAAK,+BAA+B,IAAI;AAExC,WAAK,iCAAiC;AAAA,IACvC;AAAA,IAEA,gBAAgB,MAAM;AACrB,YAAM,SAAS,CAAC,OAAO,OAAO,QAAQ,qBAAqB,uBAAuB,aAAa,cAAc,iBAAiB;AAC9H,UAAI,KAAK;AAAe,eAAO,KAAK,WAAW;AAC/C,UAAI,KAAK;AAAc,eAAO,KAAK,UAAU;AAC7C,aAAO;AAAA,IACR;AAAA,IAEA,+BAA+B,MAAM;AACpC,UAAI,KAAK,iBAAiB,KAAK,cAAc;AAC5C,cAAM,QAAQ,KAAK,gBAAgB,GAAG,kBAAkB,IAAI,GAAG,iBAAiB;AAChF,aAAK,gBAAgB;AAAA,UACpB,wDAAwD;AAAA,QACzD;AACA,aAAK,gBAAgB,KAAK,oBAAoB,EAAE,KAAK,UAAU,EAAE,IAAI,UAAU,MAAM;AAAA,MACtF;AAAA,IACD;AAAA,IAEA,mCAAmC;AAClC,YAAM,KAAK;AACX,UAAI,KAAK,cAAc;AACtB,aAAK,aAAa,GAAG,WAAW,WAAW;AAC1C,cAAI,KAAK,SAAS,IAAI,KAAK,KAAK,MAAM,GAAG;AACxC,eAAG,OAAO,aAAa,GAAG,cAAc,QAAQ,KAAK,KAAK,EAAE,KAAK,MAAM;AACtE,oBAAM,WAAW,OAAO,QAAQ,GAAG,SAAS,GAAG,IAAI;AACnD,oBAAM,MAAM,GAAG,OAAO,QAAQ,EAAE;AAChC,iBAAG,YAAY,KAAK,gBAAgB,SAAS,MAAM,IAAI,QAAQ,CAAC;AAChE,iBAAG,oBAAoB,QAAQ;AAAA,YAChC,CAAC;AAAA,UACF;AAAA,QACD;AACA,aAAK,aAAa,GAAG,YAAY,CAAC,KAAK;AACvC,aAAK,aAAa,QAAQ;AAAA,MAC3B;AAEA,UAAI,KAAK,+BAA+B,CAAC,KAAK,uBAAuB;AACpE,aAAK,4BAA4B,GAAG,YAAY;AAChD,aAAK,4BAA4B,QAAQ;AAAA,MAC1C;AAEA,UAAI,KAAK,mBAAmB;AAC3B,aAAK,kBAAkB,GAAG,OAAO;AACjC,aAAK,kBAAkB,GAAG,WAAW,WAAW;AAC/C,cAAI,KAAK,OAAO;AACf,eAAG,OAAO,aAAa,GAAG,cAAc,aAAa,KAAK,KAAK,EAAE,KAAK,MAAM;AAC3E,iBAAG,iBAAiB,GAAG,OAAO,mBAAmB;AACjD,oBAAM,gBAAgB,GAAG,eAAe,GAAG,SAAS,WAAW,KAAK,OAAO;AAC3E,oBAAM,gBAAgB,QAAQ,GAAG,eAAe,GAAG,SAAS,WAAW,KAAK,OAAO,EAAE;AACrF,kBAAI,kBAAkB,QAAW;AAChC,mBAAG,OAAO,oBAAoB,GAAG,SAAS,WAAW,KAAK,KAAK,EAAE,KAAK,MAAM;AAE3E,qBAAG,kBAAkB,UAAU,KAAK,KAAK;AAAA,gBAC1C,CAAC;AAAA,cACF,WAAW,kBAAkB,KAAK,eAAe;AAChD,mBAAG,kBAAkB,UAAU,EAAE;AACjC,sBAAM,iBAAiB,GAAG,SAAS,UAAU,KAAK;AAClD,sBAAM,iBAAiB,KAAK,MAAM,KAAK;AACvC,uBAAO;AAAA,kBACN,GAAG,wDAAwD,CAAC,gBAAgB,cAAc,CAAC;AAAA,gBAC5F;AAAA,cACD;AACA,iBAAG,mBAAmB,UAAU,aAAa;AAAA,YAC9C,CAAC;AAAA,UACF;AAAA,QACD;AACA,aAAK,kBAAkB,GAAG,YAAY,MAAM;AAC3C,iBAAO;AAAA,YACN,SAAS,EAAE,SAAS,KAAK,OAAO,QAAQ,EAAE,IAAI,QAAQ;AAAA,UACvD;AAAA,QACD;AACA,aAAK,kBAAkB,QAAQ;AAAA,MAChC;AAEA,UAAI,KAAK,mBAAmB;AAC3B,aAAK,kBAAkB,GAAG,OAAO;AACjC,aAAK,kBAAkB,GAAG,WAAW,iBAAiB;AACrD,WAAC,GAAG,aAAa,YAAY,MAAM,GAAG,qBAAqB;AAC3D,aAAG,OAAO,aAAa,GAAG,cAAc,aAAa,KAAK,KAAK;AAAA,QAChE;AACA,aAAK,kBAAkB,QAAQ;AAAA,MAChC;AAEA,UAAI,KAAK,kBAAkB;AAC1B,aAAK,iBAAiB,GAAG,OAAO;AAChC,aAAK,iBAAiB,GAAG,YAAY,MAAM;AAC1C,iBAAO;AAAA,YACN,OAAO;AAAA,YACP,SAAS;AAAA,cACR,WAAW,GAAG,SAAS;AAAA,cACvB,WAAW,GAAG,SAAS;AAAA,cACvB,cAAc,GAAG,OAAO,QAAQ,EAAE,IAAI;AAAA,YACvC;AAAA,UACD;AAAA,QACD;AACA,aAAK,iBAAiB,QAAQ;AAAA,MAC/B;AAEA,UAAI,KAAK,aAAa;AACrB,aAAK,YAAY,GAAG,WAAW,WAAW;AACzC,aAAG,OAAO,aAAa,GAAG,cAAc,OAAO,KAAK,KAAK;AAEzD,gBAAM,WAAW,OAAO,QAAQ,GAAG,SAAS,GAAG,IAAI;AACnD,aAAG,0BAA0B,GAAG,YAAa,SAAS,aAAa,KAAK;AACxE,aAAG,0BAA0B,QAAQ;AAAA,QACtC;AAAA,MACD;AAEA,aAAO,MAAM,GAAG,sBAAsB,KAAK,CAAC,WAAW,OAAO,aAAa;AAC1E,cAAM,gBAAgB,KAAK,GAAG;AAC9B,cAAM,2BAA2B,KAAK,0BAA0B,QAAQ;AAExE,YAAI,4BAA4B,iBAAiB,cAAc,UAAU,MAAM,OAAO;AACrF,wBAAc,UAAU,KAAK;AAC7B,kBAAQ,iBAAiB,QAAQ;AAAA,QAClC;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,MAAM,uBAAuB;AAC5B,UAAI,KAAK,qBAAqB,KAAK,kBAAkB;AACpD,cAAM,sBAAsB,KAAK,kBAAkB,UAAU,EAAE,MAAM;AAAA,CAAI,EAAE,OAAO,OAAK,CAAC;AACxF,YAAI,CAAC,oBAAoB;AAAQ;AAGjC,cAAM,wBAAwB,MAAM,OAAO,GAAG,SAAS,aAAa;AAAA,UACnE,SAAS,EAAE,QAAQ,CAAC,MAAM,mBAAmB,EAAC;AAAA,UAC9C,QAAQ,CAAC,YAAY,MAAM;AAAA,QAC5B,CAAC;AACD,cAAM,mBAAmB,sBAAsB,OAAO,CAAC,KAAK,MAAM;AACjE,cAAI,CAAC,IAAI,EAAE,WAAW;AACrB,gBAAI,EAAE,YAAY,CAAC;AAAA,UACpB;AACA,cAAI,EAAE,YAAY,CAAC,GAAG,IAAI,EAAE,WAAW,EAAE,IAAI;AAC7C,iBAAO;AAAA,QACR,GAAG,CAAC,CAAC;AAEL,cAAM,WAAW,OAAO,KAAK,gBAAgB,EAAE;AAC/C,cAAM,mBAAmB,iBAAiB,UAAU,KAAK;AAAA,CAAI;AAE7D,cAAM,oCAAoC,oBAAoB,WAAW,iBAAiB,UAAU;AAEpG,cAAM,mBAAmB,KAAK,iBAAiB,UAAU;AACzD,4BAAoB,YAAY,MAAM,KAAK,iBAAiB,UAAU,QAAQ;AAE9E,YAAI,mCAAmC;AACtC,eAAK,kBAAkB,UAAU,gBAAgB;AACjD,eAAK,YAAY,UAAU,iBAAiB,UAAU,MAAM;AAE5D,iBAAO,iBAAiB;AACxB,eAAK,OAAO,4BAA4B,kBAAkB,KAAK,YAAY;AAAA,QAC5E;AAAA,MACD;AAAA,IACD;AAAA,IAEA,cAAc;AACb,WAAK,6BAA6B;AAClC,WAAK,6BAA6B;AAElC,WAAK,WAAW,GAAG,SAAS,cAAc,MAAM;AAC/C,aAAK,OAAO,mBAAmB;AAAA,MAChC,CAAC;AAAA,IACF;AAAA,IAEA,mBAAmB;AAClB,WAAK,QAAQ,KAAK,YAAY,EAAE,KAAK,SAAS,KAAK;AACnD,aAAO,GAAG,KAAK,GAAG,UAAU,MAAM;AACjC,cAAM,uBAAuB,KAAK,WAAW,GAAG,UAAU;AAC1D,YAAI,sBAAsB;AACzB,eAAK,OAAO,mBAAmB;AAAA,QAChC;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,+BAA+B;AAC9B,YAAM,KAAK;AACX,WAAK,gBAAgB,GAAG,SAAS,wBAAwB,WAAW;AACnE,cAAM,YAAY,EAAE,IAAI,EAAE,KAAK,gBAAgB;AAC/C,YAAI,KAAK,sBAAsB,WAAW;AACzC,aAAG,OAAO,mBAAmB,SAAS;AACtC,eAAK,qBAAqB;AAAA,QAC3B;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,+BAA+B;AAC9B,WAAK,gBAAgB,GAAG,SAAS,mBAAmB,MAAM;AACzD,eAAO,QAAQ,uDAAuD,MAAM;AAC3E,cAAI,MAAM,KAAK,OAAO,QAAQ;AAC9B,cAAI,WAAW,KAAK;AACpB,mBAAS,sBAAsB;AAE/B,cAAI,QAAQ,2BAA2B,KAAK,UAAU,CAAC,MAAM;AAC5D,gBAAI,GAAG;AACN,qBAAO,MAAM,UAAU,SAAS,SAAS,SAAS,MAAM;AAAA,gBACvD,2BAA2B,EAAE;AAAA,gBAC7B,OAAO,KAAK,IAAI,EAAE,SAAS;AAAA,cAC5B,CAAC;AAAA,YACF;AAAA,UACD,CAAC;AAAA,QACF,CAAC;AAAA,MACF,CAAC;AAAA,IACF;AAAA,IAEA,iBAAiB,MAAM;AACtB,aAAO,KAAK,WAAW,IAAI,WAAW,MAAM,IAAI,KAAK,WAAW,IAAI,WAAW,MAAM;AAAA,IACtF;AAAA,EACD;;;AC/ZA,SAAO,QAAQ,qBAAqB;AACpC,UAAQ,YAAY,YAAY,MAAM;AAAA,IACrC,YAAY,EAAE,SAAS,QAAQ,MAAM,MAAM,aAAa,eAAe,GAAG;AACzE,WAAK,UAAU;AACf,WAAK,SAAS;AACd,WAAK,OAAO;AACZ,WAAK,OAAO;AACZ,WAAK,cAAc,eAAe,CAAC;AACnC,WAAK,aAAa,kBAAkB,CAAC;AAErC,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,iBAAiB;AAChB,WAAK,YAAY;AACjB,WAAK,YAAY;AAAA,IAClB;AAAA,IAEA,cAAc;AACb,YAAM,EAAE,MAAM,MAAM,aAAa,WAAW,IAAI;AAEhD,eAAS,WAAW;AACnB,eAAO,KAAK,OAAO,CAAC,GAAG,KAAK,MAAM;AACjC,iBAAO,IAAI,IAAI,OAAO,CAAC,IAAI,QAAQ,MAAM;AACxC,kBAAM,kBAAkB,eAAe,YAAY,KAAK,YAAY,GAAG,KAAK;AAC5E,kBAAM,YAAY,cAAc,WAAW,UAC1C,WAAW,UAAU,OAAO,WAAW,WAAW,OAAO,MAAM,MAAM,IAAI;AAE1E,mBAAO,KAAK,0BAA0B,uCAAuC,cAAc,GAAG,MAAM;AAAA,UACrG,GAAG,EAAE;AAAA,QACN,GAAG,EAAE;AAAA,MACN;AAEA,WAAK,QAAQ;AAAA,QACZ;AAAA,MACG,SAAS;AAAA;AAAA,MAEb;AAAA,IACD;AAAA,IAEA,cAAc;AACb,YAAM,KAAK;AACX,WAAK,QAAQ,GAAG,SAAS,eAAe,WAAW;AAClD,cAAM,OAAO,EAAE,IAAI;AACnB,WAAG,OAAO,aAAa,IAAI;AAAA,MAC5B,CAAC;AAAA,IACF;AAAA,EACD;;;AC9CA,SAAO,QAAQ,qBAAqB;AACpC,UAAQ,YAAY,UAAU,MAAM;AAAA,IACnC,YAAY,EAAE,QAAQ,QAAQ,GAAG;AAChC,WAAK,UAAU;AACf,WAAK,SAAS;AAEd,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,iBAAiB;AAChB,WAAK,YAAY;AACjB,WAAK,kBAAkB;AACvB,WAAK,YAAY;AACjB,WAAK,iBAAiB;AAAA,IAEvB;AAAA,IAEA,cAAc;AACb,WAAK,QAAQ;AAAA,QACZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iDAwC8C,GAAG,gBAAgB;AAAA;AAAA;AAAA;AAAA,mCAIjC,GAAG,wBAAwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCAS7B,GAAG,iBAAiB;AAAA,qCAChB,GAAG,gBAAgB;AAAA;AAAA;AAAA,MAGtD;AACA,WAAK,aAAa,KAAK,QAAQ,KAAK,oBAAoB;AACxD,WAAK,iBAAiB,KAAK,WAAW,KAAK,gBAAgB;AAC3D,WAAK,kBAAkB,KAAK,WAAW,KAAK,iBAAiB;AAC7D,WAAK,UAAU,KAAK,WAAW,KAAK,SAAS;AAC7C,WAAK,UAAU,KAAK,WAAW,KAAK,aAAa;AACjD,WAAK,0BAA0B,KAAK,WAAW,KAAK,iBAAiB;AAAA,IACtE;AAAA,IAEA,8BAA8B;AAC7B,aAAO,GAAG,QAAQ,gBAAgB,MAAS,EAAE,KAAK,CAAC,QAAQ;AAC1D,cAAM,SAAS,IAAI;AACnB,YAAI,CAAC,OAAO;AAAQ;AAEpB,aAAK,kBAAkB,KAAK,wBAAwB,KAAK,iBAAiB;AAC1E,aAAK,gBAAgB,KAAK,EAAE;AAC5B,cAAM,MAAM,KAAK,OAAO,QAAQ;AAEhC,eAAO,QAAQ,QAAM;AACpB,eAAK,gBAAgB;AAAA,YACpB,oCAAoC,GAAG,oCAAoC,GAAG;AAAA,UAC/E;AACA,cAAI,YAAY;AAAA,YACf,UAAU,WAAW;AACpB,kBAAI,UAAU,KAAK,GAAG,WAAW,KAAK,UAAU,CAAC;AAAA,YAClD;AAAA,UACD;AACA,cAAI,GAAG,aAAa,UAAU;AAC7B,wBAAY;AAAA,cACX,OAAO,WAAW;AACjB,oBAAI,IAAI,eAAe,aAAa,GAAG,WAAW,IAAI,IAAI,OAAO,GAAG;AACnE,sBAAI,eAAe,QAAQ,GAAG,WAAW,IAAI,IAAI,SAAS,IAAI,IAAI,OAAO;AAAA,gBAC1E;AAAA,cACD;AAAA,YACD;AAAA,UACD;AAEA,eAAK,GAAG,GAAG,qBAAqB,OAAO,GAAG,KAAK,aAAa;AAAA,YAC3D,IAAI,kCACA,KACA;AAAA,YAEJ,QAAQ,KAAK,gBAAgB,KAAK,IAAI,GAAG,iBAAiB;AAAA,YAC1D,cAAc;AAAA,UACf,CAAC;AACD,eAAK,GAAG,GAAG,mBAAmB,UAAU,IAAI,IAAI,GAAG,UAAU;AAAA,QAC9D,CAAC;AAAA,MACF,CAAC;AAAA,IACF;AAAA,IAEA,oBAAoB;AACnB,YAAM,KAAK;AACX,WAAK,aAAa,IAAI,QAAQ,YAAY,UAAU;AAAA,QACnD,SAAS,KAAK;AAAA,QACd,QAAQ;AAAA,UACP,cAAc,SAAS,MAAM;AAC5B,eAAG,kBAAkB,IAAI;AAAA,UAC1B;AAAA,QACD;AAAA,QACA,MAAM;AAAA,QACN,MAAM;AAAA,UACL,CAAE,GAAG,GAAG,CAAE;AAAA,UACV,CAAE,GAAG,GAAG,CAAE;AAAA,UACV,CAAE,GAAG,GAAG,CAAE;AAAA,UACV,CAAE,KAAK,GAAG,QAAS;AAAA,QACpB;AAAA,MACD,CAAC;AAED,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,kBAAkB,MAAM;AACvB,YAAM,eAAe,KAAK,KAAK,mBAAmB;AAElD,2BAAqB,IAAI;AACzB,WAAK,eAAe,iBAAiB,WAAW,KAAK,aAAa,MAAM,GAAG,EAAE,IAAI,KAAK,eAAe;AACrG,WAAK,cAAc,OAAO,IAAI,CAAC,EAAE,MAAM;AACvC,WAAK,cAAc,UAAU,KAAK,YAAY;AAE9C,eAAS,qBAAqBC,OAAM;AACnC,QAAAA,MAAK,SAAS,+BAA+B;AAC7C,mBAAW,MAAM;AAChB,UAAAA,MAAK,YAAY,+BAA+B;AAAA,QACjD,GAAG,GAAG;AAAA,MACP;AAAA,IACD;AAAA,IAEA,cAAc;AACb,YAAM,KAAK;AAEX,WAAK,eAAe,GAAG,SAAS,oBAAoB,SAAS,GAAG;AAC/D,cAAM,eAAe,EAAE,IAAI;AAE3B,YAAI,CAAC,EAAE,EAAE,MAAM,EAAE,GAAG,YAAY;AAAG;AAEnC,cAAM,aAAa,aAAa,OAAO,EAAE,OAAO,GAAG,eAAe,OAAO,EAAE,OAAO,GAAG,eAAe,WAAW;AAC/G,WAAG,eAAe,QAAQ,EAAE,WAAW,CAAC;AAExC,cAAM,OAAO,aAAa,KAAK,WAAW;AAG1C,UAAE,0BAA0B,EAAE,IAAI,WAAW,MAAM;AACnD,UAAE,iBAAiB,EAAE,IAAI,WAAW,MAAM;AAC1C,WAAG,eAAe,KAAK,aAAa,EAAE,IAAI,WAAW,QAAQ;AAC7D,WAAG,eAAe,KAAK,sBAAsB,EAAE,IAAI,WAAW,MAAM;AAGpE,UAAE,kBAAkB,EAAE,YAAY,gBAAgB;AAElD,YAAI,aAAa,SAAS,gBAAgB,GAAG;AAE5C,uBAAa,YAAY,gBAAgB;AACzC,aAAG,gBAAgB;AAAA,QACpB,OAAO;AAEN,uBAAa,SAAS,gBAAgB;AACtC,uBAAa,KAAK,0BAA0B,EAAE,IAAI,WAAW,MAAM;AACnE,uBAAa,KAAK,iBAAiB,EAAE,IAAI,WAAW,MAAM;AAC1D,aAAG,eAAe,KAAK,IAAI,aAAa,EAAE,IAAI,WAAW,MAAM;AAC/D,aAAG,eAAe,KAAK,IAAI,WAAW,EAAE,IAAI,WAAW,QAAQ;AAE/D,aAAG,gBAAgB,GAAG,GAAG;AACzB,aAAG,iBAAiB,GAAG,cAAc,OAAO,IAAI,CAAC,EAAE,MAAM;AACzD,aAAG,0BAA0B;AAAA,QAC9B;AAAA,MACD,CAAC;AAED,aAAO,GAAG,KAAK,GAAG,eAAe,kBAAkB,CAAC,QAAQ;AA5M9D;AA6MG,cAAM,UAAU,IAAI,IAAI;AACxB,cAAM,iBAAiB,GAAE,UAAK,8BAAL,mBAAgC,OAAO,EAAE;AAClE,YAAI,SAAS;AACZ,yBAAe,YAAY,aAAa,EAAE,SAAS,aAAa;AAAA,QACjE,OAAO;AACN,yBAAe,YAAY,aAAa,EAAE,SAAS,aAAa;AAAA,QACjE;AAAA,MACD,CAAC;AAED,aAAO,GAAG,KAAK,GAAG,eAAe,eAAe,CAAC,QAAQ;AACxD,YAAI,IAAI,IAAI,eAAe,CAAC,IAAI,0BAA0B;AACzD,cAAI,CAAC,IAAI,IAAI,qBAAqB;AACjC,gBAAI,2BAA2B;AAC/B,mBAAO,aAAa;AAAA,cACnB,MAAM,IAAI,IAAI,sBAAoB;AAAA,cAClC,MAAM,IAAI,QAAQ,qBAAqB;AAAA,cACvC,MAAM,IAAI,IAAI,sBAAoB;AAAA,cAClC,MAAM,IAAI,QAAQ,oBAAoB;AAAA,cACtC,MAAM,IAAI,KAAK;AAAA,cACf,MAAM,KAAK,sBAAsB,IAAI,GAAG;AAAA,cACxC,MAAO,IAAI,2BAA2B;AAAA,YACvC,CAAC;AAAA,UACF,WAAW,IAAI,IAAI,qBAAqB;AACvC,mBAAO,WAAW;AAAA,cACjB,SAAS,GAAG,2DAA2D;AAAA,cACvE,WAAW;AAAA,YACZ,CAAC;AAAA,UACF;AAAA,QACD;AAAA,MACD,CAAC;AAED,WAAK,4BAA4B;AAEjC,WAAK,eAAe,GAAG,SAAS,aAAa,WAAW;AACvD,cAAM,QAAQ,EAAE,IAAI,EAAE,KAAK,YAAY;AACvC,WAAG,cAAc,UAAU,KAAK;AAAA,MACjC,CAAC;AAED,WAAK,WAAW,GAAG,SAAS,qBAAqB,MAAM;AACtD,cAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,cAAM,cAAc,IAAI;AACxB,cAAM,QAAQ,IAAI;AAElB,YAAI,eAAe,KAAK,CAAC,MAAM,QAAQ;AACtC,gBAAM,UAAU,MAAM,SAAS,GAAG,8CAA8C,IAAI,GAAG,gCAAgC;AACvH,iBAAO,WAAW,EAAE,SAAS,WAAW,SAAS,CAAC;AAClD,iBAAO,MAAM,WAAW,OAAO;AAC/B;AAAA,QACD;AAEA,aAAK,OAAO,eAAe;AAAA,MAC5B,CAAC;AAED,WAAK,WAAW,GAAG,SAAS,iBAAiB,MAAM;AAClD,cAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,cAAM,QAAQ,IAAI;AAElB,YAAI,CAAC,MAAM,QAAQ;AAClB,iBAAO,WAAW,EAAE,SAAS,GAAG,yCAAyC,GAAG,WAAW,SAAS,CAAC;AACjG,iBAAO,MAAM,WAAW,OAAO;AAC/B;AAAA,QACD;AAEA,aAAK,gBAAgB,GAAG;AAAA,MACzB,CAAC;AAED,aAAO,GAAG,KAAK,GAAG,eAAe,eAAe,CAAC,QAAQ;AACxD,aAAK,sBAAsB,IAAI,GAAG;AAGlC,cAAM,8BAA8B,CAAC,KAAK,eAAe,KAAK,iBAAiB,EAAE,GAAG,UAAU;AAC9F,aAAK,sBAAsB,IAAI,GAAG;AAClC,SAAC,+BAA+B,KAAK,eAAe,KAAK,iBAAiB,EAAE,IAAI,WAAW,MAAM;AACjG,aAAK,wBAAwB;AAAA,MAC9B,CAAC;AAED,aAAO,GAAG,KAAK,GAAG,eAAe,kBAAkB,CAAC,QAAQ;AAC3D,cAAM,qBAAqB,gBAAgB,IAAI,IAAI,gBAAgB,IAAI,IAAI,QAAQ;AACnF,aAAK,eAAe,KAAK,wBAAwB,EAAE,KAAK,kBAAkB;AAAA,MAC3E,CAAC;AAED,aAAO,GAAG,KAAK,GAAG,yBAAyB,UAAU,CAAC,KAAK,KAAK,QAAQ;AAEvE,cAAM,cAAc,OAAO,KAAK;AAChC,cAAM,OAAO,YAAY,gBAAgB,QAAQ,OAAO,GAAG,EAAE,YAAY;AACzE,YAAI,KAAK,GAAG,mBAAmB,KAAK,GAAG,gBAAgB,UAAU,KAAK,YAAY,QAAQ;AACzF,eAAK,GAAG,gBAAgB,UAAU,YAAY,MAAM;AAAA,QACrD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,8BAA8B;AAC7B,aAAO,SAAS,GAAG,yBAAyB,CAAC,SAAS;AACrD,cAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,cAAM,EAAE,UAAU,QAAQ,SAAS,gBAAgB,IAAI;AACvD,YAAI,SAAS;AAEb,YAAI,SAAS;AACZ,kBAAQ,GAAG,kBAAkB;AAC7B,gBAAM,cAAc,KAAK,OAAO,aAAa,qBAAqB,IAAI,IAAI,cAAc,IAAI;AAC5F,cAAI,UAAU,aAAa;AAC1B,mBAAO,IAAI,SAAS;AACpB,sBAAU,GAAG,yCAAyC,CAAC,gBAAgB,QAAQ,IAAI,UAAU,CAAC,CAAC,CAAC;AAChG,iBAAK,OAAO,eAAe;AAC3B,oBAAQ,WAAW;AAAA,UAEpB,OAAO;AACN,sBAAU,GAAG,mFAAmF,CAAC,gBAAgB,QAAQ,IAAI,UAAU,CAAC,CAAC,CAAC;AAAA,UAC3I;AAAA,QACD,WAAW,iBAAiB;AAC3B,oBAAU;AACV,kBAAQ,GAAG,gBAAgB;AAAA,QAC5B;AAEA,eAAO,SAAS,EAAE,WAAW,SAAS,SAAS,MAAM,CAAC;AAAA,MACvD,CAAC;AAAA,IACF;AAAA,IAEA,4BAA4B;AAC3B,YAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,YAAM,cAAc,KAAK,OAAO,aAAa,qBAAqB,IAAI,IAAI,cAAc,IAAI;AAC5F,YAAM,mBAAmB,cAAc,IAAI;AAC3C,YAAM,gBAAgB,KAAK,gBAAgB,KAAK,cAAc,UAAU,IAAI;AAC5E,UAAI,CAAC,iBAAiB,mBAAmB,KAAK,KAAK,eAAe;AACjE,aAAK,cAAc,UAAU,gBAAgB;AAAA,MAC9C;AAAA,IACD;AAAA,IAEA,mBAAmB;AAClB,YAAM,aAAa,OAAO,MAAM,OAAO,IAAI,WAAM;AACjD,WAAK,WAAW,KAAK,mBAAmB,EAAE,KAAK,SAAS,GAAG,kBAAkB;AAC7E,aAAO,GAAG,KAAK,GAAG,cAAc,MAAM;AACrC,cAAM,qBAAqB,KAAK,WAAW,GAAG,UAAU;AACxD,cAAM,cAAc,KAAK,eAAe,KAAK,iBAAiB;AAC9D,YAAI,sBAAsB,YAAY,QAAQ;AAC7C,eAAK,WAAW,KAAK,mBAAmB,EAAE,MAAM;AAAA,QACjD;AAAA,MACD,CAAC;AAED,aAAO,GAAG,KAAK,aAAa;AAAA,QAC3B,UAAU;AAAA,QACV,QAAQ,MAAM;AACb,gBAAM,qBAAqB,KAAK,WAAW,GAAG,UAAU;AACxD,cAAI,cAAc,KAAK,eAAe,KAAK,iBAAiB;AAC5D,wBAAc,YAAY,SAAS,YAAY,KAAK,WAAW,IAAI;AAEnE,cAAI,CAAC;AAAa;AAElB,gBAAM,mBAAmB,MAAM,KAAK,KAAK,eAAe,KAAK,kBAAkB,CAAC,EAAE,IAAI,OAAK,EAAE,CAAC,EAAE,KAAK,WAAW,CAAC;AACjH,gBAAM,aAAa,iBAAiB,QAAQ,WAAW;AACvD,gBAAM,mBAAmB,aAAa,KAAK,iBAAiB;AAC5D,gBAAM,0BAA0B,KAAK,eAAe,KAAK,+BAA+B,iBAAiB,oBAAoB;AAE7H,cAAI,sBAAsB,cAAc,iBAAiB;AACxD,oCAAwB,MAAM;AAAA,UAC/B;AAAA,QACD;AAAA,QACA,WAAW,MAAM,KAAK,WAAW,GAAG,UAAU,KAAK,KAAK,eAAe,KAAK,iBAAiB,EAAE;AAAA,QAC/F,aAAa,GAAG,8BAA8B;AAAA,QAC9C,eAAe;AAAA,QACf,MAAM,SAAS,KAAK;AAAA,MACrB,CAAC;AAAA,IACF;AAAA,IAEA,gBAAgB;AAAA,IAEhB;AAAA,IAEA,yBAAyB;AACxB,WAAK,wBAAwB;AAC7B,WAAK,4BAA4B;AACjC,WAAK,sBAAsB;AAC3B,WAAK,qBAAqB;AAAA,IAC3B;AAAA,IAEA,eAAe;AACd,YAAM,MAAM,KAAK,OAAO,QAAQ;AAChC,UAAI,eAAe,QAAQ,wBAAwB,IAAI,IAAI,SAAS,IAAI,IAAI,OAAO;AAAA,IACpF;AAAA,IAEA,YAAY;AACX,WAAK,OAAO,sBAAsB,KAAK;AACvC,WAAK,iBAAiB,KAAK;AAAA,IAC5B;AAAA,IAEA,WAAW;AACV,WAAK,OAAO,sBAAsB,IAAI;AACtC,WAAK,iBAAiB,IAAI;AAE1B,WAAK,uBAAuB;AAC5B,WAAK,aAAa;AAAA,IACnB;AAAA,IAEA,yBAAyB;AACxB,UAAI,KAAK,SAAS,KAAK,iBAAiB,EAAE,QAAQ;AACjD,aAAK,SAAS,KAAK,cAAc;AAAA,MAClC,OAAO;AACN,aAAK,SAAS,KAAK,EAAE;AACrB,aAAK,oBAAoB,OAAO,GAAG,KAAK,aAAa;AAAA,UACpD,IAAI;AAAA,YACH,OAAO,GAAG,QAAQ;AAAA,YAClB,WAAW;AAAA,YACX,UAAU,WAAW;AAAA,YAAC;AAAA,UACvB;AAAA,UACA,QAAQ,KAAK,gBAAgB,KAAK,UAAU;AAAA,UAC5C,cAAc;AAAA,QACf,CAAC;AACD,aAAK,kBAAkB,UAAU,EAAE;AAAA,MACpC;AAAA,IACD;AAAA,IAEA,0BAA0B;AACzB,YAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,YAAM,WAAW,IAAI;AACrB,YAAM,WAAW,IAAI;AAErB,WAAK,eAAe,KAAK,GACxB,SAAS,IAAI,CAAC,GAAG,MAAM;AACtB,cAAM,OAAO,EAAE,gBAAgB,QAAQ,OAAO,GAAG,EAAE,YAAY;AAC/D,cAAM,eAAe,EAAE;AACvB,cAAM,SAAS,IAAI,MAAM,IAAI,SAAS;AACtC,cAAM,SAAS,EAAE,SAAS,IAAI,gBAAgB,EAAE,QAAQ,QAAQ,IAAI;AAEpE,eAAQ;AAAA;AAAA,gDAEoC,4BAA4B;AAAA,SACnE,EAAE;AAAA,qBACU,2BAA2B;AAAA,qBAC3B;AAAA;AAAA;AAAA;AAAA,MAIlB,CAAC,EAAE,KAAK,EAAE,GACT;AAEF,eAAS,QAAQ,OAAK;AACrB,cAAM,OAAO,EAAE,gBAAgB,QAAQ,OAAO,GAAG,EAAE,YAAY;AAC/D,cAAM,KAAK;AACX,aAAK,GAAG,kBAAkB,OAAO,GAAG,KAAK,aAAa;AAAA,UACrD,IAAI;AAAA,YACH,OAAO,EAAE;AAAA,YACT,WAAW;AAAA,YACX,aAAa,GAAG,qBAAqB,CAAC,EAAE,eAAe,CAAC;AAAA,YACxD,UAAU,WAAW;AACpB,oBAAM,gBAAgB,OAAO,MAAM,UAAU,EAAE,SAAS,EAAE,MAAM,QAAQ;AACxE,kBAAI,iBAAiB,KAAK,OAAO;AAChC,uBAAO,MACL,UAAU,EAAE,SAAS,EAAE,MAAM,UAAU,IAAI,KAAK,KAAK,CAAC,EACtD,KAAK,MAAM,GAAG,sBAAsB,CAAC;AAEvC,sBAAM,qBAAqB,gBAAgB,KAAK,OAAO,QAAQ;AAC/D,mBAAG,eAAe,KAAK,IAAI,aAAa,EAAE,KAAK,kBAAkB;AAAA,cAClE;AAAA,YACD;AAAA,UACD;AAAA,UACA,QAAQ,KAAK,eAAe,KAAK,IAAI,8BAA8B;AAAA,UACnE,cAAc;AAAA,QACf,CAAC;AACD,aAAK,GAAG,gBAAgB,aAAa,KAAK;AAC1C,aAAK,GAAG,gBAAgB,UAAU,EAAE,MAAM;AAAA,MAC3C,CAAC;AAED,WAAK,mCAAmC;AAExC,WAAK,sBAAsB,GAAG;AAAA,IAC/B;AAAA,IAEA,uBAAuB;AACtB,YAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,YAAM,WAAW,IAAI;AACrB,eAAS,QAAQ,OAAK;AACrB,cAAM,OAAO,EAAE,gBAAgB,QAAQ,OAAO,GAAG,EAAE,YAAY;AAC/D,YAAI,EAAE,SAAS;AACd,qBAAW,MAAM;AAChB,iBAAK,eAAe,KAAK,IAAI,8BAA8B,EAAE,OAAO,EAAE,MAAM;AAAA,UAC7E,GAAG,GAAG;AAAA,QACP;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,sBAAsB,KAAK;AAC1B,YAAM,cAAc,KAAK,OAAO,aAAa,qBAAqB,IAAI,IAAI,cAAc,IAAI;AAC5F,YAAM,WAAW,IAAI;AAErB,YAAM,YAAY,KAAK,mBAAmB,IAAI,WAAW,CAAC;AAE1D,WAAK,eAAe,KAAK,iBAAiB,EAAE,OAAO;AACnD,UAAI,iBAAiB,UAAU,IAAI,OAAK;AACvC,eAAO,qCAAqC,MAAM,gBAAgB,GAAG,UAAU,CAAC;AAAA,MACjF,CAAC,EAAE,KAAK,EAAE;AAEV,WAAK,eAAe,KAAK,4BAA4B,EAAE,KAAK,0BAA0B,EACpF,MAAM,+BAA+B,sBAAsB;AAAA,IAC9D;AAAA,IAEA,mBAAmB,aAAa;AAC/B,UAAI,QAAQ,CAAC,GAAG,GAAG,EAAE;AACrB,YAAM,SAAS,OAAO,KAAK,MAAM,WAAW,CAAC,EAAE;AAE/C,cAAQ,MAAM,IAAI,OAAK,IAAK,OAAO,SAAS,EAAG;AAE/C,YAAM,cAAc,CAAC,QAAQ,MAAM;AAClC,YAAI,YAAY,KAAK,KAAM,SAAS,CAAE,IAAI;AAC1C,eAAO,cAAc,SAAS,YAAY,IAAI;AAAA,MAC/C;AAEA,aAAO,MAAM,OAAO,CAAC,UAAU,MAAM;AACpC,YAAI,YAAY,YAAY,aAAa,CAAC;AAC1C,oBAAY,SAAS,QAAQ,SAAS,KAAK,KAAK,YAAY,IAAI;AAChE,eAAO,CAAC,GAAG,UAAU,SAAS;AAAA,MAC/B,GAAG,CAAC,CAAC;AAAA,IACN;AAAA,IAEA,qCAAqC;AACpC,YAAM,KAAK;AACX,YAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,YAAM,EAAE,iBAAiB,gBAAgB,kBAAkB,IAAI,KAAK,OAAO,qBAAqB;AAEhG,WAAK,eAAe,KAAK,8CAA8C,EAAE,OAAO,EAAE,OAAO;AAEzF,UAAI,CAAC;AAAiB;AAEtB,UAAI,aAAa,WAAW;AAC5B,UAAI,CAAC,gBAAgB;AACpB,sBAAc,GAAG,yCAAyC;AAC1D,oBAAY;AAAA,MACb,OAAO;AACN,gCAAwB,IAAI,IAAI,cAAc,IAAI,IAAI,iBAAiB,GAAG,UAAU,kBAAkB,GAAG,CAAC;AAC1G,sBAAc,GAAG,4BAA4B,CAAC,gBAAgB,qBAAqB,CAAC,CAAC;AACrF,oBAAY;AAAA,MACb;AAEA,YAAM,SAAS,KAAK,eAAe,SAAS,EAAE,SAAS,MAAM,IAAI,SAAS;AAC1E,YAAM,SAAS,IAAI,iBAAiB,IAAI,gBAAgB,IAAI,gBAAgB,IAAI,QAAQ,IAAI;AAC5F,WAAK,eAAe;AAAA,QACnB;AAAA;AAAA;AAAA,qDAGkD;AAAA,wCACb;AAAA;AAAA;AAAA;AAAA,MAItC;AAEA,WAAK,4BAA4B,OAAO,GAAG,KAAK,aAAa;AAAA,QAC5D,IAAI;AAAA,UACH,OAAO,GAAG,uBAAuB;AAAA,UACjC,WAAW;AAAA,UACX,aAAa,GAAG,8BAA8B;AAAA,UAC9C,SAAS;AAAA,UACT;AAAA,UACA,UAAU,iBAAiB;AAC1B,gBAAI,CAAC;AAAgB;AAErB,gBAAI,KAAK,QAAQ,uBAAuB;AACvC,qBAAO,WAAW;AAAA,gBACjB,SAAS,GAAG,oCAAoC,CAAC,gBAAgB,qBAAqB,CAAC,CAAC;AAAA,gBACxF,WAAW;AAAA,cACZ,CAAC;AACD,qBAAO,MAAM,WAAW,QAAQ;AAChC,iBAAG,0BAA0B,UAAU,CAAC;AACxC;AAAA,YACD;AACA,kBAAM,wBAAwB,KAAK,QAAQ,IAAI,IAAI;AACnD,kBAAM,OAAO,MAAM,UAAU,IAAI,SAAS,IAAI,MAAM,yBAAyB,qBAAqB;AAClG,mBAAO,MAAM,UAAU,IAAI,SAAS,IAAI,MAAM,kBAAkB,SAAS,KAAK,QAAQ,iBAAiB,CAAC;AAAA,UACzG;AAAA,UACA;AAAA,QACD;AAAA,QACA,QAAQ,KAAK,eAAe,KAAK,yCAAyC;AAAA,QAC1E,cAAc;AAAA,MACf,CAAC;AACD,WAAK,0BAA0B,aAAa,KAAK;AAAA,IAGlD;AAAA,IAEA,gCAAgC;AAC/B,YAAM,YAAY,KAAK,OAAO,QAAQ,EAAE,IAAI;AAC5C,UAAI,cAAc;AACjB,aAAK,eAAe;AAAA,UACnB;AAAA;AAAA;AAAA,QAGD;AAAA,IACF;AAAA,IAEA,sBAAsB,KAAK;AAC1B,UAAI,CAAC;AAAK,cAAM,KAAK,OAAO,QAAQ,EAAE;AACtC,YAAM,cAAc,IAAI;AACxB,YAAM,cAAc,KAAK,OAAO,aAAa,qBAAqB,IAAI,IAAI,cAAc,IAAI;AAC5F,YAAM,YAAY,cAAc,IAAI;AACpC,YAAM,SAAS,IAAI,iBAAiB,aAAa,IAAI,KAAK,YAAY;AACtE,YAAM,WAAW,IAAI;AACrB,YAAM,QAAQ,SAAS,GAAG,QAAQ,IAAI,GAAG,YAAY;AAErD,WAAK,QAAQ;AAAA,QACZ;AAAA,+BAC4B,GAAG,aAAa;AAAA,yBACtB,gBAAgB,aAAa,QAAQ;AAAA;AAAA;AAAA;AAAA,+BAI/B,GAAG,aAAa;AAAA,yBACtB,gBAAgB,aAAa,QAAQ;AAAA;AAAA;AAAA;AAAA,+BAI/B;AAAA,yBACN,gBAAgB,UAAU,WAAW,QAAQ;AAAA;AAAA,MAEpE;AAAA,IACD;AAAA,IAEA,gBAAgB,KAAK;AAEpB,YAAM,gBAAgB,IAAI,MAAM,IAAI,WAAS;AAAA,QAC5C,WAAW,KAAK;AAAA,QAChB,WAAW,KAAK;AAAA,QAChB,KAAK,KAAK;AAAA,QACV,UAAU,KAAK,YAAY;AAAA,MAC5B,EAAE;AAGF,WAAK,WAAW,KAAK,eAAe,EAAE,KAAK,YAAY,IAAI,EAAE,KAAK,GAAG,YAAY,CAAC;AAElF,aAAO,KAAK;AAAA,QACX,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,YAAY,IAAI;AAAA,UAChB,UAAU,IAAI;AAAA,UACd,kBAAkB,IAAI;AAAA,UACtB;AAAA,UACA,gBAAgB,CAAC;AAAA,UACjB,UAAU,IAAI,kBAAkB;AAAA,QACjC;AAAA,QACA,UAAU,CAAC,MAAM;AAChB,eAAK,WAAW,KAAK,eAAe,EAAE,KAAK,YAAY,KAAK,EAAE,KAAK,GAAG,iBAAiB,CAAC;AACxF,cAAI,EAAE,KAAK;AACV,mBAAO,WAAW;AAAA,cACjB,SAAS,GAAG,oDAAoD;AAAA,cAChE,WAAW;AAAA,YACZ,CAAC;AACD,mBAAO,MAAM,WAAW,OAAO;AAAA,UAChC,OAAO;AACN,mBAAO,WAAW;AAAA,cACjB,SAAS,GAAG,qCAAqC;AAAA,cACjD,WAAW;AAAA,YACZ,CAAC;AACD,mBAAO,MAAM,WAAW,SAAS;AAAA,UAClC;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,iBAAiB,MAAM;AACtB,aAAO,KAAK,WAAW,IAAI,WAAW,MAAM,IAAI,KAAK,WAAW,IAAI,WAAW,MAAM;AAAA,IACtF;AAAA,EACD;;;ACxpBA,SAAO,QAAQ,qBAAqB;AACpC,MAAI,YAAY,CAAC;AACjB,UAAQ,YAAY,gBAAgB,MAAM;AAAA,IACzC,YAAY,EAAE,SAAS,OAAO,GAAG;AAChC,WAAK,UAAU;AACf,WAAK,SAAS;AACd,WAAK,oBAAoB,oBAAI,IAAI;AACjC,WAAK,qBAAqB,KAAK,uBAAuB;AACtD,WAAK,YAAY,CAAC;AAClB,cAAQ,YAAY,cAAc,mBAAmB;AACrD,WAAK,qBAAqB;AAC1B,WAAK,sBAAsB;AAE3B,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,iBAAiB;AAChB,WAAK,YAAY;AACjB,WAAK,oBAAoB;AACzB,WAAK,YAAY;AACjB,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,yBAAyB;AAExB,YAAM,aAAa,OAAO,cAAc,CAAC;AACzC,aAAO,CAAC,WAAW,SAAS,QAAQ;AAAA,IACrC;AAAA,IAEA,cAAc;AACb,WAAK,QAAQ;AAAA,QACZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BASuB,GAAG,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAcpC,GAAG,yBAAyB;AAAA;AAAA;AAAA;AAAA,MAIlC;AAEA,WAAK,aAAa,KAAK,QAAQ,KAAK,kBAAkB;AACtD,WAAK,sBAAsB,KAAK,WAAW,KAAK,qBAAqB;AACrE,WAAK,iBAAiB,KAAK,WAAW,KAAK,gBAAgB;AAC3D,WAAK,aAAa,KAAK,WAAW,KAAK,YAAY;AACnD,WAAK,kBAAkB,KAAK,WAAW,KAAK,wBAAwB;AAAA,IACrE;AAAA,IAEA,cAAc;AACb,WAAK,aAAa,OAAO,GAAG,SAAS,CAAC,MAAM;AAC3C,qBAAa,KAAK,WAAW;AAC7B,aAAK,cAAc,WAAW,MAAM;AACnC,gBAAM,cAAc,EAAE,OAAO;AAC7B,kBAAQ,IAAI,4BAA4B,WAAW;AACnD,eAAK,aAAa,aAAa,KAAK,aAAa,UAAU,GAAG,KAAK,iBAAiB,UAAU,CAAC;AAAA,QAChG,GAAG,GAAG;AAAA,MACP,CAAC;AAED,YAAM,KAAK;AAGX,WAAK,oBAAoB,GAAG,SAAS,oBAAoB,SAAS,GAAG;AACpE,YAAI,CAAC,EAAE,EAAE,MAAM,EAAE,QAAQ,6BAA6B,EAAE,QAAQ;AAC/D,gBAAM,eAAe,SAAS,EAAE,IAAI,EAAE,KAAK,mBAAmB,CAAC;AAC/D,aAAG,OAAO,kBAAkB,YAAY;AAAA,QACzC;AAAA,MACD,CAAC;AAGD,WAAK,oBAAoB,GAAG,UAAU,qBAAqB,SAAS,GAAG;AACtE,UAAE,gBAAgB;AAClB,cAAM,eAAe,SAAS,EAAE,IAAI,EAAE,QAAQ,kBAAkB,EAAE,KAAK,mBAAmB,CAAC;AAE3F,YAAI,EAAE,IAAI,EAAE,GAAG,UAAU,GAAG;AAC3B,aAAG,kBAAkB,IAAI,YAAY;AAAA,QACtC,OAAO;AACN,aAAG,kBAAkB,OAAO,YAAY;AAAA,QACzC;AAEA,WAAG,qBAAqB;AAAA,MACzB,CAAC;AAGD,WAAK,WAAW,GAAG,SAAS,WAAW;AACtC,WAAG,wBAAwB;AAAA,MAC5B,CAAC;AAED,WAAK,WAAW,GAAG,SAAS,SAAS,WAAW;AAC/C,WAAG,OAAO,cAAc;AACxB,WAAG,OAAO,gBAAgB;AAAA,MAE3B,CAAC;AAGD,WAAK,WAAW,GAAG,UAAU,wBAAwB,WAAW;AAC/D,gBAAQ,IAAI,qCAAqC;AACjD,WAAG;AAAA,UACF,GAAG,aAAa,UAAU;AAAA,UAC1B,EAAE,IAAI,EAAE,IAAI;AAAA,UACZ,GAAG,iBAAiB,UAAU;AAAA,QAC/B;AAAA,MACD,CAAC;AAED,WAAK,WAAW,GAAG,UAAU,4BAA4B,WAAW;AACnE,gBAAQ,IAAI,yCAAyC;AACrD,WAAG;AAAA,UACF,GAAG,aAAa,UAAU;AAAA,UAC1B,GAAG,aAAa,UAAU;AAAA,UAC1B,EAAE,IAAI,EAAE,IAAI;AAAA,QACb;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,iBAAiB;AAEhB,aAAO,KAAK;AAAA,QACX,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,SAAS;AAAA,UACT,QAAQ,CAAC,QAAQ,WAAW;AAAA,UAC5B,SAAS,CAAC,CAAC,aAAa,MAAM,EAAE,CAAC;AAAA,UACjC,UAAU;AAAA,QACX;AAAA,QACA,UAAU,CAAC,aAAa;AACvB,cAAI,SAAS,SAAS;AACrB,iBAAK,YAAY,SAAS;AAC1B,iBAAK,uBAAuB;AAAA,UAC7B;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,yBAAyB;AAExB,UAAI,UAAU,UAAU,KAAK,UAAU,IAAI,UAAQ,KAAK,SAAS,EAAE,KAAK,IAAI;AAG5E,WAAK,iBAAiB,GAAG,UAAU;AACnC,WAAK,iBAAiB,QAAQ;AAG9B,WAAK,wBAAwB;AAAA,IAC9B;AAAA,IAEA,0BAA0B;AAEzB,aAAO,KAAK;AAAA,QACX,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,aAAa;AAAA,UACb,QAAQ;AAAA,UACR,OAAO;AAAA,QACR;AAAA,QACA,UAAU,CAAC,aAAa;AACvB,cAAI,SAAS,WAAW,SAAS,QAAQ,SAAS,GAAG;AACpD,kBAAM,sBAAsB,SAAS,QAAQ,GAAG;AAChD,gBAAI,qBAAqB;AACxB,mBAAK,iBAAiB,UAAU,mBAAmB;AAAA,YACpD;AAAA,UACD;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,sBAAsB;AACrB,YAAM,KAAK;AACX,WAAK,eAAe,OAAO,GAAG,KAAK,aAAa;AAAA,QAC/C,IAAI;AAAA,UACH,OAAO,GAAG,QAAQ;AAAA,UAClB,WAAW;AAAA,UACX,aAAa,GAAG,uCAAuC;AAAA,QACxD;AAAA,QACA,QAAQ,KAAK,WAAW,KAAK,eAAe;AAAA,QAC5C,cAAc;AAAA,MACf,CAAC;AAED,WAAK,eAAe,OAAO,GAAG,KAAK,aAAa;AAAA,QAC/C,IAAI;AAAA,UACH,OAAO,GAAG,gBAAgB;AAAA,UAC1B,WAAW;AAAA,UACX,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UACT,aAAa,GAAG,0BAA0B;AAAA,UAC1C,UAAU,WAAW;AACpB,oBAAQ,IAAI,4BAA4B,GAAG,aAAa,UAAU,CAAC;AACnE,gBAAI,GAAG,WAAW,GAAG,UAAU,GAAG;AACjC,iBAAG;AAAA,gBACF,GAAG,aAAa,UAAU;AAAA,gBAC1B,GAAG,aAAa,UAAU;AAAA,gBAC1B,GAAG,iBAAiB,UAAU;AAAA,cAC/B;AAAA,YACD;AAAA,UACD;AAAA,QACD;AAAA,QACA,QAAQ,KAAK,WAAW,KAAK,eAAe;AAAA,QAC5C,cAAc;AAAA,MACf,CAAC;AAED,WAAK,mBAAmB,OAAO,GAAG,KAAK,aAAa;AAAA,QACnD,IAAI;AAAA,UACH,OAAO,GAAG,YAAY;AAAA,UACtB,WAAW;AAAA,UACX,SAAS;AAAA,UACT,aAAa,GAAG,mBAAmB;AAAA,UACnC,UAAU,WAAW;AACpB,oBAAQ,IAAI,gCAAgC,GAAG,iBAAiB,UAAU,CAAC;AAC3E,gBAAI,GAAG,WAAW,GAAG,UAAU,GAAG;AACjC,iBAAG;AAAA,gBACF,GAAG,aAAa,UAAU;AAAA,gBAC1B,GAAG,aAAa,UAAU;AAAA,gBAC1B,GAAG,iBAAiB,UAAU;AAAA,cAC/B;AAAA,YACD;AAAA,UACD;AAAA,QACD;AAAA,QACA,QAAQ,KAAK,WAAW,KAAK,mBAAmB;AAAA,QAChD,cAAc;AAAA,MACf,CAAC;AAED,WAAK,aAAa,aAAa,KAAK;AACpC,WAAK,aAAa,aAAa,KAAK;AACpC,WAAK,iBAAiB,aAAa,KAAK;AACxC,WAAK,aAAa,UAAU,OAAO;AAAA,IACpC;AAAA,IAED,aAAa,cAAc,IAAI,SAAS,SAAS,aAAa,IAAI;AAEjE,WAAK,oBAAoB,KAAK,EAAE;AAEhC,aAAO,IAAI,OAAO;AAClB,WAAK,OAAO,cAAc;AAG1B,UAAI,KAAK,qBAAqB;AAC7B,qBAAa,KAAK;AAClB,aAAK,iBAAiB,UAAU,UAAU;AAC1C,aAAK,sBAAsB;AAAA,MAC5B;AAGA,UAAI,CAAC,eAAe,KAAK,cAAc;AACtC,sBAAc,KAAK,aAAa,UAAU,KAAK;AAAA,MAChD;AACA,UAAI,CAAC,UAAU,KAAK,cAAc;AACjC,iBAAS,KAAK,aAAa,UAAU,KAAK;AAAA,MAC3C;AACA,UAAI,CAAC,cAAc,KAAK,kBAAkB;AACzC,qBAAa,KAAK,iBAAiB,UAAU,KAAK;AAAA,MACnD;AAGA,WAAK,kBAAkB,MAAM;AAC7B,WAAK,qBAAqB;AAC1B,aAAO,OAAO,KAAK;AAAA,QAClB,QAAQ;AAAA,QACR,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,aAAa,eAAe;AAAA,UAC5B,QAAQ,UAAU;AAAA,UAClB,YAAY,eAAe,QAAQ,KAAK;AAAA,UACxC,gBAAgB,KAAK,qBAAqB,KAAK,IAAI,IAAI;AAAA,QACxD;AAAA,QACA,UAAU,CAAC,aAAa;AACvB,iBAAO,IAAI,SAAS;AACpB,kBAAQ,IAAI,oBAAoB,SAAS,OAAO;AAGhD,eAAK,oBAAoB,MAAM;AAE/B,eAAK,WAAW,SAAS,WAAW,CAAC;AACrC,sBAAY,SAAS,WAAW,CAAC;AAEjC,cAAI,SAAS,WAAW,SAAS,QAAQ,SAAS,GAAG;AAEpD,kBAAM,WAAW,SAAS,uBAAuB;AAEjD,qBAAS,QAAQ,QAAQ,aAAW;AACnC,oBAAM,eAAe,KAAK,iBAAiB,OAAO;AAClD,oBAAM,WAAW,SAAS,cAAc,KAAK;AAC7C,uBAAS,YAAY;AACrB,uBAAS,YAAY,SAAS,UAAU;AAAA,YACzC,CAAC;AAED,iBAAK,oBAAoB,OAAO,QAAQ;AAAA,UACzC,OAAO;AACN,iBAAK,oBAAoB,KAAK,oHAAoH;AAAA,UACnJ;AAEA,eAAK,8BAA8B,SAAS,OAAO;AAAA,QACpD;AAAA,QACA,OAAO,CAAC,UAAU;AACjB,iBAAO,IAAI,SAAS;AACpB,kBAAQ,MAAM,+BAA+B,KAAK;AAClD,eAAK,oBAAoB,KAAK,oHAAoH;AAClJ,iBAAO,SAAS,GAAG,8CAA8C,CAAC;AAAA,QACnE;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IACC,8BAA8B,UAAU;AACvC,UAAI,CAAC,YAAY,SAAS,WAAW,GAAG;AACvC,aAAK,OAAO,cAAc;AAC1B;AAAA,MACD;AAEA,YAAM,sBAAsB,KAAK,qBAC9B,SAAS,KAAK,SAAO,IAAI,SAAS,KAAK,kBAAkB,KAAK,SAAS,KACvE,SAAS;AAEZ,UAAI,qBAAqB;AACxB,aAAK,OAAO,kBAAkB,oBAAoB,IAAI;AACtD,aAAK,0BAA0B,oBAAoB,IAAI;AACvD,YAAI,KAAK,sBAAsB,KAAK,uBAAuB,oBAAoB,MAAM;AACpF,iBAAO,WAAW;AAAA,YACjB,SAAS,GAAG,6BAA6B,IAAI,oBAAoB;AAAA,YACjE,WAAW;AAAA,UACZ,CAAC;AAAA,QACF;AAAA,MACD;AACA,WAAK,qBAAqB;AAAA,IAC3B;AAAA,IAEA,0BAA0B,cAAc;AAEvC,WAAK,oBAAoB,KAAK,kBAAkB,EAAE,YAAY,aAAa;AAG3E,WAAK,oBAAoB,KAAK,uBAAuB,OAAO,YAAY,KAAK,EAAE,SAAS,aAAa;AAAA,IACtG;AAAA,IAEA,yCAAyC,iBAAiB,oBAAoB,MAAM;AACnF,UAAI,mBAAmB;AACtB,aAAK,qBAAqB;AAAA,MAC3B;AACA,WAAK,sBAAsB;AAC3B,aAAO,KAAK,iBAAiB,IAAI;AAAA,IAClC;AAAA,IAEA,iBAAiB,SAAS;AACzB,YAAM,mBAAmB,OAAO,QAAQ,eAAa,MAAI,QAAQ,YAAY,EAAE,OAAO,gBAAgB;AAGtG,YAAM,gBAAgB,KAAK,qBAC1B;AAAA;AAAA,aAEU;AAGX,YAAM,kBAAkB,QAAQ,kBAC/B;AAAA;AAAA;AAAA;AAAA,MAIG,OAAO,SAAS,QAAQ,iBAAiB,EAAE;AAAA,aACpC;AAEX,aACC,mDAAmD,OAAO,QAAQ,IAAI;AAAA,MACnE;AAAA;AAAA;AAAA,gFAG0E,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,SAK/E,OAAO,SAAS,QAAQ,UAAU,EAAE;AAAA;AAAA,QAErC;AAAA;AAAA;AAAA,iFAGyE,gBAAgB,QAAQ,aAAa,QAAQ,UAAU,CAAC,KAAK;AAAA,2EACnE;AAAA;AAAA;AAAA;AAAA,IAK1E;AAAA,IAEA,uBAAuB;AAEtB,UAAI,CAAC,KAAK,oBAAoB;AAC7B,aAAK,eAAe,KAAK;AACzB;AAAA,MACD;AAEA,YAAM,QAAQ,KAAK,kBAAkB;AACrC,WAAK,gBAAgB,KAAK,KAAK;AAE/B,UAAI,SAAS,GAAG;AACf,aAAK,eAAe,KAAK;AACzB,aAAK,WAAW,KAAK,YAAY,KAAK;AAAA,MACvC,WAAW,UAAU,GAAG;AACvB,aAAK,eAAe,KAAK;AACzB,aAAK,WAAW,KAAK,YAAY,IAAI;AAAA,MACtC,OAAO;AACN,aAAK,eAAe,KAAK;AAAA,MAC1B;AAAA,IACD;AAAA,IAEA,0BAA0B;AAEzB,UAAI,CAAC,KAAK,oBAAoB;AAC7B,eAAO,SAAS,GAAG,+CAA+C,CAAC;AACnE;AAAA,MACD;AAEA,UAAI,KAAK,kBAAkB,OAAO,GAAG;AACpC,eAAO,SAAS,GAAG,6CAA6C,CAAC;AACjE;AAAA,MACD;AAEA,YAAM,iBAAiB,MAAM,KAAK,KAAK,iBAAiB;AACxD,YAAM,yBAAyB,UAAU,OAAO,SAAO,eAAe,SAAS,IAAI,IAAI,CAAC;AAGxF,YAAM,YAAY,CAAC,GAAG,IAAI,IAAI,uBAAuB,IAAI,SAAO,IAAI,QAAQ,CAAC,CAAC;AAC9E,UAAI,UAAU,SAAS,GAAG;AACzB,eAAO,SAAS,GAAG,gGAAgG,CAAC;AACpH;AAAA,MACD;AAGA,aAAO;AAAA,QACN,GAAG,uFAAuF,CAAC,eAAe,MAAM,CAAC;AAAA,QACjH,MAAM;AACL,eAAK,cAAc,gBAAgB,uBAAuB,GAAG,QAAQ;AAAA,QACtE;AAAA,MACD;AAAA,IACD;AAAA,IAEA,cAAc,eAAe,UAAU;AACtC,aAAO,IAAI,OAAO,GAAG,qBAAqB,CAAC;AAE3C,aAAO,KAAK;AAAA,QACX,QAAQ;AAAA,QACR,MAAM;AAAA,UACL;AAAA,UACA;AAAA,QACD;AAAA,QACA,UAAU,CAAC,aAAa;AACvB,iBAAO,IAAI,SAAS;AACpB,cAAI,SAAS,WAAW,SAAS,QAAQ,SAAS;AACjD,mBAAO,WAAW;AAAA,cACjB,SAAS,GAAG,kDAAkD,CAAC,SAAS,QAAQ,WAAW,CAAC;AAAA,cAC5F,WAAW;AAAA,YACZ,CAAC;AAGD,iBAAK,kBAAkB,MAAM;AAC7B,iBAAK,aAAa;AAGlB,gBAAI,SAAS,QAAQ,aAAa;AACjC,yBAAW,MAAM;AAChB,qBAAK,OAAO,kBAAkB,SAAS,QAAQ,WAAW;AAAA,cAC3D,GAAG,CAAC;AAAA,YACL;AAAA,UACD,OAAO;AACN,mBAAO,SAAS,GAAG,+BAA+B,CAAC,SAAS,QAAQ,SAAS,eAAe,CAAC,CAAC;AAAA,UAC/F;AAAA,QACD;AAAA,QACA,OAAO,CAAC,UAAU;AACjB,iBAAO,IAAI,SAAS;AACpB,iBAAO,SAAS,GAAG,2CAA2C,CAAC;AAC/D,kBAAQ,MAAM,gBAAgB,KAAK;AAAA,QACpC;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,iBAAiB,MAAM;AACtB,aAAO,OAAO,aAAa;AAAA,QAC1B,MAAM;AACL,cAAI,MAAM;AACT,iBAAK,WAAW,IAAI,WAAW,MAAM;AACrC,mBAAO,KAAK,aAAa;AAAA,UAC1B,OAAO;AACN,iBAAK,WAAW,IAAI,WAAW,MAAM;AAErC,iBAAK,kBAAkB,MAAM;AAC7B,iBAAK,qBAAqB;AAAA,UAC3B;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,EACD;;;ACtfA,SAAO,QAAQ,qBAAqB;AACpC,UAAQ,YAAY,mBAAmB,MAAM;AAAA,IAC5C,YAAY,EAAE,SAAS,aAAa,OAAO,GAAG;AAC7C,WAAK,UAAU;AACf,WAAK,cAAc;AACnB,WAAK,SAAS;AAEd,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,iBAAiB;AAChB,WAAK,YAAY;AACjB,WAAK,wBAAwB;AAC7B,WAAK,YAAY;AACjB,WAAK,iBAAiB;AAAA,IACvB;AAAA,IAEA,cAAc;AACb,WAAK,QAAQ;AAAA,QACZ;AAAA;AAAA,OAEI,GAAG,wCAAwC;AAAA;AAAA;AAAA;AAAA;AAAA,2BAKvB,GAAG,OAAO;AAAA;AAAA,2BAEV,GAAG,QAAQ;AAAA;AAAA,2BAEX,GAAG,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAMtC;AAEA,WAAK,aAAa,KAAK,QAAQ,KAAK,qBAAqB;AACzD,WAAK,mBAAmB,KAAK,WAAW,KAAK,0BAA0B;AACvE,WAAK,qBAAqB,KAAK,WAAW,KAAK,gBAAgB;AAC/D,WAAK,iBAAiB,KAAK,mBAAmB,KAAK,gBAAgB;AACnE,WAAK,mBAAmB,KAAK,mBAAmB,KAAK,kBAAkB;AACvE,WAAK,oBAAoB,KAAK,mBAAmB,KAAK,mBAAmB;AACzE,WAAK,qBAAqB,KAAK,mBAAmB,KAAK,qBAAqB;AAC5E,WAAK,gBAAgB,KAAK,mBAAmB,KAAK,eAAe;AAAA,IAClE;AAAA,IAEA,0BAA0B;AACzB,YAAM,eAAe,IAAI,OAAO,GAAG,OAAO;AAAA,QACzC,OAAO;AAAA,QACP,QAAQ;AAAA,UACP,EAAC,WAAW,YAAY,WAAW,QAAQ,SAAS,SAAS,OAAO,YAAY,MAAM,EAAC;AAAA,UACvF,EAAC,WAAU,WAAW,WAAU,cAAc,OAAM,mBAAkB;AAAA,QACvE;AAAA,QACA,gBAAgB,MAAM;AACrB,eAAK,WAAW;AAAA,QACjB;AAAA,QACA,sBAAsB,GAAG,MAAM;AAAA,MAChC,CAAC;AACD,WAAK,eAAe;AAEpB,YAAM,iBAAiB,IAAI,OAAO,GAAG,OAAO;AAAA,QACxC,OAAO;AAAA,QACP,QAAQ;AAAA,UACJ;AAAA,YACG,WAAW;AAAA,YACX,WAAW;AAAA,YACX,SAAS;AAAA,YACT,OAAO;AAAA,YACP,MAAM;AAAA,UACT;AAAA,UACA;AAAA,YACE,WAAW;AAAA,YACV,WAAW;AAAA,YACX,OAAO;AAAA,YACP,MAAM;AAAA,YACN,SAAS;AAAA,UACZ;AAAA,QACH;AAAA,QACF,gBAAgB,MAAM;AAClB,eAAK,qBAAqB;AAAA,QAC5B;AAAA,QACF,sBAAsB,GAAG,aAAa;AAAA,MACxC,CAAC;AACF,WAAK,iBAAiB;AAEtB,YAAM,eAAe,IAAI,OAAO,GAAG,OAAO;AAAA,QACzC,OAAO;AAAA,QACP,QAAQ;AAAA,UACP,EAAC,WAAW,SAAS,WAAW,QAAQ,OAAO,gBAAe;AAAA,QAC/D;AAAA,QACA,gBAAgB,MAAM;AACrB,eAAK,cAAc;AAAA,QACpB;AAAA,QACA,sBAAsB,GAAG,OAAO;AAAA,MACjC,CAAC;AACD,WAAK,eAAe;AAEpB,YAAM,qBAAqB,IAAI,OAAO,GAAG,OAAO;AAAA,QAC/C,OAAO;AAAA,QACP,QAAQ;AAAA,UACP,EAAC,WAAW,SAAS,WAAW,QAAQ,OAAO,gBAAe;AAAA,QAC/D;AAAA,QACA,gBAAgB,MAAM;AACrB,eAAK,YAAY;AAAA,QAClB;AAAA,QACA,sBAAsB,GAAG,OAAO;AAAA,MACjC,CAAC;AACD,WAAK,qBAAqB;AAAA,IAC3B;AAAA,IAEA,uBAAuB,KAAK;AAC3B,YAAM,EAAE,OAAO,IAAI;AACnB,UAAI,kBAAkB;AAEtB,cAAQ,CAAC,QAAQ,cAAc,GAAG,MAAM,MAAM,kBAAkB;AAChE,iBAAW,YAAY,kBAAkB;AACzC,iBAAW,aAAa,kBAAkB;AAE1C,aAAO;AAAA,kCACyB,IAAI;AAAA,mCACH,KAAK;AAAA,4BACZ,GAAG,SAAS,MAAM,IAAI;AAAA;AAAA;AAAA,gCAGlB,gBAAgB,IAAI,aAAa,IAAI,QAAQ;AAAA,iCAC5C,IAAI;AAAA,qDACgB,0BAA0B,IAAI;AAAA;AAAA,IAElF;AAAA,IAEA,cAAc,KAAK,WAAW;AAC7B,aAAO;AAAA,8BACqB,UAAU;AAAA,6BACX,UAAU,OAAO,KAAK,UAAU;AAAA,mCAC1B,uBAAuB;AAAA;AAGxD,eAAS,yBAAyB;AACjC,YAAI,UAAU,QAAQ,UAAU,mBAAmB,UAAU,SAAS,UAAU,iBAAiB;AAChG,iBAAO,4BAA4B,UAAU;AAAA,+BAClB,gBAAgB,UAAU,MAAM,IAAI,QAAQ;AAAA,QACxE,OAAO;AACN,iBAAO,0BAA0B,gBAAgB,UAAU,mBAAmB,UAAU,MAAM,IAAI,QAAQ;AAAA,QAC3G;AAAA,MACD;AAAA,IACD;AAAA,IAEA,kBAAkB,KAAK;AACtB,UAAI,IAAI,iBAAiB;AACxB,eAAO;AAAA,uBACa,IAAI;AAAA,aACd,gBAAgB,IAAI,iBAAiB,IAAI,QAAQ;AAAA;AAAA,MAE5D,OAAO;AACN,eAAO;AAAA,MACR;AAAA,IACD;AAAA,IAEA,mBAAmB,KAAK;AACvB,aAAO;AAAA,YACG,GAAG,WAAW;AAAA,YACd,gBAAgB,IAAI,WAAW,IAAI,QAAQ;AAAA;AAAA,IAEtD;AAAA,IAEA,eAAe,KAAK;AACnB,UAAI,CAAC,IAAI,MAAM;AAAQ,eAAO;AAE9B,UAAI,aAAa,IAAI,MAAM,IAAI,OAAK;AACnC,cAAM,cAAc,SAAS,KAAK,EAAE,WAAW,IAAI,EAAE,cAAgB,EAAE,QAAQ,IAAK,GAAG,EAAE,iBAAiB,EAAE,UAAS,EAAE;AACvH,eAAO;AAAA;AAAA,8BAEoB;AAAA,8BACA,gBAAgB,EAAE,kCAAkC,IAAI,QAAQ;AAAA;AAAA;AAAA,MAG5F,CAAC,EAAE,KAAK,EAAE;AAEV,aAAO,8BAA8B;AAAA,IACtC;AAAA,IAEA,qBAAqB,KAAK;AACzB,aAAO;AAAA,YACG,GAAG,aAAa;AAAA,YAChB,gBAAgB,IAAI,aAAa,IAAI,QAAQ;AAAA;AAAA,IAExD;AAAA,IAEA,iBAAiB,KAAK,SAAS;AAC9B,aAAO;AAAA,YACG,GAAG,QAAQ,eAAe;AAAA,YAC1B,gBAAgB,QAAQ,QAAQ,IAAI,QAAQ;AAAA;AAAA,IAEvD;AAAA,IAEA,cAAc;AACb,WAAK,mBAAmB,GAAG,SAAS,eAAe,MAAM;AACxD,aAAK,OAAO,eAAe,KAAK,IAAI,IAAI;AACxC,aAAK,iBAAiB,KAAK;AAC3B,aAAK,WAAW,KAAK,yBAAyB,EAAE,IAAI,WAAW,MAAM;AACrE,aAAK,iBAAiB,IAAI,WAAW,MAAM;AAAA,MAC5C,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,aAAa,MAAM;AACtD,aAAK,OAAO,WAAW,KAAK,IAAI,IAAI;AACpC,aAAK,iBAAiB,KAAK;AAC3B,aAAK,WAAW,KAAK,yBAAyB,EAAE,IAAI,WAAW,MAAM;AACrE,aAAK,iBAAiB,IAAI,WAAW,MAAM;AAAA,MAC5C,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,eAAe,MAAM;AACxD,aAAK,OAAO,aAAa,KAAK,IAAI,IAAI;AACtC,aAAK,yBAAyB;AAAA,MAC/B,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,oBAAoB,MAAM;AAC7D,gBAAQ,IAAI,8BAA8B,KAAK,GAAG;AAC/C,YAAI,CAAC,KAAK,IAAI,sBAAsB,KAAK,IAAI,sBAAsB,GAAG;AAClE,iBAAO,WAAW;AAAA,YACf,SAAS,GAAG,8BAA8B;AAAA,YAC1C,WAAW;AAAA,UACf,CAAC;AACD;AAAA,QACH;AACA,aAAK,eAAe,YAAY,OAAO,UAAU,KAAK,IAAI,kBAAkB;AAC5E,aAAK,eAAe,KAAK;AAAA,MAC7B,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,aAAa,MAAM;AACtD,YAAI,cAAc,KAAK,YAAY,4BAA4B,IAAI,OAAK,KAAK,IAAI,EAAE,YAAY,SAAS,EAAE;AAC1G,YAAI,UAAU,mBAAoB,KAAK,IAAI,WAAU;AACrD,mBAAW,aAAa,KAAK,YAAY,yBAAyB,WAAW;AAE7E,eAAO,KAAK;AAAA,UACX,QAAQ;AAAA,UACR,MAAM;AAAA,YACL,SAAS,KAAK,IAAI;AAAA,YAClB,SAAS,KAAK,IAAI;AAAA,YAClB,cAAc,KAAK,YAAY;AAAA,UAChC;AAAA,UAEA,gBAAgB;AAAA,UAChB,UAAU,SAAU,GAAG;AACtB,uBAAW,sCAAoC,OAAO,SAAO,EAAE,QAAQ;AACvE,mBAAO,KAAK,OAAO;AAAA,UACpB;AAAA,QACD,CAAC;AAAA,MACF,CAAC;AAED,eAAS,aAAa,KAAK,MAAM;AAChC,eAAO,IAAI,QAAQ,YAAY,SAAS,OAAO,QAAQ;AACtD,iBAAO,OAAO,KAAK,YAAY,cAC5B,KAAK,UACL;AAAA,QACJ,CAAC;AAAA,MACF;AAEA,WAAK,mBAAmB,GAAG,SAAS,YAAY,MAAM;AACrD,aAAK,OAAO,UAAU;AACtB,aAAK,iBAAiB,KAAK;AAC3B,aAAK,WAAW,KAAK,yBAAyB,EAAE,IAAI,WAAW,MAAM;AACrE,aAAK,iBAAiB,IAAI,WAAW,MAAM;AAAA,MAC5C,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,cAAc,MAAM;AACvD,aAAK,aAAa,YAAY,SAAS,UAAU,KAAK,cAAc;AACpE,aAAK,aAAa,KAAK;AAAA,MACxB,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,oBAAoB,MAAM;AAC7D,aAAK,YAAY;AAAA,MAClB,CAAC;AAEK,WAAK,mBAAmB,GAAG,SAAS,oBAAoB,MAAM;AACnE,aAAK,YAAY;AAAA,MAClB,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,cAAc,MAAM;AACvD,aAAK,cAAc;AAAA,MACpB,CAAC;AAAA,IACF;AAAA,IAEA,uBAAuB;AACpB,YAAM,SAAS,KAAK,eAAe,WAAW;AAE9C,UAAI,CAAC,OAAO,iBAAiB;AACzB,eAAO,WAAW;AAAA,UACd,SAAS,GAAG,iCAAiC;AAAA,UAC7C,WAAW;AAAA,QACf,CAAC;AACD;AAAA,MACJ;AACH,UAAI,OAAO,gBAAgB,YAAY,EAAE,QAAQ,OAAO,GAAG,MAAM,kBAAkB;AAC5E,aAAK,6BAA6B,MAAM;AACxC;AAAA,MACJ;AAEA,UAAI,CAAC,OAAO,UAAU,OAAO,UAAU,GAAG;AACtC,eAAO,WAAW;AAAA,UACd,SAAS,GAAG,6BAA6B;AAAA,UACzC,WAAW;AAAA,QACf,CAAC;AACD;AAAA,MACJ;AAEA,UAAI,OAAO,SAAS,KAAK,IAAI,oBAAoB;AAC7C,eAAO,WAAW;AAAA,UACd,SAAS;AAAA,YAAG;AAAA,YACR,CAAC,gBAAgB,KAAK,IAAI,oBAAoB,KAAK,IAAI,QAAQ,CAAC;AAAA,UAAC;AAAA,UACrE,WAAW;AAAA,QACf,CAAC;AACD;AAAA,MACJ;AAEA,aAAO,IAAI,OAAO,GAAG,2BAA2B,CAAC;AAGjD,aAAO,KAAK;AAAA,QACR,QAAQ;AAAA,QACR,MAAM;AAAA,UACF,cAAc,KAAK,IAAI;AAAA,UACvB,iBAAiB,OAAO;AAAA,UACxB,QAAQ,OAAO;AAAA,QACnB;AAAA,QACA,UAAU,CAAC,MAAM;AAtUzB;AAuUY,iBAAO,IAAI,SAAS;AACpB,cAAI,CAAC,EAAE,OAAO,EAAE,WAAW,EAAE,QAAQ,SAAS;AAC1C,mBAAO,WAAW;AAAA,cACd,SAAS,GAAG,4BAA4B;AAAA,cACxC,WAAW;AAAA,YACf,CAAC;AACD,iBAAK,eAAe,KAAK;AAEzB,mBAAO,GAAG,QAAQ,iBAAiB,KAAK,IAAI,IAAI,EAC3C,KAAK,SAAO,KAAK,gBAAgB,GAAG,CAAC;AAAA,UAC9C,OAAO;AACH,mBAAO,WAAW;AAAA,cACd,SAAS,GAAG,0BAA0B,OAAK,OAAE,YAAF,mBAAW,UAAS,EAAE,OAAO;AAAA,cACxE,WAAW;AAAA,YACf,CAAC;AAAA,UACL;AAAA,QACJ;AAAA,MACJ,CAAC;AAAA,IACL;AAAA,IAEA,6BAA6B,QAAQ;AACjC,YAAM,KAAK;AACX,YAAM,MAAM,KAAK;AACjB,YAAM,qBAAqB,IAAI;AAG/B,aAAO,KAAK;AAAA,QACR,QAAQ;AAAA,QACR,UAAU,SAAS,GAAG;AAClB,cAAI,EAAE,WAAW,EAAE,QAAQ,SAAS,GAAG;AACnC,eAAG,4BAA4B,EAAE,SAAS,KAAK,oBAAoB,MAAM;AAAA,UAC7E,OAAO;AACH,mBAAO,SAAS;AAAA,cACZ,OAAO,GAAG,uBAAuB;AAAA,cACjC,SAAS,GAAG,iDAAiD;AAAA,cAC7D,WAAW;AAAA,YACf,CAAC;AAAA,UACL;AAAA,QACJ;AAAA,MACJ,CAAC;AAAA,IACL;AAAA,IAEA,4BAA4B,UAAU,KAAK,oBAAoB,gBAAgB;AAC3E,YAAM,KAAK;AAGX,YAAM,eAAe,SAAS,IAAI,aAAW;AACzC,cAAM,mBAAmB,gBAAgB,QAAQ,aAAa,IAAI,QAAQ;AAC1E,cAAM,mBAAmB,gBAAgB,QAAQ,kBAAkB,IAAI,QAAQ;AAC/E,cAAM,iBAAiB,OAAO,SAAS,YAAY,QAAQ,SAAS;AACpE,cAAM,eAAe,QAAQ,mBAAmB,cAAc,YAC3C,QAAQ,mBAAmB,mBAAmB,YAAY;AAE7E,eAAO;AAAA,mCACoB,QAAQ,yBAAyB,QAAQ;AAAA;AAAA;AAAA;AAAA,sBAItD,QAAQ,aAAa;AAAA,sBACrB,QAAQ,WAAW;AAAA,iDACQ;AAAA,oEACmB;AAAA;AAAA,0CAE1B;AAAA,0BAChB,GAAG,QAAQ,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0CAMT,QAAQ;AAAA;AAAA;AAAA,sBAG5B;AAAA;AAAA;AAAA,MAGlB,CAAC,EAAE,KAAK,EAAE;AAEV,YAAM,cAAc;AAAA;AAAA;AAAA;AAAA,8BAIM,GAAG,oBAAoB,MAAM,gBAAgB,oBAAoB,IAAI,QAAQ;AAAA;AAAA,0BAEjF,GAAG,UAAU,MAAM,gBAAgB,GAAG,IAAI,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2EASD,GAAG,QAAQ;AAAA,kCACpD,GAAG,MAAM;AAAA,kCACT,GAAG,UAAU;AAAA,6DACc,GAAG,UAAU;AAAA,6DACb,GAAG,WAAW;AAAA,kCACzC,GAAG,QAAQ;AAAA,8DACiB,GAAG,cAAc;AAAA,kCAC7C,GAAG,MAAM;AAAA;AAAA;AAAA;AAAA,0BAIjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAOtB,YAAM,SAAS,IAAI,OAAO,GAAG,OAAO;AAAA,QAChC,OAAO,GAAG,8BAA8B;AAAA,QACxC,QAAQ;AAAA,UACJ;AAAA,YACI,WAAW;AAAA,YACX,WAAW;AAAA,YACX,SAAS;AAAA,UACb;AAAA,QACJ;AAAA,QACA,MAAM;AAAA,QACN,sBAAsB,GAAG,yBAAyB;AAAA,QAClD,gBAAgB,WAAW;AACvB,aAAG,6BAA6B,QAAQ,KAAK,cAAc;AAAA,QAC/D;AAAA,QACA,wBAAwB,GAAG,QAAQ;AAAA,MACvC,CAAC;AAED,aAAO,KAAK;AAGZ,iBAAW,MAAM;AACb,cAAM,iBAAiB,OAAO;AAG9B,uBAAe,KAAK,mBAAmB,EAAE,GAAG,UAAU,WAAW;AAC7D,gBAAM,MAAM,EAAE,IAAI,EAAE,QAAQ,IAAI;AAChC,gBAAM,eAAe,IAAI,KAAK,eAAe;AAC7C,gBAAM,mBAAmB,WAAW,IAAI,KAAK,WAAW,CAAC;AAEzD,cAAI,EAAE,IAAI,EAAE,GAAG,UAAU,GAAG;AACxB,yBAAa,KAAK,YAAY,KAAK;AAEnC,kBAAM,cAAc,KAAK,IAAI,kBAAkB,kBAAkB;AACjE,yBAAa,IAAI,WAAW;AAAA,UAChC,OAAO;AACH,yBAAa,KAAK,YAAY,IAAI,EAAE,IAAI,EAAE;AAAA,UAC9C;AAEA,aAAG,6BAA6B,gBAAgB,IAAI,QAAQ;AAAA,QAChE,CAAC;AAGD,uBAAe,KAAK,eAAe,EAAE,GAAG,SAAS,WAAW;AACxD,aAAG,6BAA6B,gBAAgB,IAAI,QAAQ;AAAA,QAChE,CAAC;AAAA,MACL,GAAG,GAAG;AAAA,IACV;AAAA,IACA,6BAA6B,gBAAgB,UAAU;AACnD,UAAI,QAAQ;AACZ,qBAAe,KAAK,2BAA2B,EAAE,KAAK,WAAW;AAC7D,cAAM,MAAM,EAAE,IAAI,EAAE,QAAQ,IAAI;AAChC,cAAM,eAAe,IAAI,KAAK,eAAe;AAC7C,cAAM,SAAS,WAAW,aAAa,IAAI,CAAC,KAAK;AACjD,iBAAS;AAAA,MACb,CAAC;AAED,qBAAe,KAAK,iBAAiB,EAAE;AAAA,QACnC,GAAG,GAAG,UAAU,MAAM,gBAAgB,OAAO,QAAQ;AAAA,MACzD;AAAA,IACJ;AAAA,IAEA,6BAA6B,QAAQ,KAAK,gBAAgB;AACtD,YAAM,KAAK;AACX,YAAM,oBAAoB,CAAC;AAC3B,UAAI,eAAe;AACnB,UAAI,YAAY;AAEhB,aAAO,SAAS,KAAK,2BAA2B,EAAE,KAAK,WAAW;AAC9D,cAAM,MAAM,EAAE,IAAI,EAAE,QAAQ,IAAI;AAChC,cAAM,aAAa,IAAI,KAAK,YAAY;AACxC,cAAM,mBAAmB,WAAW,IAAI,KAAK,WAAW,CAAC;AACzD,cAAM,eAAe,IAAI,KAAK,eAAe;AAC7C,cAAM,eAAe,WAAW,aAAa,IAAI,CAAC,KAAK;AAEvD,YAAI,gBAAgB,GAAG;AACnB,iBAAO,SAAS;AAAA,YACZ,OAAO,GAAG,gBAAgB;AAAA,YAC1B,SAAS,GAAG,wDAAwD;AAAA,YACpE,WAAW;AAAA,UACf,CAAC;AACD,sBAAY;AACZ,iBAAO;AAAA,QACX;AAEA,YAAI,eAAe,kBAAkB;AACjC,iBAAO,SAAS;AAAA,YACZ,OAAO,GAAG,0BAA0B;AAAA,YACpC,SAAS,GAAG,iEAAiE,CAAC,UAAU,CAAC;AAAA,YACzF,WAAW;AAAA,UACf,CAAC;AACD,sBAAY;AACZ,iBAAO;AAAA,QACX;AAEA,0BAAkB,KAAK;AAAA,UACnB,IAAI;AAAA,UACJ,QAAQ;AAAA,QACZ,CAAC;AACD,wBAAgB;AAAA,MACpB,CAAC;AAED,YAAM,qBAAqB,IAAI;AAC/B,UAAI,eAAe,oBAAoB;AACnC,eAAO,SAAS;AAAA,UACZ,OAAO,GAAG,4BAA4B;AAAA,UACtC,SAAS,GAAG,qEAAqE;AAAA,YAC7E,gBAAgB,cAAc,IAAI,QAAQ;AAAA,YAC1C,gBAAgB,oBAAoB,IAAI,QAAQ;AAAA,UACpD,CAAC;AAAA,UACD,WAAW;AAAA,QACf,CAAC;AACD;AAAA,MACJ;AAEA,UAAI,aAAa,kBAAkB,WAAW,GAAG;AAC7C,YAAI,kBAAkB,WAAW,GAAG;AAChC,iBAAO,SAAS;AAAA,YACZ,OAAO,GAAG,cAAc;AAAA,YACxB,SAAS,GAAG,8CAA8C;AAAA,YAC1D,WAAW;AAAA,UACf,CAAC;AAAA,QACL;AACA;AAAA,MACJ;AAGA,aAAO;AAAA,QACH,GAAG,6CAA6C;AAAA,UAC5C,kBAAkB;AAAA,UAClB,gBAAgB,cAAc,IAAI,QAAQ;AAAA,QAC9C,CAAC;AAAA,QACD,WAAW;AACP,aAAG,+BAA+B,mBAAmB,KAAK,cAAc,cAAc;AACtF,iBAAO,KAAK;AAAA,QAChB;AAAA,MACJ;AAAA,IACJ;AAAA,IAEA,+BAA+B,mBAAmB,KAAK,cAAc,gBAAgB;AACjF,YAAM,KAAK;AAEX,aAAO,WAAW;AAAA,QACd,SAAS,GAAG,sCAAsC;AAAA,QAClD,WAAW;AAAA,MACf,CAAC;AAED,aAAO,KAAK;AAAA,QACR,QAAQ;AAAA,QACR,MAAM;AAAA,UACF,eAAe;AAAA,UACf,cAAc,IAAI;AAAA,QACtB;AAAA,QACA,UAAU,SAAS,GAAG;AA9kB9B;AA+kBY,cAAI,EAAE,WAAW,EAAE,QAAQ,SAAS;AAEhC,mBAAO,KAAK;AAAA,cACR,QAAQ;AAAA,cACR,MAAM;AAAA,gBACF,cAAc,IAAI;AAAA,gBAClB,iBAAiB,eAAe;AAAA,gBAChC,QAAQ;AAAA,cACZ;AAAA,cACA,UAAU,SAAS,WAAW;AAxlBlD,oBAAAC;AAylBwB,oBAAI,UAAU,WAAW,UAAU,QAAQ,SAAS;AAChD,yBAAO,WAAW;AAAA,oBACd,SAAS,GAAG,8CAA8C;AAAA,oBAC1D,WAAW;AAAA,kBACf,CAAC;AAED,qBAAG,eAAe,KAAK;AAGvB,yBAAO,GAAG,QAAQ,iBAAiB,IAAI,IAAI,EACtC,KAAK,iBAAe,GAAG,gBAAgB,WAAW,CAAC;AAAA,gBAC5D,OAAO;AACH,yBAAO,SAAS;AAAA,oBACZ,OAAO,GAAG,qBAAqB;AAAA,oBAC/B,WAASA,MAAA,UAAU,YAAV,gBAAAA,IAAmB,UAAS,GAAG,iCAAiC;AAAA,oBACzE,WAAW;AAAA,kBACf,CAAC;AAAA,gBACL;AAAA,cACJ;AAAA,YACJ,CAAC;AAAA,UACL,OAAO;AACH,mBAAO,SAAS;AAAA,cACZ,OAAO,GAAG,OAAO;AAAA,cACjB,WAAS,OAAE,YAAF,mBAAW,YAAW,GAAG,6CAA6C;AAAA,cAC/E,WAAW;AAAA,YACf,CAAC;AAAA,UACL;AAAA,QACJ;AAAA,QACA,OAAO,SAAS,OAAO;AACnB,kBAAQ,MAAM,oCAAoC,KAAK;AACvD,iBAAO,SAAS;AAAA,YACZ,OAAO,GAAG,OAAO;AAAA,YACjB,SAAS,GAAG,6CAA6C;AAAA,YACzD,WAAW;AAAA,UACf,CAAC;AAAA,QACL;AAAA,MACJ,CAAC;AAAA,IACL;AAAA,IAEC,gBAAgB;AACf,YAAM,MAAM,KAAK,OAAO,QAAQ;AAChC,YAAM,eAAe,KAAK,YAAY,qCAAqC,IAAI;AAC/E,YAAM,UAAU,KAAK,IAAI;AACzB,YAAM,UAAU,KAAK,IAAI;AACzB,YAAM,aAAa,KAAK,IAAI,eAAe,GAAG,eAAe;AAC7D,YAAM,YAAY,KAAK,IAAI,YAAY,OAAO,KAAK;AAEnD,aAAO,GAAG,UAAU,kBAAkB,kBAAkB,qBAAqB,EAC3E,KAAK,CAAC,EAAE,QAAQ,MAAM;AACtB,YAAI,WAAW,QAAQ,wBAAwB,KAAK;AACnD,eAAK,cAAc,SAAS,SAAS,cAAc,YAAY,SAAS;AAAA,QACzE,OAAO;AACN,iBAAO,MAAM;AAAA,YACZ;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UACD;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACH;AAAA,IAEA,cAAc;AACb,UAAI,CAAC,KAAK,OAAO,CAAC,KAAK,IAAI,SAAS,KAAK,IAAI,MAAM,WAAW,GAAG;AAChE,eAAO,WAAW;AAAA,UACjB,SAAS,GAAG,8BAA8B;AAAA,UAC1C,WAAW;AAAA,QACZ,CAAC;AACD;AAAA,MACD;AAEA,UAAI,KAAK,IAAI,cAAc,GAAG;AAC7B,eAAO,WAAW;AAAA,UACjB,SAAS,GAAG,kCAAkC;AAAA,UAC9C,WAAW;AAAA,QACZ,CAAC;AACD;AAAA,MACD;AAEA,WAAK,yBAAyB;AAAA,IAC/B;AAAA,IAEA,2BAA2B;AAC1B,YAAM,aAAa,KAAK,IAAI,MAAM,IAAI,CAAC,MAAM,WAAW;AAAA,QACvD,KAAK,QAAQ;AAAA,QACb,WAAW,KAAK;AAAA,QAChB,WAAW,KAAK,aAAa,KAAK;AAAA,QAClC,eAAe,KAAK;AAAA,QACpB,WAAW;AAAA,QACX,MAAM,KAAK;AAAA,QACX,KAAK,KAAK;AAAA,QACV,gBAAgB;AAAA,QAChB,UAAU;AAAA,MACX,EAAE;AAEF,YAAM,SAAS,IAAI,OAAO,GAAG,OAAO;AAAA,QACnC,OAAO,GAAG,aAAa;AAAA,QACvB,MAAM;AAAA,QACN,QAAQ;AAAA,UACP;AAAA,YACC,WAAW;AAAA,YACX,WAAW;AAAA,YACX,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAWV;AAAA,UACA;AAAA,YACC,WAAW;AAAA,YACX,WAAW;AAAA,YACX,OAAO,GAAG,wBAAwB;AAAA,YAClC,SAAS;AAAA,YACT,MAAM;AAAA,YACN,aAAa,GAAG,uCAAuC;AAAA,YACvD,QAAQ,MAAM;AACb,oBAAM,QAAQ,OAAO,UAAU,oBAAoB;AACnD,kBAAI,SAAS,KAAK,SAAS,GAAG;AAC7B,qBAAK,mBAAmB,QAAQ,YAAY,KAAK;AAAA,cAClD;AAAA,YACD;AAAA,UACD;AAAA,UACA;AAAA,YACC,WAAW;AAAA,YACX,WAAW;AAAA,YACX,SAAS,KAAK,qBAAqB,YAAY,CAAC;AAAA,UACjD;AAAA,QACD;AAAA,QACA,gBAAgB,MAAM;AACrB,eAAK,qBAAqB,QAAQ,UAAU;AAAA,QAC7C;AAAA,QACA,sBAAsB,GAAG,aAAa;AAAA,QACtC,wBAAwB,GAAG,QAAQ;AAAA,MACpC,CAAC;AAED,WAAK,eAAe;AACpB,WAAK,mBAAmB;AAExB,aAAO,KAAK;AAEZ,iBAAW,MAAM;AAChB,aAAK,kBAAkB,MAAM;AAAA,MAC9B,GAAG,CAAC;AAAA,IACL;AAAA,IAEA,qBAAqB,YAAY,eAAe;AAC/C,UAAI,kBAAkB;AACtB,eAAS,IAAI,GAAG,KAAK,eAAe,KAAK;AACxC,2BAAmB,kBAAkB,cAAc;AAAA,MACpD;AAEA,UAAI,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAQY,GAAG,MAAM;AAAA,yBACT,GAAG,eAAe;AAAA,yBAClB,GAAG,WAAW;AAAA,yBACd,GAAG,MAAM;AAAA,yBACT,GAAG,QAAQ;AAAA,yBACX,GAAG,SAAS;AAAA;AAAA;AAAA;AAAA;AAMnC,iBAAW,QAAQ,CAAC,MAAM,UAAU;AACnC,gBAAQ;AAAA,sBACW;AAAA;AAAA,+DAEyC;AAAA;AAAA;AAAA,qBAG1C,KAAK;AAAA,kCACQ,KAAK;AAAA;AAAA;AAAA,4CAGK,KAAK,iBAAiB,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA,wBAK/C;AAAA;AAAA,iBAEP,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA,QAKd,gBAAgB,KAAK,MAAM,KAAK,IAAI,QAAQ;AAAA;AAAA;AAAA,+CAGL;AAAA,SACtC,gBAAgB,GAAG,KAAK,IAAI,QAAQ;AAAA;AAAA;AAAA;AAAA,gEAImB;AAAA,SACvD;AAAA;AAAA;AAAA;AAAA;AAAA,MAKP,CAAC;AAED,cAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sEAW4D,gBAAgB,GAAG,KAAK,IAAI,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAOxG,aAAO;AAAA,IACR;AAAA,IAEA,mBAAmB,QAAQ,YAAY,eAAe;AACrD,UAAI,gBAAgB,KAAK,gBAAgB,GAAG;AAC3C,eAAO,WAAW;AAAA,UACjB,SAAS,GAAG,4CAA4C;AAAA,UACxD,WAAW;AAAA,QACZ,CAAC;AACD;AAAA,MACD;AAEA,YAAM,WAAW,KAAK,qBAAqB,YAAY,aAAa;AACpE,aAAO,YAAY,YAAY,SAAS,KAAK,QAAQ;AAErD,WAAK,mBAAmB,QAAQ,UAAU;AAE1C,iBAAW,MAAM;AAChB,aAAK,kBAAkB,MAAM;AAAA,MAC9B,GAAG,CAAC;AAAA,IACL;AAAA,IAEA,mBAAmB,QAAQ,YAAY;AACtC,YAAM,UAAU,OAAO;AAEvB,iBAAW,QAAQ,CAAC,MAAM,UAAU;AACnC,cAAM,MAAM,QAAQ,KAAK,kBAAkB,SAAS;AAEpD,YAAI,KAAK,cAAc,EAAE,KAAK,WAAW,KAAK,QAAQ;AACtD,YAAI,KAAK,YAAY,EAAE,IAAI,KAAK,SAAS;AACzC,YAAI,KAAK,iBAAiB,EAAE,IAAI,KAAK,cAAc;AAEnD,aAAK,oBAAoB,OAAO,KAAK,WAAW,KAAK,IAAI;AAAA,MAC1D,CAAC;AAED,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,kBAAkB,QAAQ;AACzB,YAAM,UAAU,OAAO;AAEvB,cAAQ,KAAK,aAAa,EAAE,GAAG,UAAU,CAAC,MAAM;AAC/C,cAAM,UAAU,EAAE,EAAE,MAAM,EAAE,GAAG,UAAU;AACzC,gBAAQ,KAAK,cAAc,EAAE,KAAK,WAAW,OAAO;AAEpD,gBAAQ,KAAK,YAAY,EAAE,KAAK,CAAC,GAAG,UAAU;AAC7C,gBAAM,QAAQ,EAAE,KAAK,EAAE,KAAK,OAAO;AACnC,gBAAM,UAAU,WAAW,EAAE,KAAK,EAAE,KAAK,KAAK,CAAC;AAC/C,gBAAM,MAAM,UAAU,UAAU;AAEhC,YAAE,KAAK,EAAE,IAAI,GAAG;AAChB,eAAK,iBAAiB,OAAO,WAAW;AACxC,eAAK,iBAAiB,OAAO,YAAY;AACzC,eAAK,oBAAoB,OAAO,KAAK,KAAK,iBAAiB,OAAO,IAAI;AAAA,QACvE,CAAC;AAED,aAAK,eAAe;AAAA,MACrB,CAAC;AAED,cAAQ,KAAK,cAAc,EAAE,GAAG,UAAU,CAAC,MAAM;AAChD,cAAM,WAAW,EAAE,EAAE,MAAM;AAC3B,cAAM,QAAQ,SAAS,KAAK,OAAO;AACnC,cAAM,UAAU,SAAS,GAAG,UAAU;AACtC,cAAM,YAAY,QAAQ,KAAK,0BAA0B,SAAS;AAElE,aAAK,iBAAiB,OAAO,WAAW;AAExC,YAAI,SAAS;AACZ,gBAAM,UAAU,WAAW,UAAU,KAAK,KAAK,CAAC;AAChD,oBAAU,IAAI,OAAO;AACrB,eAAK,iBAAiB,OAAO,YAAY;AACzC,eAAK,oBAAoB,OAAO,SAAS,KAAK,iBAAiB,OAAO,IAAI;AAAA,QAC3E,OAAO;AACN,oBAAU,IAAI,CAAC;AACf,eAAK,iBAAiB,OAAO,YAAY;AACzC,eAAK,oBAAoB,OAAO,GAAG,KAAK,iBAAiB,OAAO,IAAI;AAAA,QACrE;AAEA,aAAK,eAAe;AAAA,MACrB,CAAC;AAED,cAAQ,KAAK,YAAY,EAAE,GAAG,gBAAgB,CAAC,MAAM;AACpD,cAAM,QAAQ,EAAE,EAAE,MAAM;AACxB,cAAM,QAAQ,MAAM,KAAK,OAAO;AAChC,YAAI,MAAM,WAAW,MAAM,IAAI,CAAC,KAAK;AACrC,cAAM,UAAU,WAAW,MAAM,KAAK,KAAK,CAAC;AAE5C,YAAI,MAAM,SAAS;AAClB,gBAAM;AACN,gBAAM,IAAI,GAAG;AAAA,QACd;AACA,YAAI,MAAM,GAAG;AACZ,gBAAM;AACN,gBAAM,IAAI,GAAG;AAAA,QACd;AAEA,cAAM,WAAW,QAAQ,KAAK,4BAA4B,SAAS;AACnE,iBAAS,KAAK,WAAW,MAAM,CAAC;AAEhC,aAAK,iBAAiB,OAAO,YAAY;AACzC,aAAK,iBAAiB,OAAO,WAAW,MAAM;AAE9C,aAAK,oBAAoB,OAAO,KAAK,KAAK,iBAAiB,OAAO,IAAI;AACtE,aAAK,eAAe;AAAA,MACrB,CAAC;AAED,cAAQ,KAAK,iBAAiB,EAAE,GAAG,UAAU,CAAC,MAAM;AACnD,cAAM,SAAS,EAAE,EAAE,MAAM;AACzB,cAAM,QAAQ,OAAO,KAAK,OAAO;AACjC,cAAM,cAAc,SAAS,OAAO,IAAI,CAAC;AAEzC,aAAK,iBAAiB,OAAO,iBAAiB;AAAA,MAC/C,CAAC;AAAA,IACF;AAAA,IAEA,oBAAoB,OAAO,KAAK,MAAM;AACrC,YAAM,SAAS,MAAM;AACrB,WAAK,aAAa,SAAS,KAAK,6BAA6B,SAAS,EACpE,KAAK,gBAAgB,QAAQ,KAAK,IAAI,QAAQ,CAAC;AAAA,IAClD;AAAA,IAEA,iBAAiB;AAChB,YAAM,iBAAiB,KAAK,iBAAiB,OAAO,UAAQ,KAAK,YAAY,KAAK,YAAY,CAAC;AAC/F,YAAM,eAAe,eAAe,OAAO,CAAC,KAAK,SAAS,MAAO,KAAK,YAAY,KAAK,MAAO,CAAC;AAE/F,WAAK,aAAa,SAAS,KAAK,iBAAiB,EAAE,KAAK,eAAe,MAAM;AAC7E,WAAK,aAAa,SAAS,KAAK,eAAe,EAAE,KAAK,gBAAgB,cAAc,KAAK,IAAI,QAAQ,CAAC;AAAA,IACvG;AAAA,IAEA,qBAAqB,QAAQ,YAAY;AACxC,YAAM,iBAAiB,WAAW,OAAO,UAAQ,KAAK,YAAY,KAAK,YAAY,CAAC;AAEpF,UAAI,eAAe,WAAW,GAAG;AAChC,eAAO,WAAW;AAAA,UACjB,SAAS,GAAG,2CAA2C;AAAA,UACvD,WAAW;AAAA,QACZ,CAAC;AACD;AAAA,MACD;AAEA,YAAM,iBAAiB,CAAC;AACxB,qBAAe,QAAQ,UAAQ;AAC9B,cAAM,cAAc,KAAK,eAAe,SAAS;AACjD,YAAI,CAAC,eAAe,cAAc;AACjC,yBAAe,eAAe,CAAC;AAAA,QAChC;AACA,uBAAe,aAAa,KAAK;AAAA,UAChC,WAAW,KAAK;AAAA,UAChB,WAAW,KAAK;AAAA,QACjB,CAAC;AAAA,MACF,CAAC;AAED,YAAM,uBAAuB,KAAK,+BAA+B,gBAAgB,cAAc;AAE/F,YAAM,gBAAgB,OAAO,KAAK,cAAc,EAAE;AAClD,YAAM,cAAc,eAAe;AACnC,YAAM,eAAe,eAAe,OAAO,CAAC,KAAK,SAAS,MAAO,KAAK,YAAY,KAAK,MAAO,CAAC;AAE/F,aAAO;AAAA,QACN,GAAG,oBAAoB,qCAAqC,sBAAsB,gBAAgB,cAAc,KAAK,IAAI,QAAQ,eAAe;AAAA,QAChJ,MAAM;AACL,eAAK,oBAAoB,gBAAgB,oBAAoB;AAC7D,iBAAO,KAAK;AAAA,QACb;AAAA,MACD;AAAA,IACD;AAAA,IAEA,+BAA+B,gBAAgB,gBAAgB;AAC9D,YAAM,qBAAqB,eAAe,OAAO,CAAC,KAAK,SAAS,MAAO,KAAK,YAAY,KAAK,MAAO,CAAC;AACrG,YAAM,sBAAsB,KAAK,IAAI,eAAe;AAEpD,YAAM,uBAAuB,CAAC;AAE9B,aAAO,KAAK,cAAc,EAAE,QAAQ,iBAAe;AAClD,cAAM,cAAc,eAAe;AACnC,cAAM,eAAe,YAAY,OAAO,CAAC,KAAK,eAAe;AAC5D,gBAAM,YAAY,eAAe,KAAK,UAAQ,KAAK,cAAc,WAAW,SAAS;AACrF,iBAAO,MAAO,WAAW,YAAY,UAAU;AAAA,QAChD,GAAG,CAAC;AAEJ,cAAM,gBAAgB,eAAe;AACrC,cAAM,oBAAoB,sBAAsB;AAEhD,6BAAqB,eAAe;AAAA,UACnC,QAAQ;AAAA,UACR,gBAAgB;AAAA,UAChB;AAAA,QACD;AAAA,MACD,CAAC;AAED,aAAO;AAAA,IACR;AAAA,IAEA,oBAAoB,gBAAgB,sBAAsB;AACzD,aAAO,IAAI,OAAO,GAAG,oBAAoB,CAAC;AAE1C,aAAO,KAAK;AAAA,QACX,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,kBAAkB,KAAK,IAAI;AAAA,UAC3B;AAAA,UACA;AAAA,UACA,mBAAmB;AAAA,QACpB;AAAA,QACA,UAAU,CAAC,MAAM;AA/gCpB;AAghCI,iBAAO,IAAI,SAAS;AAEpB,cAAI,CAAC,EAAE,OAAO,EAAE,WAAW,EAAE,QAAQ,SAAS;AAC7C,kBAAM,SAAS,EAAE;AAGjB,kBAAM,qBAAqB,OAAO,gBAAgB,OAAO,aAAa,SAAS,IAC9E,OAAO,aAAa,GAAG,OAAO;AAG/B,kBAAM,aAAa,CAAC;AAGpB,mBAAO,WAAW;AAAA,cACjB,SAAS,GAAG,wDAAwD,CAAC,OAAO,aAAa,MAAM,CAAC;AAAA,cAChG,WAAW;AAAA,YACZ,CAAC;AAGD,gBAAI,QAAQ,YAAY,cAAc,kBAAkB;AACvD,yBAAW;AAAA,gBACV,QAAQ,YAAY,cAAc,iBAAiB,aAAa;AAAA,cACjE;AAAA,YACD;AAGA,gBAAI,wBAAsB,aAAQ,YAAY,cAAc,qBAAlC,mBAAoD,OAAO,oBAAmB;AACvG,yBAAW;AAAA,gBACV,OAAO,GAAG,QAAQ,iBAAiB,kBAAkB,EAAE,KAAK,CAAC,QAAQ;AAEpE,sBAAI,QAAQ,YAAY,cAAc,iBAAiB,OAAO,eAAe;AAC5E,4BAAQ,YAAY,cAAc,iBAAiB,OAAO,cAAc;AAAA,kBACzE;AACA,uBAAK,gBAAgB,GAAG;AAAA,gBACzB,CAAC;AAAA,cACF;AAAA,YACD;AAGA,oBAAQ,IAAI,UAAU,EAAE,MAAM,MAAM;AAAA,YAEpC,CAAC;AAAA,UAEF,OAAO;AACN,mBAAO,WAAW;AAAA,cACjB,SAAS,GAAG,yBAAyB,KAAK,EAAE,WAAW,EAAE;AAAA,cACzD,WAAW;AAAA,YACZ,CAAC;AAAA,UACF;AAAA,QACD;AAAA,QACA,OAAO,CAAC,MAAM;AACb,iBAAO,IAAI,SAAS;AACpB,iBAAO,WAAW;AAAA,YACjB,SAAS,GAAG,uCAAuC;AAAA,YACnD,WAAW;AAAA,UACZ,CAAC;AAAA,QACF;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,cAAc;AACb,YAAM,UAAU,KAAK,IAAI;AACzB,YAAM,UAAU,KAAK,IAAI;AACzB,YAAM,eAAe;AACrB,YAAM,aAAa,KAAK,IAAI,eAAe,GAAG,eAAe;AAC7D,YAAM,YAAY,KAAK,IAAI,YAAY,OAAO,KAAK;AAEnD,YAAM,gBAAgB,CAACC,UAASC,UAASC,eAAcC,aAAYC,eAAc;AAChF,cAAM,2BAA2B,8BAA8B;AAC/D,cAAM,iBAAiB,oBAAoB,0BAA0BJ,UAASE,aAAY;AAE1F,YAAI,eAAe,WAAW,GAAG;AAChC,qCAA2BF,UAASC,UAASC,eAAcC,aAAYC,YAAW,eAAe,EAAE;AAAA,QACpG,WAAW,iBAAiBF,aAAY,GAAG;AAC1C,iBAAO,WAAW;AAAA,YACjB,SAAS,GAAG,0BAA0B;AAAA,YACtC,UAAU,GAAG,4EAA4E;AAAA,YACzF,WAAW;AAAA,UACZ,GAAG,EAAE;AACL,kCAAwBF,UAASE,aAAY;AAAA,QAC9C,OAAO;AACN,uCAA6BF,UAASC,UAASC,eAAcC,aAAYC,UAAS;AAAA,QACnF;AAAA,MACD;AAEA,YAAM,6BAA6B,CAACJ,UAASC,UAASC,eAAcC,aAAYC,YAAW,gBAAgB;AAC1G,YAAI,iBAAiBF,aAAY,GAAG;AACnC,4BAAkBF,UAASC,UAASC,eAAcE,YAAW,CAAC,QAAQ;AACrE,gBAAI,IAAI,YAAY,yBAAyB;AAC5C,qBAAO,WAAW;AAAA,gBACjB,SAAS,GAAG,+CAA+C;AAAA,gBAC3D,WAAW;AAAA,cACZ,GAAG,EAAE;AACL;AAAA,YACD;AACA,mBAAO,GAAG,KAAK,WAAW,EACxB,KAAK,MAAM;AACX,kBAAI,SAAS,GAAG,QAAQ,OAAO,YAAY,OAAO;AAClD,kBAAI,OAAO,CAAC,IAAI,YAAY;AAC5B,qBAAO,GAAG,MAAM,QAAQ,IAAI;AAAA,YAC7B,CAAC,EACA,KAAK,OAAO,GAAG,KAAK,UAAU,EAC9B,MAAM,CAAC,QAAQ;AACf,qBAAO,GAAG,KAAK,QAAQ,GAAG;AAC1B,qBAAO,WAAW;AAAA,gBACjB,SAAS,GAAG,uBAAuB,IAAI,WAAW,IAAI;AAAA,gBACtD,WAAW;AAAA,cACZ,CAAC;AACD,qBAAO,MAAM,WAAW,OAAO;AAAA,YAChC,CAAC;AAAA,UACH,CAAC;AAAA,QACF,OAAO;AACN,iBAAO,WAAW;AAAA,YACjB,SAAS,GAAG,gDAAgD;AAAA,YAC5D,UAAU,GAAG,sEAAsE;AAAA,YACnF,WAAW;AAAA,UACZ,GAAG,EAAE;AACL,uCAA6BJ,UAASC,UAASC,eAAcC,aAAYC,UAAS;AAAA,QACnF;AAAA,MACD;AAEA,YAAM,oBAAoB,CAACJ,UAASC,UAASC,eAAcE,YAAW,aAAa;AAClF,cAAM,iBAAiB,KAAK,IAAI,MAAM,IAAI,WAAS;AAAA,UAClD,WAAW,KAAK;AAAA,UAChB,WAAW,KAAK,aAAa,KAAK;AAAA,UAClC,KAAK,KAAK;AAAA,UACV,KAAK,KAAK;AAAA,UACV,MAAM,KAAK;AAAA,UACX,MAAM,KAAK;AAAA,QACZ,EAAE;AAEF,eAAO,KAAK;AAAA,UACX,QAAQ;AAAA,UACR,MAAM;AAAA,YACL,cAAcH;AAAA,YACd,eAAe;AAAA,YACf,cAAcC;AAAA,YACd,OAAOE;AAAA,UACR;AAAA,UACA,UAAU,CAAC,MAAM;AA3pCrB;AA4pCK,gBAAI,CAAC,EAAE,OAAO,EAAE,WAAW,EAAE,QAAQ,SAAS;AAC7C,kBAAI,EAAE,QAAQ,oBAAoB,GAAG;AACpC,yBAAS,EAAE,SAAS,wBAAwB,CAAC;AAC7C;AAAA,cACD;AAEA,kBAAI,CAAC,EAAE,QAAQ,QAAQ,CAAC,EAAE,QAAQ,KAAK,SAAS,EAAE,QAAQ,KAAK,MAAM,WAAW,GAAG;AAClF,yBAAS,EAAE,SAAS,wBAAwB,CAAC;AAC7C;AAAA,cACD;AAEA,mCAAqB,EAAE,QAAQ,MAAMF,eAAc,CAAC,iBAAiB;AACpE,yBAAS,EAAE,cAA4B,SAAS,EAAE,QAAQ,QAAQ,CAAC;AAAA,cACpE,CAAC;AAAA,YACF,OAAO;AACN,qBAAO,WAAW;AAAA,gBACjB,SAAS,GAAG,uCAAqC,OAAE,YAAF,mBAAW,UAAS,gBAAgB;AAAA,gBACrF,WAAW;AAAA,cACZ,CAAC;AACD,qBAAO,MAAM,WAAW,OAAO;AAAA,YAChC;AAAA,UACD;AAAA,QACD,CAAC;AAAA,MACF;AAEA,YAAM,uBAAuB,CAAC,UAAUA,eAAc,aAAa;AAClE,YAAI,CAAC,YAAY,CAAC,SAAS,SAAS,CAAC,SAAS,MAAM,QAAQ;AAC3D,mBAAS,EAAE;AACX;AAAA,QACD;AAEA,eAAO,KAAK;AAAA,UACX,QAAQ;AAAA,UACR,MAAM;AAAA,YACL,SAAS;AAAA,YACT,MAAMA;AAAA,UACP;AAAA,UACA,UAAU,CAAC,MAAM;AAChB,gBAAI,CAAC,EAAE,OAAO,EAAE,SAAS;AACxB,oBAAM,mBAAmB,EAAE;AAC3B,kBAAI,iBAAiB,iBAAiB,GAAG;AACxC,uBAAO,WAAW;AAAA,kBACjB,SAAS,GAAG,2CAA2C;AAAA,kBACvD,WAAW;AAAA,gBACZ,CAAC;AACD,uBAAO,MAAM,WAAW,OAAO;AAC/B;AAAA,cACD;AAEA,oBAAM,WAAW,iBAAiB,gBAAgB;AAClD,kBAAI,CAAC,UAAU;AACd,uBAAO,WAAW;AAAA,kBACjB,SAAS,GAAG,8CAA8C;AAAA,kBAC1D,WAAW;AAAA,gBACZ,CAAC;AACD,uBAAO,MAAM,WAAW,OAAO;AAC/B;AAAA,cACD;AAEA,kBAAI;AACH,sBAAM,UAAU,EAAE,KAAK,SAAS;AAChC,sBAAM,eAAe,OAAO,gBAAgB,UAAU,OAAO;AAC7D,yBAAS,YAAY;AAAA,cACtB,SAAS,OAAP;AACD,uBAAO,WAAW;AAAA,kBACjB,SAAS,GAAG,oCAAoC,MAAM,WAAW,MAAM;AAAA,kBACvE,WAAW;AAAA,gBACZ,CAAC;AACD,uBAAO,MAAM,WAAW,OAAO;AAC/B,yBAAS,EAAE;AAAA,cACZ;AAAA,YACD,OAAO;AACN,qBAAO,WAAW;AAAA,gBACjB,SAAS,GAAG,+BAA+B;AAAA,gBAC3C,WAAW;AAAA,cACZ,CAAC;AACD,qBAAO,MAAM,WAAW,OAAO;AAC/B,uBAAS,EAAE;AAAA,YACZ;AAAA,UACD;AAAA,QACD,CAAC;AAAA,MACF;AAEA,YAAM,mBAAmB,CAAC,WAAW;AACpC,YAAIA,gBAAe,CAAC;AACpB,YAAI,OAAO,mBAAmB,OAAO,gBAAgB,SAAS;AAC7D,UAAAA,gBAAe,OAAO,gBAAgB;AAAA,QACvC;AACA,eAAOA,cAAa,iBAAiB;AAAA,MACtC;AAEA,YAAM,gCAAgC,MAAM;AAC3C,YAAI;AACH,iBAAO,KAAK,MAAM,aAAa,4BAA4B,IAAI;AAAA,QAChE,SAAS,GAAP;AACD,iBAAO,CAAC;AAAA,QACT;AAAA,MACD;AAEA,YAAM,sBAAsB,CAAC,0BAA0BF,UAASE,kBAAiB;AAChF,YAAI,yBAAyBF,WAAU;AACtC,iBAAO,yBAAyBA,UAAS;AAAA,YACxC,CAAC,gBAAgB,YAAY,iBAAiBE;AAAA,UAC/C;AAAA,QACD;AACA,eAAO,CAAC;AAAA,MACT;AAEA,YAAM,+BAA+B,CAACF,UAASC,UAASC,eAAcC,aAAYC,eAAc;AAC/F,eAAO,MAAM;AAAA,UACZJ;AAAA,UACAC;AAAA,UACAC;AAAA,UACAC;AAAA,UACAC;AAAA,QACD;AAAA,MACD;AAEA,YAAM,0BAA0B,CAACJ,UAAS,yBAAyB;AAClE,YAAI,2BAA2B,8BAA8B;AAC7D,YAAI,OAAO,yBAAyBA,aAAY,CAAC;AAEjD,eAAO,GAAG,KAAK,oBAAoB,EAAE,KAAK,CAAC,iBAAiB;AAC3D,cAAI,EAAE,gBAAgB,aAAa,SAAS;AAC3C,mBAAO,MAAM,GAAG,0BAA0B,CAAC;AAC3C;AAAA,UACD;AAEA,gBAAM,SAAS,IAAI,OAAO,GAAG,OAAO;AAAA,YACnC,OAAO,GAAG,kBAAkB;AAAA,YAC5B,QAAQ;AAAA,cACP,EAAE,WAAW,gBAAgB;AAAA,cAC7B;AAAA,gBACC,WAAW;AAAA,gBACX,WAAW;AAAA,gBACX,OAAO,GAAG,iBAAiB;AAAA,gBAC3B,eAAe;AAAA,gBACf;AAAA,gBACA,UAAU,MAAM;AAAA,gBAChB,QAAQ;AAAA,kBACP;AAAA,oBACC,WAAW;AAAA,oBACX,WAAW;AAAA,oBACX,SAAS;AAAA,oBACT,SAAS,OAAO,KAAK,kBAAkBA,QAAO;AAAA,oBAC9C,WAAW;AAAA,oBACX,cAAc;AAAA,oBACd,OAAO,GAAG,cAAc;AAAA,kBACzB;AAAA,kBACA;AAAA,oBACC,WAAW;AAAA,oBACX,WAAW;AAAA,oBACX,SAAS;AAAA,oBACT,SAAS;AAAA,oBACT,WAAW;AAAA,oBACX,cAAc;AAAA,oBACd,OAAO,GAAG,SAAS;AAAA,kBACpB;AAAA,gBACD;AAAA,cACD;AAAA,YACD;AAAA,YACA,gBAAgB,MAAM;AACrB,kBAAI,kBAAkB,OAAO,WAAW,EAAE;AAC1C,kBAAI,mBAAmB,gBAAgB,QAAQ;AAC9C,oBAAI,oBAAoB,gBAAgB,IAAI,CAAC,MAAM,EAAE,YAAY;AACjE,oBAAI,gBAAgB,kBAAkB;AAAA,kBACrC,CAAC,MAAM,QAAQ,kBAAkB,QAAQ,IAAI,KAAK;AAAA,gBACnD;AACA,oBAAI,eAAe;AAClB,yBAAO,MAAM,GAAG,gEAAgE,CAAC;AACjF;AAAA,gBACD;AAAA,cACD,OAAO;AACN,kCAAkB,CAAC;AAAA,cACpB;AAEA,kBAAI,iCAAiC,8BAA8B;AACnE,6CAA+BA,YAAW;AAC1C,2BAAa,2BAA2B,KAAK,UAAU,8BAA8B;AAErF,qBAAO,KAAK;AAEZ,4BAAcA,UAAS,SAAS,sBAAsB,YAAY,SAAS;AAAA,YAC5E;AAAA,YACA,sBAAsB,GAAG,MAAM;AAAA,UAChC,CAAC;AAED,iBAAO,KAAK;AAAA,QACb,CAAC;AAAA,MACF;AAEA,UAAI,CAAC,KAAK,IAAI,MAAM,QAAQ;AAC3B,eAAO,WAAW;AAAA,UACjB,SAAS,GAAG,mCAAmC;AAAA,UAC/C,WAAW;AAAA,QACZ,CAAC;AACD,eAAO,OAAO,MAAM,WAAW,OAAO;AAAA,MACvC;AAGA,aAAO,GAAG,UAAU,kBAAkB,kBAAkB,qBAAqB,EAC3E,KAAK,CAAC,EAAE,QAAQ,MAAM;AAEtB,YAAI,WAAW,QAAQ,wBAAwB,KAAK;AACnD,wBAAc,SAAS,SAAS,cAAc,YAAY,SAAS;AAAA,QACpE,OAAO;AACN,uCAA6B,SAAS,SAAS,cAAc,YAAY,SAAS;AAAA,QACnF;AAAA,MACD,CAAC,EACA,MAAM,MAAM;AAEZ,eAAO,WAAW;AAAA,UACjB,SAAS,GAAG,iCAAiC;AAAA,UAC7C,WAAW;AAAA,QACZ,CAAC;AACD,eAAO,MAAM,WAAW,OAAO;AAAA,MAChC,CAAC;AAAA,IACH;AAAA,IAEA,cAAc,SAAS,SAAS,cAAc,YAAY,WAAW;AACpE,YAAM,2BAA2B,KAAK,8BAA8B;AACpE,YAAM,iBAAiB,KAAK,oBAAoB,0BAA0B,SAAS,YAAY;AAE/F,UAAI,eAAe,WAAW,GAAG;AAChC,aAAK,2BAA2B,SAAS,SAAS,cAAc,YAAY,WAAW,eAAe,EAAE;AAAA,MACzG,WAAW,KAAK,iBAAiB,YAAY,GAAG;AAC/C,eAAO,WAAW;AAAA,UACjB,SAAS,GAAG,0BAA0B;AAAA,UACtC,UAAU,GAAG,4EAA4E;AAAA,UACzF,WAAW;AAAA,QACZ,GAAG,EAAE;AACL,aAAK,wBAAwB,SAAS,YAAY;AAAA,MACnD,OAAO;AACN,aAAK,6BAA6B,SAAS,SAAS,cAAc,YAAY,SAAS;AAAA,MACxF;AAAA,IACD;AAAA,IAEA,2BAA2B,SAAS,SAAS,cAAc,YAAY,WAAW,aAAa;AAC9F,UAAI,KAAK,iBAAiB,YAAY,GAAG;AACxC,aAAK,kBAAkB,SAAS,SAAS,cAAc,WAAW,CAAC,QAAQ;AAC1E,iBAAO,GAAG,KAAK,WAAW,EACxB,KAAK,MAAM;AACX,gBAAI,SAAS,GAAG,QAAQ,OAAO,YAAY,OAAO;AAClD,gBAAI,OAAO,CAAC,IAAI,YAAY;AAC5B,mBAAO,GAAG,MAAM,QAAQ,IAAI;AAAA,UAC7B,CAAC,EACA,KAAK,OAAO,GAAG,KAAK,UAAU,EAC9B,MAAM,CAAC,QAAQ;AACf,mBAAO,GAAG,KAAK,QAAQ,GAAG;AAAA,UAC3B,CAAC;AAAA,QACH,CAAC;AAAA,MACF,OAAO;AACN,eAAO,WAAW;AAAA,UACjB,SAAS,GAAG,gDAAgD;AAAA,UAC5D,UAAU,GAAG,sEAAsE;AAAA,UACnF,WAAW;AAAA,QACZ,GAAG,EAAE;AACL,aAAK,6BAA6B,SAAS,SAAS,cAAc,YAAY,SAAS;AAAA,MACxF;AAAA,IACD;AAAA,IAEA,kBAAkB,SAAS,SAAS,cAAc,WAAW,UAAU;AACtE,aAAO,KAAK;AAAA,QACX,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,KAAK,OAAO,QAAQ,SAAS,OAAO;AAAA,UACpC;AAAA,UACA,OAAO;AAAA,QACR;AAAA,QACA,UAAU,CAAC,MAAM;AAChB,cAAI,CAAC,EAAE,KAAK;AACX,qBAAS,EAAE,OAAO;AAAA,UACnB;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,iBAAiB,QAAQ;AACxB,UAAI,eAAe,CAAC;AACpB,UAAI,OAAO,mBAAmB,OAAO,gBAAgB,SAAS;AAC7D,uBAAe,OAAO,gBAAgB;AAAA,MACvC;AACA,aAAO,aAAa,iBAAiB;AAAA,IACtC;AAAA,IAEA,gCAAgC;AAC/B,UAAI;AACH,eAAO,KAAK,MAAM,aAAa,4BAA4B,IAAI;AAAA,MAChE,SAAS,GAAP;AACD,eAAO,CAAC;AAAA,MACT;AAAA,IACD;AAAA,IAEA,oBAAoB,0BAA0B,SAAS,cAAc;AACpE,UAAI,yBAAyB,UAAU;AACtC,eAAO,yBAAyB,SAAS;AAAA,UACxC,CAAC,gBAAgB,YAAY,iBAAiB;AAAA,QAC/C;AAAA,MACD;AACA,aAAO,CAAC;AAAA,IACT;AAAA,IAEA,6BAA6B,SAAS,SAAS,cAAc,YAAY,WAAW;AACnF,aAAO,MAAM;AAAA,QACZ;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACD;AAAA,IACD;AAAA,IAEA,wBAAwB,SAAS,sBAAsB;AACtD,UAAI,2BAA2B,KAAK,8BAA8B;AAClE,UAAI,OAAO,yBAAyB,YAAY,CAAC;AAEjD,aAAO,GAAG,KAAK,oBAAoB,EAAE,KAAK,CAAC,iBAAiB;AAC3D,YAAI,EAAE,gBAAgB,aAAa,SAAS;AAC3C,iBAAO,MAAM,GAAG,0BAA0B,CAAC;AAC3C;AAAA,QACD;AAEA,cAAM,SAAS,IAAI,OAAO,GAAG,OAAO;AAAA,UACnC,OAAO,GAAG,kBAAkB;AAAA,UAC5B,QAAQ;AAAA,YACP;AAAA,cACC,WAAW;AAAA,YACZ;AAAA,YACA;AAAA,cACC,WAAW;AAAA,cACX,WAAW;AAAA,cACX,OAAO,GAAG,iBAAiB;AAAA,cAC3B,eAAe;AAAA,cACf;AAAA,cACA,UAAU,MAAM;AACf,uBAAO;AAAA,cACR;AAAA,cACA,QAAQ;AAAA,gBACP;AAAA,kBACC,WAAW;AAAA,kBACX,WAAW;AAAA,kBACX,SAAS;AAAA,kBACT,SAAS,OAAO,KAAK,kBAAkB,OAAO;AAAA,kBAC9C,WAAW;AAAA,kBACX,cAAc;AAAA,kBACd,OAAO,GAAG,cAAc;AAAA,gBACzB;AAAA,gBACA;AAAA,kBACC,WAAW;AAAA,kBACX,WAAW;AAAA,kBACX,SAAS;AAAA,kBACT,SAAS;AAAA,kBACT,WAAW;AAAA,kBACX,cAAc;AAAA,kBACd,OAAO,GAAG,SAAS;AAAA,gBACpB;AAAA,cACD;AAAA,YACD;AAAA,UACD;AAAA,UACA,gBAAgB,MAAM;AACrB,gBAAI,kBAAkB,OAAO,WAAW,EAAE;AAC1C,gBAAI,mBAAmB,gBAAgB,QAAQ;AAC9C,kBAAI,oBAAoB,gBAAgB,IAAI,CAAC,MAAM,EAAE,YAAY;AACjE,kBAAI,gBAAgB,kBAAkB;AAAA,gBACrC,CAAC,MAAM,QAAQ,kBAAkB,QAAQ,IAAI,KAAK;AAAA,cACnD;AACA,kBAAI,eAAe;AAClB,uBAAO,MAAM,GAAG,gEAAgE,CAAC;AACjF;AAAA,cACD;AAAA,YACD,OAAO;AACN,gCAAkB,CAAC;AAAA,YACpB;AAEA,gBAAI,iCAAiC,KAAK,8BAA8B;AACxE,2CAA+B,WAAW;AAC1C,yBAAa,2BAA2B,KAAK,UAAU,8BAA8B;AAErF,mBAAO,KAAK;AAEZ,iBAAK,cAAc,SAAS,KAAK,IAAI,MAAM,sBAAsB,KAAK,IAAI,aAAa,KAAK,IAAI,YAAY,OAAO,KAAK,IAAI;AAAA,UAC7H;AAAA,UACA,sBAAsB,GAAG,MAAM;AAAA,QAChC,CAAC;AAED,eAAO,KAAK;AAAA,MACb,CAAC;AAAA,IACF;AAAA,IAEA,mBAAmB;AAClB,YAAM,aAAa,OAAO,MAAM,OAAO,IAAI,WAAM;AACjD,WAAK,mBAAmB,KAAK,YAAY,EAAE,KAAK,SAAS,GAAG,cAAc;AAC1E,aAAO,GAAG,KAAK,aAAa;AAAA,QAC3B,UAAU;AAAA,QACV,QAAQ,MAAM,KAAK,mBAAmB,KAAK,YAAY,EAAE,MAAM;AAAA,QAC/D,WAAW,MAAM,KAAK,WAAW,GAAG,UAAU,KAAK,KAAK,mBAAmB,KAAK,YAAY,EAAE,GAAG,UAAU;AAAA,QAC3G,aAAa,GAAG,eAAe;AAAA,QAC/B,MAAM,SAAS,KAAK;AAAA,MACrB,CAAC;AACD,WAAK,mBAAmB,KAAK,kBAAkB,EAAE,KAAK,SAAS,GAAG,cAAc;AAChF,aAAO,GAAG,KAAK,aAAa;AAAA,QAC3B,UAAU;AAAA,QACV,QAAQ,MAAM,KAAK,mBAAmB,KAAK,kBAAkB,EAAE,MAAM;AAAA,QACrE,WAAW,MAAM,KAAK,WAAW,GAAG,UAAU,KAAK,KAAK,mBAAmB,KAAK,kBAAkB,EAAE,GAAG,UAAU;AAAA,QACjH,aAAa,GAAG,aAAa;AAAA,QAC7B,MAAM,SAAS,KAAK;AAAA,MACrB,CAAC;AACD,WAAK,mBAAmB,KAAK,UAAU,EAAE,KAAK,SAAS,GAAG,kBAAkB;AAC5E,aAAO,GAAG,KAAK,GAAG,cAAc,MAAM;AACrC,cAAM,qBAAqB,KAAK,WAAW,GAAG,UAAU;AACxD,YAAI,sBAAsB,KAAK,mBAAmB,KAAK,UAAU,EAAE,GAAG,UAAU,GAAG;AAClF,eAAK,mBAAmB,KAAK,UAAU,EAAE,MAAM;AAAA,QAChD;AAAA,MACD,CAAC;AACD,WAAK,mBAAmB,KAAK,WAAW,EAAE,KAAK,SAAS,GAAG,cAAc;AACzE,aAAO,GAAG,KAAK,aAAa;AAAA,QAC3B,UAAU;AAAA,QACV,QAAQ,MAAM,KAAK,mBAAmB,KAAK,WAAW,EAAE,MAAM;AAAA,QAC9D,WAAW,MAAM,KAAK,WAAW,GAAG,UAAU,KAAK,KAAK,mBAAmB,KAAK,WAAW,EAAE,GAAG,UAAU;AAAA,QAC1G,aAAa,GAAG,cAAc;AAAA,QAC9B,MAAM,SAAS,KAAK;AAAA,MACrB,CAAC;AAAA,IACF;AAAA,IAEA,aAAa;AACZ,YAAM,MAAM,KAAK,OAAO,QAAQ;AAChC,YAAM,aAAa,KAAK,aAAa,WAAW,EAAE;AAClD,YAAM,UAAU,KAAK,aAAa,WAAW,EAAE;AAC/C,YAAM,MAAM,KAAK,OAAO,IAAI;AAC5B,YAAM,eAAe,IAAI;AAEzB,aAAO,KAAK;AAAA,QACX,QAAQ;AAAA,QACR,MAAM;AAAA,UACL;AAAA,UACA,SAAS,GAAG,IAAI,KAAK,IAAI,IAAI,OAAO,IAAI;AAAA,UACxC,SAAS,UAAU,UAAU,GAAG,IAAI,KAAK,IAAI,IAAI,OAAO,IAAI;AAAA,UAC5D,SAAS,IAAI;AAAA,UACb,MAAM,IAAI;AAAA,UACV,YAAY;AAAA,UACZ;AAAA,UACA,kBAAkB,OAAO,KAAK,UAAU;AAAA,UACxC,OAAO,IAAI;AAAA,QACZ;AAAA,QACA,UAAU,OAAK;AACd,cAAI,CAAC,EAAE,KAAK;AACX,mBAAO,MAAM,WAAW,OAAO;AAC/B,gBAAI,EAAE,QAAQ,uBAAuB;AACpC,qBAAO,SAAS;AAAA,gBACf;AAAA,gBACA,CAAE,OAAO,MAAM,YAAY,EAAE,QAAQ,qBAAqB,CAAE;AAAA,cAC7D,CAAC;AAAA,YACF,OAAO;AACN,qBAAO,WAAW;AAAA,gBACjB,SAAS,GAAG,0BAA0B;AAAA,gBACtC,WAAW;AAAA,cACZ,CAAC;AAAA,YACF;AACA,iBAAK,aAAa,KAAK;AAAA,UACxB,OAAO;AACN,mBAAO,SAAS,GAAG,0DAA0D,CAAC;AAAA,UAC/E;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,iBAAiB,KAAK;AACrB,WAAK,cAAc,KAAK,EAAE;AAC1B,UAAI,QAAQ,OAAK;AAChB,YAAI,EAAE,WAAW;AAChB,YAAE,aAAa,QAAQ,OAAK;AAC3B,kBAAM,aAAa,EAAE,MAAM,GAAG,EAAE,GAAG,YAAY;AAC/C,kBAAM,MAAM,GAAG,CAAC;AAChB,iBAAK,cAAc;AAAA,cAClB,2CAA2C,mBAAmB;AAAA,YAC/D;AAAA,UACD,CAAC;AAAA,QACF;AAAA,MACD,CAAC;AACD,WAAK,cAAc,SAAS,EAAE,KAAK,EAAE,YAAY,MAAM;AAAA,IACxD;AAAA,IAEA,2BAA2B,MAAM;AAChC,UAAI,MAAM;AACT,aAAK,iBAAiB,IAAI,WAAW,MAAM;AAC3C,aAAK,WAAW,KAAK,yBAAyB,EAAE,IAAI,WAAW,MAAM;AAAA,MACtE,OAAO;AACN,aAAK,iBAAiB,IAAI,WAAW,MAAM;AAC3C,aAAK,WAAW,KAAK,yBAAyB,EAAE,IAAI,WAAW,MAAM;AAAA,MACtE;AAAA,IACD;AAAA,IAEA,sBAAsB,kBAAkB;AACvC,UAAI;AACH,eAAO,CAAC,EAAE,WAAW,MAAM,cAAc,CAAC,iBAAiB,WAAW,EAAE,CAAC;AAE1E,YAAM,gBAAgB,OAAO,WAAW,SAAS,QAAQ;AAEzD,YAAM,eAAe,gBAClB,CAAC,iBAAgB,cAAa,aAAa,IAC3C,CAAC,iBAAgB,cAAa,eAAc,aAAa;AAE5D,YAAM,gBAAgB,gBAChB,CAAC,eAAe,IAChB,KAAK,IAAI,qBAAqB,IACzB,CAAC,iBAAiB,eAAe,QAAQ,IACzC,CAAC,iBAAiB,QAAQ;AAErC,aAAO;AAAA,QACN,EAAE,WAAW,KAAK,IAAI,cAAc,GAAG,cAAc,aAAa;AAAA,QAClE,EAAE,WAAW,CAAC,KAAK,IAAI,aAAa,KAAK,IAAI,cAAc,GAAG,cAAc,cAAa;AAAA,QACzF,EAAE,WAAW,KAAK,IAAI,aAAa,KAAK,IAAI,cAAc,GAAG,cAAc,CAAC,eAAe,EAAC;AAAA,MAC7F;AAAA,IACD;AAAA,IAEA,gBAAgB,KAAK,mBAAiB,OAAO;AAC5C,yBACC,KAAK,WAAW,IAAI,eAAe,mBAAmB,IACtD,KAAK,WAAW,IAAI,eAAe,iBAAiB;AAErD,WAAK,2BAA2B,KAAK;AAErC,WAAK,MAAM;AAEX,WAAK,qBAAqB,GAAG;AAE7B,WAAK,kBAAkB,GAAG;AAE1B,WAAK,mBAAmB,GAAG;AAE3B,WAAK,qBAAqB,GAAG;AAE7B,YAAM,qBAAqB,KAAK,sBAAsB,gBAAgB;AAEtE,WAAK,iBAAiB,kBAAkB;AACxC,WAAK,iBAAiB,IAAI,SAAQ,mBAAmB,QAAQ,KAAK;AAElE,UAAI,oBAAoB,KAAK,iCAAiC;AAC7D,aAAK,cAAc;AAAA,MACpB;AAAA,IACD;AAAA,IAEA,qBAAqB,KAAK;AACzB,aAAO,GAAG,UAAU,YAAY,KAAK,IAAI,UAAU,UAAU,EAAE,KAAK,CAAC,EAAE,QAAQ,MAAM;AACpF,aAAK,iBAAiB,QAAQ,YAAY;AAC1C,cAAM,oBAAoB,KAAK,uBAAuB,GAAG;AACzD,aAAK,eAAe,KAAK,iBAAiB;AAAA,MAC3C,CAAC;AAAA,IACF;AAAA,IAEA,kBAAkB,KAAK;AACtB,WAAK,iBAAiB,KAAK,EAAE;AAC7B,UAAI,MAAM,QAAQ,UAAQ;AACzB,cAAM,WAAW,KAAK,cAAc,KAAK,IAAI;AAC7C,aAAK,iBAAiB,OAAO,QAAQ;AACrC,aAAK,8BAA8B;AAAA,MACpC,CAAC;AAAA,IACF;AAAA,IAEA,gCAAgC;AAC/B,YAAM,YAAY,MAAM,KAAK,KAAK,iBAAiB,KAAK,iBAAiB,CAAC;AAC1E,WAAK,iBAAiB,KAAK,iBAAiB,EAAE,IAAI,SAAS,EAAE;AAC7D,UAAI,YAAY,UAAU,OAAO,CAACK,YAAW,QAAQ;AACpD,YAAI,EAAE,GAAG,EAAE,MAAM,IAAIA;AACpB,UAAAA,aAAY,EAAE,GAAG,EAAE,MAAM;AAC1B,eAAOA;AAAA,MACR,GAAG,CAAC;AAEJ,mBAAa;AACb,UAAI,aAAa;AAAG,oBAAY;AAEhC,WAAK,iBAAiB,KAAK,iBAAiB,EAAE,IAAI,SAAS,SAAS;AAAA,IACrE;AAAA,IAEA,qBAAqB,KAAK;AACzB,WAAK,mBAAmB,KAAK,EAAE;AAC/B,UAAI,SAAS,QAAQ,OAAK;AACzB,YAAI,EAAE,QAAQ;AACb,gBAAM,cAAc,KAAK,iBAAiB,KAAK,CAAC;AAChD,eAAK,mBAAmB,OAAO,WAAW;AAAA,QAC3C;AAAA,MACD,CAAC;AACD,UAAI,IAAI,yBAAyB,IAAI,gBAAgB;AACpD,cAAM,cAAc,KAAK,iBAAiB,KAAK;AAAA,UAC9C,iBAAiB;AAAA,UACjB,QAAQ,IAAI;AAAA,QACb,CAAC;AACD,aAAK,mBAAmB,OAAO,WAAW;AAAA,MAC3C;AAAA,IACD;AAAA,IAEA,mBAAmB,KAAK;AACvB,WAAK,kBAAkB,KAAK,EAAE;AAE9B,YAAM,gBAAgB,KAAK,mBAAmB,GAAG;AACjD,YAAM,YAAY,KAAK,eAAe,GAAG;AACzC,YAAM,eAAe,KAAK,kBAAkB,GAAG;AAC/C,YAAM,kBAAkB,KAAK,qBAAqB,GAAG;AACrD,WAAK,kBAAkB,OAAO,aAAa;AAC3C,WAAK,kBAAkB,OAAO,SAAS;AACvC,WAAK,kBAAkB,OAAO,YAAY;AAC1C,WAAK,kBAAkB,OAAO,eAAe;AAAA,IAC9C;AAAA,IAEA,iBAAiB,MAAM;AACtB,aAAO,KAAK,WAAW,IAAI,WAAW,MAAM,IAAI,KAAK,WAAW,IAAI,WAAW,MAAM;AAAA,IACtF;AAAA,IAEA,2BAA2B;AAC1B,WAAK,2BAA2B,IAAI;AAAA,IACrC;AAAA,EACD;;;AC/vDA,SAAO,QAAQ,qBAAqB;AAEpC,UAAQ,YAAY,gBAAgB,MAAM;AAAA,IACtC,YAAY,EAAE,SAAS,QAAQ,YAAY,GAAG;AAC1C,cAAQ,IAAI,kBAAkB,SAAS,QAAQ,QAAQ,QAAQ,GAAG,UAAU,CAAC;AAC7E,UAAI,CAAC,WAAW,CAAC,QAAQ,QAAQ;AAC7B,gBAAQ,MAAM,oDAAoD;AAClE;AAAA,MACJ;AACA,WAAK,UAAU;AACf,WAAK,SAAS;AACd,WAAK,cAAc;AACnB,WAAK,iBAAiB;AACtB,WAAK,eAAe;AAAA,IACxB;AAAA,IAEA,iBAAiB;AACb,WAAK,YAAY;AACjB,WAAK,YAAY;AACjB,WAAK,YAAY;AAAA,IACrB;AAAA,IAEA,cAAc;AACV,WAAK,QAAQ,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yDAgT+B,GAAG,YAAY;AAAA;AAAA;AAAA,mDAGrB,GAAG,iBAAiB;AAAA,qDAClB,GAAG,uCAAuC;AAAA;AAAA;AAAA,iFAGd,GAAG,kBAAkB;AAAA;AAAA;AAAA;AAAA;AAAA,8FAKR,GAAG,qCAAqC;AAAA,0BAC5G,GAAG,kBAAkB;AAAA;AAAA;AAAA;AAAA,SAItC;AAAA,IACL;AAAA,IAEA,cAAc;AACV,YAAM,QAAQ,KAAK,QAAQ,KAAK,aAAa;AAC7C,YAAM,MAAM;AACZ,WAAK,sBAAsB;AAE3B,aAAO,KAAK;AAAA,QACR,QAAQ;AAAA,QACR,UAAU,CAAC,MAAM;AACb,kBAAQ,IAAI,yBAAyB,CAAC;AACtC,gBAAM,MAAM;AACZ,cAAI,EAAE,KAAK;AACP,mBAAO,SAAS,GAAG,yCAAyC,CAAC;AAC7D,iBAAK,cAAc,CAAC,CAAC;AAAA,UACzB,OAAO;AACH,iBAAK,aAAa,EAAE,WAAW,CAAC;AAChC,iBAAK,cAAc,KAAK,UAAU;AAAA,UACtC;AAAA,QACJ;AAAA,MACJ,CAAC;AAAA,IACL;AAAA,IAEA,wBAAwB;AACpB,YAAM,QAAQ,KAAK,QAAQ,KAAK,aAAa;AAC7C,eAAS,IAAI,GAAG,IAAI,GAAG,KAAK;AACxB,cAAM,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAQZ;AAAA,MACL;AAAA,IACJ;AAAA,IAEA,cAAc,QAAQ;AAClB,cAAQ,IAAI,qBAAqB,MAAM;AACvC,YAAM,QAAQ,KAAK,QAAQ,KAAK,aAAa;AAC7C,YAAM,MAAM;AAEZ,UAAI,CAAC,OAAO,QAAQ;AAChB,cAAM,OAAO;AAAA;AAAA;AAAA,yBAGA,GAAG,qBAAqB;AAAA,6BACpB,GAAG,yBAAyB;AAAA;AAAA,aAE5C;AACD;AAAA,MACJ;AAEA,aAAO,QAAQ,WAAS;AACpB,cAAM,UAAU,MAAM,eAAe,SAAS,MAAM,aAAa,MAAM,GAAG,EAAE,EAAE,IAAI;AAClF,cAAM,cAAc,MAAM,WAAW,cAAc,UAC/C,WAAW,IAAI,oBACf,WAAW,IAAI,yBAAyB;AAC5C,cAAM,YAAY,MAAM,WAAW,cAAc,aAAa,WAAW,MAAM,eAAe;AAE9F,cAAM,OAAO;AAAA,yCACgB,eAAe,KAAK,mBAAmB,MAAM,OAAO,aAAa;AAAA,mCACvE,MAAM;AAAA;AAAA;AAAA,mCAGN,GAAG,OAAO,KAAK,MAAM,eAAe;AAAA;AAAA,iDAEtB,MAAM;AAAA,0BAC7B,MAAM,eAAe,yBAAyB,MAAM,qBAAqB;AAAA;AAAA;AAAA,kDAGjD;AAAA,mDACC,GAAG,UAAU,MAAM,MAAM,oBAAoB,GAAG,OAAO;AAAA;AAAA;AAAA,aAG7F;AAAA,MACL,CAAC;AACD,cAAQ,IAAI,yBAAyB,MAAM,KAAK,aAAa,EAAE,MAAM;AAAA,IACzE;AAAA,IAEA,cAAc,YAAY;AACtB,UAAI,CAAC,KAAK;AAAY;AACtB,YAAM,iBAAiB,aACnB,KAAK,WAAW;AAAA,QAAO,WACnB,MAAM,WAAW,YAAY,EAAE,SAAS,UAAU,KAClD,MAAM,iBAAiB,SAAS,EAAE,SAAS,UAAU,KACrD,MAAM,OAAO,YAAY,EAAE,SAAS,UAAU;AAAA,MAClD,IAAI,KAAK;AACb,cAAQ,IAAI,oBAAoB,cAAc;AAC9C,WAAK,cAAc,cAAc;AAAA,IACrC;AAAA,IAEA,cAAc;AACV,YAAM,KAAK;AAEX,WAAK,QAAQ,GAAG,SAAS,uBAAuB,OAAO,MAAM,SAAS,WAAW;AAC7E,cAAM,aAAa,EAAE,IAAI,EAAE,IAAI,EAAE,YAAY,EAAE,KAAK;AACpD,WAAG,cAAc,UAAU;AAAA,MAC/B,GAAG,GAAG,CAAC;AAEP,WAAK,QAAQ,GAAG,SAAS,eAAe,WAAW;AAC/C,WAAG,QAAQ,KAAK,aAAa,EAAE,YAAY,UAAU;AACrD,UAAE,IAAI,EAAE,SAAS,UAAU;AAC3B,WAAG,iBAAiB,EAAE,IAAI,EAAE,KAAK,OAAO;AACxC,WAAG,QAAQ,KAAK,cAAc,EAAE,KAAK,YAAY,KAAK;AAAA,MAC1D,CAAC;AAED,WAAK,QAAQ,GAAG,WAAW,eAAe,SAAS,GAAG;AAClD,YAAI,EAAE,QAAQ,WAAW,EAAE,QAAQ,KAAK;AACpC,YAAE,eAAe;AACjB,YAAE,IAAI,EAAE,MAAM;AAAA,QAClB;AAAA,MACJ,CAAC;AAED,WAAK,QAAQ,GAAG,SAAS,gBAAgB,WAAW;AA5c5D;AA6cY,YAAI,GAAG,gBAAgB;AACnB,yBAAG,QAAO,mBAAV,4BAA2B,GAAG;AAAA,QAClC;AAAA,MACJ,CAAC;AAED,WAAK,QAAQ,GAAG,SAAS,mBAAmB,WAAW;AAld/D;AAmdY,uBAAG,QAAO,wBAAV;AAAA,MACJ,CAAC;AAAA,IACL;AAAA,IAEA,qBAAqB;AACjB,aAAO,KAAK;AAAA,IAChB;AAAA,IAEA,iBAAiB,MAAM;AACnB,UAAI,MAAM;AACN,aAAK,QAAQ,KAAK;AAAA,MACtB,OAAO;AACH,aAAK,QAAQ,KAAK;AAAA,MACtB;AAAA,IACJ;AAAA,EACJ;",
  "names": ["onScan", "max_width", "precision", "onScan", "max_width", "item", "$btn", "_a", "doctype", "docname", "print_format", "letterhead", "lang_code", "max_width"]
}
